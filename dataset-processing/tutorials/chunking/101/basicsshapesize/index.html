<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Basics of Chunk Shape and Size - HyTEST Project</title><meta property="og:title" content="Basics of Chunk Shape and Size - HyTEST Project"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/hytest//build/_assets/app-SDGCW62C.css"/><link rel="stylesheet" href="/hytest//build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hytest//favicon.ico"/><link rel="stylesheet" href="/hytest//myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hytest//"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="HyTEST Project" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hytest//">HyTEST Project</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Environment Set-Up" class="block break-words rounded py-2 grow cursor-pointer">Environment Set-Up</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Getting Started" class="block break-words rounded py-2 grow cursor-pointer">Getting Started</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Access" class="block break-words rounded py-2 grow cursor-pointer">Dataset Access</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Zarr Creation" class="block break-words rounded py-2 grow cursor-pointer">Zarr Creation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Processing" class="block break-words rounded py-2 grow cursor-pointer">Dataset Processing</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Model Evaluation" class="block break-words rounded py-2 grow cursor-pointer">Model Evaluation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Back Matter" class="block break-words rounded py-2 grow cursor-pointer">Back Matter</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/hytest-org/hytest" title="GitHub Repository: hytest-org/hytest" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Basics of Chunk Shape and Size</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="mSSN99OnVq" class="myst-jp-nb-block relative group/block"><p>The goal of this notebook is to learn the basics about chunk shape and size.
We will discuss several factors to think about when deciding on chunk shape and size for datasets being written to storage.
These factors can affect the read pattern from storage and subsequently the computations.</p></div><div id="F4EaJs2ntY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import xarray as xr
import fsspec</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xtRCCGj_UueZZAj3Fv-AD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qkvB8EtqHv" class="myst-jp-nb-block relative group/block"><h2 id="accessing-the-example-dataset" class="relative group"><span class="heading-text">Accessing the Example Dataset</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#accessing-the-example-dataset" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this notebook, we will use the monthly PRISM v2 dataset as an example for understanding the effects of chunk shape and size.
Let’s go ahead and read in the file using xarray.
To do this, we will use <a target="_blank" rel="noreferrer" href="https://filesystem-spec.readthedocs.io/en/latest/" class="">fsspec</a> to get a mapper to the Zarr file on the HyTEST OSN.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>The xarray loader is “lazy”, meaning it will read just enough of the data to make decisions about its shape, structure, etc.
It will pretend like the whole dataset is in memory (and we can treat it that way), but it will only load data as required.</p></div></aside></div><div id="paa8YnVvWH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fs = fsspec.filesystem(
    &#x27;s3&#x27;,
    anon=True,   # anonymous = does not require credentials
    client_kwargs={&#x27;endpoint_url&#x27;: &#x27;https://usgs.osn.mghpcc.org/&#x27;}
)
ds = xr.open_dataset(
    fs.get_mapper(&#x27;s3://mdmf/gdp/PRISM_v2.zarr/&#x27;),
    engine=&#x27;zarr&#x27;
)
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-xTCav4SyiHck9xFkZNdx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FvJu3y7WC9" class="myst-jp-nb-block relative group/block"><h2 id="chunk-shape-and-size" class="relative group"><span class="heading-text">Chunk Shape and Size</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#chunk-shape-and-size" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Given what we know about this data, we can apply some storage principles to form a strategy for how best to chunk the data if we were to write it to storage (assuming it isn’t already).
Broadly, we need to specify chunk shape and size.</p><h3 id="shape-considerations" class="relative group"><span class="heading-text">Shape Considerations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#shape-considerations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>“<span data-state="closed"><a class="hover-link" href="/hytest//dataset-processing/tutorials/chunking/back/glossary"><strong>Chunk shape</strong></a></span>” is the shape of a chunk, which specifies the number of elements in each dimension.
So, we will need to decide on the size of each of the dimensions of the chunks.
The preferred shape of each chunk will depend on the read pattern for future analyses.
Our goal is to chunk the data so that future reads will be performant, and that depends on whether the analyses favor one dimension or another.
For some datasets, this will be very apparent.
For example, streamflow gage data is very likely to be consumed along the <code>time</code> dimension.
So, a collection of data from multiple gages is <em>more likely</em> to have the individual time series analyzed as opposed to analyzing all gages at a given time.
Therefore, we would want a chunk shape that is larger along the time dimension.
For datasets where there is no clear preference, we can try to chunk based on likely read patterns, but allow for other patterns without too much of a performance penalty.</p><p>Let’s see how we might do this for our example dataset.
Being this dataset spans space and time, it will likely be used in one of two dominant read patterns:</p><ul><li><p>Time series for a given location (or small spatial extent)</p><ul><li><p>Special case: Is it likely that the time series will be subset by a logical unit (e.g., will this monthly data be consumed in blocks of 12 (i.e., yearly))?</p></li></ul></li><li><p>Full spatial extent for a given point in time.</p><ul><li><p>Special case: Are specific spatial regions more used than others?</p></li></ul></li></ul><p>Let’s look at a couple of options for space and time chunking:</p></div><div id="CWAetY4iQ6" class="myst-jp-nb-block relative group/block"><h4 id="time-dimension" class="relative group"><span class="heading-text">Time Dimension</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#time-dimension" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>As we can see above, the example dataset has 1555 monthly time steps.
How many chunks would we have if we chunked in groups of twelve (i.e., a year at a time)?</p></div><div id="l3JItfkE4X" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(f&quot;Number of chunks: {len(ds.time) / 12:0.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xjkP9HDaK7-42uzU4a1Kt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zufqEW0tQM" class="myst-jp-nb-block relative group/block"><p>In this case, a user could get a single year of monthly data as a single chunk.
It is important to note that we have just over a round number of chunks. Having <code>129.58</code> time chunks means we will have 130 chunks in practice, but the last one is not full-sized. The last chunk would be a <span data-state="closed"><a class="hover-link" href="/hytest//dataset-processing/tutorials/chunking/back/glossary">“<strong>partial chunk</strong>”</a></span> because we do not have a full year of data for 2024.</p><p>So this is where the judgement call gets made: Which is the more likely read pattern for time: year-by-year, or the whole time series (or some sequence of a few years)?
For PRISM, it is more likely that someone will want more than just one year of data.
A happy medium for chunk shape along the time dimension could be 6 years of data per chunk.</p></div><div id="HnaFIF4Msk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">time_chunk_shape = 12 * 6
print(f&quot;Number of chunks: {len(ds.time) / time_chunk_shape:0.2f}; Chunk of shape: {time_chunk_shape}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hYn6sFCGSn8DV7xlICT-c" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="F4WH2fxvaN" class="myst-jp-nb-block relative group/block"><p>This pattern means only 22 chunks (instead of the 126 chunks we were considering a moment ago) are needed for a full time series in a given location.</p></div><div id="mg2uy8bEr6" class="myst-jp-nb-block relative group/block"><h4 id="spatial-dimension" class="relative group"><span class="heading-text">Spatial Dimension</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-dimension" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>As we can see in our example dataset, it technically contains two spatial dimensions: <code>lat</code> and <code>lon</code>.
So, we’re really chunking both of these dimensions when we talk about chunking with respect to space.
While we will consider them both together here, it is important to point out that they can have separate chunk shapes.
This leads to the the question of whether future users of this data will want strips of latitude or longitude, square “tiles” in space, or some proportionally-sized tiles of latitude and longitude?
That is, is it important that the North-South extent be broken into the same number of chunks as the East-West extent?
Let’s start by chunking this into square tiles.
Being that there are more <code>lon</code> elements than <code>lat</code> elements, this means there will be more <code>lon</code> chunks than <code>lat</code> chunks.</p></div><div id="ws3sul5dqY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">nlon = len(ds.lon)
nlat = len(ds.lat)
space_chunk_size = nlat // 4 # split the smaller of the two dimensions into 4 chunks
print(f&quot;Number of &#x27;lon&#x27; chunks: {nlon / space_chunk_size:0.3f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}&quot;)
print(f&quot;Number of &#x27;lat&#x27; chunks: {nlat / space_chunk_size:0.3f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0UeeB4vjasJeMpLnyE9-S" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kZ8iffRv0I" class="myst-jp-nb-block relative group/block"><p>Having <code>9.06</code> longitude chunks means we will have 10 chunks in practice, but that last one is not full-sized.
In this case, this means that the last chunk in the given dimension will be extremely thin.</p><p>In the case of the latitude chunks, the extra <code>0.006</code> of a chunk means that the last, fractional chunk (or <span data-state="closed"><a class="hover-link" href="/hytest//dataset-processing/tutorials/chunking/back/glossary">“<strong>partial chunk</strong>”</a></span>) is only one <code>lat</code> observation.</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>Ideally, we would want partial chunks to be at least half the size of the standard chunk.
The bigger that “remainder” fraction, the better.</p></div></aside><p>Let’s adjust the chunk shape a little so that we don’t have that sliver.
We’re still committed to square tiles, so let’s try a larger chunk shape to change the size of that last fraction.
Increasing the chunk size a little should get us bigger “remainders”.</p></div><div id="B1WEPYfhjE" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">space_chunk_size = 157
print(f&quot;Number of &#x27;lon&#x27; chunks: {nlon / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}&quot;)
print(f&quot;Number of &#x27;lat&#x27; chunks: {nlat / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="kqLqizGM01cQ-R_06jzJ9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CGUbcsf7sZ" class="myst-jp-nb-block relative group/block"><p>With this pattern, the “remainder” latitude chunk will have a shape of 150 in the <code>lat</code> dimension, and the “remainder” longitude chunk will have a shape of 149 in the <code>lon</code> dimension.
All others will be a square 157 observations in both dimensions.
This amounts to a 9x4 chunk grid, with the last chunk in each dimension being partial.</p><p>The entire spatial extent for a single time step can be read in 36 chunks with this chunk shape.
That seems a little high, given that this dataset will likely be taken at full spatial extent for a typical analysis.
Let’s go a little bigger to see what that gets us:</p></div><div id="eiy1rpBQLr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">space_chunk_size = 354 # 157 * 2
print(f&quot;Number of &#x27;lon&#x27; chunks: {nlon / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}&quot;)
print(f&quot;Number of &#x27;lat&#x27; chunks: {nlat / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="aFAr-meZe_0LikjMgsFXD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="R0pyvPRFQy" class="myst-jp-nb-block relative group/block"><p>This is just as good in terms of full-chunk remainders, and the whole extent can be read in with only 8 chunks.
The smallest remainder is still &gt;75% of a full-sized square tile, which is acceptable.</p></div><div id="AXC0erOihQ" class="myst-jp-nb-block relative group/block"><p>Alternatively, we could stop being committed to square tiles and try and split the spatial regions more evenly.
For example, we could get as close to a 4x2 split as possible:</p></div><div id="o2JUjU05Nw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add one to do a ceil divide
lon_space_chunk_size = nlon // 4 + 1
lat_space_chunk_size = nlat // 2 + 1
print(f&quot;Number of &#x27;lon&#x27; chunks: {nlon / lon_space_chunk_size:0.3f}; Chunk of shape {lon_space_chunk_size}; Size of last chunk: {nlon % lon_space_chunk_size}&quot;)
print(f&quot;Number of &#x27;lat&#x27; chunks: {nlat / lat_space_chunk_size:0.3f}; Chunk of shape {lat_space_chunk_size}; Size of last chunk: {nlat % lat_space_chunk_size}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="LhEYyn9A6V4UH723OV2U_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Dzu4LGGWQb" class="myst-jp-nb-block relative group/block"><p>Or we could aim for a 3x3 split:</p></div><div id="Vgz92lbqdP" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add one to do a ceil divide
lon_space_chunk_size = nlon // 3 + 1
lat_space_chunk_size = nlat // 3 + 1
print(f&quot;Number of &#x27;lon&#x27; chunks: {nlon / lon_space_chunk_size:0.3f}; Chunk of shape {lon_space_chunk_size}; Size of last chunk: {nlon % lon_space_chunk_size}&quot;)
print(f&quot;Number of &#x27;lat&#x27; chunks: {nlat / lat_space_chunk_size:0.3f}; Chunk of shape {lat_space_chunk_size}; Size of last chunk: {nlat % lat_space_chunk_size}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0gwhts4MpELLefDHDYZ1I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="y8kiYLx893" class="myst-jp-nb-block relative group/block"><p>As you might be getting, the chunking proportion between latitude and longitude is not super important.
What is important for basic chunk shape is the total number of chunks between the two and the minimization of the remainder in the final chunk of each dimension.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>If we were really confident that most analyses wanted the full extent, we might be better off to just put the whole lat/lon dimensions into single chunks each.
This would ensure (and require) that we read the entire spatial extent.
However, our poor time-series analysis would then be stuck reading the entire dataset to get all time values for a single location.</p></div></aside></div><div id="Y8PE7aR4r6" class="myst-jp-nb-block relative group/block"><h3 id="size-considerations" class="relative group"><span class="heading-text">Size Considerations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#size-considerations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Shape is only part of the equation.
Total “<span data-state="closed"><a class="hover-link" href="/hytest//dataset-processing/tutorials/chunking/back/glossary"><strong>chunk size</strong></a></span>” also matters.
Size considerations come into play mostly as a consideration of how the chunks are stored on disk.
The retrieval time is influenced by the size of each chunk.
Here are some constraints:</p><ul><li><p>Files Too Big:
In a Zarr dataset, each <strong>chunk</strong> is stored as a separate binary file (and the entire zarr dataset is a directory grouping these many “chunk” files).
If we need data from a particular chunk, no matter how little or how much, that file gets opened, decompressed, and the whole thing read into memory.
A large chunk size means that there may be a lot of data transferred in situations when only a small subset of that chunk’s data is actually needed.
It also means there might not be enough chunks to allow the dask workers to stay busy loading data in parallel.</p></li><li><p>Files Too Small:
If the chunk size is too small, the time it takes to read and decompress the data for each chunk can become comparable to the latency of S3 (typically 10-100ms).
We want the reads to take at least a second or so, so that the latency is not a significant part of the overall timing.</p></li></ul><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>As a general rule, aim for chunk sizes between 10 and 200 MB, depending on shape and expected read pattern of a user.</p></div></aside><h4 id="total-chunk-size" class="relative group"><span class="heading-text">Total Chunk Size</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#total-chunk-size" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>To esimate the total chunk size, all we need is the expected chunk shape and data type to know how many bytes a value takes up.
As an example, let’s use a chunk shape of <code>{&#x27;time&#x27;: 72, &#x27;lat&#x27;: 354, &#x27;lon&#x27;: 354}</code>
This will tell us if we’ve hit our target of between 10 and 200 MB per chunk.</p></div><div id="ahzW0jtELt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">chunks = {&#x27;time&#x27;: 72, &#x27;lat&#x27;: 354, &#x27;lon&#x27;: 354}
bytes_per_value = ds.tmn.dtype.itemsize
total_bytes = chunks[&#x27;time&#x27;] * chunks[&#x27;lat&#x27;] * chunks[&#x27;lon&#x27;] * bytes_per_value
kiB = total_bytes / (2 ** 10)
MiB = kiB / (2 ** 10)
print(f&quot;TMN chunk size: {total_bytes} ({kiB=:.2f}) ({MiB=:.2f})&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OmAek0DmR0Ssh-c-pGFLG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="QvYxhXI8YG" class="myst-jp-nb-block relative group/block"><p>We’re looking really good for size: about 69 MiB.
This maybe even a bit low.
But we’re in the (admittedly broad) range of 10-200 MiB of uncompressed data (i.e., in-memory) per chunk.
Therefore, this seems like it would be a reasonable chunk shape and size for our dataset.
If we were curious about other chunk shapes, like a non-square <code>lat</code> and <code>lon</code> chunk, we could repeat this computation to estimate its size and determine if it is reasonable.
However, we aren’t going to do that here, but it is something you could try on your own if you are curious.</p></div><div id="S80tZt4096" class="myst-jp-nb-block relative group/block"><h2 id="review-and-final-considerations" class="relative group"><span class="heading-text">Review and Final Considerations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#review-and-final-considerations" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Now that you have a general idea on how to pick chunk shape and size, let’s review and add a few final considerations.</p><h3 id="basic-chunking-recommendations" class="relative group"><span class="heading-text">Basic Chunking Recommendations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#basic-chunking-recommendations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>When determining the basic chunk shape and size, the choice will depend on the future read pattern and analysis.
If this pattern is unknown, then it is important to take a balanced chunking approach that does not favor one dimension over the others (i.e., larger overall shape in a given dimension).
Next, choosing a chunk shape should try to prevent partial chunks if possible.
Otherwise, partial chunks should be at least half the size of the standard chunk.
Finally, the total chunk size should be between 10 and 200 MiB for optimal performance.</p><h3 id="final-considerations" class="relative group"><span class="heading-text">Final Considerations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#final-considerations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>One final thing to consider is that these basic recommendations assume that your chunked data will be static and not updated.
However, some datasets, especially climate related ones, are periodically updated in their time dimension.
These datasets are commonly updated at regular intervals (e.g., every year with the previous years data).
This can change the choice of chunk shape such that adding the next year’s worth of data does not require rechunking the whole data set or result in small partial chunks.
For our PRISM example, if we chose a temporal chunk shape of length 72 (i.e., six years per chunk), adding a year worth of data would require appending the partial chunk until it becomes full.
Then, further new data would require starting a new partial chunk.
This could be prevented if we chose a chunk size of 12 (i.e., one year per chunk).
Then, additional data would only require making new chunks versus editing existing chunks.
Therefore, considering updates to the dataset when deciding the chunking plan can save a lot of time when appending the dataset in the future.</p><p>Additionally, all of the information provided here does not discuss proper optimization of chunk shape and size.
Proper optimization would attempt to select chunk sizes that are near powers of two (i.e., <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span>) to facilitate optimal storage and disk retrieval.
Details on this topic can be found in the advanced topic notebook of <a class="" href="/hytest//dataset-processing/tutorials/chunking/201/optimalchunkselection">Choosing an Optimal Chunk Size and Shape</a>.</p></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/hytest//dataset-processing/tutorials/chunking/101/examinedatachunking"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>How to Examine a Stored Dataset’s Chunk Shape</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hytest//dataset-processing/tutorials/chunking/101/writechunkedfiles"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>Writing Chunked Files</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hytest//build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-N76G4W6Y.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hytest//build/root-AA24SA6C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AH7OE64W.js"/><link rel="modulepreload" href="/hytest//build/routes/$-5SFLQWPV.js"/><script>window.__remixContext = {"url":"/dataset-processing/tutorials/chunking/101/basicsshapesize","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hytest/"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"df62576c49f4e819a25c8b37c3a0247670865e6f4ae11e92f6c60701cf8213e2","slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","location":"/dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb","dependencies":[],"frontmatter":{"title":"Basics of Chunk Shape and Size","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb","exports":[{"format":"ipynb","filename":"BasicsShapeSize.ipynb","url":"/hytest//build/BasicsShapeSize-301235fb743ea9cef1d71bd805123d28.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The goal of this notebook is to learn the basics about chunk shape and size.\nWe will discuss several factors to think about when deciding on chunk shape and size for datasets being written to storage.\nThese factors can affect the read pattern from storage and subsequently the computations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YRl77lGI5A"}],"key":"c11fPWpO2O"}],"visibility":"show","key":"mSSN99OnVq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport fsspec","key":"jHdvmAI7Kr"},{"type":"outputs","id":"xtRCCGj_UueZZAj3Fv-AD","children":[],"key":"WSKk6mTUTy"}],"key":"F4EaJs2ntY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accessing the Example Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cOqpiixNBj"}],"identifier":"accessing-the-example-dataset","label":"Accessing the Example Dataset","html_id":"accessing-the-example-dataset","implicit":true,"key":"D1v9DSKhNs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In this notebook, we will use the monthly PRISM v2 dataset as an example for understanding the effects of chunk shape and size.\nLet’s go ahead and read in the file using xarray.\nTo do this, we will use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ow4aIMdYbr"},{"type":"link","url":"https://filesystem-spec.readthedocs.io/en/latest/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VTCCo7PV2m"}],"urlSource":"https://filesystem-spec.readthedocs.io/en/latest/","key":"siI8XgVmNw"},{"type":"text","value":" to get a mapper to the Zarr file on the HyTEST OSN.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PgtcQi28wB"}],"key":"dwal0Sgect"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"q4EMJTW5Q1"}],"key":"o0FyOeI9UH"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The xarray loader is “lazy”, meaning it will read just enough of the data to make decisions about its shape, structure, etc.\nIt will pretend like the whole dataset is in memory (and we can treat it that way), but it will only load data as required.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"qVBHTB2tkA"}],"key":"BhTCXOiXat"}],"key":"aFiM3oKDIN"}],"key":"qkvB8EtqHv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fs = fsspec.filesystem(\n    's3',\n    anon=True,   # anonymous = does not require credentials\n    client_kwargs={'endpoint_url': 'https://usgs.osn.mghpcc.org/'}\n)\nds = xr.open_dataset(\n    fs.get_mapper('s3://mdmf/gdp/PRISM_v2.zarr/'),\n    engine='zarr'\n)\nds","key":"TISPALBf3r"},{"type":"outputs","id":"-xTCav4SyiHck9xFkZNdx","children":[],"key":"GDNK5feCIT"}],"key":"paa8YnVvWH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chunk Shape and Size","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xEuslAQgjB"}],"identifier":"chunk-shape-and-size","label":"Chunk Shape and Size","html_id":"chunk-shape-and-size","implicit":true,"key":"O2rJvxWvPB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Given what we know about this data, we can apply some storage principles to form a strategy for how best to chunk the data if we were to write it to storage (assuming it isn’t already).\nBroadly, we need to specify chunk shape and size.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UHGvA1VD3w"}],"key":"K7xPXW7iPF"},{"type":"heading","depth":3,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Shape Considerations","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"suLgAydF3f"}],"identifier":"shape-considerations","label":"Shape Considerations","html_id":"shape-considerations","implicit":true,"key":"smP0CL1Ljx"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"“","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"UccX6siMKW"},{"type":"crossReference","url":"/dataset-processing/tutorials/chunking/back/glossary","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Chunk shape","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"WUM9BAdmtw"}],"key":"tTPIFE9Hgo"}],"urlSource":"../back/Glossary.md#term-Chunk-shape","dataUrl":"/dataset-processing.tutorials.chunking.back.glossary.json","identifier":"term-chunk-shape","label":"term-Chunk-shape","remote":true,"protocol":"file","key":"AtY5ZWjiZp"},{"type":"text","value":"” is the shape of a chunk, which specifies the number of elements in each dimension.\nSo, we will need to decide on the size of each of the dimensions of the chunks.\nThe preferred shape of each chunk will depend on the read pattern for future analyses.\nOur goal is to chunk the data so that future reads will be performant, and that depends on whether the analyses favor one dimension or another.\nFor some datasets, this will be very apparent.\nFor example, streamflow gage data is very likely to be consumed along the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"eZgjnYp4Pn"},{"type":"inlineCode","value":"time","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"mZCCPf4CWx"},{"type":"text","value":" dimension.\nSo, a collection of data from multiple gages is ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wPLa9LN3Nv"},{"type":"emphasis","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"more likely","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"up4Stjt48Q"}],"key":"SjIExz14xU"},{"type":"text","value":" to have the individual time series analyzed as opposed to analyzing all gages at a given time.\nTherefore, we would want a chunk shape that is larger along the time dimension.\nFor datasets where there is no clear preference, we can try to chunk based on likely read patterns, but allow for other patterns without too much of a performance penalty.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"io3FEsApIo"}],"key":"sIlaaci34q"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Let’s see how we might do this for our example dataset.\nBeing this dataset spans space and time, it will likely be used in one of two dominant read patterns:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"eup5CJtBtD"}],"key":"M75wFRKq4a"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Time series for a given location (or small spatial extent)","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"inVfPVLrlk"}],"key":"EKvx1aBYtN"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Special case: Is it likely that the time series will be subset by a logical unit (e.g., will this monthly data be consumed in blocks of 12 (i.e., yearly))?","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"MF1gGYzXvh"}],"key":"UMImFpIuhS"}],"key":"ZtnxC8Fzn6"}],"key":"B4xmgUGnUy"}],"key":"KkmZkXIk15"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Full spatial extent for a given point in time.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"acK2G9x57J"}],"key":"ciNp9wZnKl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Special case: Are specific spatial regions more used than others?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"gCrdZuEdnY"}],"key":"Tci5iosY5z"}],"key":"RYMnzSRiQT"}],"key":"UTrja4M7jP"}],"key":"BFBMhsxpSE"}],"key":"mZMGWrj8Fk"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Let’s look at a couple of options for space and time chunking:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Va1MsqA5Ul"}],"key":"ghqNtNRoyS"}],"key":"FvJu3y7WC9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Time Dimension","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HtGdeZ1Aol"}],"identifier":"time-dimension","label":"Time Dimension","html_id":"time-dimension","implicit":true,"key":"fWPncGrpOF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"As we can see above, the example dataset has 1555 monthly time steps.\nHow many chunks would we have if we chunked in groups of twelve (i.e., a year at a time)?","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i6PjRQEhJP"}],"key":"sIuNBoJnL5"}],"key":"CWAetY4iQ6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"Number of chunks: {len(ds.time) / 12:0.2f}\")","key":"onC3n80Hx1"},{"type":"outputs","id":"xjkP9HDaK7-42uzU4a1Kt","children":[],"key":"jr6KFtj8om"}],"key":"l3JItfkE4X"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this case, a user could get a single year of monthly data as a single chunk.\nIt is important to note that we have just over a round number of chunks. Having ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QQCVjYEwnF"},{"type":"inlineCode","value":"129.58","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SnlU2To92r"},{"type":"text","value":" time chunks means we will have 130 chunks in practice, but the last one is not full-sized. The last chunk would be a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XfR7j3F2g3"},{"type":"crossReference","url":"/dataset-processing/tutorials/chunking/back/glossary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"“","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hdiyAQRViN"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"partial chunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HhccVv3rDb"}],"key":"rVYjXlr3R0"},{"type":"text","value":"”","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QCyhJFpqZz"}],"urlSource":"../back/Glossary.md#term-Partial-Chunk","dataUrl":"/dataset-processing.tutorials.chunking.back.glossary.json","identifier":"term-partial-chunk","label":"term-Partial-Chunk","remote":true,"protocol":"file","key":"hHeL6gXZQb"},{"type":"text","value":" because we do not have a full year of data for 2024.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YCVcrniiM1"}],"key":"b6cQ0aMCsl"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"So this is where the judgement call gets made: Which is the more likely read pattern for time: year-by-year, or the whole time series (or some sequence of a few years)?\nFor PRISM, it is more likely that someone will want more than just one year of data.\nA happy medium for chunk shape along the time dimension could be 6 years of data per chunk.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sb5ywEuvBk"}],"key":"UttBo11fyT"}],"key":"zufqEW0tQM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"time_chunk_shape = 12 * 6\nprint(f\"Number of chunks: {len(ds.time) / time_chunk_shape:0.2f}; Chunk of shape: {time_chunk_shape}\")","key":"HLFHD2eRqW"},{"type":"outputs","id":"hYn6sFCGSn8DV7xlICT-c","children":[],"key":"T8onca6cHM"}],"key":"HnaFIF4Msk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This pattern means only 22 chunks (instead of the 126 chunks we were considering a moment ago) are needed for a full time series in a given location.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zT9KrZefXy"}],"key":"kllU5G18E4"}],"key":"F4WH2fxvaN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial Dimension","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NsJiHs9vzU"}],"identifier":"spatial-dimension","label":"Spatial Dimension","html_id":"spatial-dimension","implicit":true,"key":"ocs0VE43sR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"As we can see in our example dataset, it technically contains two spatial dimensions: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tbZyggFEnX"},{"type":"inlineCode","value":"lat","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hUCBxOWNUo"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"d4glUMk2R7"},{"type":"inlineCode","value":"lon","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LyCZ0oerU1"},{"type":"text","value":".\nSo, we’re really chunking both of these dimensions when we talk about chunking with respect to space.\nWhile we will consider them both together here, it is important to point out that they can have separate chunk shapes.\nThis leads to the the question of whether future users of this data will want strips of latitude or longitude, square “tiles” in space, or some proportionally-sized tiles of latitude and longitude?\nThat is, is it important that the North-South extent be broken into the same number of chunks as the East-West extent?\nLet’s start by chunking this into square tiles.\nBeing that there are more ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Aq2NJJwrzr"},{"type":"inlineCode","value":"lon","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xGOKOqGzWK"},{"type":"text","value":" elements than ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nqvbbLZWkH"},{"type":"inlineCode","value":"lat","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lslb4FAvkv"},{"type":"text","value":" elements, this means there will be more ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cp2mccq7g9"},{"type":"inlineCode","value":"lon","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zCFWKjBtZM"},{"type":"text","value":" chunks than ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DN7pputbrp"},{"type":"inlineCode","value":"lat","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eDCVjJGbgo"},{"type":"text","value":" chunks.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YnjrobeVhg"}],"key":"EsDMnW9dCQ"}],"key":"mg2uy8bEr6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nlon = len(ds.lon)\nnlat = len(ds.lat)\nspace_chunk_size = nlat // 4 # split the smaller of the two dimensions into 4 chunks\nprint(f\"Number of 'lon' chunks: {nlon / space_chunk_size:0.3f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}\")\nprint(f\"Number of 'lat' chunks: {nlat / space_chunk_size:0.3f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}\")","key":"l7wKNlQgzb"},{"type":"outputs","id":"0UeeB4vjasJeMpLnyE9-S","children":[],"key":"pq7bWeAgM4"}],"key":"ws3sul5dqY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Having ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fEwTbI8igL"},{"type":"inlineCode","value":"9.06","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zPM7io2Nl2"},{"type":"text","value":" longitude chunks means we will have 10 chunks in practice, but that last one is not full-sized.\nIn this case, this means that the last chunk in the given dimension will be extremely thin.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PAEymtixYA"}],"key":"ZRnv9SiXnh"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In the case of the latitude chunks, the extra ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"k2n7jH2LIk"},{"type":"inlineCode","value":"0.006","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"N0mBA1ui5A"},{"type":"text","value":" of a chunk means that the last, fractional chunk (or ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gCZptaXM8L"},{"type":"crossReference","url":"/dataset-processing/tutorials/chunking/back/glossary","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"“","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TekRgd7Oj9"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"partial chunk","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tJfWc9sahy"}],"key":"CQyF4p3sMC"},{"type":"text","value":"”","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TCB13Gu3bf"}],"urlSource":"../back/Glossary.md#term-Partial-Chunk","dataUrl":"/dataset-processing.tutorials.chunking.back.glossary.json","identifier":"term-partial-chunk","label":"term-Partial-Chunk","remote":true,"protocol":"file","key":"aH21OWGqrJ"},{"type":"text","value":") is only one ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Opu5HdOzgK"},{"type":"inlineCode","value":"lat","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ldKpVaWwNk"},{"type":"text","value":" observation.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DkpIa8b7WN"}],"key":"PmmEa3KqvM"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"O0J1Uvuyst"}],"key":"MXPfP37NhZ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Ideally, we would want partial chunks to be at least half the size of the standard chunk.\nThe bigger that “remainder” fraction, the better.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"G8O6r3H1CY"}],"key":"HHwa7nLc8u"}],"key":"Ll8EgZhZps"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Let’s adjust the chunk shape a little so that we don’t have that sliver.\nWe’re still committed to square tiles, so let’s try a larger chunk shape to change the size of that last fraction.\nIncreasing the chunk size a little should get us bigger “remainders”.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"bwwlRGQ3oP"}],"key":"G2mxWsX877"}],"key":"kZ8iffRv0I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"space_chunk_size = 157\nprint(f\"Number of 'lon' chunks: {nlon / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}\")\nprint(f\"Number of 'lat' chunks: {nlat / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}\")","key":"mdIctUoegl"},{"type":"outputs","id":"kqLqizGM01cQ-R_06jzJ9","children":[],"key":"WiCg4Uu4PK"}],"key":"B1WEPYfhjE"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With this pattern, the “remainder” latitude chunk will have a shape of 150 in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XoadxYpcU4"},{"type":"inlineCode","value":"lat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VpFVI100fn"},{"type":"text","value":" dimension, and the “remainder” longitude chunk will have a shape of 149 in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i7KTlIdDb5"},{"type":"inlineCode","value":"lon","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TEkHneGQ64"},{"type":"text","value":" dimension.\nAll others will be a square 157 observations in both dimensions.\nThis amounts to a 9x4 chunk grid, with the last chunk in each dimension being partial.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BEF5kVIcQP"}],"key":"O8FBbTkZng"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The entire spatial extent for a single time step can be read in 36 chunks with this chunk shape.\nThat seems a little high, given that this dataset will likely be taken at full spatial extent for a typical analysis.\nLet’s go a little bigger to see what that gets us:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jux85pCR2y"}],"key":"sOJ9huK09F"}],"key":"CGUbcsf7sZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"space_chunk_size = 354 # 157 * 2\nprint(f\"Number of 'lon' chunks: {nlon / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlon % space_chunk_size}\")\nprint(f\"Number of 'lat' chunks: {nlat / space_chunk_size:0.2f}; Chunk of shape {space_chunk_size}; Size of last chunk: {nlat % space_chunk_size}\")","key":"dC1afiBCLw"},{"type":"outputs","id":"aFAr-meZe_0LikjMgsFXD","children":[],"key":"oZMfaynv4m"}],"key":"eiy1rpBQLr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This is just as good in terms of full-chunk remainders, and the whole extent can be read in with only 8 chunks.\nThe smallest remainder is still \u003e75% of a full-sized square tile, which is acceptable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DqQnqpIeqp"}],"key":"xMTSBVCYSN"}],"key":"R0pyvPRFQy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Alternatively, we could stop being committed to square tiles and try and split the spatial regions more evenly.\nFor example, we could get as close to a 4x2 split as possible:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"laWUF6GLgl"}],"key":"HuxdGwA8I2"}],"key":"AXC0erOihQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Add one to do a ceil divide\nlon_space_chunk_size = nlon // 4 + 1\nlat_space_chunk_size = nlat // 2 + 1\nprint(f\"Number of 'lon' chunks: {nlon / lon_space_chunk_size:0.3f}; Chunk of shape {lon_space_chunk_size}; Size of last chunk: {nlon % lon_space_chunk_size}\")\nprint(f\"Number of 'lat' chunks: {nlat / lat_space_chunk_size:0.3f}; Chunk of shape {lat_space_chunk_size}; Size of last chunk: {nlat % lat_space_chunk_size}\")","key":"cU791ou5Wp"},{"type":"outputs","id":"LhEYyn9A6V4UH723OV2U_","children":[],"key":"GJBOZoKMos"}],"key":"o2JUjU05Nw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Or we could aim for a 3x3 split:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VZ9Lu4t8NN"}],"key":"ZhWVTUC0sd"}],"key":"Dzu4LGGWQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Add one to do a ceil divide\nlon_space_chunk_size = nlon // 3 + 1\nlat_space_chunk_size = nlat // 3 + 1\nprint(f\"Number of 'lon' chunks: {nlon / lon_space_chunk_size:0.3f}; Chunk of shape {lon_space_chunk_size}; Size of last chunk: {nlon % lon_space_chunk_size}\")\nprint(f\"Number of 'lat' chunks: {nlat / lat_space_chunk_size:0.3f}; Chunk of shape {lat_space_chunk_size}; Size of last chunk: {nlat % lat_space_chunk_size}\")","key":"F2GKMvoLBy"},{"type":"outputs","id":"0gwhts4MpELLefDHDYZ1I","children":[],"key":"uV2lA4LaNd"}],"key":"Vgz92lbqdP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"As you might be getting, the chunking proportion between latitude and longitude is not super important.\nWhat is important for basic chunk shape is the total number of chunks between the two and the minimization of the remainder in the final chunk of each dimension.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R9IqOZ5LUi"}],"key":"PXjMkZk6aZ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"o2AuljzMSu"}],"key":"aikvefyx1z"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"If we were really confident that most analyses wanted the full extent, we might be better off to just put the whole lat/lon dimensions into single chunks each.\nThis would ensure (and require) that we read the entire spatial extent.\nHowever, our poor time-series analysis would then be stuck reading the entire dataset to get all time values for a single location.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UPS1i9W2gp"}],"key":"AK9WlQsXG9"}],"key":"tgXqbhXCq9"}],"key":"y8kiYLx893"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Size Considerations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rxtv5Itsrd"}],"identifier":"size-considerations","label":"Size Considerations","html_id":"size-considerations","implicit":true,"key":"MVfZ7D6ZDk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Shape is only part of the equation.\nTotal “","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eMZjWUQurx"},{"type":"crossReference","url":"/dataset-processing/tutorials/chunking/back/glossary","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"chunk size","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n4YFTdjRGo"}],"key":"NQtoXvJeIo"}],"urlSource":"../back/Glossary.md#term-Chunk-size","dataUrl":"/dataset-processing.tutorials.chunking.back.glossary.json","identifier":"term-chunk-size","label":"term-Chunk-size","remote":true,"protocol":"file","key":"tDZ63Y06C2"},{"type":"text","value":"” also matters.\nSize considerations come into play mostly as a consideration of how the chunks are stored on disk.\nThe retrieval time is influenced by the size of each chunk.\nHere are some constraints:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WuBKI0991S"}],"key":"oAio8Ld7JO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Files Too Big:\nIn a Zarr dataset, each ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lkGbGJoTFp"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"chunk","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"f20ZOTG4Fw"}],"key":"tdOHutArD8"},{"type":"text","value":" is stored as a separate binary file (and the entire zarr dataset is a directory grouping these many “chunk” files).\nIf we need data from a particular chunk, no matter how little or how much, that file gets opened, decompressed, and the whole thing read into memory.\nA large chunk size means that there may be a lot of data transferred in situations when only a small subset of that chunk’s data is actually needed.\nIt also means there might not be enough chunks to allow the dask workers to stay busy loading data in parallel.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GgwOMgYpWV"}],"key":"k3pnlTrv9m"}],"key":"s3l1G6DlKI"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Files Too Small:\nIf the chunk size is too small, the time it takes to read and decompress the data for each chunk can become comparable to the latency of S3 (typically 10-100ms).\nWe want the reads to take at least a second or so, so that the latency is not a significant part of the overall timing.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"YVxUdf7Ej1"}],"key":"zBF2ZLQ26K"}],"key":"bGKz0bFlgJ"}],"key":"YbVTPANBya"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"acHwNpIdsS"}],"key":"n6ru6hRmcK"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"As a general rule, aim for chunk sizes between 10 and 200 MB, depending on shape and expected read pattern of a user.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"jT6ec5wx5O"}],"key":"saYj2WyHud"}],"key":"MkM5F9cDvr"},{"type":"heading","depth":4,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Total Chunk Size","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"wiuWd44DDN"}],"identifier":"total-chunk-size","label":"Total Chunk Size","html_id":"total-chunk-size","implicit":true,"key":"jh8ukLs9Ak"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"To esimate the total chunk size, all we need is the expected chunk shape and data type to know how many bytes a value takes up.\nAs an example, let’s use a chunk shape of ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"aRhgf2ZfoV"},{"type":"inlineCode","value":"{'time': 72, 'lat': 354, 'lon': 354}","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"KqJPNHZI5l"},{"type":"text","value":"\nThis will tell us if we’ve hit our target of between 10 and 200 MB per chunk.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"iPo5vQZH9j"}],"key":"LY5jwgDBwh"}],"key":"Y8PE7aR4r6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"chunks = {'time': 72, 'lat': 354, 'lon': 354}\nbytes_per_value = ds.tmn.dtype.itemsize\ntotal_bytes = chunks['time'] * chunks['lat'] * chunks['lon'] * bytes_per_value\nkiB = total_bytes / (2 ** 10)\nMiB = kiB / (2 ** 10)\nprint(f\"TMN chunk size: {total_bytes} ({kiB=:.2f}) ({MiB=:.2f})\")","key":"BXqAjUC6Yk"},{"type":"outputs","id":"OmAek0DmR0Ssh-c-pGFLG","children":[],"key":"eleFPvjZUM"}],"key":"ahzW0jtELt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We’re looking really good for size: about 69 MiB.\nThis maybe even a bit low.\nBut we’re in the (admittedly broad) range of 10-200 MiB of uncompressed data (i.e., in-memory) per chunk.\nTherefore, this seems like it would be a reasonable chunk shape and size for our dataset.\nIf we were curious about other chunk shapes, like a non-square ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"arNZdlYjew"},{"type":"inlineCode","value":"lat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rKotu3WCkX"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NeP7oRHbs6"},{"type":"inlineCode","value":"lon","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v68AcL7b09"},{"type":"text","value":" chunk, we could repeat this computation to estimate its size and determine if it is reasonable.\nHowever, we aren’t going to do that here, but it is something you could try on your own if you are curious.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MZkZweHpwZ"}],"key":"x2lpymWCQZ"}],"key":"QvYxhXI8YG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Review and Final Considerations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IKJtamH6in"}],"identifier":"review-and-final-considerations","label":"Review and Final Considerations","html_id":"review-and-final-considerations","implicit":true,"key":"g183JF628z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now that you have a general idea on how to pick chunk shape and size, let’s review and add a few final considerations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KOl8iZduIf"}],"key":"LKjOC9363i"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Basic Chunking Recommendations","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IaWMAScZFj"}],"identifier":"basic-chunking-recommendations","label":"Basic Chunking Recommendations","html_id":"basic-chunking-recommendations","implicit":true,"key":"o3K7JkwyWO"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"When determining the basic chunk shape and size, the choice will depend on the future read pattern and analysis.\nIf this pattern is unknown, then it is important to take a balanced chunking approach that does not favor one dimension over the others (i.e., larger overall shape in a given dimension).\nNext, choosing a chunk shape should try to prevent partial chunks if possible.\nOtherwise, partial chunks should be at least half the size of the standard chunk.\nFinally, the total chunk size should be between 10 and 200 MiB for optimal performance.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IAeuxy1IGO"}],"key":"vy3VmmAw5j"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Final Considerations","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"uWoYewsHD6"}],"identifier":"final-considerations","label":"Final Considerations","html_id":"final-considerations","implicit":true,"key":"npNPWI8VR4"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"One final thing to consider is that these basic recommendations assume that your chunked data will be static and not updated.\nHowever, some datasets, especially climate related ones, are periodically updated in their time dimension.\nThese datasets are commonly updated at regular intervals (e.g., every year with the previous years data).\nThis can change the choice of chunk shape such that adding the next year’s worth of data does not require rechunking the whole data set or result in small partial chunks.\nFor our PRISM example, if we chose a temporal chunk shape of length 72 (i.e., six years per chunk), adding a year worth of data would require appending the partial chunk until it becomes full.\nThen, further new data would require starting a new partial chunk.\nThis could be prevented if we chose a chunk size of 12 (i.e., one year per chunk).\nThen, additional data would only require making new chunks versus editing existing chunks.\nTherefore, considering updates to the dataset when deciding the chunking plan can save a lot of time when appending the dataset in the future.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"MqUXxvUuwS"}],"key":"K8CJXqjDU8"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Additionally, all of the information provided here does not discuss proper optimization of chunk shape and size.\nProper optimization would attempt to select chunk sizes that are near powers of two (i.e., ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"E1tbCZfi6D"},{"type":"inlineMath","value":"2^N","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmn\u003e2\u003c/mn\u003e\u003cmi\u003eN\u003c/mi\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e2^N\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8413em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e2\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8413em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"feJDjQo8gF"},{"type":"text","value":") to facilitate optimal storage and disk retrieval.\nDetails on this topic can be found in the advanced topic notebook of ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"jraYQN00wh"},{"type":"link","url":"/dataset-processing/tutorials/chunking/201/optimalchunkselection","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Choosing an Optimal Chunk Size and Shape","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"JhSoUyKEjg"}],"urlSource":"../201/OptimalChunkSelection.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.201.optimalchunkselection.json","internal":true,"protocol":"file","key":"PYpVZYwVP8"},{"type":"text","value":".","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"BzvHTs2Xic"}],"key":"gYSzdYfe11"}],"key":"S80tZt4096"}],"key":"DEM73atRuN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"How to Examine a Stored Dataset’s Chunk Shape","url":"/dataset-processing/tutorials/chunking/101/examinedatachunking","group":"Zarr Creation"},"next":{"title":"Writing Chunked Files","url":"/dataset-processing/tutorials/chunking/101/writechunkedfiles","group":"Zarr Creation"}}},"domain":"http://localhost:3005"},"project":{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hytest//build/manifest-5D5D9E8C.js";
import * as route0 from "/hytest//build/root-AA24SA6C.js";
import * as route1 from "/hytest//build/routes/$-5SFLQWPV.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hytest//build/entry.client-PCJPW7TK.js");</script></body></html>