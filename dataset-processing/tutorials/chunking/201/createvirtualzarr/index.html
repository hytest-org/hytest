<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Generating a Virtual Zarr Store - HyTEST Project</title><meta property="og:title" content="Generating a Virtual Zarr Store - HyTEST Project"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/hytest//build/_assets/app-SDGCW62C.css"/><link rel="stylesheet" href="/hytest//build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hytest//favicon.ico"/><link rel="stylesheet" href="/hytest//myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hytest//"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="HyTEST Project" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hytest//">HyTEST Project</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Environment Set-Up" class="block break-words rounded py-2 grow cursor-pointer">Environment Set-Up</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Getting Started" class="block break-words rounded py-2 grow cursor-pointer">Getting Started</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Access" class="block break-words rounded py-2 grow cursor-pointer">Dataset Access</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Zarr Creation" class="block break-words rounded py-2 grow cursor-pointer">Zarr Creation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Processing" class="block break-words rounded py-2 grow cursor-pointer">Dataset Processing</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Model Evaluation" class="block break-words rounded py-2 grow cursor-pointer">Model Evaluation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Back Matter" class="block break-words rounded py-2 grow cursor-pointer">Back Matter</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/hytest-org/hytest" title="GitHub Repository: hytest-org/hytest" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Generating a Virtual Zarr Store</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="se3xRmf4O6" class="myst-jp-nb-block relative group/block"><aside class="myst-aside myst-aside-${kind} text-sm lg:h-0 col-margin-right"><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>This notebook builds off the <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/index.html" class="">Kerchunk</a> and <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/index.html" class="">VirtualiZarr</a> docs.</p></div></aside></aside></div><div id="hiaRu98OIp" class="myst-jp-nb-block relative group/block"><p>The objective of this notebook is to learn how to create a virtual Zarr store for a collection of NetCDF files that together make up a complete dataset.
To do this, we will use <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/index.html" class="">Kerchunk</a> and <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/index.html" class="">VirtualiZarr</a>.
As these two packages can both create virtual Zarr stores but do it in different ways, we will utilize them both to show how they compare in combination with <a target="_blank" rel="noreferrer" href="https://www.dask.org/" class="">dask</a> for parallel execution.</p></div><div id="KfzdsoEJna" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
# Needed when boto3 &gt;= 1.36.0 or the rechunking process will fail
# This needs to be set before the boto3 library gets loaded
# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168
os.environ[&#x27;AWS_REQUEST_CHECKSUM_CALCULATION&#x27;] = &#x27;when_required&#x27;
os.environ[&#x27;AWS_RESPONSE_CHECKSUM_VALIDATION&#x27;] = &#x27;when_required&#x27;
import fsspec
import xarray as xr
import ujson
import time
import kerchunk.hdf
import kerchunk.combine
from virtualizarr import open_virtual_dataset
import logging
import dask</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="zMxs5U2oq4xApulWN-MPi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="dUeW4j2Ixk" class="myst-jp-nb-block relative group/block"><h2 id="kerchunk-vs-virtualizarr" class="relative group"><span class="heading-text">Kerchunk vs VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk-vs-virtualizarr" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To begin, let’s explain what a virtual Zarr store even is.
A “<span data-state="closed"><a class="hover-link" href="/hytest//dataset-processing/tutorials/chunking/back/glossary"><strong>virtual Zarr store</strong></a></span>” is a virtual representation of a Zarr store generated by mapping any number of real datasets in individual files (e.g., NetCDF/HDF5, GRIB2, TIFF) together into a single, sliceable dataset via an interface layer.
This interface layer, which Kerchunk and VirtualiZarr generate, contains information about the original files (e.g., chunking, compression, data byte location, etc.) needed to efficiently access the data.
While this could be done with <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html" class=""><code>xarray.open_mfdataset</code></a>, we don’t want to run this command every time we open the dataset as it can be a slow and expensive process.
The reason for this is that <code>xarray.open_mfdataset</code> performs many consistency checks as it runs, and it requires partially opening all of the datasets to get general metadata information on each of the individual files.
Therefore, for numerous files, this can have significant overhead, and it would be preferable to just cache these checks and metadata for more performant future reads.
This cache (specifically in Zarr format) is what a virtual Zarr store is.
Once we have the virtual Zarr store, we can open the combined xarray dataset using <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html" class=""><code>xarray.open_dataset</code></a> for an almost instantaneous read.</p><p>Now that we know what a virtual Zarr store is, let’s discuss the differences between Kerchunk and VirtualiZarr and their virtual Zarr stores.
At a top level, VirtualiZarr provides almost all of the same features as Kerchunk.
The primary difference is that Kerchunk supports non-Zarr-like virtual format, while VirtualiZarr is specifically focused on the Zarr format.
Additionally, Kerchunk creates the virtual Zarr store and represents it in memory using json formatting (the format used for Zarr metadata).
Alternatively, VirtualiZarr represents the store as array-level abstractions (which can be converted to json format).
These abstractions can be cleanly wrapped by xarray for easy use of <code>xarray.concat</code> and <code>xarray.merge</code> commands to combine virtual Zarr stores.
A nice table comparing the two packages can be found in the <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/faq.html#how-do-virtualizarr-and-kerchunk-compare" class="">VirtualiZarr FAQs</a>, which shows how the two packages represent virtual Zarr stores and their comparative syntax.</p></div><div id="Q3EmZJrNg4" class="myst-jp-nb-block relative group/block"><h2 id="spin-up-dask-cluster" class="relative group"><span class="heading-text">Spin up Dask Cluster</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spin-up-dask-cluster" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To run the virtual Zarr creation in parallel, we need to spin up a Dask cluster to schedule the various workers.</p></div><div id="gORpSQIsJy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%run ../../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb
## If this notebook is not being run on Nebari, replace the above 
## path name with a helper appropriate to your compute environment.  Examples:
# %run ../../../../environment_set_up/Start_Dask_Cluster_Denali.ipynb
# %run ../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb
# %run ../../../../environment_set_up/Start_Dask_Cluster_Desktop.ipynb</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="gXURkJF0cwhyOCxN_uCVi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="rCAnpfUF1o" class="myst-jp-nb-block relative group/block"><h2 id="example-comparison" class="relative group"><span class="heading-text">Example Comparison</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#example-comparison" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>With our Dask cluster ready, let’s see how Kerchunk and VirtualiZarr can be utilized to generate a vitrual Zarr store.
For this example, we will use the same daily gridMET NetCDF data as used in the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/writechunkedfiles">Writing Chunked File tutorial</a>.
Only this time we will use all of the variables not just precipitation.
These include:</p><ul><li><p>precipitation,</p></li><li><p>maximum relative humidity,</p></li><li><p>minimum relative humidity,</p></li><li><p>specific humidity,</p></li><li><p>downward shortwave radiation,</p></li><li><p>minimum air temperature,</p></li><li><p>maximum air temperature,</p></li><li><p>wind direction, and</p></li><li><p>wind speed.</p></li></ul><p>The data is currently hosted on the HyTEST OSN as a collection NetCDF files.
To access the data with both Kerchunk and VirtualiZarr, we will use <a target="_blank" rel="noreferrer" href="https://filesystem-spec.readthedocs.io/en/latest/" class="">fsspec</a> to get the list of files that we are wanting to combine into a virtual Zarr store.</p><p>First we need to create the file system for accessing the files, and a second one for outputting the virtual Zarr store.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>We will exclude the year 2019 for now and use it later to show how to append virtual Zarr stores.
Also, we will not use 2020 as it is a partial year with different chunking than the other 40 years, which is currently incompatible with Kerchunk and Virtualizarr.</p></div></aside></div><div id="WCgU5wunAr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># These reader options will be needed for VirtualiZarr
# We created them here to show how they fold into fsspec
reader_options = {
    &#x27;storage_options&#x27;: {
        &#x27;anon&#x27;: True, 
        &#x27;client_kwargs&#x27;: {
            &#x27;endpoint_url&#x27;: &#x27;https://usgs.osn.mghpcc.org/&#x27;
        }
    }
}

fs = fsspec.filesystem(
    protocol=&#x27;s3&#x27;,
    **reader_options[&#x27;storage_options&#x27;]
)

fs_local = fsspec.filesystem(&#x27;&#x27;)
# Make directories to save the virtual zarr stores
fs_local.mkdirs(&#x27;virtual_zarr/kerchunk&#x27;, exist_ok=True)
fs_local.mkdirs(&#x27;virtual_zarr/virtualizarr&#x27;, exist_ok=True)

file_glob = fs.glob(&#x27;s3://mdmf/gdp/netcdf/gridmet/gridmet/*198*.nc&#x27;)
file_glob = [file for file in file_glob if ((&#x27;2020&#x27; not in file) and (&#x27;2019&#x27; not in file))]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7MuFg4IVJCl9WQQldfXDF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eaOJGuuzVJ" class="myst-jp-nb-block relative group/block"><p>Now, we are ready to generate the virtual Zarr stores.
For both Kerchunk and VirtualiZarr (<a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/usage.html#opening-files-as-virtual-datasets" class="">for now</a>), this consists of two steps:</p><ol start="1"><li><p>Convert single original data files into individual virtual Zarr stores,</p></li><li><p>Combine the individual virtual Zarr stores into a single combined virtual Zarr store.</p></li></ol><p>We will show these two steps seperately and how they are done for each package.</p></div><div id="xcfUinVRnu" class="myst-jp-nb-block relative group/block"><h3 id="generate-individual-virtual-zarr-stores" class="relative group"><span class="heading-text">Generate Individual Virtual Zarr Stores</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#generate-individual-virtual-zarr-stores" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="kerchunk" class="relative group"><span class="heading-text">Kerchunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>To generate the individual virtual Zarr stores with Kerchunk, we will use <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr" class=""><code>kerchunk.hdf.SingleHdf5ToZarr</code></a>, which translates the content of one HDF5 file into Zarr metadata.
Other translators exist in Kerchunk that can convert GeoTiffs and NetCDF3 files.
However, as we are looking at NetCDF4 files (a specific version of a HDF5 file), we will use the HDF5 translator.
As this only translates one file, we can make a collection of <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/delayed.html" class=""><code>dask.delayed</code></a> objects that wrap the <code>SingleHdf5ToZarr</code> call to run it for all files in parallel.</p></div><div id="oHcvXx3hQP" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Make a function to run in parallel with dask
@dask.delayed
def generate_single_virtual_zarr(file):
    with fs.open(file) as hdf:
        h5chunks = kerchunk.hdf.SingleHdf5ToZarr(hdf, file, inline_threshold=0)
        return h5chunks.translate()

# Time the duration for later comparison
t0 = time.time()

# Generate Dask Delayed objects
tasks = [generate_single_virtual_zarr(file) for file in file_glob]
# Compute the delayed object
single_virtual_zarrs = dask.compute(*tasks)

kerchunk_time = time.time() - t0

single_virtual_zarrs[0]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OlevbSChUZ8dgvRWc4F-I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jB5yIGGJWZ" class="myst-jp-nb-block relative group/block"><p>Notice that the output for a virtualization of a single NetCDF is a json style dictionary, where the coordinate data is actually kept in the dictionary, while the data is a file pointer and the byte range for each chunk.</p></div><div id="Akvl7bMxVO" class="myst-jp-nb-block relative group/block"><h4 id="virtualizarr" class="relative group"><span class="heading-text">VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#virtualizarr" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>To generate the individual virtual Zarr stores with VirtualiZarr, we will use <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset" class=""><code>virtualizarr.open_virtual_dataset</code></a>, which can infer what type of file we are reading instead of us having to specify.
Like Kerchunk, this only translates one file at a time.
So, we can make a collection of <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/delayed.html" class=""><code>dask.delayed</code></a> objects that wraps <code>open_virtual_dataset</code> to run it for all files in parallel.</p><aside class="myst-admonition myst-admonition-important my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Important</div></div><div class="myst-admonition-body px-4 py-1"><p>When reading in the individual files as virtual datasets, it is critical to include the <code>loadable_variables</code> keyword.
The keyword should be set to a list of the coordinate names.
By adding this keyword, the coordinates are read into memory rather than being loaded as virtual data.
This can make a massive difference in the next steps of (1) concatenation as it gives the coordinates indexes and (2) the serialization of the virtual Zarr store as it saves the in-memory coordinates directly to the store rather than a pointer.
Also, if this is not included, coordinates of different sizes will not be able to be concatenated due to potential chunking differences.
The only downside is that it can slightly increase the time it takes to initially read the virtual datasets.
However, this slowdown is more than worth the future convenience of having the coords in-memory when reading in the virtual Zarr store.</p></div></aside></div><div id="vnB8IsTuMS" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()

tasks = [
    dask.delayed(open_virtual_dataset)(
        f&#x27;s3://{file}&#x27;,
        indexes={},
        loadable_variables=[&#x27;day&#x27;, &#x27;lat&#x27;, &#x27;lon&#x27;, &#x27;crs&#x27;],
        decode_times=True,
        reader_options=reader_options
    )
    for file in file_glob
]

virtual_datasets = dask.compute(*tasks)

virtualizarr_time = time.time() - t0

virtual_datasets[0]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="zhPcySN-jAq_FlaOrKABC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iG25sloTLD" class="myst-jp-nb-block relative group/block"><p>Notice that the output for a virtualization of a single NetCDF is now an <code>xarray.Dataset</code>, where the data is a <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ManifestArray.html" class=""><code>ManifestArray</code></a> object.
This <code>ManifestArray</code> contains <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ChunkManifest.html#virtualizarr.manifests.ChunkManifest" class=""><code>ChunkManifest</code></a> objects that hold the same info as the Kerchunk json format (i.e., a file pointer and the byte range for each chunk), but allows for it to be nicely wrapped by xarray.</p></div><div id="S7zIKJvMIX" class="myst-jp-nb-block relative group/block"><h3 id="combine-individual-virtual-zarr-stores" class="relative group"><span class="heading-text">Combine Individual Virtual Zarr Stores</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#combine-individual-virtual-zarr-stores" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="kerchunk-1" class="relative group"><span class="heading-text">Kerchunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>To combine the individual virtual Zarr stores into one virtual Zarr store with Kerchunk, we will use <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr" class=""><code>kerchunk.combine.MultiZarrToZarr</code></a>, which combines the content of multiple virtual Zarr stores into a single virtual Zarr store.
This call requires feeding <code>MultiZarrToZarr</code> the remote access info that we needed for our file system, along with the dimension we want to combine.</p></div><div id="UrESy3xrFT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()

mzz = kerchunk.combine.MultiZarrToZarr(
    single_virtual_zarrs,
    remote_protocol=&#x27;s3&#x27;,
    remote_options=reader_options[&#x27;storage_options&#x27;],
    concat_dims=[&quot;day&quot;]
)

out = mzz.translate()

# Save the virtual Zarr store, serialized as json
with fs_local.open(&#x27;virtual_zarr/kerchunk/gridmet.json&#x27;, &#x27;wb&#x27;) as f:
    f.write(ujson.dumps(out).encode())

kerchunk_time += time.time() - t0

out</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="AySGYh83OxengPvaECFjq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="m6SFxsVk45" class="myst-jp-nb-block relative group/block"><p>Again, notice the output type is in a json format with the coords in the dictionary and data chunks having pointers, but this time all chunks are in the one dictionary.</p></div><div id="Q26OEXzxY3" class="myst-jp-nb-block relative group/block"><h4 id="virtualizarr-1" class="relative group"><span class="heading-text">VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#virtualizarr-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>To combine the virtual datasets from VirtualiZarr, we can just use <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.combine_by_coords.html" class=""><code>xarray.combine_by_coords</code></a> which will auto-magically combine the virtual datasets together.</p></div><div id="hx7poyRp83" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()

virtual_ds = xr.combine_by_coords(virtual_datasets, coords=&#x27;minimal&#x27;, compat=&#x27;override&#x27;, combine_attrs=&#x27;override&#x27;)

# Save the virtual Zarr store, serialized as json
virtual_ds.virtualize.to_kerchunk(&#x27;virtual_zarr/virtualizarr/gridmet.json&#x27;, format=&#x27;json&#x27;)

virtualizarr_time += time.time() - t0

virtual_ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qGTAy8qnSE6MlH47JUtoW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CJZpM968p4" class="myst-jp-nb-block relative group/block"><p>Notice that when we saved the virtual dataset that we converted it to a Kerchunk format for saving.</p></div><div id="PSvI71vqwn" class="myst-jp-nb-block relative group/block"><h3 id="opening-the-virtual-zarr-stores" class="relative group"><span class="heading-text">Opening the Virtual Zarr Stores</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#opening-the-virtual-zarr-stores" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To open the virtual Zarr stores, we can use the same method for both stores as we converted to Kerchunk format when saving from VirtualiZarr.</p><h4 id="kerchunk-2" class="relative group"><span class="heading-text">Kerchunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="QzW7gqilAC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()

ds = xr.open_dataset(
    &#x27;virtual_zarr/kerchunk/gridmet.json&#x27;,
    chunks={},
    engine=&quot;kerchunk&quot;,
    backend_kwargs={
        &quot;storage_options&quot;: {
            &quot;remote_protocol&quot;: &quot;s3&quot;,
            &quot;remote_options&quot;: reader_options[&#x27;storage_options&#x27;]
        },
    }
)

kerchunk_read_time = time.time() - t0

ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="yi-qbkh3yfvNkepSaNBBF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="xRuAqfDCeK" class="myst-jp-nb-block relative group/block"><h4 id="virtualizarr-2" class="relative group"><span class="heading-text">VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#virtualizarr-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="salxhXoZyO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()

ds = xr.open_dataset(
    &#x27;virtual_zarr/virtualizarr/gridmet.json&#x27;,
    chunks={},
    engine=&quot;kerchunk&quot;,
    backend_kwargs={
        &quot;storage_options&quot;: {
            &quot;remote_protocol&quot;: &quot;s3&quot;,
            &quot;remote_options&quot;: reader_options[&#x27;storage_options&#x27;]
        },
    }
)

virtualizarr_read_time = time.time() - t0

ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="dNaqjhUsXw6XCB0bXErjX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="y57twiw9iC" class="myst-jp-nb-block relative group/block"><h3 id="reading-with-xarray-open-mfdataset" class="relative group"><span class="heading-text">Reading with <code>xarray.open_mfdataset</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reading-with-xarray-open-mfdataset" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As a comparison of read times, let’s also compile the dataset using <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html" class=""><code>xarray.open_mfdataset</code></a> in parallel with Dask.
This way we can see if we will be saving time in the future by having the compiled virtual Zarr for faster reads.</p></div><div id="HcJnvUJPtt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time 
t0 = time.time()

ds = xr.open_mfdataset(
    [fs.open(file) for file in file_glob],
    chunks={},
    parallel=True,
    engine=&#x27;h5netcdf&#x27;
)

open_mfdataset_time = time.time() - t0

ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ur01YzJz1ji2vKPZI2s9m" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eKtEyVkGBf" class="myst-jp-nb-block relative group/block"><p>Now, let’s compare the computational times!</p></div><div id="ZZLAakjySY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(&quot;Kerchunk virtual Zarr creation time: &quot;
      f&quot;{kerchunk_time:.0f}s ({kerchunk_time/60:.1f} min)&quot;)
print(&quot;VirtualiZarr virtual Zarr creation time: &quot;
      f&quot;{virtualizarr_time:.0f}s ({virtualizarr_time/60:.1f} min)&quot;)
print(&quot;open_mfdataset dataset creation time: &quot;
      f&quot;{open_mfdataset_time:.0f}s ({open_mfdataset_time/60:.1f} min)&quot;)
print(f&quot;Time ratio: Kerchunk to open_mfdataset = {kerchunk_time/open_mfdataset_time:.2f}\n&quot;
      f&quot;            VirtualiZarr to open_mfdataset = {virtualizarr_time/open_mfdataset_time:.2f}\n&quot;
      f&quot;            Kerchunk to VirtualiZarr = {kerchunk_time/virtualizarr_time:.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Te-LXGHslnup677Vtm4oV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZCE12Naju5" class="myst-jp-nb-block relative group/block"><p>As we can see the Kerchunk and VirtualiZarr take about the same amount of time to create a virtual zarr store. <code>open_mfdataset</code> can create the <code>Dataset</code> on the fly in slightly less time than it takes to create the virtual zarr stores (about 30 seconds less, in this case). However, if you use <code>open_mfdataset</code>, you will have to create this dataset <strong>each time</strong> you run your code, whereas Kerchunk and Virtualizarr can create the dataset once and then read it much faster on future uses. Looking at read speed after the virtual Zarr store creation:</p></div><div id="o04e61U90Z" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(&quot;Kerchunk virtual Zarr read time: &quot;
      f&quot;{kerchunk_read_time:.2f}s&quot;)
print(&quot;VirtualiZarr virtual Zarr read time: &quot;
      f&quot;{virtualizarr_read_time:.2f}s&quot;)
print(&quot;open_mfdataset dataset read/creation time: &quot;
      f&quot;{open_mfdataset_time:.0f}s ({open_mfdataset_time/60:.1f} min)&quot;)
print(f&quot;Time ratio: Kerchunk to open_mfdataset = {kerchunk_read_time/open_mfdataset_time:.3f}\n&quot;
      f&quot;            VirtualiZarr to open_mfdataset = {virtualizarr_read_time/open_mfdataset_time:.3f}\n&quot;
      f&quot;            Kerchunk to VirtualiZarr = {kerchunk_read_time/virtualizarr_read_time:.3f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GM2I_6ftcKXjvnIPBM2_s" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="c7nHlAfMPJ" class="myst-jp-nb-block relative group/block"><p>From this, it is very clear that performing more than one read using either the Kerchunk or VirtualiZarr virtual Zarr store is more efficient that reading with <code>open_mfdataset</code>.
Additionally, the differences in read times between Kerchunk and Virtualizarr, while appearing drastic, is likely not going to be significant in any workflow.</p></div><div id="VNAZiaPwpZ" class="myst-jp-nb-block relative group/block"><h2 id="appending-to-existing-virtual-zarr-store" class="relative group"><span class="heading-text">Appending to Existing Virtual Zarr Store</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#appending-to-existing-virtual-zarr-store" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>As noted when <span data-state="closed"><a href="#example-comparison" class="hover-link">introducing the gridMET data</a></span>, we did not utilize the 2019 data in order to show how to append it to a virtual Zarr store.
The ability to append more data to the virtual Zarr store is highly convienient, as plenty of datasets are continuously updated as new data becomes available.
So, let’s appends some data to our virtual Zarr stores we just made.</p><p>First, we create the 2019 file glob.</p></div><div id="PBPtH9cJMT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">file_glob_2019 = fs.glob(&#x27;s3://mdmf/gdp/netcdf/gridmet/gridmet/*_2019.nc&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="v7mlVW9GHGAYp1bmDR6_K" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="VdE5RYJriV" class="myst-jp-nb-block relative group/block"><h3 id="create-new-virtual-zarr-for-new-file" class="relative group"><span class="heading-text">Create New Virtual Zarr for New File</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#create-new-virtual-zarr-for-new-file" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Next, we need to get our 2019 NetCDFs into a virtual Zarr store.</p><h4 id="kerchunk-3" class="relative group"><span class="heading-text">Kerchunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>We will do this for Kerchunk the same way we did before, by using <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr" class=""><code>kerchunk.hdf.SingleHdf5ToZarr</code></a>, which translates the content of one HDF5 (NetCDF4) file into Zarr metadata.</p></div><div id="RhT2furVAs" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">tasks = [generate_single_virtual_zarr(file) for file in file_glob_2019]
single_virtual_zarrs_2019 = dask.compute(*tasks)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vLBL_z8B9VYkHuA4OgIiM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gz2azGo2fq" class="myst-jp-nb-block relative group/block"><h4 id="virtualizarr-3" class="relative group"><span class="heading-text">VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#virtualizarr-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>And for VirtualiZarr, we will use <a target="_blank" rel="noreferrer" href="https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset" class=""><code>virtualizarr.open_virtual_dataset</code></a>.</p></div><div id="Hd6GQy7imV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">tasks = [
    dask.delayed(open_virtual_dataset)(
        f&#x27;s3://{file}&#x27;,
        indexes={},
        loadable_variables=[&#x27;day&#x27;, &#x27;lat&#x27;, &#x27;lon&#x27;, &#x27;crs&#x27;],
        decode_times=True,
        reader_options=reader_options
    )
    for file in file_glob_2019
]

virtual_datasets_2019 = dask.compute(*tasks)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="KQKdb1cfX35LGIandC8Se" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LgSJoGrhBU" class="myst-jp-nb-block relative group/block"><h3 id="append-to-existing-store" class="relative group"><span class="heading-text">Append to Existing Store</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#append-to-existing-store" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Now, we can append the virtualized NetCDFs to our existing stores.</p><h4 id="kerchunk-4" class="relative group"><span class="heading-text">Kerchunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#kerchunk-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>For Kerchunk, we will use still <a target="_blank" rel="noreferrer" href="https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr" class=""><code>kerchunk.combine.MultiZarrToZarr</code></a>.
However, this time we will need to use the <code>append</code> method to append our new data.</p></div><div id="tQJ3mC0vAI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Append to the existing reference file
mzz = kerchunk.combine.MultiZarrToZarr.append(
    single_virtual_zarrs_2019,
    original_refs=out,
    concat_dims=[&quot;day&quot;],
    remote_protocol=&#x27;s3&#x27;,
    remote_options=reader_options[&#x27;storage_options&#x27;],
)

out_2019 = mzz.translate()

# Save the virtual Zarr store, serialized as json
with fs_local.open(&#x27;virtual_zarr/kerchunk/gridmet_appended.json&#x27;, &#x27;wb&#x27;) as f:
    f.write(ujson.dumps(out_2019).encode())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="r6VamzdsEKi6fnwFj9_tf" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="IxxluqEG0n" class="myst-jp-nb-block relative group/block"><h4 id="virtualizarr-4" class="relative group"><span class="heading-text">VirtualiZarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#virtualizarr-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>For VirtualiZarr, we can just use <code>xarray.concat</code> and <code>xarray.merge</code> like would to combine any <code>xarray.Dataset</code>.</p></div><div id="WXN8PBTEJK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">virtual_ds_2019 = xr.merge(virtual_datasets_2019, compat=&#x27;override&#x27;, combine_attrs=&#x27;override&#x27;)
virtual_ds = xr.concat([virtual_ds, virtual_ds_2019], dim=&#x27;day&#x27;, coords=&#x27;minimal&#x27;, compat=&#x27;override&#x27;, combine_attrs=&#x27;override&#x27;)
virtual_ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YLIhhK-f65pDhMDxjDeo4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sH4gI8NMpI" class="myst-jp-nb-block relative group/block"><p>This simple <code>xarray.merge</code> and <code>concat</code> is the major advantage of VirtualiZarr.
Rather than having to figure out Kerchunk’s syntax and commands, we can keep using xarray as we already do.
Therefore, the increase in time to create the virtual Zarr store compared to Kerchunk is likely worth it due to its native compatibility with xarray.</p></div><div id="SCn73NXIbL" class="myst-jp-nb-block relative group/block"><h3 id="double-check-new-stores" class="relative group"><span class="heading-text">Double Check New Stores</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#double-check-new-stores" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Finally, let’s read in the appended stores to make sure that we correctly appended the 2019 data.</p></div><div id="t20ocICTo4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds = xr.open_dataset(
    &#x27;virtual_zarr/kerchunk/gridmet_appended.json&#x27;,
    engine=&quot;kerchunk&quot;,
    chunks={},
    backend_kwargs={
        &quot;storage_options&quot;: {
            &quot;remote_protocol&quot;: &quot;s3&quot;,
            &quot;remote_options&quot;: reader_options[&#x27;storage_options&#x27;]
        },
    }
)
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_t0aNl7qxcqBcfBGIc4ru" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="xtwVaJj4mD" class="myst-jp-nb-block relative group/block"><p>Nice!
The 2019 data is now appended and showing on the day coordinate.</p></div><div id="uUcF7hX13C" class="myst-jp-nb-block relative group/block"><h2 id="clean-up" class="relative group"><span class="heading-text">Clean Up</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#clean-up" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Rather than deleting the virtual Zarr stores that we created, we will actually keep them for use in future tutorials.
However, we will do want to conform with best practices and close our Dask client and cluster.</p></div><div id="E3N7Xahgrs" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">client.close()
cluster.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0PyfyypGQlhRzLzs0yzvF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/hytest//dataset-processing/tutorials/chunking/201/rechunkingwithdask"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>Rechunking Larger Datasets with Dask</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hytest//dataset-processing/tutorials/chunking/201/includecrsinzarr"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>Adding Coordinate Reference Systems (CRS) to Zarr Datasets</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hytest//build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-N76G4W6Y.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hytest//build/root-AA24SA6C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AH7OE64W.js"/><link rel="modulepreload" href="/hytest//build/routes/$-5SFLQWPV.js"/><script>window.__remixContext = {"url":"/dataset-processing/tutorials/chunking/201/createvirtualzarr","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hytest/"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"c78ca0cd8eec01b91f82777f1db828da871fba8970056b8de4a18a22543e4140","slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","location":"/dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb","dependencies":[],"frontmatter":{"title":"Generating a Virtual Zarr Store","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb","exports":[{"format":"ipynb","filename":"CreateVirtualZarr.ipynb","url":"/hytest//build/CreateVirtualZarr-ba985d0e1083cd9182118aa2d55ea348.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"aside","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"XLhR3jqZ81"}],"key":"UiB1c4BZ8H"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook builds off the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e7rzMQ4B1H"},{"type":"link","url":"https://fsspec.github.io/kerchunk/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hVtlMjQ0DJ"}],"urlSource":"https://fsspec.github.io/kerchunk/index.html","key":"CGn6rHwsXY"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JqHXqfa1yX"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RaH37SQOqA"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/index.html","key":"YUfd0pMEZC"},{"type":"text","value":" docs.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U6uJcVWdSR"}],"key":"jNPJxMbwk7"}],"key":"Z5rVPTWhsI"}],"key":"mWnrjfDTRQ"}],"key":"se3xRmf4O6"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The objective of this notebook is to learn how to create a virtual Zarr store for a collection of NetCDF files that together make up a complete dataset.\nTo do this, we will use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OIKeCOjBSC"},{"type":"link","url":"https://fsspec.github.io/kerchunk/index.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wOvk85dfPO"}],"urlSource":"https://fsspec.github.io/kerchunk/index.html","key":"lNhUSPFXLb"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TCbbJia0Vi"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/index.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T0vKfTxcgJ"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/index.html","key":"e36EugpIeb"},{"type":"text","value":".\nAs these two packages can both create virtual Zarr stores but do it in different ways, we will utilize them both to show how they compare in combination with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JVLOQow4xd"},{"type":"link","url":"https://www.dask.org/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g9QqONz8K1"}],"urlSource":"https://www.dask.org/","key":"wpho9CuZUw"},{"type":"text","value":" for parallel execution.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gmQJy8zWwA"}],"key":"VtJh4DXFFJ"}],"key":"hiaRu98OIp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\n# Needed when boto3 \u003e= 1.36.0 or the rechunking process will fail\n# This needs to be set before the boto3 library gets loaded\n# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168\nos.environ['AWS_REQUEST_CHECKSUM_CALCULATION'] = 'when_required'\nos.environ['AWS_RESPONSE_CHECKSUM_VALIDATION'] = 'when_required'\nimport fsspec\nimport xarray as xr\nimport ujson\nimport time\nimport kerchunk.hdf\nimport kerchunk.combine\nfrom virtualizarr import open_virtual_dataset\nimport logging\nimport dask","key":"GqL0GP0uAR"},{"type":"outputs","id":"zMxs5U2oq4xApulWN-MPi","children":[],"key":"vWb0bQQWns"}],"key":"KfzdsoEJna"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Kerchunk vs VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ii38FUq46W"}],"identifier":"kerchunk-vs-virtualizarr","label":"Kerchunk vs VirtualiZarr","html_id":"kerchunk-vs-virtualizarr","implicit":true,"key":"ipdZTjDxgC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"To begin, let’s explain what a virtual Zarr store even is.\nA “","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gF7CXfmFCu"},{"type":"crossReference","url":"/dataset-processing/tutorials/chunking/back/glossary","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"virtual Zarr store","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yxRGQNTKc6"}],"key":"mpoQmP3EaO"}],"urlSource":"../back/Glossary.md#term-Virtual-Zarr-Store","dataUrl":"/dataset-processing.tutorials.chunking.back.glossary.json","identifier":"term-virtual-zarr-store","label":"term-Virtual-Zarr-Store","remote":true,"protocol":"file","key":"EtVMaPsqqZ"},{"type":"text","value":"” is a virtual representation of a Zarr store generated by mapping any number of real datasets in individual files (e.g., NetCDF/HDF5, GRIB2, TIFF) together into a single, sliceable dataset via an interface layer.\nThis interface layer, which Kerchunk and VirtualiZarr generate, contains information about the original files (e.g., chunking, compression, data byte location, etc.) needed to efficiently access the data.\nWhile this could be done with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PftBOd7JuA"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"xarray.open_mfdataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"h0qKWCNRG3"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html","key":"ytyokGAObI"},{"type":"text","value":", we don’t want to run this command every time we open the dataset as it can be a slow and expensive process.\nThe reason for this is that ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ipYfZVTaeR"},{"type":"inlineCode","value":"xarray.open_mfdataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oHTHM47KvC"},{"type":"text","value":" performs many consistency checks as it runs, and it requires partially opening all of the datasets to get general metadata information on each of the individual files.\nTherefore, for numerous files, this can have significant overhead, and it would be preferable to just cache these checks and metadata for more performant future reads.\nThis cache (specifically in Zarr format) is what a virtual Zarr store is.\nOnce we have the virtual Zarr store, we can open the combined xarray dataset using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Crbn0c4t4o"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"xarray.open_dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JeepUKsjVb"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html","key":"RXCVeAIn5u"},{"type":"text","value":" for an almost instantaneous read.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N2jumMY0pH"}],"key":"EXpHY9Ug1i"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Now that we know what a virtual Zarr store is, let’s discuss the differences between Kerchunk and VirtualiZarr and their virtual Zarr stores.\nAt a top level, VirtualiZarr provides almost all of the same features as Kerchunk.\nThe primary difference is that Kerchunk supports non-Zarr-like virtual format, while VirtualiZarr is specifically focused on the Zarr format.\nAdditionally, Kerchunk creates the virtual Zarr store and represents it in memory using json formatting (the format used for Zarr metadata).\nAlternatively, VirtualiZarr represents the store as array-level abstractions (which can be converted to json format).\nThese abstractions can be cleanly wrapped by xarray for easy use of ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xWueTXdhHV"},{"type":"inlineCode","value":"xarray.concat","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"MBWQf2vHkd"},{"type":"text","value":" and ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"lwEwq9ZGG1"},{"type":"inlineCode","value":"xarray.merge","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"S3WR4aPiCM"},{"type":"text","value":" commands to combine virtual Zarr stores.\nA nice table comparing the two packages can be found in the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"PxCiQKOVHg"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/faq.html#how-do-virtualizarr-and-kerchunk-compare","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"VirtualiZarr FAQs","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"CrY2CjPIZd"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/faq.html#how-do-virtualizarr-and-kerchunk-compare","key":"Hoogh5wXrW"},{"type":"text","value":", which shows how the two packages represent virtual Zarr stores and their comparative syntax.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rL4WVR1jje"}],"key":"JCyKFBEzl9"}],"key":"dUeW4j2Ixk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spin up Dask Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oHYiRDJKfI"}],"identifier":"spin-up-dask-cluster","label":"Spin up Dask Cluster","html_id":"spin-up-dask-cluster","implicit":true,"key":"CopmdwuA8y"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To run the virtual Zarr creation in parallel, we need to spin up a Dask cluster to schedule the various workers.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"txkHZ3tY3Q"}],"key":"zSAlAuLYZc"}],"key":"Q3EmZJrNg4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%run ../../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb\n## If this notebook is not being run on Nebari, replace the above \n## path name with a helper appropriate to your compute environment.  Examples:\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Denali.ipynb\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Desktop.ipynb","key":"F4RIA16J8a"},{"type":"outputs","id":"gXURkJF0cwhyOCxN_uCVi","children":[],"key":"wGWnIWZ4TE"}],"key":"gORpSQIsJy"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Example Comparison","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TIatDL3MVI"}],"identifier":"example-comparison","label":"Example Comparison","html_id":"example-comparison","implicit":true,"key":"kWmsBDgJ0V"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"With our Dask cluster ready, let’s see how Kerchunk and VirtualiZarr can be utilized to generate a vitrual Zarr store.\nFor this example, we will use the same daily gridMET NetCDF data as used in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rfBdlYtYHX"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/writechunkedfiles","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Writing Chunked File tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g60XYojWKW"}],"urlSource":"../101/WriteChunkedFiles.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.writechunkedfiles.json","internal":true,"protocol":"file","key":"dLqehjoUHO"},{"type":"text","value":".\nOnly this time we will use all of the variables not just precipitation.\nThese include:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZaqGRGLOC7"}],"key":"zv5bpoqQM7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"precipitation,","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nSKHzgvSr9"}],"key":"QVBDVFd0rq"}],"key":"e6QuNNwCpH"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"maximum relative humidity,","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"dQynUvXLrN"}],"key":"aJmKE54alj"}],"key":"XFEWyGxz07"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"minimum relative humidity,","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IzcZFhVCGy"}],"key":"YRyZOhcGgV"}],"key":"PkXELRwsl6"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"specific humidity,","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UguVWfxOmh"}],"key":"YKWXIC9QQe"}],"key":"Dmxv9r3b6n"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"downward shortwave radiation,","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"H5hrdoRX0W"}],"key":"YSdJ6lHYeK"}],"key":"kCy2UowBK0"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"minimum air temperature,","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"kniDHgvjMc"}],"key":"Z3dGBiGXBm"}],"key":"X5uPDAq1zN"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"maximum air temperature,","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"SMZaRKe1Uo"}],"key":"K76Sc2djBw"}],"key":"gL1Fb8fzRd"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"wind direction, and","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"JB33JuHq1Q"}],"key":"UEpN7PU2em"}],"key":"ntr9Xe1PmS"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"wind speed.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"d8B2W5rTTQ"}],"key":"eBCUK10MRT"}],"key":"JNhdsZRH1D"}],"key":"xibvh6sg0M"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"The data is currently hosted on the HyTEST OSN as a collection NetCDF files.\nTo access the data with both Kerchunk and VirtualiZarr, we will use ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"aoA7bGAy0W"},{"type":"link","url":"https://filesystem-spec.readthedocs.io/en/latest/","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"fsspec","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"sPUgHC8Evf"}],"urlSource":"https://filesystem-spec.readthedocs.io/en/latest/","key":"Pn2hNmdpmk"},{"type":"text","value":" to get the list of files that we are wanting to combine into a virtual Zarr store.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"DTbIWQPASW"}],"key":"YGlmXZeUV1"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"First we need to create the file system for accessing the files, and a second one for outputting the virtual Zarr store.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ZbzUwIqlaT"}],"key":"lMuDilBMbS"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"UeOAvg1cEG"}],"key":"S6F8WppD3D"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"We will exclude the year 2019 for now and use it later to show how to append virtual Zarr stores.\nAlso, we will not use 2020 as it is a partial year with different chunking than the other 40 years, which is currently incompatible with Kerchunk and Virtualizarr.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"foLsQWpUz0"}],"key":"LuZ2pReJHO"}],"key":"By3UrgKN1I"}],"visibility":"show","key":"rCAnpfUF1o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# These reader options will be needed for VirtualiZarr\n# We created them here to show how they fold into fsspec\nreader_options = {\n    'storage_options': {\n        'anon': True, \n        'client_kwargs': {\n            'endpoint_url': 'https://usgs.osn.mghpcc.org/'\n        }\n    }\n}\n\nfs = fsspec.filesystem(\n    protocol='s3',\n    **reader_options['storage_options']\n)\n\nfs_local = fsspec.filesystem('')\n# Make directories to save the virtual zarr stores\nfs_local.mkdirs('virtual_zarr/kerchunk', exist_ok=True)\nfs_local.mkdirs('virtual_zarr/virtualizarr', exist_ok=True)\n\nfile_glob = fs.glob('s3://mdmf/gdp/netcdf/gridmet/gridmet/*198*.nc')\nfile_glob = [file for file in file_glob if (('2020' not in file) and ('2019' not in file))]","key":"La2TIPNuY0"},{"type":"outputs","id":"7MuFg4IVJCl9WQQldfXDF","children":[],"key":"mjRi0wb7xp"}],"key":"WCgU5wunAr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now, we are ready to generate the virtual Zarr stores.\nFor both Kerchunk and VirtualiZarr (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jM9IKtj6I4"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/usage.html#opening-files-as-virtual-datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"for now","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NJIjpAwOfc"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/usage.html#opening-files-as-virtual-datasets","key":"R1jBa6dE3x"},{"type":"text","value":"), this consists of two steps:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LAYdeLs9GG"}],"key":"Z2blyT3rkN"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Convert single original data files into individual virtual Zarr stores,","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rTXx8cUD2f"}],"key":"nxHBn8Jzrb"}],"key":"Cc4L4uLfWy"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Combine the individual virtual Zarr stores into a single combined virtual Zarr store.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CLhqRn70FY"}],"key":"CV0QIBKfBf"}],"key":"lKezSzC7ys"}],"key":"cuXFS8nN6G"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We will show these two steps seperately and how they are done for each package.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gEVFoWOSP0"}],"key":"CzJMrqYAw9"}],"key":"eaOJGuuzVJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate Individual Virtual Zarr Stores","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pRNz7GiHN6"}],"identifier":"generate-individual-virtual-zarr-stores","label":"Generate Individual Virtual Zarr Stores","html_id":"generate-individual-virtual-zarr-stores","implicit":true,"key":"FxSd4wmXi1"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"behtLS9GR8"}],"identifier":"kerchunk","label":"Kerchunk","html_id":"kerchunk","implicit":true,"key":"tVccz7FYi8"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"To generate the individual virtual Zarr stores with Kerchunk, we will use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k6xYO2hZFE"},{"type":"link","url":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"kerchunk.hdf.SingleHdf5ToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"me43suhxEk"}],"urlSource":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr","key":"t18sq5log9"},{"type":"text","value":", which translates the content of one HDF5 file into Zarr metadata.\nOther translators exist in Kerchunk that can convert GeoTiffs and NetCDF3 files.\nHowever, as we are looking at NetCDF4 files (a specific version of a HDF5 file), we will use the HDF5 translator.\nAs this only translates one file, we can make a collection of ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I0l88HlIW8"},{"type":"link","url":"https://docs.dask.org/en/stable/delayed.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"dask.delayed","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H1DbbIO9KT"}],"urlSource":"https://docs.dask.org/en/stable/delayed.html","key":"hkPtLEDkEj"},{"type":"text","value":" objects that wrap the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f2t9wPPyE5"},{"type":"inlineCode","value":"SingleHdf5ToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TScNb6LvaX"},{"type":"text","value":" call to run it for all files in parallel.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HFT3GhUuVi"}],"key":"jAGFYN1efP"}],"key":"xcfUinVRnu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Make a function to run in parallel with dask\n@dask.delayed\ndef generate_single_virtual_zarr(file):\n    with fs.open(file) as hdf:\n        h5chunks = kerchunk.hdf.SingleHdf5ToZarr(hdf, file, inline_threshold=0)\n        return h5chunks.translate()\n\n# Time the duration for later comparison\nt0 = time.time()\n\n# Generate Dask Delayed objects\ntasks = [generate_single_virtual_zarr(file) for file in file_glob]\n# Compute the delayed object\nsingle_virtual_zarrs = dask.compute(*tasks)\n\nkerchunk_time = time.time() - t0\n\nsingle_virtual_zarrs[0]","key":"NfUCvL4zIl"},{"type":"outputs","id":"OlevbSChUZ8dgvRWc4F-I","children":[],"key":"EtuAFszTAM"}],"key":"oHcvXx3hQP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Notice that the output for a virtualization of a single NetCDF is a json style dictionary, where the coordinate data is actually kept in the dictionary, while the data is a file pointer and the byte range for each chunk.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DGdGCpF5lS"}],"key":"bDrqVw0kGV"}],"key":"jB5yIGGJWZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jbn5GEHHfE"}],"identifier":"virtualizarr","label":"VirtualiZarr","html_id":"virtualizarr","implicit":true,"key":"re1yEJt4Kh"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"To generate the individual virtual Zarr stores with VirtualiZarr, we will use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JKR9Zge87Z"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"virtualizarr.open_virtual_dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BKr1q8ajQs"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset","key":"bqSem2jd4b"},{"type":"text","value":", which can infer what type of file we are reading instead of us having to specify.\nLike Kerchunk, this only translates one file at a time.\nSo, we can make a collection of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gU9zdnCvAq"},{"type":"link","url":"https://docs.dask.org/en/stable/delayed.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"dask.delayed","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zQKuayPXQz"}],"urlSource":"https://docs.dask.org/en/stable/delayed.html","key":"l9D42KyV93"},{"type":"text","value":" objects that wraps ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CHotEizb4B"},{"type":"inlineCode","value":"open_virtual_dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ofNT6KsCC0"},{"type":"text","value":" to run it for all files in parallel.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yiHoAXk0Am"}],"key":"UuAVnLyM5Q"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Important","key":"K3mvqtCsUO"}],"key":"Xc8KP8rUX6"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"When reading in the individual files as virtual datasets, it is critical to include the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"w5PoGr1WRT"},{"type":"inlineCode","value":"loadable_variables","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LamW1uzJi5"},{"type":"text","value":" keyword.\nThe keyword should be set to a list of the coordinate names.\nBy adding this keyword, the coordinates are read into memory rather than being loaded as virtual data.\nThis can make a massive difference in the next steps of (1) concatenation as it gives the coordinates indexes and (2) the serialization of the virtual Zarr store as it saves the in-memory coordinates directly to the store rather than a pointer.\nAlso, if this is not included, coordinates of different sizes will not be able to be concatenated due to potential chunking differences.\nThe only downside is that it can slightly increase the time it takes to initially read the virtual datasets.\nHowever, this slowdown is more than worth the future convenience of having the coords in-memory when reading in the virtual Zarr store.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"kDIG0hmN2n"}],"key":"sAbQJII3zS"}],"key":"eRFMijgCD7"}],"key":"Akvl7bMxVO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\n\ntasks = [\n    dask.delayed(open_virtual_dataset)(\n        f's3://{file}',\n        indexes={},\n        loadable_variables=['day', 'lat', 'lon', 'crs'],\n        decode_times=True,\n        reader_options=reader_options\n    )\n    for file in file_glob\n]\n\nvirtual_datasets = dask.compute(*tasks)\n\nvirtualizarr_time = time.time() - t0\n\nvirtual_datasets[0]","key":"pdvp3x42UK"},{"type":"outputs","id":"zhPcySN-jAq_FlaOrKABC","children":[],"key":"JK5WvQyRzD"}],"key":"vnB8IsTuMS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Notice that the output for a virtualization of a single NetCDF is now an ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TCLCenki2i"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oUipRq4NUT"},{"type":"text","value":", where the data is a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Pe0jTxDC2H"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ManifestArray.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"ManifestArray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N1xmv0Qw0w"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ManifestArray.html","key":"XeXD85H3W8"},{"type":"text","value":" object.\nThis ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zqazTWSF6t"},{"type":"inlineCode","value":"ManifestArray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Korf24McBq"},{"type":"text","value":" contains ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ytjygS03SE"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ChunkManifest.html#virtualizarr.manifests.ChunkManifest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"ChunkManifest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vBkYJuyx43"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.manifests.ChunkManifest.html#virtualizarr.manifests.ChunkManifest","key":"mUgbWBzuEM"},{"type":"text","value":" objects that hold the same info as the Kerchunk json format (i.e., a file pointer and the byte range for each chunk), but allows for it to be nicely wrapped by xarray.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K6IKHKiMF9"}],"key":"VzIv8J9daT"}],"key":"iG25sloTLD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combine Individual Virtual Zarr Stores","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j9VHYSnz12"}],"identifier":"combine-individual-virtual-zarr-stores","label":"Combine Individual Virtual Zarr Stores","html_id":"combine-individual-virtual-zarr-stores","implicit":true,"key":"NZniLN5AuR"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GHHf1XVv7R"}],"identifier":"kerchunk","label":"Kerchunk","html_id":"kerchunk-1","implicit":true,"key":"MkRySgURZH"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To combine the individual virtual Zarr stores into one virtual Zarr store with Kerchunk, we will use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"znfHiXjpJR"},{"type":"link","url":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"kerchunk.combine.MultiZarrToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"n3vUmqy6Ya"}],"urlSource":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr","key":"uahVkHP74Y"},{"type":"text","value":", which combines the content of multiple virtual Zarr stores into a single virtual Zarr store.\nThis call requires feeding ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"u3mxeQbugH"},{"type":"inlineCode","value":"MultiZarrToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bNiGhVSF0R"},{"type":"text","value":" the remote access info that we needed for our file system, along with the dimension we want to combine.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xOKo1mw2PJ"}],"key":"qkgNQQO8Oc"}],"key":"S7zIKJvMIX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\n\nmzz = kerchunk.combine.MultiZarrToZarr(\n    single_virtual_zarrs,\n    remote_protocol='s3',\n    remote_options=reader_options['storage_options'],\n    concat_dims=[\"day\"]\n)\n\nout = mzz.translate()\n\n# Save the virtual Zarr store, serialized as json\nwith fs_local.open('virtual_zarr/kerchunk/gridmet.json', 'wb') as f:\n    f.write(ujson.dumps(out).encode())\n\nkerchunk_time += time.time() - t0\n\nout","key":"ocqZHDBqpg"},{"type":"outputs","id":"AySGYh83OxengPvaECFjq","children":[],"key":"gnNwBLSF0W"}],"key":"UrESy3xrFT"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Again, notice the output type is in a json format with the coords in the dictionary and data chunks having pointers, but this time all chunks are in the one dictionary.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c06TOyTARZ"}],"key":"dgB3BWf9Q2"}],"key":"m6SFxsVk45"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w2vdlPviZT"}],"identifier":"virtualizarr","label":"VirtualiZarr","html_id":"virtualizarr-1","implicit":true,"key":"P312OUooaA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To combine the virtual datasets from VirtualiZarr, we can just use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ifIa7DpYiP"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.combine_by_coords.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"xarray.combine_by_coords","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Hy20q5SsOu"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.combine_by_coords.html","key":"mvMs3BPDtQ"},{"type":"text","value":" which will auto-magically combine the virtual datasets together.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"asnymSSMk5"}],"key":"MerQJ3dAFk"}],"key":"Q26OEXzxY3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\n\nvirtual_ds = xr.combine_by_coords(virtual_datasets, coords='minimal', compat='override', combine_attrs='override')\n\n# Save the virtual Zarr store, serialized as json\nvirtual_ds.virtualize.to_kerchunk('virtual_zarr/virtualizarr/gridmet.json', format='json')\n\nvirtualizarr_time += time.time() - t0\n\nvirtual_ds","key":"mbOJcgtqK7"},{"type":"outputs","id":"qGTAy8qnSE6MlH47JUtoW","children":[],"key":"nyO1MkwJsg"}],"key":"hx7poyRp83"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Notice that when we saved the virtual dataset that we converted it to a Kerchunk format for saving.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HTUQT8FIWy"}],"key":"L2VSlE7Nwh"}],"key":"CJZpM968p4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Opening the Virtual Zarr Stores","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UmUm30IE9X"}],"identifier":"opening-the-virtual-zarr-stores","label":"Opening the Virtual Zarr Stores","html_id":"opening-the-virtual-zarr-stores","implicit":true,"key":"LZjwOujEFi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To open the virtual Zarr stores, we can use the same method for both stores as we converted to Kerchunk format when saving from VirtualiZarr.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gH2GfkfXdR"}],"key":"y2GOGKtD2k"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uWDPKq496n"}],"identifier":"kerchunk","label":"Kerchunk","html_id":"kerchunk-2","implicit":true,"key":"iZB12RL2wf"}],"key":"PSvI71vqwn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\n\nds = xr.open_dataset(\n    'virtual_zarr/kerchunk/gridmet.json',\n    chunks={},\n    engine=\"kerchunk\",\n    backend_kwargs={\n        \"storage_options\": {\n            \"remote_protocol\": \"s3\",\n            \"remote_options\": reader_options['storage_options']\n        },\n    }\n)\n\nkerchunk_read_time = time.time() - t0\n\nds","key":"eq6cbfi0Sf"},{"type":"outputs","id":"yi-qbkh3yfvNkepSaNBBF","children":[],"key":"mt1rfSSNRI"}],"key":"QzW7gqilAC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WyuTU7NtDK"}],"identifier":"virtualizarr","label":"VirtualiZarr","html_id":"virtualizarr-2","implicit":true,"key":"eNhdJBjZgD"}],"key":"xRuAqfDCeK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\n\nds = xr.open_dataset(\n    'virtual_zarr/virtualizarr/gridmet.json',\n    chunks={},\n    engine=\"kerchunk\",\n    backend_kwargs={\n        \"storage_options\": {\n            \"remote_protocol\": \"s3\",\n            \"remote_options\": reader_options['storage_options']\n        },\n    }\n)\n\nvirtualizarr_read_time = time.time() - t0\n\nds","key":"v4b7mjFx7w"},{"type":"outputs","id":"dNaqjhUsXw6XCB0bXErjX","children":[],"key":"wjK8th69vo"}],"key":"salxhXoZyO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reading with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dkDnRbxYgq"},{"type":"inlineCode","value":"xarray.open_mfdataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DqtW6Ms2I1"}],"identifier":"reading-with-xarray-open-mfdataset","label":"Reading with xarray.open_mfdataset","html_id":"reading-with-xarray-open-mfdataset","implicit":true,"key":"i6VZ33p7gR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"As a comparison of read times, let’s also compile the dataset using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ygX8t3YaqR"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"xarray.open_mfdataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gG1znihGHx"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.open_mfdataset.html","key":"Iw89JjGIWv"},{"type":"text","value":" in parallel with Dask.\nThis way we can see if we will be saving time in the future by having the compiled virtual Zarr for faster reads.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"V0tUvE59AA"}],"key":"wmZyfVX4QF"}],"key":"y57twiw9iC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time \nt0 = time.time()\n\nds = xr.open_mfdataset(\n    [fs.open(file) for file in file_glob],\n    chunks={},\n    parallel=True,\n    engine='h5netcdf'\n)\n\nopen_mfdataset_time = time.time() - t0\n\nds","key":"ojpZkWqmPT"},{"type":"outputs","id":"ur01YzJz1ji2vKPZI2s9m","children":[],"key":"vREhNnwYT3"}],"key":"HcJnvUJPtt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s compare the computational times!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kj6AwcCgiq"}],"key":"B6EIF3s1jI"}],"key":"eKtEyVkGBf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Kerchunk virtual Zarr creation time: \"\n      f\"{kerchunk_time:.0f}s ({kerchunk_time/60:.1f} min)\")\nprint(\"VirtualiZarr virtual Zarr creation time: \"\n      f\"{virtualizarr_time:.0f}s ({virtualizarr_time/60:.1f} min)\")\nprint(\"open_mfdataset dataset creation time: \"\n      f\"{open_mfdataset_time:.0f}s ({open_mfdataset_time/60:.1f} min)\")\nprint(f\"Time ratio: Kerchunk to open_mfdataset = {kerchunk_time/open_mfdataset_time:.2f}\\n\"\n      f\"            VirtualiZarr to open_mfdataset = {virtualizarr_time/open_mfdataset_time:.2f}\\n\"\n      f\"            Kerchunk to VirtualiZarr = {kerchunk_time/virtualizarr_time:.2f}\")","key":"e8nD2Ie7IJ"},{"type":"outputs","id":"Te-LXGHslnup677Vtm4oV","children":[],"key":"rCoJC6czDj"}],"key":"ZZLAakjySY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As we can see the Kerchunk and VirtualiZarr take about the same amount of time to create a virtual zarr store. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fOHoM59M48"},{"type":"inlineCode","value":"open_mfdataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yVzeOC77KK"},{"type":"text","value":" can create the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CRPhAkUK44"},{"type":"inlineCode","value":"Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z9cZTshLl9"},{"type":"text","value":" on the fly in slightly less time than it takes to create the virtual zarr stores (about 30 seconds less, in this case). However, if you use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FXa5unocWr"},{"type":"inlineCode","value":"open_mfdataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"du67YBZojh"},{"type":"text","value":", you will have to create this dataset ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ztxlPPIoVX"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"each time","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IEgvnKLJUf"}],"key":"SaMkf0p0ov"},{"type":"text","value":" you run your code, whereas Kerchunk and Virtualizarr can create the dataset once and then read it much faster on future uses. Looking at read speed after the virtual Zarr store creation:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OxRdgBK8Cf"}],"key":"KNu4r9o0jj"}],"key":"ZCE12Naju5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Kerchunk virtual Zarr read time: \"\n      f\"{kerchunk_read_time:.2f}s\")\nprint(\"VirtualiZarr virtual Zarr read time: \"\n      f\"{virtualizarr_read_time:.2f}s\")\nprint(\"open_mfdataset dataset read/creation time: \"\n      f\"{open_mfdataset_time:.0f}s ({open_mfdataset_time/60:.1f} min)\")\nprint(f\"Time ratio: Kerchunk to open_mfdataset = {kerchunk_read_time/open_mfdataset_time:.3f}\\n\"\n      f\"            VirtualiZarr to open_mfdataset = {virtualizarr_read_time/open_mfdataset_time:.3f}\\n\"\n      f\"            Kerchunk to VirtualiZarr = {kerchunk_read_time/virtualizarr_read_time:.3f}\")","key":"n1mxR0AUM9"},{"type":"outputs","id":"GM2I_6ftcKXjvnIPBM2_s","children":[],"key":"lUs56tb2iG"}],"key":"o04e61U90Z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"From this, it is very clear that performing more than one read using either the Kerchunk or VirtualiZarr virtual Zarr store is more efficient that reading with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oBd6WvATxN"},{"type":"inlineCode","value":"open_mfdataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C23MAOwJrl"},{"type":"text","value":".\nAdditionally, the differences in read times between Kerchunk and Virtualizarr, while appearing drastic, is likely not going to be significant in any workflow.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ePyuOuFUqJ"}],"key":"bgjbcjvuBp"}],"key":"c7nHlAfMPJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Appending to Existing Virtual Zarr Store","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Udpent8Eo9"}],"identifier":"appending-to-existing-virtual-zarr-store","label":"Appending to Existing Virtual Zarr Store","html_id":"appending-to-existing-virtual-zarr-store","implicit":true,"key":"JQYsaFmS0F"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"As noted when ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qmiuxgiMNl"},{"type":"crossReference","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"introducing the gridMET data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UdcxksX5gk"}],"identifier":"example-comparison","label":"Example-Comparison","kind":"heading","template":"{name}","resolved":true,"html_id":"example-comparison","key":"qPRbMOhjea"},{"type":"text","value":", we did not utilize the 2019 data in order to show how to append it to a virtual Zarr store.\nThe ability to append more data to the virtual Zarr store is highly convienient, as plenty of datasets are continuously updated as new data becomes available.\nSo, let’s appends some data to our virtual Zarr stores we just made.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NibfBJjFQl"}],"key":"nmsxKBHPOM"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"First, we create the 2019 file glob.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"vVLhRDnDQw"}],"key":"ZzwJJNpiDR"}],"key":"VNAZiaPwpZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"file_glob_2019 = fs.glob('s3://mdmf/gdp/netcdf/gridmet/gridmet/*_2019.nc')","key":"v1OTZNeuHn"},{"type":"outputs","id":"v7mlVW9GHGAYp1bmDR6_K","children":[],"key":"p8lVFoS9JQ"}],"key":"PBPtH9cJMT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create New Virtual Zarr for New File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PLh7O6kcwM"}],"identifier":"create-new-virtual-zarr-for-new-file","label":"Create New Virtual Zarr for New File","html_id":"create-new-virtual-zarr-for-new-file","implicit":true,"key":"jcD4DXspQY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Next, we need to get our 2019 NetCDFs into a virtual Zarr store.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j8XxeMaaeY"}],"key":"vL8rhMRwPr"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sauOi7nRxc"}],"identifier":"kerchunk","label":"Kerchunk","html_id":"kerchunk-3","implicit":true,"key":"xiGxMCn6Yx"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We will do this for Kerchunk the same way we did before, by using ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZSXNFQYk78"},{"type":"link","url":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"kerchunk.hdf.SingleHdf5ToZarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jMpvzBdfqd"}],"urlSource":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.hdf.SingleHdf5ToZarr","key":"WsfjrcfVin"},{"type":"text","value":", which translates the content of one HDF5 (NetCDF4) file into Zarr metadata.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"A7aALWuyQi"}],"key":"cTwzymNzQu"}],"key":"VdE5RYJriV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tasks = [generate_single_virtual_zarr(file) for file in file_glob_2019]\nsingle_virtual_zarrs_2019 = dask.compute(*tasks)","key":"M8uKaJoPFR"},{"type":"outputs","id":"vLBL_z8B9VYkHuA4OgIiM","children":[],"key":"CClH4ycosv"}],"key":"RhT2furVAs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FZ9WtxoZ5h"}],"identifier":"virtualizarr","label":"VirtualiZarr","html_id":"virtualizarr-3","implicit":true,"key":"l7P4rh2vKj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"And for VirtualiZarr, we will use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Vuuvv9zBLu"},{"type":"link","url":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"virtualizarr.open_virtual_dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hVj7ge2xap"}],"urlSource":"https://virtualizarr.readthedocs.io/en/stable/generated/virtualizarr.backend.open_virtual_dataset.html#virtualizarr-backend-open-virtual-dataset","key":"dLXfIlj6oN"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MizSgOFBzO"}],"key":"NaAMtpvrGB"}],"key":"gz2azGo2fq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tasks = [\n    dask.delayed(open_virtual_dataset)(\n        f's3://{file}',\n        indexes={},\n        loadable_variables=['day', 'lat', 'lon', 'crs'],\n        decode_times=True,\n        reader_options=reader_options\n    )\n    for file in file_glob_2019\n]\n\nvirtual_datasets_2019 = dask.compute(*tasks)","key":"BPeHRy48F2"},{"type":"outputs","id":"KQKdb1cfX35LGIandC8Se","children":[],"key":"ht486bQ66V"}],"key":"Hd6GQy7imV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Append to Existing Store","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZRP4OD8MHx"}],"identifier":"append-to-existing-store","label":"Append to Existing Store","html_id":"append-to-existing-store","implicit":true,"key":"i0HgfsmN28"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now, we can append the virtualized NetCDFs to our existing stores.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XqmJRo5cin"}],"key":"XfjH6bwLVE"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ec1MMBb6My"}],"identifier":"kerchunk","label":"Kerchunk","html_id":"kerchunk-4","implicit":true,"key":"XeF6LxsuZc"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"For Kerchunk, we will use still ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ly3mKw6V9D"},{"type":"link","url":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"kerchunk.combine.MultiZarrToZarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dmLa6yvCYq"}],"urlSource":"https://fsspec.github.io/kerchunk/reference.html#kerchunk.combine.MultiZarrToZarr","key":"VH6pKfh5z3"},{"type":"text","value":".\nHowever, this time we will need to use the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"r1xp2io39o"},{"type":"inlineCode","value":"append","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ODa644Jkyx"},{"type":"text","value":" method to append our new data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ruUyOliV20"}],"key":"ukZd6uXDKB"}],"key":"LgSJoGrhBU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Append to the existing reference file\nmzz = kerchunk.combine.MultiZarrToZarr.append(\n    single_virtual_zarrs_2019,\n    original_refs=out,\n    concat_dims=[\"day\"],\n    remote_protocol='s3',\n    remote_options=reader_options['storage_options'],\n)\n\nout_2019 = mzz.translate()\n\n# Save the virtual Zarr store, serialized as json\nwith fs_local.open('virtual_zarr/kerchunk/gridmet_appended.json', 'wb') as f:\n    f.write(ujson.dumps(out_2019).encode())","key":"dnjqqwnVo7"},{"type":"outputs","id":"r6VamzdsEKi6fnwFj9_tf","children":[],"key":"Gl8zXA8hDF"}],"key":"tQJ3mC0vAI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SqSbhGbNku"}],"identifier":"virtualizarr","label":"VirtualiZarr","html_id":"virtualizarr-4","implicit":true,"key":"g5eM9Gcjfe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For VirtualiZarr, we can just use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sp9Yt7nQYr"},{"type":"inlineCode","value":"xarray.concat","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hOxcQSeQgx"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tRNXqDBfwR"},{"type":"inlineCode","value":"xarray.merge","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LfM0bWVPMD"},{"type":"text","value":" like would to combine any ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XJk8nnLklp"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kU8HaSfcDU"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PBDYdCMhTf"}],"key":"ZCP8TkWquN"}],"key":"IxxluqEG0n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"virtual_ds_2019 = xr.merge(virtual_datasets_2019, compat='override', combine_attrs='override')\nvirtual_ds = xr.concat([virtual_ds, virtual_ds_2019], dim='day', coords='minimal', compat='override', combine_attrs='override')\nvirtual_ds","key":"ktQqU69mUB"},{"type":"outputs","id":"YLIhhK-f65pDhMDxjDeo4","children":[],"key":"G6OImd8bja"}],"key":"WXN8PBTEJK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This simple ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B4NBXNgblU"},{"type":"inlineCode","value":"xarray.merge","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YHyQppM8nx"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CjSQuZg0xR"},{"type":"inlineCode","value":"concat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VSXCBxwz7i"},{"type":"text","value":" is the major advantage of VirtualiZarr.\nRather than having to figure out Kerchunk’s syntax and commands, we can keep using xarray as we already do.\nTherefore, the increase in time to create the virtual Zarr store compared to Kerchunk is likely worth it due to its native compatibility with xarray.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iI1uopoujX"}],"key":"Mm8uUGm8wv"}],"key":"sH4gI8NMpI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Double Check New Stores","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VdjypWwWKc"}],"identifier":"double-check-new-stores","label":"Double Check New Stores","html_id":"double-check-new-stores","implicit":true,"key":"TRzdfqAv5v"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Finally, let’s read in the appended stores to make sure that we correctly appended the 2019 data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mUV8Sew5DD"}],"key":"OmcdOEz4zy"}],"key":"SCn73NXIbL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = xr.open_dataset(\n    'virtual_zarr/kerchunk/gridmet_appended.json',\n    engine=\"kerchunk\",\n    chunks={},\n    backend_kwargs={\n        \"storage_options\": {\n            \"remote_protocol\": \"s3\",\n            \"remote_options\": reader_options['storage_options']\n        },\n    }\n)\nds","key":"SBf8PpN1mb"},{"type":"outputs","id":"_t0aNl7qxcqBcfBGIc4ru","children":[],"key":"myASg1W86J"}],"key":"t20ocICTo4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Nice!\nThe 2019 data is now appended and showing on the day coordinate.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GauNxLTRVV"}],"key":"D1SpFmevar"}],"key":"xtwVaJj4mD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Clean Up","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NSsQz3YFOg"}],"identifier":"clean-up","label":"Clean Up","html_id":"clean-up","implicit":true,"key":"Hom0Sv2VmP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Rather than deleting the virtual Zarr stores that we created, we will actually keep them for use in future tutorials.\nHowever, we will do want to conform with best practices and close our Dask client and cluster.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kavK2qXI46"}],"key":"eJnNOgIRfX"}],"key":"uUcF7hX13C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.close()\ncluster.close()","key":"BFb7xl9NYr"},{"type":"outputs","id":"0PyfyypGQlhRzLzs0yzvF","children":[],"key":"TFHcC5JhSF"}],"key":"E3N7Xahgrs"}],"key":"aWsMGUevW9"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Rechunking Larger Datasets with Dask","url":"/dataset-processing/tutorials/chunking/201/rechunkingwithdask","group":"Zarr Creation"},"next":{"title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","url":"/dataset-processing/tutorials/chunking/201/includecrsinzarr","group":"Zarr Creation"}}},"domain":"http://localhost:3005"},"project":{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hytest//build/manifest-5D5D9E8C.js";
import * as route0 from "/hytest//build/root-AA24SA6C.js";
import * as route1 from "/hytest//build/routes/$-5SFLQWPV.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hytest//build/entry.client-PCJPW7TK.js");</script></body></html>