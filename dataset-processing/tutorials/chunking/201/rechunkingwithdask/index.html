<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Rechunking Larger Datasets with Dask - HyTEST Project</title><meta property="og:title" content="Rechunking Larger Datasets with Dask - HyTEST Project"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/hytest//build/_assets/app-SDGCW62C.css"/><link rel="stylesheet" href="/hytest//build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hytest//favicon.ico"/><link rel="stylesheet" href="/hytest//myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hytest//"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="HyTEST Project" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hytest//">HyTEST Project</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Environment Set-Up" class="block break-words rounded py-2 grow cursor-pointer">Environment Set-Up</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Getting Started" class="block break-words rounded py-2 grow cursor-pointer">Getting Started</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Access" class="block break-words rounded py-2 grow cursor-pointer">Dataset Access</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Zarr Creation" class="block break-words rounded py-2 grow cursor-pointer">Zarr Creation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Processing" class="block break-words rounded py-2 grow cursor-pointer">Dataset Processing</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Model Evaluation" class="block break-words rounded py-2 grow cursor-pointer">Model Evaluation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Back Matter" class="block break-words rounded py-2 grow cursor-pointer">Back Matter</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/hytest-org/hytest" title="GitHub Repository: hytest-org/hytest" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Rechunking Larger Datasets with Dask</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="kXbIFlzTjf" class="myst-jp-nb-block relative group/block"><p>The goal of this notebook is to expand on the rechunking performed in the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">Introductory Rechunking tutorial</a>.
This notebook will perfrom the same operations, but will work on the <strong>much</strong> larger dataset and involve some parallelization using <a target="_blank" rel="noreferrer" href="https://www.dask.org/" class="">dask</a>.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>You should only run workflows like this tutorial on a cloud or HPC compute node.
In application, this will require reading and writing <strong>enormous</strong> amounts of data.
Using a typical network connection and simple compute environment, you would saturate your bandwidth and max out your processor, thereby taking days for the rechunking to complete.</p></div></aside></div><div id="d7BGId38Ct" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
# Needed when boto3 &gt;= 1.36.0 or the rechunking process will fail
# This needs to be set before the boto3 library gets loaded
# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168
os.environ[&#x27;AWS_REQUEST_CHECKSUM_CALCULATION&#x27;] = &#x27;when_required&#x27;
os.environ[&#x27;AWS_RESPONSE_CHECKSUM_VALIDATION&#x27;] = &#x27;when_required&#x27;
import xarray as xr
import fsspec
from rechunker import rechunk
import zarr
import dask.diagnostics
import logging
import dask
import configparser

dask.config.set({&#x27;temporary_directory&#x27;:&#x27;../&#x27;})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="uxN7B5v07BkCrfPBQr3aR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Tq6x46Vazv" class="myst-jp-nb-block relative group/block"><h2 id="read-in-a-zarr-store" class="relative group"><span class="heading-text">Read in a Zarr Store</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#read-in-a-zarr-store" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Like the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">Introductory Rechunking tutorial</a>, we will use the data from the National Water Model Retrospective Version 2.1.
The full dataset is part of the <a target="_blank" rel="noreferrer" href="https://aws.amazon.com/opendata/" class="">AWS Open Data Program</a>, available via the S3 bucket at: <code>s3://noaa-nwm-retro-v2-zarr-pds/</code>.</p><p>As this is a Zarr store, let’s read it in with <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html" class=""><code>xarray.open_dataset()</code></a> and <code>engine=&#x27;zarr&#x27;</code>.</p></div><div id="Xnn7KxQSGR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">file = fsspec.get_mapper(&#x27;s3://noaa-nwm-retro-v2-zarr-pds&#x27;, anon=True)
ds = xr.open_dataset(file, chunks={}, engine=&#x27;zarr&#x27;)
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="d9rQ5SjK4qM1vFoU_Beoc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kl5N5aE9VD" class="myst-jp-nb-block relative group/block"><h2 id="restrict-for-tutorial" class="relative group"><span class="heading-text">Restrict for Tutorial</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#restrict-for-tutorial" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>As we saw in the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">Introductory Rechunking tutorial</a>, this dataset is massive, taking up almost 32 TiB uncompressed.
As this is a tutorial, we will still restrict the data to a subset - we don’t really need to work on the entire dataset to demonstrate how to use dask to scale up.
Following the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">Introductory Rechunking tutorial</a> let’s only look at <code>streamflow</code> and <code>velocity</code> for the first 15,000 <code>feature_id</code>s, |but we will look at the entire 2000s decade of water years (October 1999 through September 2009) instead of a single water year this time.
This will make our dataset larger-than-memory, but it should still run in a reasonable amount of time.</p><p>For processing the full-sized dataset, you’d just skip this step where we slice off a representative example of the data.
Expect run time to increase in proportion to the size of the data being processed.</p></div><div id="mjJD0tzY5P" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds = ds[[&#x27;streamflow&#x27;, &#x27;velocity&#x27;]]
ds = ds.isel(feature_id=slice(0, 15000))
ds = ds.sel(time=slice(&#x27;1999-10-01&#x27;, &#x27;2009-09-30&#x27;))
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Q2R3iK-MeV56mqSoW8nEF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MMBgdkPwl1" class="myst-jp-nb-block relative group/block"><p>Now, our subset of data is only about 10 GiB per data variable and has a chunk shape of <code>{&#x27;time&#x27;: 672, &#x27;feature_id&#x27;: 15000}</code> with size of 76.9 MiB.
However, the chunk shape is not an optimal choice for our analysis as it is chunked completely by <code>feature_id</code> (i.e., all feature IDs for a given time can be read in a single chunk).
Following the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">Introductory Rechunking tutorial</a>, let’s get chunk shapes that are time-series wise chunking (i.e., all <code>time</code> for a given <code>feature_id</code> in one chunk) for streamflow and balanced for velocity.</p></div><div id="sKLPQn9ZNc" class="myst-jp-nb-block relative group/block"><h2 id="rechunk-plan" class="relative group"><span class="heading-text">Rechunk Plan</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#rechunk-plan" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Using our general strategy of time-series wise chunking for streamflow and balanced for velocity,
let’s compute how large the chunk sizes will be if we have chunk shapes of <code>{&#x27;time&#x27;: 87672, &#x27;feature_id&#x27;: 1}</code> for streamflow and 3 chunks per dimension for velocity.</p></div><div id="OZIGwWID2n" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">nfeature = len(ds.feature_id)
ntime = len(ds.time)

streamflow_chunk_plan = {&#x27;time&#x27;: ntime, &#x27;feature_id&#x27;: 1}
bytes_per_value = ds.streamflow.dtype.itemsize
total_bytes = streamflow_chunk_plan[&#x27;time&#x27;] * streamflow_chunk_plan[&#x27;feature_id&#x27;] * bytes_per_value
streamflow_MiB = total_bytes / (2 ** 10) ** 2
partial_chunks = {&#x27;time&#x27;: ntime -  streamflow_chunk_plan[&#x27;time&#x27;] * (ntime / streamflow_chunk_plan[&#x27;time&#x27;]),
                  &#x27;feature_id&#x27;: nfeature -  streamflow_chunk_plan[&#x27;feature_id&#x27;] * (nfeature / streamflow_chunk_plan[&#x27;feature_id&#x27;]),}
print(&quot;STREAMFLOW \n&quot;
      f&quot;Chunk of shape {streamflow_chunk_plan} \n&quot;
      f&quot;Partial &#x27;time&#x27; chunk remainder: {partial_chunks[&#x27;time&#x27;]} ({partial_chunks[&#x27;time&#x27;]/streamflow_chunk_plan[&#x27;time&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Partial &#x27;feature_id&#x27; chunk remainder: {partial_chunks[&#x27;feature_id&#x27;]} ({partial_chunks[&#x27;feature_id&#x27;]/streamflow_chunk_plan[&#x27;feature_id&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Chunk size: {streamflow_MiB:.2f} [MiB] \n&quot;)

chunks_per_dim = 3
velocity_chunk_plan = {&#x27;time&#x27;: ntime // chunks_per_dim, &#x27;feature_id&#x27;: nfeature // chunks_per_dim}
bytes_per_value = ds.velocity.dtype.itemsize
total_bytes = velocity_chunk_plan[&#x27;time&#x27;] * velocity_chunk_plan[&#x27;feature_id&#x27;] * bytes_per_value
velocity_MiB = total_bytes / (2 ** 10) ** 2
partial_chunks = {&#x27;time&#x27;: ntime -  velocity_chunk_plan[&#x27;time&#x27;] * chunks_per_dim,
                  &#x27;feature_id&#x27;: nfeature -  velocity_chunk_plan[&#x27;feature_id&#x27;] * chunks_per_dim,}
print(&quot;VELOCITY \n&quot;
      f&quot;Chunk of shape {velocity_chunk_plan} \n&quot;
      f&quot;Partial &#x27;time&#x27; chunk remainder: {partial_chunks[&#x27;time&#x27;]} ({partial_chunks[&#x27;time&#x27;]/velocity_chunk_plan[&#x27;time&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Partial &#x27;feature_id&#x27; chunk remainder: {partial_chunks[&#x27;feature_id&#x27;]} ({partial_chunks[&#x27;feature_id&#x27;]/velocity_chunk_plan[&#x27;feature_id&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Chunk size: {velocity_MiB:.2f} [MiB]&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="N7zWGXOsOkcA7o8bOucZ4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jhE5XYIG4O" class="myst-jp-nb-block relative group/block"><p>Okay, we can see that the streamflow chunk size is way to small by a factor of ~100.
So, let’s include 100 feature IDs per chunk.
As for velocity, it is ~10x too big.
As it is an even chunk split, that means we need to increase the number of chunks per dimension by ~<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mn>10</mn></msqrt><mo>≈</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\sqrt{10} \approx 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">10</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span>.
However knowing that the time dimension is hourly, we can get no partial chunks if our chunk per dimension is a divisor of 24.
Luckily, this also applies to the feature ID dimension as 15000 is a multiple of 24.
So, rather than increasing our chunks per dimension by a factor of 3 to 9, let’s increase them to 12 as this will give no partial chunks.</p></div><div id="CFSgXAZejh" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">nfeature = len(ds.feature_id)
ntime = len(ds.time)

streamflow_chunk_plan = {&#x27;time&#x27;: ntime, &#x27;feature_id&#x27;: 100}
bytes_per_value = ds.streamflow.dtype.itemsize
total_bytes = streamflow_chunk_plan[&#x27;time&#x27;] * streamflow_chunk_plan[&#x27;feature_id&#x27;] * bytes_per_value
streamflow_MiB = total_bytes / (2 ** 10) ** 2
partial_chunks = {&#x27;time&#x27;: ntime -  streamflow_chunk_plan[&#x27;time&#x27;] * (ntime / streamflow_chunk_plan[&#x27;time&#x27;]),
                  &#x27;feature_id&#x27;: nfeature -  streamflow_chunk_plan[&#x27;feature_id&#x27;] * (nfeature / streamflow_chunk_plan[&#x27;feature_id&#x27;]),}
print(&quot;STREAMFLOW \n&quot;
      f&quot;Chunk of shape {streamflow_chunk_plan} \n&quot;
      f&quot;Partial &#x27;time&#x27; chunk remainder: {partial_chunks[&#x27;time&#x27;]} ({partial_chunks[&#x27;time&#x27;]/streamflow_chunk_plan[&#x27;time&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Partial &#x27;feature_id&#x27; chunk remainder: {partial_chunks[&#x27;feature_id&#x27;]} ({partial_chunks[&#x27;feature_id&#x27;]/streamflow_chunk_plan[&#x27;feature_id&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Chunk size: {streamflow_MiB:.2f} [MiB] \n&quot;)

chunks_per_dim = 12
velocity_chunk_plan = {&#x27;time&#x27;: ntime // chunks_per_dim, &#x27;feature_id&#x27;: nfeature // chunks_per_dim}
bytes_per_value = ds.velocity.dtype.itemsize
total_bytes = velocity_chunk_plan[&#x27;time&#x27;] * velocity_chunk_plan[&#x27;feature_id&#x27;] * bytes_per_value
velocity_MiB = total_bytes / (2 ** 10) ** 2
partial_chunks = {&#x27;time&#x27;: ntime -  velocity_chunk_plan[&#x27;time&#x27;] * chunks_per_dim,
                  &#x27;feature_id&#x27;: nfeature -  velocity_chunk_plan[&#x27;feature_id&#x27;] * chunks_per_dim,}
print(&quot;VELOCITY \n&quot;
      f&quot;Chunk of shape {velocity_chunk_plan} \n&quot;
      f&quot;Partial &#x27;time&#x27; chunk remainder: {partial_chunks[&#x27;time&#x27;]} ({partial_chunks[&#x27;time&#x27;]/velocity_chunk_plan[&#x27;time&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Partial &#x27;feature_id&#x27; chunk remainder: {partial_chunks[&#x27;feature_id&#x27;]} ({partial_chunks[&#x27;feature_id&#x27;]/velocity_chunk_plan[&#x27;feature_id&#x27;]:.3f}% of a chunk)\n&quot;
      f&quot;Chunk size: {velocity_MiB:.2f} [MiB]&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Yr9TYsc0Cvavn8ujgI-9h" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kohO9pCjJl" class="myst-jp-nb-block relative group/block"><p>Nice!
Now, our chunks are a reasonable size and have no remainders.
So, let’s use these chunk plans for our rechunking.</p></div><div id="bdKBY12yzg" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">chunk_plan = {
    &#x27;streamflow&#x27;: streamflow_chunk_plan,
    &#x27;velocity&#x27;: velocity_chunk_plan,
     # We don&#x27;t want any of the coordinates chunked
    &#x27;latitude&#x27;: (nfeature,),
    &#x27;longitude&#x27;: (nfeature,),    
    &#x27;time&#x27;: (ntime,),
    &#x27;feature_id&#x27;: (nfeature,)
}
chunk_plan</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="crNWf3tHLJZxpKm6ntZak" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="WNsNM0KXfd" class="myst-jp-nb-block relative group/block"><h2 id="rechunk-with-rechunker" class="relative group"><span class="heading-text">Rechunk with Rechunker</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#rechunk-with-rechunker" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>With this plan, we can now ask Rechunker to re-write the data using the prescribed chunking pattern.</p><h3 id="set-up-output-location" class="relative group"><span class="heading-text">Set up output location</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#set-up-output-location" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Unlike with the smaller dataset in our previous rechunking tutorial, we will write this larger dataset to an object store (similar to an S3 bucket) on the USGS OSN Pod.
So, we need to set that up so that Rechunker will have a suitable place to write data.</p><p>First, we need to set up our credentials that allow us to write to the OSN Pod and direct it to the endpoint where the OSN Pod is located (while it is available via the S3 API, it is not in AWS, so we have to tell it where to find the pod!). If you do not already have access to the credentials to write to the OSN Pod and you are a USGS staff member or collaborator, please reach out to <a target="_blank" rel="noreferrer" href="mailto:asnyder@usgs.gov" class="">asnyder@usgs.gov</a> to request them. If you are not a USGS staff or collaborator, you will need to set up a different location that to you have write permissions to. This could be an AWS S3 bucket that you have access too or you could even set up an <code>fsspec</code> <code>LocalFileSystem</code>.</p></div><div id="nkMOWv3QGj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">awsconfig = configparser.ConfigParser()
awsconfig.read(
    os.path.expanduser(&#x27;~/.aws/credentials&#x27;) 
    # default location... if yours is elsewhere, change this.
)
_profile_nm  = &#x27;osn-hytest-scratch&#x27;
_endpoint = &#x27;https://usgs.osn.mghpcc.org/&#x27;

# Set environment vars based on parsed awsconfig
try:
    os.environ[&#x27;AWS_ACCESS_KEY_ID&#x27;]     = awsconfig[_profile_nm][&#x27;aws_access_key_id&#x27;]
    os.environ[&#x27;AWS_SECRET_ACCESS_KEY&#x27;] = awsconfig[_profile_nm][&#x27;aws_secret_access_key&#x27;]
    os.environ[&#x27;AWS_S3_ENDPOINT&#x27;]       = _endpoint
    os.environ[&#x27;AWS_PROFILE&#x27;] = _profile_nm
    os.environ[&#x27;AWS_DEFAULT_PROFILE&#x27;] = _profile_nm
except KeyError as e:
    logging.error(&quot;Problem parsing the AWS credentials file. &quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ca1v25mJEoRilhw33yhS6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZKToX5pdgI" class="myst-jp-nb-block relative group/block"><p>Next, we make our S3 <code>fsspec.filesystem</code> with the required user info and get the mapper to this file to pass to Rechunker.</p></div><div id="EaSH96toOH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from getpass import getuser
uname=getuser()

fs = fsspec.filesystem(
    &#x27;s3&#x27;, 
    anon=False, 
    default_fill_cache=False, 
    skip_instance_cache=True, 
    client_kwargs={&#x27;endpoint_url&#x27;: os.environ[&#x27;AWS_S3_ENDPOINT&#x27;], }
)

output_dir = f&#x27;s3://hytest-scratch/rechunking_tutorial/{uname}/&#x27;

temp_store = fs.get_mapper(output_dir + &#x27;temp_store.zarr&#x27;)
target_store = fs.get_mapper(output_dir + &#x27;tutorial_rechunked.zarr&#x27;)
# Check if the objects exist and remove if they do
for filename in [temp_store, target_store]:
    try:
        fs.rm(filename.root, recursive=True)
    except:
        FileNotFoundError</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="o1WDqy4xxF8dOygsdCoza" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UsW2qnWpRt" class="myst-jp-nb-block relative group/block"><h3 id="spin-up-dask-cluster" class="relative group"><span class="heading-text">Spin up Dask Cluster</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spin-up-dask-cluster" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Our rechunking operation will be able to work in parallel.
To do that, we will spin up a dask cluster to schedule the various workers.</p><p>This cluster will be configured differently depending on where you compute is performed. We have set up this notebook to run on <a target="_blank" rel="noreferrer" href="https://www.nebari.dev/" class="">Nebari</a>. If you are working on USGS systems, you can likely use one of our <a target="_blank" rel="noreferrer" href="https://hytest-org.github.io/hytest/environment_set_up/clusters.html" class="">example codes to spin up a dask cluster</a>. Otherwise, please refer to the <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/deploying.html" class="">dask deployment docs</a> for details.</p></div><div id="h1QCr5snko" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%run ../../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb
## If this notebook is not being run on Nebari, replace the above 
## path name with a helper appropriate to your compute environment.  Examples:
# %run ../../../../environment_set_up/Start_Dask_Cluster_Denali.ipynb
# %run ../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb
# %run ../../../../environment_set_up/Start_Dask_Cluster_Desktop.ipynb</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="5GHGqkApMVK9ai9XmwgRz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BbqJO8yIJb" class="myst-jp-nb-block relative group/block"><h3 id="rechunk" class="relative group"><span class="heading-text">Rechunk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#rechunk" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Now, we are ready to rechunk!</p></div><div id="rXLPvym6jC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">result = rechunk(
    # Make sure the base chunks are correct
    ds.chunk({&#x27;time&#x27;: 672, &#x27;feature_id&#x27;: 15000}),
    target_chunks=chunk_plan,
    max_mem=&quot;2GB&quot;,
    target_store=target_store,
    temp_store=temp_store
)
result</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="b7bIa4un-RfL3RiR5ZrYi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Lf2vm7zKiu" class="myst-jp-nb-block relative group/block"><p>Remember that merely invoking Rechunker does not do any work.
It just sorts out the rechunking plan and writes metadata.
We need to call <code>.execute</code> on the <code>result</code> object to actually run the rechunking.</p></div><div id="smZ9bl1Zil" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">with dask.diagnostics.ProgressBar():
    r = result.execute(retries=10)  

# Also consolidate the metadata for fast reading into xarray
_ = zarr.consolidate_metadata(target_store)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="r78jhGhyH5siv-PfeXYXg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="tJn2anfBAF" class="myst-jp-nb-block relative group/block"><h2 id="confirm-the-creation-of-the-zarr-store-by-rechunker" class="relative group"><span class="heading-text">Confirm the Creation of the Zarr Store by Rechunker</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#confirm-the-creation-of-the-zarr-store-by-rechunker" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Let’s read in the resulting re-chunked dataset to confirm it turned out how we intended.</p></div><div id="qHoyQGrYmX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds_rechunked = xr.open_zarr(target_store)
ds_rechunked</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="g1cHiuYFSoO4GFxsAdtKH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UdNX8nZNaX" class="myst-jp-nb-block relative group/block"><p>Nice, looks good!
You may have noticed that the only difference between the <a class="" href="/hytest//dataset-processing/tutorials/chunking/101/rechunking">introductory tutorial on rechunking</a> and this is the inclusion of creating the dask cluster and where we saved the files.
Picking your compute environment and output location will typically be the only things that vary in other workflows requiring rechunking.
Therefore, if you understand this rechunking process you should be able to apply it to your own data efficiently.</p></div><div id="ijoAgoBUoK" class="myst-jp-nb-block relative group/block"><h2 id="clean-up" class="relative group"><span class="heading-text">Clean Up</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#clean-up" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>As we don’t want to keep this rechunked Zarr, let’s go ahead and delete it.
We will also conform with best practices and close our Dask client and cluster.</p></div><div id="w35hoaJRFU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fs.rm(temp_store.root, recursive=True)
fs.rm(target_store.root, recursive=True)
        
client.close()
cluster.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="tFOY_HgLKJrbaatYAkgLp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/hytest//dataset-processing/tutorials/chunking/201"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>Advanced Topics in Chunking</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hytest//dataset-processing/tutorials/chunking/201/createvirtualzarr"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Zarr Creation</div>Generating a Virtual Zarr Store</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hytest//build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-N76G4W6Y.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hytest//build/root-AA24SA6C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AH7OE64W.js"/><link rel="modulepreload" href="/hytest//build/routes/$-5SFLQWPV.js"/><script>window.__remixContext = {"url":"/dataset-processing/tutorials/chunking/201/rechunkingwithdask","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hytest/"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"623db27a81f0bb55be1f0fec6f67c97896a3707b97c3bda58a9c77da92cb358f","slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","location":"/dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb","dependencies":[],"frontmatter":{"title":"Rechunking Larger Datasets with Dask","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb","exports":[{"format":"ipynb","filename":"RechunkingwithDask.ipynb","url":"/hytest//build/RechunkingwithDask-ce64fc54b919abfe2ec18557fd0547ce.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The goal of this notebook is to expand on the rechunking performed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PxUqoqKWwG"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Introductory Rechunking tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zhC2zhWQj1"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"xHzfBRTxc0"},{"type":"text","value":".\nThis notebook will perfrom the same operations, but will work on the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B4RMMgvP4O"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"much","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HBycrH58rM"}],"key":"QEVDQNHlqI"},{"type":"text","value":" larger dataset and involve some parallelization using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kqCIuFDlWO"},{"type":"link","url":"https://www.dask.org/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dwYlopEziW"}],"urlSource":"https://www.dask.org/","key":"jZFzsKe2we"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JvHRthBlvW"}],"key":"febxpWOw2A"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"vFoWGZaQQm"}],"key":"NGgCwzMi7O"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"You should only run workflows like this tutorial on a cloud or HPC compute node.\nIn application, this will require reading and writing ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xfTwT1FsFV"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"enormous","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"W8jeZ1KECS"}],"key":"eVNsi0YHgb"},{"type":"text","value":" amounts of data.\nUsing a typical network connection and simple compute environment, you would saturate your bandwidth and max out your processor, thereby taking days for the rechunking to complete.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FanDFt6GVK"}],"key":"KJVqEaTQhF"}],"key":"MoXpKjFKNY"}],"key":"kXbIFlzTjf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\n# Needed when boto3 \u003e= 1.36.0 or the rechunking process will fail\n# This needs to be set before the boto3 library gets loaded\n# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168\nos.environ['AWS_REQUEST_CHECKSUM_CALCULATION'] = 'when_required'\nos.environ['AWS_RESPONSE_CHECKSUM_VALIDATION'] = 'when_required'\nimport xarray as xr\nimport fsspec\nfrom rechunker import rechunk\nimport zarr\nimport dask.diagnostics\nimport logging\nimport dask\nimport configparser\n\ndask.config.set({'temporary_directory':'../'})","key":"oK6oisQaS1"},{"type":"outputs","id":"uxN7B5v07BkCrfPBQr3aR","children":[],"key":"bXOOMJMpLB"}],"key":"d7BGId38Ct"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read in a Zarr Store","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yay8lF3fxW"}],"identifier":"read-in-a-zarr-store","label":"Read in a Zarr Store","html_id":"read-in-a-zarr-store","implicit":true,"key":"CydQaRHlf9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Like the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uqTn2GDAnA"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Introductory Rechunking tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uNJITZwN9J"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"hcgplipZuE"},{"type":"text","value":", we will use the data from the National Water Model Retrospective Version 2.1.\nThe full dataset is part of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZAMewXo5ER"},{"type":"link","url":"https://aws.amazon.com/opendata/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"AWS Open Data Program","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dGQGnTxaxd"}],"urlSource":"https://aws.amazon.com/opendata/","key":"LOeAnyRySA"},{"type":"text","value":", available via the S3 bucket at: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"umoRRUdnWx"},{"type":"inlineCode","value":"s3://noaa-nwm-retro-v2-zarr-pds/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Adk9q0fjR8"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VODNjJETYp"}],"key":"wnwLZXkpOF"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"As this is a Zarr store, let’s read it in with ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eho7v3FT6l"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"inlineCode","value":"xarray.open_dataset()","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BGwcvJo0qp"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html","key":"z4UkGXLiHH"},{"type":"text","value":" and ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GFdasU2EQx"},{"type":"inlineCode","value":"engine='zarr'","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"oIVfQkTvir"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"J2FOeh2VYg"}],"key":"VBm9Zbm96u"}],"key":"Tq6x46Vazv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"file = fsspec.get_mapper('s3://noaa-nwm-retro-v2-zarr-pds', anon=True)\nds = xr.open_dataset(file, chunks={}, engine='zarr')\nds","key":"VRPTAfd4ts"},{"type":"outputs","id":"d9rQ5SjK4qM1vFoU_Beoc","children":[],"key":"JD7NQzOqMG"}],"key":"Xnn7KxQSGR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Restrict for Tutorial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZvX3v23yHa"}],"identifier":"restrict-for-tutorial","label":"Restrict for Tutorial","html_id":"restrict-for-tutorial","implicit":true,"key":"Uli2yKwnIR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"As we saw in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eDoR5MLZOD"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Introductory Rechunking tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZGowsO8w5V"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"dy74Z7XxvK"},{"type":"text","value":", this dataset is massive, taking up almost 32 TiB uncompressed.\nAs this is a tutorial, we will still restrict the data to a subset - we don’t really need to work on the entire dataset to demonstrate how to use dask to scale up.\nFollowing the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oBRqocGDFT"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Introductory Rechunking tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jPUJitOOjR"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"rHQpfRJQmk"},{"type":"text","value":" let’s only look at ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JpXxrLcJJk"},{"type":"inlineCode","value":"streamflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hDa2vqEout"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u58KlSZ4VK"},{"type":"inlineCode","value":"velocity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MpaKCcSnxi"},{"type":"text","value":" for the first 15,000 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sAoK8lcFlc"},{"type":"inlineCode","value":"feature_id","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ajTUswdAwG"},{"type":"text","value":"s, |but we will look at the entire 2000s decade of water years (October 1999 through September 2009) instead of a single water year this time.\nThis will make our dataset larger-than-memory, but it should still run in a reasonable amount of time.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YGhlPRKsLr"}],"key":"yUJRLJS66t"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"For processing the full-sized dataset, you’d just skip this step where we slice off a representative example of the data.\nExpect run time to increase in proportion to the size of the data being processed.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"z857tj9aYo"}],"key":"Ws6jlNqcVh"}],"key":"kl5N5aE9VD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = ds[['streamflow', 'velocity']]\nds = ds.isel(feature_id=slice(0, 15000))\nds = ds.sel(time=slice('1999-10-01', '2009-09-30'))\nds","key":"mQawF7XpBp"},{"type":"outputs","id":"Q2R3iK-MeV56mqSoW8nEF","children":[],"key":"wVlpHotmmg"}],"key":"mjJD0tzY5P"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now, our subset of data is only about 10 GiB per data variable and has a chunk shape of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xmWO5g6luu"},{"type":"inlineCode","value":"{'time': 672, 'feature_id': 15000}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oPR8YMLptt"},{"type":"text","value":" with size of 76.9 MiB.\nHowever, the chunk shape is not an optimal choice for our analysis as it is chunked completely by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vdLNEc7iVU"},{"type":"inlineCode","value":"feature_id","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zNs1WsqfOY"},{"type":"text","value":" (i.e., all feature IDs for a given time can be read in a single chunk).\nFollowing the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"do77X0VsXK"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Introductory Rechunking tutorial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bF89xNSMqQ"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"Mu9urAcst1"},{"type":"text","value":", let’s get chunk shapes that are time-series wise chunking (i.e., all ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NZ0JexBfFg"},{"type":"inlineCode","value":"time","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pg8Lj4pj8K"},{"type":"text","value":" for a given ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VKDJuNdxbv"},{"type":"inlineCode","value":"feature_id","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bn7aR3BErj"},{"type":"text","value":" in one chunk) for streamflow and balanced for velocity.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PB8y0w70Ri"}],"key":"MPMaJI2llS"}],"key":"MMBgdkPwl1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Rechunk Plan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sOn0ZxGhh7"}],"identifier":"rechunk-plan","label":"Rechunk Plan","html_id":"rechunk-plan","implicit":true,"key":"PEwQsB9r29"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Using our general strategy of time-series wise chunking for streamflow and balanced for velocity,\nlet’s compute how large the chunk sizes will be if we have chunk shapes of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Xk8deoaD2s"},{"type":"inlineCode","value":"{'time': 87672, 'feature_id': 1}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TKhb69Rhes"},{"type":"text","value":" for streamflow and 3 chunks per dimension for velocity.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gvDlG0B0XC"}],"key":"AwWPy9Ktx9"}],"key":"sKLPQn9ZNc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nfeature = len(ds.feature_id)\nntime = len(ds.time)\n\nstreamflow_chunk_plan = {'time': ntime, 'feature_id': 1}\nbytes_per_value = ds.streamflow.dtype.itemsize\ntotal_bytes = streamflow_chunk_plan['time'] * streamflow_chunk_plan['feature_id'] * bytes_per_value\nstreamflow_MiB = total_bytes / (2 ** 10) ** 2\npartial_chunks = {'time': ntime -  streamflow_chunk_plan['time'] * (ntime / streamflow_chunk_plan['time']),\n                  'feature_id': nfeature -  streamflow_chunk_plan['feature_id'] * (nfeature / streamflow_chunk_plan['feature_id']),}\nprint(\"STREAMFLOW \\n\"\n      f\"Chunk of shape {streamflow_chunk_plan} \\n\"\n      f\"Partial 'time' chunk remainder: {partial_chunks['time']} ({partial_chunks['time']/streamflow_chunk_plan['time']:.3f}% of a chunk)\\n\"\n      f\"Partial 'feature_id' chunk remainder: {partial_chunks['feature_id']} ({partial_chunks['feature_id']/streamflow_chunk_plan['feature_id']:.3f}% of a chunk)\\n\"\n      f\"Chunk size: {streamflow_MiB:.2f} [MiB] \\n\")\n\nchunks_per_dim = 3\nvelocity_chunk_plan = {'time': ntime // chunks_per_dim, 'feature_id': nfeature // chunks_per_dim}\nbytes_per_value = ds.velocity.dtype.itemsize\ntotal_bytes = velocity_chunk_plan['time'] * velocity_chunk_plan['feature_id'] * bytes_per_value\nvelocity_MiB = total_bytes / (2 ** 10) ** 2\npartial_chunks = {'time': ntime -  velocity_chunk_plan['time'] * chunks_per_dim,\n                  'feature_id': nfeature -  velocity_chunk_plan['feature_id'] * chunks_per_dim,}\nprint(\"VELOCITY \\n\"\n      f\"Chunk of shape {velocity_chunk_plan} \\n\"\n      f\"Partial 'time' chunk remainder: {partial_chunks['time']} ({partial_chunks['time']/velocity_chunk_plan['time']:.3f}% of a chunk)\\n\"\n      f\"Partial 'feature_id' chunk remainder: {partial_chunks['feature_id']} ({partial_chunks['feature_id']/velocity_chunk_plan['feature_id']:.3f}% of a chunk)\\n\"\n      f\"Chunk size: {velocity_MiB:.2f} [MiB]\")","key":"mmgR9nrEjZ"},{"type":"outputs","id":"N7zWGXOsOkcA7o8bOucZ4","children":[],"key":"HXXkQFq575"}],"key":"OZIGwWID2n"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Okay, we can see that the streamflow chunk size is way to small by a factor of ~100.\nSo, let’s include 100 feature IDs per chunk.\nAs for velocity, it is ~10x too big.\nAs it is an even chunk split, that means we need to increase the number of chunks per dimension by ~","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V43WM1y8cO"},{"type":"inlineMath","value":"\\sqrt{10} \\approx 3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsqrt\u003e\u003cmn\u003e10\u003c/mn\u003e\u003c/msqrt\u003e\u003cmo\u003e≈\u003c/mo\u003e\u003cmn\u003e3\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\sqrt{10} \\approx 3\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.04em;vertical-align:-0.1328em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord sqrt\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9072em;\"\u003e\u003cspan class=\"svg-align\" style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\" style=\"padding-left:0.833em;\"\u003e\u003cspan class=\"mord\"\u003e10\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.8672em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'\u003e\u003cpath d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1328em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≈\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e3\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"HCKmeyfKtG"},{"type":"text","value":".\nHowever knowing that the time dimension is hourly, we can get no partial chunks if our chunk per dimension is a divisor of 24.\nLuckily, this also applies to the feature ID dimension as 15000 is a multiple of 24.\nSo, rather than increasing our chunks per dimension by a factor of 3 to 9, let’s increase them to 12 as this will give no partial chunks.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qzRAbk24we"}],"key":"sBJYVGkqZd"}],"key":"jhE5XYIG4O"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nfeature = len(ds.feature_id)\nntime = len(ds.time)\n\nstreamflow_chunk_plan = {'time': ntime, 'feature_id': 100}\nbytes_per_value = ds.streamflow.dtype.itemsize\ntotal_bytes = streamflow_chunk_plan['time'] * streamflow_chunk_plan['feature_id'] * bytes_per_value\nstreamflow_MiB = total_bytes / (2 ** 10) ** 2\npartial_chunks = {'time': ntime -  streamflow_chunk_plan['time'] * (ntime / streamflow_chunk_plan['time']),\n                  'feature_id': nfeature -  streamflow_chunk_plan['feature_id'] * (nfeature / streamflow_chunk_plan['feature_id']),}\nprint(\"STREAMFLOW \\n\"\n      f\"Chunk of shape {streamflow_chunk_plan} \\n\"\n      f\"Partial 'time' chunk remainder: {partial_chunks['time']} ({partial_chunks['time']/streamflow_chunk_plan['time']:.3f}% of a chunk)\\n\"\n      f\"Partial 'feature_id' chunk remainder: {partial_chunks['feature_id']} ({partial_chunks['feature_id']/streamflow_chunk_plan['feature_id']:.3f}% of a chunk)\\n\"\n      f\"Chunk size: {streamflow_MiB:.2f} [MiB] \\n\")\n\nchunks_per_dim = 12\nvelocity_chunk_plan = {'time': ntime // chunks_per_dim, 'feature_id': nfeature // chunks_per_dim}\nbytes_per_value = ds.velocity.dtype.itemsize\ntotal_bytes = velocity_chunk_plan['time'] * velocity_chunk_plan['feature_id'] * bytes_per_value\nvelocity_MiB = total_bytes / (2 ** 10) ** 2\npartial_chunks = {'time': ntime -  velocity_chunk_plan['time'] * chunks_per_dim,\n                  'feature_id': nfeature -  velocity_chunk_plan['feature_id'] * chunks_per_dim,}\nprint(\"VELOCITY \\n\"\n      f\"Chunk of shape {velocity_chunk_plan} \\n\"\n      f\"Partial 'time' chunk remainder: {partial_chunks['time']} ({partial_chunks['time']/velocity_chunk_plan['time']:.3f}% of a chunk)\\n\"\n      f\"Partial 'feature_id' chunk remainder: {partial_chunks['feature_id']} ({partial_chunks['feature_id']/velocity_chunk_plan['feature_id']:.3f}% of a chunk)\\n\"\n      f\"Chunk size: {velocity_MiB:.2f} [MiB]\")","key":"Ff5uPrkHyi"},{"type":"outputs","id":"Yr9TYsc0Cvavn8ujgI-9h","children":[],"key":"KTnNep75HR"}],"key":"CFSgXAZejh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Nice!\nNow, our chunks are a reasonable size and have no remainders.\nSo, let’s use these chunk plans for our rechunking.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jgCuAlE0gK"}],"key":"OyXX3IDLKB"}],"key":"kohO9pCjJl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"chunk_plan = {\n    'streamflow': streamflow_chunk_plan,\n    'velocity': velocity_chunk_plan,\n     # We don't want any of the coordinates chunked\n    'latitude': (nfeature,),\n    'longitude': (nfeature,),    \n    'time': (ntime,),\n    'feature_id': (nfeature,)\n}\nchunk_plan","key":"r44HygoFwR"},{"type":"outputs","id":"crNWf3tHLJZxpKm6ntZak","children":[],"key":"wICTwi3tzj"}],"key":"bdKBY12yzg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Rechunk with Rechunker","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rnAZWdT6H1"}],"identifier":"rechunk-with-rechunker","label":"Rechunk with Rechunker","html_id":"rechunk-with-rechunker","implicit":true,"key":"MVub918nOY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With this plan, we can now ask Rechunker to re-write the data using the prescribed chunking pattern.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UzkvQj7C5e"}],"key":"nMJRtQ2krU"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Set up output location","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LbQP6yJF17"}],"identifier":"set-up-output-location","label":"Set up output location","html_id":"set-up-output-location","implicit":true,"key":"Y7y0AATGSn"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Unlike with the smaller dataset in our previous rechunking tutorial, we will write this larger dataset to an object store (similar to an S3 bucket) on the USGS OSN Pod.\nSo, we need to set that up so that Rechunker will have a suitable place to write data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SYgeNxWFmf"}],"key":"GgiozUQH7h"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"First, we need to set up our credentials that allow us to write to the OSN Pod and direct it to the endpoint where the OSN Pod is located (while it is available via the S3 API, it is not in AWS, so we have to tell it where to find the pod!). If you do not already have access to the credentials to write to the OSN Pod and you are a USGS staff member or collaborator, please reach out to ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"HbODNJ1aKv"},{"type":"link","url":"mailto:asnyder@usgs.gov","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"asnyder@usgs.gov","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lG8RTQKzQv"}],"urlSource":"mailto:asnyder@usgs.gov","key":"Hb6SozWUBq"},{"type":"text","value":" to request them. If you are not a USGS staff or collaborator, you will need to set up a different location that to you have write permissions to. This could be an AWS S3 bucket that you have access too or you could even set up an ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"MSr2p9fESa"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qjjpwj3ChW"},{"type":"text","value":" ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"tmdPzZslRb"},{"type":"inlineCode","value":"LocalFileSystem","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"cpFdjHkidW"},{"type":"text","value":".","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UAmnnzpgys"}],"key":"sPS27jy8pL"}],"key":"WNsNM0KXfd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"awsconfig = configparser.ConfigParser()\nawsconfig.read(\n    os.path.expanduser('~/.aws/credentials') \n    # default location... if yours is elsewhere, change this.\n)\n_profile_nm  = 'osn-hytest-scratch'\n_endpoint = 'https://usgs.osn.mghpcc.org/'\n\n# Set environment vars based on parsed awsconfig\ntry:\n    os.environ['AWS_ACCESS_KEY_ID']     = awsconfig[_profile_nm]['aws_access_key_id']\n    os.environ['AWS_SECRET_ACCESS_KEY'] = awsconfig[_profile_nm]['aws_secret_access_key']\n    os.environ['AWS_S3_ENDPOINT']       = _endpoint\n    os.environ['AWS_PROFILE'] = _profile_nm\n    os.environ['AWS_DEFAULT_PROFILE'] = _profile_nm\nexcept KeyError as e:\n    logging.error(\"Problem parsing the AWS credentials file. \")","key":"KAVBAOh8Nm"},{"type":"outputs","id":"ca1v25mJEoRilhw33yhS6","children":[],"key":"QOP9RWZBtB"}],"key":"nkMOWv3QGj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we make our S3 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GMb5KVXm9c"},{"type":"inlineCode","value":"fsspec.filesystem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vez5fVmzEQ"},{"type":"text","value":" with the required user info and get the mapper to this file to pass to Rechunker.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iNe0QUgEOn"}],"key":"wDR178oYXu"}],"key":"ZKToX5pdgI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from getpass import getuser\nuname=getuser()\n\nfs = fsspec.filesystem(\n    's3', \n    anon=False, \n    default_fill_cache=False, \n    skip_instance_cache=True, \n    client_kwargs={'endpoint_url': os.environ['AWS_S3_ENDPOINT'], }\n)\n\noutput_dir = f's3://hytest-scratch/rechunking_tutorial/{uname}/'\n\ntemp_store = fs.get_mapper(output_dir + 'temp_store.zarr')\ntarget_store = fs.get_mapper(output_dir + 'tutorial_rechunked.zarr')\n# Check if the objects exist and remove if they do\nfor filename in [temp_store, target_store]:\n    try:\n        fs.rm(filename.root, recursive=True)\n    except:\n        FileNotFoundError","key":"crqDfDGISD"},{"type":"outputs","id":"o1WDqy4xxF8dOygsdCoza","children":[],"key":"NBH6qHbfh5"}],"key":"EaSH96toOH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spin up Dask Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dGo18wG3RM"}],"identifier":"spin-up-dask-cluster","label":"Spin up Dask Cluster","html_id":"spin-up-dask-cluster","implicit":true,"key":"AkyjkPidWw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Our rechunking operation will be able to work in parallel.\nTo do that, we will spin up a dask cluster to schedule the various workers.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pq17fc1rPs"}],"key":"Bo2pnCQSWb"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This cluster will be configured differently depending on where you compute is performed. We have set up this notebook to run on ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"kLXGsH1ONh"},{"type":"link","url":"https://www.nebari.dev/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Nebari","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vsPsk0dPXU"}],"urlSource":"https://www.nebari.dev/","key":"hw1U6dUCGf"},{"type":"text","value":". If you are working on USGS systems, you can likely use one of our ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WtGW9ObkWz"},{"type":"link","url":"https://hytest-org.github.io/hytest/environment_set_up/clusters.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"example codes to spin up a dask cluster","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"btsNKrAWZ9"}],"urlSource":"https://hytest-org.github.io/hytest/environment_set_up/clusters.html","key":"KMsvqbZAlm"},{"type":"text","value":". Otherwise, please refer to the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yI9sAKghKQ"},{"type":"link","url":"https://docs.dask.org/en/stable/deploying.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"dask deployment docs","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"f1GD3WeaV1"}],"urlSource":"https://docs.dask.org/en/stable/deploying.html","key":"qQdAV3aAxL"},{"type":"text","value":" for details.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"n9Vi79xUq5"}],"key":"p56XCNcYW7"}],"key":"UsW2qnWpRt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%run ../../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb\n## If this notebook is not being run on Nebari, replace the above \n## path name with a helper appropriate to your compute environment.  Examples:\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Denali.ipynb\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb\n# %run ../../../../environment_set_up/Start_Dask_Cluster_Desktop.ipynb","key":"rU7Ifn1opB"},{"type":"outputs","id":"5GHGqkApMVK9ai9XmwgRz","children":[],"key":"E52RaSGcfc"}],"key":"h1QCr5snko"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Rechunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WOUBcxOZdN"}],"identifier":"rechunk","label":"Rechunk","html_id":"rechunk","implicit":true,"key":"hq6bTajRmo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now, we are ready to rechunk!","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YOaybijVYX"}],"key":"hLTRLijQBe"}],"key":"BbqJO8yIJb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"result = rechunk(\n    # Make sure the base chunks are correct\n    ds.chunk({'time': 672, 'feature_id': 15000}),\n    target_chunks=chunk_plan,\n    max_mem=\"2GB\",\n    target_store=target_store,\n    temp_store=temp_store\n)\nresult","key":"Kjel5RKaxy"},{"type":"outputs","id":"b7bIa4un-RfL3RiR5ZrYi","children":[],"key":"grbnv2sibN"}],"key":"rXLPvym6jC"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Remember that merely invoking Rechunker does not do any work.\nIt just sorts out the rechunking plan and writes metadata.\nWe need to call ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lUN1XP7D3f"},{"type":"inlineCode","value":".execute","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L1CNQA7gxo"},{"type":"text","value":" on the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cVueGVV2NL"},{"type":"inlineCode","value":"result","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JMThh87lYE"},{"type":"text","value":" object to actually run the rechunking.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OYONyxAYZ8"}],"key":"Nh2Zyk6zS7"}],"key":"Lf2vm7zKiu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"with dask.diagnostics.ProgressBar():\n    r = result.execute(retries=10)  \n\n# Also consolidate the metadata for fast reading into xarray\n_ = zarr.consolidate_metadata(target_store)","key":"kxjObJAGvL"},{"type":"outputs","id":"r78jhGhyH5siv-PfeXYXg","children":[],"key":"zXLBICvipB"}],"key":"smZ9bl1Zil"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Confirm the Creation of the Zarr Store by Rechunker","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mlyKGKVU3v"}],"identifier":"confirm-the-creation-of-the-zarr-store-by-rechunker","label":"Confirm the Creation of the Zarr Store by Rechunker","html_id":"confirm-the-creation-of-the-zarr-store-by-rechunker","implicit":true,"key":"V50AjSWJoK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s read in the resulting re-chunked dataset to confirm it turned out how we intended.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DjbVU3Ihx3"}],"key":"YvWZUVq1wk"}],"key":"tJn2anfBAF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_rechunked = xr.open_zarr(target_store)\nds_rechunked","key":"b1YIdZs43n"},{"type":"outputs","id":"g1cHiuYFSoO4GFxsAdtKH","children":[],"key":"hKqJHIBXrz"}],"key":"qHoyQGrYmX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Nice, looks good!\nYou may have noticed that the only difference between the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cpsIDKrrBs"},{"type":"link","url":"/dataset-processing/tutorials/chunking/101/rechunking","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"introductory tutorial on rechunking","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P2BtMR4s4Y"}],"urlSource":"../101/Rechunking.ipynb","dataUrl":"/dataset-processing.tutorials.chunking.101.rechunking.json","internal":true,"protocol":"file","key":"myuFEnAIqW"},{"type":"text","value":" and this is the inclusion of creating the dask cluster and where we saved the files.\nPicking your compute environment and output location will typically be the only things that vary in other workflows requiring rechunking.\nTherefore, if you understand this rechunking process you should be able to apply it to your own data efficiently.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nWwxiQbzuE"}],"key":"OcB3irWA30"}],"key":"UdNX8nZNaX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Clean Up","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m6U3kmyP10"}],"identifier":"clean-up","label":"Clean Up","html_id":"clean-up","implicit":true,"key":"JyCGe8ngqJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"As we don’t want to keep this rechunked Zarr, let’s go ahead and delete it.\nWe will also conform with best practices and close our Dask client and cluster.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GWHRyA7G5g"}],"key":"krrgSf3Fsw"}],"key":"ijoAgoBUoK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fs.rm(temp_store.root, recursive=True)\nfs.rm(target_store.root, recursive=True)\n        \nclient.close()\ncluster.close()","key":"TmMX59tXWA"},{"type":"outputs","id":"tFOY_HgLKJrbaatYAkgLp","children":[],"key":"KoxvLklx3s"}],"key":"w35hoaJRFU"}],"key":"jdM8sOoYtz"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Advanced Topics in Chunking","url":"/dataset-processing/tutorials/chunking/201","group":"Zarr Creation"},"next":{"title":"Generating a Virtual Zarr Store","url":"/dataset-processing/tutorials/chunking/201/createvirtualzarr","group":"Zarr Creation"}}},"domain":"http://localhost:3005"},"project":{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hytest//build/manifest-5D5D9E8C.js";
import * as route0 from "/hytest//build/root-AA24SA6C.js";
import * as route1 from "/hytest//build/routes/$-5SFLQWPV.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hytest//build/entry.client-PCJPW7TK.js");</script></body></html>