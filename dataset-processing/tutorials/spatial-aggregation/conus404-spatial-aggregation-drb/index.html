<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s - HyTEST Project</title><meta property="og:title" content="gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s - HyTEST Project"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/hytest//build/_assets/app-SDGCW62C.css"/><link rel="stylesheet" href="/hytest//build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hytest//favicon.ico"/><link rel="stylesheet" href="/hytest//myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hytest//"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="HyTEST Project" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hytest//">HyTEST Project</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Environment Set-Up" class="block break-words rounded py-2 grow cursor-pointer">Environment Set-Up</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Getting Started" class="block break-words rounded py-2 grow cursor-pointer">Getting Started</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Access" class="block break-words rounded py-2 grow cursor-pointer">Dataset Access</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Zarr Creation" class="block break-words rounded py-2 grow cursor-pointer">Zarr Creation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Processing" class="block break-words rounded py-2 grow cursor-pointer">Dataset Processing</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Model Evaluation" class="block break-words rounded py-2 grow cursor-pointer">Model Evaluation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Back Matter" class="block break-words rounded py-2 grow cursor-pointer">Back Matter</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/hytest-org/hytest" title="GitHub Repository: hytest-org/hytest" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="OsBwp88Af1" class="myst-jp-nb-block relative group/block"><p>This tutorial demonstrates the use of gdptools, a python package for area-weighted interpolation of <em>source</em> gridded datasets, such as conus404, to <em>target</em> polygonal geospatial fabrics.  Source datasets can be any gridded dataset that can be opened in XArray.  However it’s important to note that gdptools, operations on XArray Datasets or DataArrays with dimensions of (Y,X,Time) generally.  As such climate datasets that have ensemble dimensions will require subsetting by ensemble to obtain the a dataset with the proper dimensions.  The target dataset can be any polygonal dataset that can be read by GeoPandas.  GDPtools also has capabilities of interpolating gridded data to lines as well, but our focus here is interpolating to polygons.</p><p>In this workflow, CONUS404 is aggregated to Deleware River Basin (DRB) HUC12s. The spatial polygons used in this notebook come from the <a target="_blank" rel="noreferrer" href="https://www.sciencebase.gov/catalog/item/60cb5edfd34e86b938a373f4" class=""><strong>NHDPlusV2 snapshot of the Watershed Boundary Dataset HUC12 boundaries</strong></a> provided through the <a target="_blank" rel="noreferrer" href="https://docs.hyriver.io/readme/pygeohydro.html" class="">PyGeoHydro</a> python package.</p><p>We use the HyTest intake catalog to access CONUS404 from the OSN pod. This notebook provides a relatively simple and efficient workflow that can be easily run on a local computer.</p></div><div id="YsTfLCDAjK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Common python packages
import xarray as xr
import hvplot.xarray
import hvplot.pandas
import hvplot.dask
import intake
import pystac
from packaging.version import Version
import zarr
import warnings
import datetime
import holoviews as hv
import geoviews as gv
from holoviews import opts
import cartopy.crs as ccrs
import panel as pn
import numpy as np
import pandas as pd
import geopandas as gpd

# HyRiver packages
from pynhd import NLDI, WaterData
import pygeohydro as gh
# GDPTools packages
from gdptools import AggGen, UserCatData, WeightGen
import os
# Until gdptools updates it&#x27;s numpy dependency to v2, the environment statement below is required
os.environ[&quot;HYRIVER_CACHE_DISABLE&quot;] = &quot;true&quot;

hv.extension(&quot;bokeh&quot;)
pn.extension()

warnings.filterwarnings(&#x27;ignore&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OJPWkyfgxPk9w1rDAGCPV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="COCjkLiQFL" class="myst-jp-nb-block relative group/block"><p>Here we setup a variable the sets our local context, working on the HPC or working locally on your Desktop.  This just modifies the access point of the conus404 data, using the Hovenweep access for HPC and the OSN pod access for the Desktop.</p></div><div id="F5rdkRF5dq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t_sys = &quot;Desktop&quot;  # &quot;HPC&quot;  # or &quot;Desktop&quot;
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="rmHKm-M6B9kGtIazLe3oc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qYyjbNZlsW" class="myst-jp-nb-block relative group/block"><p>We can use a subset of the <a target="_blank" rel="noreferrer" href="https://docs.hyriver.io/index.html" class=""><strong>HyRiver</strong></a> Python packages to access HUC12 geometries representing the Delaware River Basin. The process involves several steps:</p><ol start="1"><li><p><strong>Select the HUC4 Mid-Atlantic Region</strong>:</p><ul><li><p>This region encompasses the Delaware River Basin (HUC4 code: 0204).</p></li></ul></li><li><p><strong>Retrieve HUC12 Basins within the Selected HUC4</strong>:</p><ul><li><p>Obtain all HUC12 basins that fall within the HUC4 Mid-Atlantic region.</p></li></ul></li><li><p><strong>Filter HUC12 Basins</strong>:</p><ul><li><p>Focus on the HUC12 basins within the two HUC6 regions whose drainages terminate in the Delaware River Basin (DRB).</p></li><li><p>Exclude basins with drainages that terminate at the coast.</p></li></ul></li></ol><p>We used <a target="_blank" rel="noreferrer" href="https://water.usgs.gov/wsc/map_index.html" class=""><strong>Science in Your Watershed</strong></a> to help identify the HUC6 regions that drain directly into the DRB.</p></div><div id="MRRH4R3Tg2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">
wbd = gh.WBD(&quot;huc4&quot;)
del_huc4 = wbd.byids(field=&quot;huc4&quot;, fids=&quot;0204&quot;)
huc12_basins = WaterData(&#x27;wbd12&#x27;).bygeom(del_huc4.geometry[0])
filtered_gdf = huc12_basins[huc12_basins[&#x27;huc12&#x27;].str.startswith((&#x27;020401&#x27;, &#x27;020402&#x27;))]
filtered_gdf</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="pOM3FmM-QMPDwqgtiaDMo" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="JFOiIUlknc" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from holoviews.element.tiles import OSM
drb = filtered_gdf.hvplot(
    geo=True, coastline=&#x27;50m&#x27;, alpha=0.2,  frame_width=300,
    xlabel=&quot;longitude&quot;, ylabel=&quot;latitude&quot;,
    title=&quot;Delaware River HUC12 basins&quot;, aspect=&#x27;equal&#x27;
)
OSM() * drb</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GIQ79QB0qpejw-9SfV_5Z" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iACmi2Tqgv" class="myst-jp-nb-block relative group/block"><p>Access conus404 via the WMA STAC catalog.</p></div><div id="HLF9SY5gXQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def get_children(catalog, collection_id=None):
    &quot;&quot;&quot;
    This function retrieves a specified collection from a STAC catalog/collection and prints key metadata 
    for exploring/accessing the datasets contained within it.
    If there is no collection ID provided, the collections in the top level of the catalog will be printed.
    If a collection ID is provided, it will retrieve the collection with that ID from the input catalog/collection.
    If the collection ID points to a dataset, it will print the assets available for the dataset.
    If the collection ID points to another collection, it will list the child collections in the IDed collection.

    Args:
        catalog (pystac.Catalog | pystac.Collection): The STAC catalog/collection object.
        collection_id (str): The ID of the collection or dataset to retrieve from catalog.
    
    Returns:
        collection (pystac.Catalog | pystac.Collection): The collection object corresponding to the provided ID
                                                         or the top-level catalog if no ID is provided.
    &quot;&quot;&quot;
    dataset = False
    if collection_id:
        collection = catalog.get_child(collection_id)
        if collection.assets:
            dataset = True
            print(f&quot;{collection_id} is a dataset. Please review the assets below and select one to open.&quot;)

        else:
            print(f&quot;{collection_id} is a collection. Please review the child items and select one to open in the next cell.&quot;)
    else:
        collection = catalog
    if dataset==True:
        # List the assets
        for asset in collection.assets:
            print(f&quot;Asset ID: {asset}&quot;)
            print(f&quot;    Title: {collection.assets[asset].title}&quot;)
            print(f&quot;    Description: {collection.assets[asset].description}&quot;)
    else:
        collections = list(collection.get_collections())
        print(f&quot;Number of collections: {len(collections)}&quot;)
        print(&quot;Collections IDs:&quot;)
        for child_collection in collections:
            id = child_collection.id
            cite_as = &quot;Not available&quot;
            for link in child_collection.links:
                if link.rel == &quot;cite-as&quot;:
                    cite_as = link.target
            print(f&quot;- {id}, Source: {cite_as}&quot;)
    return collection</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="5RbQuADlY0Sh9RXZWrbhE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UOwbz1OqIM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># url for the WMA STAC Catalog
catalog_url = &quot;https://api.water.usgs.gov/gdp/pygeoapi/stac/stac-collection/&quot;

# use pystac to read the catalog
catalog = pystac.Catalog.from_file(catalog_url)

# list the collections in the catalog
catalog = get_children(catalog)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="UKyQ5-cdiOBFXcYxcwkWD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="r6UHc8Bte8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># select a collection from the catalog, replace the collection ID with the one you want to use:
collection = get_children(catalog, collection_id=&quot;conus404&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="FGe0HuTXzfqBY19NGHw6q" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="lscJ97abIi" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># select a collection from the catalog, replace the collection ID with the one you want to use:
collection = get_children(collection, collection_id=&quot;conus404_xtrm_daily&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3nHVq3-gqOUxAS9qyyhSi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ill9etjQFw" class="myst-jp-nb-block relative group/block"><p>There are a couple of options for accessing <strong>conus404</strong>:</p><ol start="1"><li><p><strong>HPC Setting (<code>t_sys = HPC</code>)</strong>:</p><ul><li><p><strong>Assumption</strong>: The notebook is run on the USGS HPC Hovenweep.</p></li><li><p><strong>Access Method</strong>: Utilizes the on-premises version of the data.</p></li><li><p><strong>Benefits</strong>:</p><ul><li><p><strong>Workflow Association</strong>: The workflow is directly linked to the data.</p></li><li><p><strong>Speed</strong>: Eliminates the need to download data, significantly reducing access and processing time.</p></li></ul></li></ul></li><li><p><strong>Desktop Setting (<code>t_sys = Desktop</code>)</strong>:</p><ul><li><p><strong>Use Case</strong>: Suitable for workflows that do not require HPC resources or for developing workflows locally before deploying them to the HPC.</p></li><li><p><strong>Access Method</strong>: Connects to the <strong>conus404</strong> data via the OSN pod.</p></li><li><p><strong>Benefits</strong>:</p><ul><li><p><strong>Flexibility</strong>: Allows for local development and testing.</p></li><li><p><strong>Performance</strong>: Provides a fast connection to the data.</p></li></ul></li></ul></li></ol></div><div id="XSWtzRPE2m" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Select the dataset you want to read into your notebook and preview its metadata
if t_sys == &quot;HPC&quot;:
    selected_asset_id = &#x27;zarr-disk-hovenweep&#x27;
elif t_sys == &quot;Desktop&quot;:
    selected_asset_id = &#x27;zarr-s3-osn&#x27; 
else:
    print(&quot;Please set the variable t_sys above to one of &#x27;HPC&#x27; or &#x27;Desktop&#x27;&quot;)        
asset = collection.assets[selected_asset_id]
asset</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="CHwljpKEWK1syNCHMosXj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KpCPUw3lKD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># read in the dataset and use metpy to parse the crs information on the dataset
print(f&quot;Reading {selected_asset_id} metadata...&quot;, end=&#x27;&#x27;)
if Version(zarr.__version__) &lt; Version(&quot;3.0.0&quot;):
    ds = xr.open_dataset(
        asset.href,
        storage_options=asset.extra_fields[&#x27;xarray:storage_options&#x27;],
        **asset.extra_fields[&#x27;xarray:open_kwargs&#x27;]
    )
else:
    ds = xr.open_dataset(
    asset.href,
    storage_options=asset.extra_fields[&#x27;xarray:storage_options&#x27;],
    **asset.extra_fields[&#x27;xarray:open_kwargs&#x27;],
    zarr_format=2
    )



ds = ds.metpy.parse_cf()
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="p5XEAvYUdlnDMYR5VWEyu" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UvaoP7hdKk" class="myst-jp-nb-block relative group/block"><h2 id="gdptools-background" class="relative group"><span class="heading-text">GDPTools Background</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#gdptools-background" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section, we utilize three data classes from the <code>gdptools</code> package: <code>UserCatData</code>, <code>WeightGen</code>, and <code>AggGen</code>.</p><ul><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/user_input_data_classes.html" class=""><strong>UserCatData</strong></a>:<br/>Serves as a data container for both the source and target datasets, along with their associated metadata. The instantiated object <code>user_data</code> is employed by both the <code>WeightGen</code> and <code>AggGen</code> classes.</p></li><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/weight_gen_classes.html" class=""><strong>WeightGen</strong></a>:<br/>Responsible for calculating the intersected areas between the source and target datasets. It generates normalized area-weights, which are subsequently used by the <code>AggGen</code> class to compute interpolated values between the datasets.</p></li><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html" class=""><strong>AggGen</strong></a>:<br/>Facilitates the interpolation of target data to match the source data using the areal weights calculated by <code>WeightGen</code>. This process is conducted over the time period specified in the <code>UserCatData</code> object.</p></li></ul><h3 id="instantiation-of-the-usercatdata-class" class="relative group"><span class="heading-text">Instantiation of the <code>UserCatData</code> class.</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#instantiation-of-the-usercatdata-class" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="ClZ2rJrUrn" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Coordinate Reference System (CRS) of the conus404 dataset
source_crs = ds.crs.crs_wkt

# Coordinate names of the conus404 dataset
x_coord = &quot;x&quot;
y_coord = &quot;y&quot;
t_coord = &quot;time&quot;

# Time period of interest for areal interpolation of conus404 to DRB HUC12s
# using the AggGen class below. Note: The dates follow the same format as the
# time values in the conus404 dataset.
sdate = &quot;1979-10-01T00:00:00.000000000&quot;
edate = &quot;2022-10-01T00:00:00.000000000&quot;

# Variables from the conus404 dataset used for areal interpolation
variables = [&quot;T2MIN&quot;, &quot;T2MAX&quot;, &quot;RAINNCVMEAN&quot;]

# CRS of the DRB HUC12 polygons
target_crs = 5070

# Column name for the unique identifier associated with target polygons.
# This ID is used in both the generated weights file and the areal interpolated output.
target_poly_idx = &quot;huc12&quot;

# Common equal-area CRS for reprojecting both source and target data.
# This CRS is used for calculating areal weights in the WeightGen class.
weight_gen_crs = 5070

# Instantiate the UserCatData class, which serves as a container for both
# source and target datasets, along with associated metadata. The UserCatData
# object provides methods used by the WeightGen and AggGen classes to subset
# and reproject the data.
user_data = UserCatData(
    ds=ds,
    proj_ds=source_crs,
    x_coord=x_coord,
    y_coord=y_coord,
    t_coord=t_coord,
    var=variables,
    f_feature=filtered_gdf,
    proj_feature=target_crs,
    id_feature=target_poly_idx,
    period=[sdate, edate],
)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="efDVu79mgx51sV_SioHSp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="xUaVr8KaKP" class="myst-jp-nb-block relative group/block"><h2 id="weight-generation-with-weightgen" class="relative group"><span class="heading-text">Weight Generation with <code>WeightGen</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#weight-generation-with-weightgen" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section, we utilize the <code>WeightGen</code> class from the <code>gdptools</code> package to calculate the normalized areal weights necessary for interpolating the source gridded data (<code>conus404</code>) to the target polygonal boundaries (<code>DRB HUC12s</code>). The areal weights represent the proportion of each grid cell that overlaps with each polygon, facilitating accurate <strong>areal interpolation</strong> of the data. These weights are calculated using the <code>calculate_weights()</code> method.</p><p><strong>Weight Calculation Process:</strong></p><ol start="1"><li><p><strong>Subset Source Data</strong>: The source data is subset based on the bounds of the target data, with an additional small buffer to ensure coverage. The buffer size is determined based on the cell size of the source data. The buffer is 2 times the max(dx, dy). In other words, the buffer is essentially 2 source grid cells in the x and y dimensions.</p></li><li><p><strong>Create cell boundary GeoDataFrame</strong>: A GeoDataFrame of the cell boundaries is created for each node in the subsetted source data, enabling spatial operations.</p></li><li><p><strong>Validate Geometries</strong>: The target file is checked for invalid geometries, which can occur due to various reasons such as topology errors. Invalid geometries are fixed using Shapely’s <code>make_valid()</code> method to prevent failures during intersection calculations.</p></li><li><p><strong>Calculate and Normalize Areas</strong>: For each polygon, <code>gdptools</code> calculates the area of each intersecting grid cell and normalizes it by the total area of the target polygon. This ensures that the weights for each polygon sum to 1, provided the polygon is entirely covered by the source data.</p><ul><li><p><strong>Validation</strong>: A quick check on the weights can be performed by grouping the resulting weights by the <code>target_poly_idx</code> and calculating the sum. For all polygons completely covered by the source data, the weights will sum to 1.</p></li></ul></li></ol><p><strong>Note:</strong> The <code>method</code> parameter can be set to one of <code>&quot;serial&quot;</code>, <code>&quot;parallel&quot;</code>, or <code>&quot;dask&quot;</code>. Given the scale of the gridded <code>conus404</code> data (4 km × 4 km) and the number and spatial footprint of the <code>DRB HUC12s</code>, using <code>&quot;serial&quot;</code> in this case is the most efficient method. In subsequent sections, we will explore how the <code>&quot;parallel&quot;</code> and <code>&quot;dask&quot;</code> methods can provide speed-ups in the areal interpolation process, as well as in the computation of weights for broader CONUS-wide targets.</p></div><div id="QiJxRN89N1" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
wght_gen = WeightGen(
    user_data=user_data,
    method=&quot;serial&quot;,
    output_file=&quot;wghts_drb_ser_c404daily.csv&quot;,
    weight_gen_crs=6931
)

wdf = wght_gen.calculate_weights()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="PLsMzNszNjt-cmIGyqXyj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ltlxbO5QVT" class="myst-jp-nb-block relative group/block"><h2 id="areal-interpolation-with-the-agggen-class" class="relative group"><span class="heading-text">Areal Interpolation with the <code>AggGen</code> Class</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#areal-interpolation-with-the-agggen-class" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section, we demonstrate the use of the <code>AggGen</code> class and its <code>calculate_agg()</code> method from the <code>gdptools</code> package to perform areal interpolation. We will explore all three <code>agg_engine</code> options: <code>&quot;serial&quot;</code>, <code>&quot;parallel&quot;</code>, and <code>&quot;dask&quot;</code>. The following links provide detailed documentation on the available parameter options:</p><ul><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGENGINES" class=""><strong>agg_engines</strong></a></p></li><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGWRITERS" class=""><strong>agg_writers</strong></a></p></li><li><p><a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.STATSMETHODS" class=""><strong>stat_methods</strong></a></p></li></ul><p>When using <code>AggGen</code> and the <code>calculate_agg()</code> method, it is important to consider the overlap between the source and target data when selecting the <code>stat_method</code> parameter value. All statistical methods have a masked variant in addition to the standard method; for example, <code>&quot;mean&quot;</code> and <code>&quot;masked_mean&quot;</code>. In cases where the source data has partial overlap with a target polygon, the <code>&quot;mean&quot;</code> method will return a missing value for the polygon, whereas the <code>&quot;masked_mean&quot;</code> method will calculate the statistic based on the available overlapping source cells. These considerations help users determine whether using a masked statistic is desirable or if a missing value would be preferred, allowing for post-processing of missing values (e.g., using nearest-neighbor or other approaches to handle the lack of overlap). In the case here conus404 completely covers the footprint of the DRB HUC12s, as such the <code>&quot;mean&quot;</code> method would be sufficient.</p></div><div id="qh1BFqev9l" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
agg_gen = AggGen(
    user_data=user_data,
    stat_method=&quot;mean&quot;,
    agg_engine=&quot;parallel&quot;,
    jobs=4,
    agg_writer=&quot;netcdf&quot;,
    weights=&#x27;wghts_drb_ser_c404daily.csv&#x27;,
    out_path=&#x27;.&#x27;,
    file_prefix=&quot;serial_weights&quot;,
    precision=8
)
ngdf, ds_out = agg_gen.calculate_agg()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0ip2QWQCSDVvyd13Osl1m" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ER5CpaIeFO" class="myst-jp-nb-block relative group/block"><h2 id="output" class="relative group"><span class="heading-text">Output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#output" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The <a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AggGen.calculate_agg" class=""><strong><code>calculate_agg()</code></strong></a> method returns two objects: <code>ngdf</code> and <code>ds_out</code>.</p><ul><li><p><strong><code>ngdf</code></strong>: A <code>GeoDataFrame</code> derived from the target GeoDataFrame (<code>filtered_gdf</code>) specified in the <code>UserCatData</code> container. This GeoDataFrame has been both sorted and dissolved based on the identifiers in the <code>&quot;huc12&quot;</code> column, as defined by the <code>target_poly_idx</code> parameter.</p></li><li><p><strong><code>ds_out</code></strong>: The areally weighted interpolation output as an XArray Dataset. The Dataset consists of dimensions <code>time</code> and <code>huc12</code>, and the data variables are <code>T2MIN</code>, <code>T2MAX</code>, and <code>RAINNCVMEAN</code>.</p></li></ul><p>A preview of the <code>ngdf</code> GeoDataFrame below shows that it is sorted by <code>&quot;huc12&quot;</code>. In this case, there are no duplicate <code>&quot;huc12&quot;</code> values, resulting in the original and output GeoDataFrames having the same number of rows.  Some target datasets such as the GFv1.1, will result in many dissolved geometries.</p></div><div id="QbXxmkYIp5" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ngdf.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="QDMCiHq_BcAfEYmVfZqmO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FcMOLqP82a" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds_out</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_N_uWFgBxp_EoxOo9olns" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="a9TgkVlezp" class="myst-jp-nb-block relative group/block"><h2 id="plot-the-results-as-a-quick-sanity-check" class="relative group"><span class="heading-text">Plot the results as a quick sanity check</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-results-as-a-quick-sanity-check" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here we plot the results along with the corresponding conus404 values.  To make the plot a little more interesting we choose the time step with the most precipitation.  This provides a quick qualitative sanity check.  If one is intersted in looking in more detail in a graphic presentation of a target polygon, overlayed on the intersecting grid cells, with the grid-cell values and weights shown for each intersection, please look at the tail end of notebook <a target="_blank" rel="noreferrer" href="https://gdptools.readthedocs.io/en/develop/Examples/ClimateR-Catalog/terraclime_et.html" class=""><strong>ClimateR-Catalog - Terraclime data</strong></a> for some example code to generate a plot which give a more quantitative expression of the result.</p></div><div id="aieMRYv8lN" class="myst-jp-nb-block relative group/block"><p><strong>Format the interpolated results for plotting</strong></p></div><div id="F465FvTdYR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Convert processed xarray Dataset to DataFrame
df = ds_out.to_dataframe().reset_index()
# Pivot the DataFrame to have variables as separate columns
df_pivot = df.pivot_table(index=[&#x27;time&#x27;, &#x27;huc12&#x27;], values=[&#x27;T2MAX&#x27;, &#x27;T2MIN&#x27;, &#x27;RAINNCVMEAN&#x27;]).reset_index()

# Merge GeoDataFrame with DataFrame
merged_gdf = ngdf.to_crs(5070).merge(df_pivot, on=&#x27;huc12&#x27;)

# Convert RAINNCVMEAN from kg/m²/s to mm/day
merged_gdf[&#x27;RAINNCVMEAN_mm_day&#x27;] = merged_gdf[&#x27;RAINNCVMEAN&#x27;] * 86400
# Convert T2MAX and T2MIN from Kelvin to Celsius
merged_gdf[&#x27;T2MAX_C&#x27;] = merged_gdf[&#x27;T2MAX&#x27;] - 273.15
merged_gdf[&#x27;T2MIN_C&#x27;] = merged_gdf[&#x27;T2MIN&#x27;] - 273.15

# Calculate total precipitation for each time step
rain_sum = merged_gdf.groupby(&#x27;time&#x27;)[&#x27;RAINNCVMEAN_mm_day&#x27;].sum()

# Identify the time step with the maximum total precipitation
max_rain_time = rain_sum.idxmax()
print(f&quot;Time step with maximum total precipitation: {max_rain_time}&quot;)

# Subset the GeoDataFrame for the selected time step
subset = merged_gdf[merged_gdf[&#x27;time&#x27;] == max_rain_time]
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="b3Itp9Dv5U447QxuNo1mv" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Q9ETZCHkSO" class="myst-jp-nb-block relative group/block"><p><strong>Process the sub-setted conus404 data for plotting</strong></p></div><div id="jtvqxcs9rx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">
# We can use our agg_gen object to retrieve the subsetted conus404 data
da_t2max = agg_gen.agg_data.get(&quot;T2MAX&quot;).da
da_t2min = agg_gen.agg_data.get(&quot;T2MIN&quot;).da
da_rain = agg_gen.agg_data.get(&quot;RAINNCVMEAN&quot;).da

# Get the subsetted raw conus404 cubes used in the areal interpolation
da_t2max = agg_gen.agg_data.get(&quot;T2MAX&quot;).da.sel(time=max_rain_time) - 273.15
da_t2min = agg_gen.agg_data.get(&quot;T2MIN&quot;).da.sel(time=max_rain_time) - 273.15
da_rain = agg_gen.agg_data.get(&quot;RAINNCVMEAN&quot;).da.sel(time=max_rain_time) * 86400</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="IHFOnK3Rk9MyQP9xL_1Z2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zag4gKkoT2" class="myst-jp-nb-block relative group/block"><p><strong>Generate the plot</strong></p><ul><li><p>Here we use <a target="_blank" rel="noreferrer" href="https://geoviews.org/" class="">GeoViews</a> and <a target="_blank" rel="noreferrer" href="https://holoviews.org/" class="">HoloViews</a></p></li></ul></div><div id="aEC7I9hpbh" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define Cartopy CRS using EPSG code 5070 (NAD83 / Conus Albers)
crs_cartopy = ccrs.epsg(5070)

# Define color maps for each variable
color_maps = {
    &#x27;T2MAX_C&#x27;: &#x27;Reds&#x27;,
    &#x27;T2MIN_C&#x27;: &#x27;Blues&#x27;,
    &#x27;RAINNCVMEAN_mm_day&#x27;: &#x27;Greens&#x27;
}
# Define color maps for raw data
color_maps_raw = {
    &#x27;T2MAX&#x27;: &#x27;Reds&#x27;,
    &#x27;T2MIN&#x27;: &#x27;Blues&#x27;,
    &#x27;RAINNCVMEAN&#x27;: &#x27;Greens&#x27;
}
# Create Polygons for T2MAX_C
map_T2MAX = gv.Polygons(
    subset.to_crs(5070), 
    vdims=[&#x27;T2MAX_C&#x27;],
    crs=crs_cartopy  # Use Cartopy CRS here
).opts(
    cmap=color_maps[&#x27;T2MAX_C&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;T2MAX (°C)&#x27;,  # Included units
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;,
    padding=0,
)

# Create Polygons for T2MIN_C
map_T2MIN = gv.Polygons(
    subset.to_crs(5070), 
    vdims=[&#x27;T2MIN_C&#x27;],
    crs=crs_cartopy
).opts(
    cmap=color_maps[&#x27;T2MIN_C&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;T2MIN (°C)&#x27;,  # Included units
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;,
    padding=0,
)

# Create Polygons for RAINNCVMEAN_mm_day
map_RAINNCVMEAN = gv.Polygons(
    subset.to_crs(5070), 
    vdims=[&#x27;RAINNCVMEAN_mm_day&#x27;],
    crs=crs_cartopy
).opts(
    cmap=color_maps[&#x27;RAINNCVMEAN_mm_day&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;RAINNCVMEAN (mm/day)&#x27;,  # Included units
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;,
    padding=0,
)

# Create raw sub-setted data frames
# Assuming &#x27;lon&#x27; and &#x27;lat&#x27; are the coordinate names; adjust if necessary
coord_x = &#x27;x&#x27;  # Replace with actual x-coordinate name
coord_y = &#x27;y&#x27;  # Replace with actual y-coordinate name

# Create HoloViews Image for T2MAX (Raw)
image_T2MAX_raw = hv.Image(
    da_t2max, 
    kdims=[coord_x, coord_y],
    vdims=[&#x27;T2MAX&#x27;]
).opts(
    cmap=color_maps_raw[&#x27;T2MAX&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;T2MAX Raw (°C)&#x27;,
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;
)

# Create HoloViews Image for T2MIN (Raw)
image_T2MIN_raw = hv.Image(
    da_t2min, 
    kdims=[coord_x, coord_y],
    vdims=[&#x27;T2MIN&#x27;]
).opts(
    cmap=color_maps_raw[&#x27;T2MIN&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;T2MIN Raw (°C)&#x27;,
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;
)

# Create HoloViews Image for RAINNCVMEAN (Raw)
image_RAIN_raw = hv.Image(
    da_rain, 
    kdims=[coord_x, coord_y],
    vdims=[&#x27;RAINNCVMEAN&#x27;]
).opts(
    cmap=color_maps_raw[&#x27;RAINNCVMEAN&#x27;],
    colorbar=True,
    tools=[&#x27;hover&#x27;],
    title=&#x27;RAINNCVMEAN Raw (mm/day)&#x27;,
    alpha=0.7,
    frame_width=200,
    aspect=&#x27;equal&#x27;
)

# Create a GridSpec with 3 rows and 3 columns
grid = pn.GridSpec(ncols=3, nrows=2, sizing_mode=&#x27;fixed&#x27;, width=900, height=1200)

# Add title spanning all columns in the first row
title = pn.pane.Markdown(
    f&quot;&lt;h2 style=&#x27;text-align: center;&#x27;&gt;Areal Interpolation for {max_rain_time.strftime(&#x27;%Y-%m-%d&#x27;)}&lt;/h2&gt;&quot;,
    width=900,
    height=20
)

# Add raw data plots in the first row
grid[0, 0] = image_T2MAX_raw
grid[0, 1] = image_T2MIN_raw
grid[0, 2] = image_RAIN_raw

# Add processed data plots in the second row
grid[1, 0] = map_T2MAX
grid[1, 1] = map_T2MIN
grid[1, 2] = map_RAINNCVMEAN


# Display the grid
# final_layout
grid


# Combine the three maps into a single layout arranged horizontally
maped_layout = pn.Row(
    map_T2MAX,
    pn.Spacer(sizing_mode=&quot;stretch_width&quot;),
    map_T2MIN,
    pn.Spacer(sizing_mode=&quot;stretch_width&quot;),
    map_RAINNCVMEAN,
    width=800
)

# Combine raw data plots horizontally
raw_layout = pn.Row(
    image_T2MAX_raw,
    pn.Spacer(sizing_mode=&quot;stretch_width&quot;),
    image_T2MIN_raw,
    pn.Spacer(sizing_mode=&quot;stretch_width&quot;),
    image_RAIN_raw,
    width=800
)

# Create a main title using HTML for center alignment within Markdown
title = pn.pane.Markdown(
    f&quot;&lt;h3 style=&#x27;text-align: center;&#x27;&gt;Areal Interpolation for {max_rain_time.strftime(&#x27;%Y-%m-%d&#x27;)}&lt;/h3&gt;&quot;,
    # width=1800  # Adjust width as needed
)

# Combine both rows vertically
combined_layout = pn.Column(
    raw_layout,
    maped_layout
)
# Combine the title and the layout vertically
final_layout = pn.Column(
    title,
    combined_layout,
    width=850
)

final_layout</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="keEbnSINAWfbX24z2H4ph" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jxxtAkphoj" class="myst-jp-nb-block relative group/block"><p>There is a clear increasing gradient in temperature from north to south that is visible in the interpolated results.</p></div><div id="pnuwvr2wO9" class="myst-jp-nb-block relative group/block"><h2 id="parallel-and-dask-methods" class="relative group"><span class="heading-text">Parallel and Dask Methods</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#parallel-and-dask-methods" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The domain of this workflow is small enough that using either the parallel or dask methods are not necessary.  However there is a speedup that we illustrate.  The parallel and dask engines used in the AggGen object operate in a similar manner using <code>multiprocessing</code> and <code>dask bag</code> respectivly. Using the jobs parameter the user can specify the number of processes to run.  The target data is chunked by the number of processes and each processor recieves a chunked GeoDataFrame along with a copy of the sub-setted source data.  This creates an overhead that can determine how effiently the parallel processing runs.</p><p>The tradeoff in using parallel processing lies in the balance between the number of processors and the overhead of copying data. While increasing the number of processors can significantly reduce computation time by dividing the workload, it also increases the amount of memory used for duplicate datasets and the coordination time between processes. There is a ‘sweet spot’ where the number of processors maximizes performance but beyond this point, additional processors may slow down the operation due to the overhead of managing more processes. The optimal number of processors depends on the size of the data, available memory, and system architecture, and can typically be found through experimentation.</p><p>Importantly, most of the time in processing here is dominated by downloading the data, so the speedup is relatively small.  For larger domains the processing will be a larger percentage of the total time and the speedup should be more pronounced.  Well explore that in the CONUS scale processing of conus404 on Hovenweep.</p></div><div id="aYEimlK4Kk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
gg_gen = AggGen(
    user_data=user_data,
    stat_method=&quot;masked_mean&quot;,
    agg_engine=&quot;parallel&quot;,
    agg_writer=&quot;netcdf&quot;,
    weights=&#x27;wghts_drb_ser_c404daily.csv&#x27;,
    out_path=&#x27;.&#x27;,
    file_prefix=&quot;testing_p2&quot;,
    precision=8,
    jobs=4
)
ngdf, ds_out = agg_gen.calculate_agg()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="F2OwZWa3WwE4dzpnh86Rw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Q2PquD2CTI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
agg_gen = AggGen(
    user_data=user_data,
    stat_method=&quot;masked_mean&quot;,
    agg_engine=&quot;dask&quot;,
    agg_writer=&quot;netcdf&quot;,
    weights=&#x27;wghts_drb_ser_c404daily.csv&#x27;,
    out_path=&#x27;.&#x27;,
    file_prefix=&quot;testing_p3&quot;,
    precision=8,
    jobs=4
)
ngdf, ds_out = agg_gen.calculate_agg()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="EOOfrUi9N6BQo7hNwy4fT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="pPQlDuuSdK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds_agg = xr.open_dataset(&quot;testing_p3.nc&quot;)
ds_agg</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="yTt-Dtb_GyEzM2N8KEqSH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="nTQ9ZwqpGW" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds_agg.T2MAX.values</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="rRtuo2IyBagnpwjWVsxzk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/hytest//dataset-processing/spatial-aggregation"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Dataset Processing</div>Spatial Aggregation</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hytest//dataset-processing/tutorials/spatial-aggregation/conus404-spatial-aggregation-gfv1-1"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Dataset Processing</div>gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hytest//build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-N76G4W6Y.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hytest//build/root-AA24SA6C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AH7OE64W.js"/><link rel="modulepreload" href="/hytest//build/routes/$-5SFLQWPV.js"/><script>window.__remixContext = {"url":"/dataset-processing/tutorials/spatial-aggregation/conus404-spatial-aggregation-drb","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hytest/"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"21b39478de7acbbed8a01664927b327001aec7ff7e4100b0b49df44260a3be45","slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","location":"/dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb","dependencies":[],"frontmatter":{"title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb","exports":[{"format":"ipynb","filename":"conus404_spatial_aggregation_DRB.ipynb","url":"/hytest//build/conus404_spatial_agg-9e8fcc828ff8d8da4e8f32579b41cfb9.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial demonstrates the use of gdptools, a python package for area-weighted interpolation of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QXtkNRO2Gl"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IfvH5vt1Sm"}],"key":"E5DDXbWXtQ"},{"type":"text","value":" gridded datasets, such as conus404, to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PgOeXzyBJH"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"target","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NbB4MFxPH9"}],"key":"hZ3xYhLtyh"},{"type":"text","value":" polygonal geospatial fabrics.  Source datasets can be any gridded dataset that can be opened in XArray.  However it’s important to note that gdptools, operations on XArray Datasets or DataArrays with dimensions of (Y,X,Time) generally.  As such climate datasets that have ensemble dimensions will require subsetting by ensemble to obtain the a dataset with the proper dimensions.  The target dataset can be any polygonal dataset that can be read by GeoPandas.  GDPtools also has capabilities of interpolating gridded data to lines as well, but our focus here is interpolating to polygons.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ktZXeWbN9W"}],"key":"Qzvi7emfVE"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In this workflow, CONUS404 is aggregated to Deleware River Basin (DRB) HUC12s. The spatial polygons used in this notebook come from the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Q0CniDJtCL"},{"type":"link","url":"https://www.sciencebase.gov/catalog/item/60cb5edfd34e86b938a373f4","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"NHDPlusV2 snapshot of the Watershed Boundary Dataset HUC12 boundaries","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jQxoEMZ17n"}],"key":"IKFsgq7hZl"}],"urlSource":"https://www.sciencebase.gov/catalog/item/60cb5edfd34e86b938a373f4","key":"FumRj2oFyD"},{"type":"text","value":" provided through the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"A3XRinjzcd"},{"type":"link","url":"https://docs.hyriver.io/readme/pygeohydro.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"PyGeoHydro","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jrGxj97s22"}],"urlSource":"https://docs.hyriver.io/readme/pygeohydro.html","key":"YlqZ9FTFX9"},{"type":"text","value":" python package.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vEahtPquTh"}],"key":"LCMcjUBAua"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We use the HyTest intake catalog to access CONUS404 from the OSN pod. This notebook provides a relatively simple and efficient workflow that can be easily run on a local computer.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JKwpyjWFM5"}],"key":"FN6CWlNrlI"}],"key":"OsBwp88Af1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Common python packages\nimport xarray as xr\nimport hvplot.xarray\nimport hvplot.pandas\nimport hvplot.dask\nimport intake\nimport pystac\nfrom packaging.version import Version\nimport zarr\nimport warnings\nimport datetime\nimport holoviews as hv\nimport geoviews as gv\nfrom holoviews import opts\nimport cartopy.crs as ccrs\nimport panel as pn\nimport numpy as np\nimport pandas as pd\nimport geopandas as gpd\n\n# HyRiver packages\nfrom pynhd import NLDI, WaterData\nimport pygeohydro as gh\n# GDPTools packages\nfrom gdptools import AggGen, UserCatData, WeightGen\nimport os\n# Until gdptools updates it's numpy dependency to v2, the environment statement below is required\nos.environ[\"HYRIVER_CACHE_DISABLE\"] = \"true\"\n\nhv.extension(\"bokeh\")\npn.extension()\n\nwarnings.filterwarnings('ignore')","key":"fFqkKQkEMF"},{"type":"outputs","id":"OJPWkyfgxPk9w1rDAGCPV","children":[],"key":"OuBDrbp4aB"}],"key":"YsTfLCDAjK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we setup a variable the sets our local context, working on the HPC or working locally on your Desktop.  This just modifies the access point of the conus404 data, using the Hovenweep access for HPC and the OSN pod access for the Desktop.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LJplFmFtFv"}],"key":"mEZ1XpAjMX"}],"key":"COCjkLiQFL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t_sys = \"Desktop\"  # \"HPC\"  # or \"Desktop\"\n","key":"kE0WV60w5j"},{"type":"outputs","id":"rmHKm-M6B9kGtIazLe3oc","children":[],"key":"s5A7UqQrfx"}],"key":"F5rdkRF5dq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can use a subset of the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uCKv5vc3K6"},{"type":"link","url":"https://docs.hyriver.io/index.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HyRiver","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CZo533kTnk"}],"key":"TXK1EaT1LZ"}],"urlSource":"https://docs.hyriver.io/index.html","key":"owLK2sSrvV"},{"type":"text","value":" Python packages to access HUC12 geometries representing the Delaware River Basin. The process involves several steps:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oZQMYd52qC"}],"key":"vrdGh6NQzC"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Select the HUC4 Mid-Atlantic Region","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rlD9jPSwdr"}],"key":"janLglUtP5"},{"type":"text","value":":","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nWudW1JGsJ"}],"key":"LQpovaQDpW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This region encompasses the Delaware River Basin (HUC4 code: 0204).","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IZFEjutSfP"}],"key":"T0bErwI5QL"}],"key":"oz5ywvk8RF"}],"key":"Z8LYJ3yfGE"}],"key":"ZEB3GgUtrx"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Retrieve HUC12 Basins within the Selected HUC4","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"b842Z4ecFy"}],"key":"DKh438WzBE"},{"type":"text","value":":","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZK6gzoT54C"}],"key":"XyEXOIGTZU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Obtain all HUC12 basins that fall within the HUC4 Mid-Atlantic region.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Edj7odXPcI"}],"key":"LaOUw6vy8g"}],"key":"HUDXlEzkvk"}],"key":"mTasOWs3k4"}],"key":"TYqsabPlfh"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Filter HUC12 Basins","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"cWOjQd9NLu"}],"key":"BWLytU5Har"},{"type":"text","value":":","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lyl2eIox8n"}],"key":"d9GYEtKeES"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Focus on the HUC12 basins within the two HUC6 regions whose drainages terminate in the Delaware River Basin (DRB).","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UIAnlpK5rK"}],"key":"nI4t5rxklh"}],"key":"tR2dmr7Dlt"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Exclude basins with drainages that terminate at the coast.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"zgavmJoPF8"}],"key":"A6MpcFkImC"}],"key":"wbJPbyazmX"}],"key":"hRd5U2OgmD"}],"key":"dGUYNuPw3o"}],"key":"EcbFRM2DAn"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"We used ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"GzAjZHvF8n"},{"type":"link","url":"https://water.usgs.gov/wsc/map_index.html","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Science in Your Watershed","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"C61GMMrEcX"}],"key":"EBi9sU1AnU"}],"urlSource":"https://water.usgs.gov/wsc/map_index.html","key":"DQoIrzTiuQ"},{"type":"text","value":" to help identify the HUC6 regions that drain directly into the DRB.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZJJoHzZGxx"}],"key":"aU55WxMaIf"}],"key":"qYyjbNZlsW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nwbd = gh.WBD(\"huc4\")\ndel_huc4 = wbd.byids(field=\"huc4\", fids=\"0204\")\nhuc12_basins = WaterData('wbd12').bygeom(del_huc4.geometry[0])\nfiltered_gdf = huc12_basins[huc12_basins['huc12'].str.startswith(('020401', '020402'))]\nfiltered_gdf","key":"giFgzZgdRm"},{"type":"outputs","id":"pOM3FmM-QMPDwqgtiaDMo","children":[],"key":"AIh075w5SR"}],"key":"MRRH4R3Tg2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from holoviews.element.tiles import OSM\ndrb = filtered_gdf.hvplot(\n    geo=True, coastline='50m', alpha=0.2,  frame_width=300,\n    xlabel=\"longitude\", ylabel=\"latitude\",\n    title=\"Delaware River HUC12 basins\", aspect='equal'\n)\nOSM() * drb","key":"Izuip4SMyE"},{"type":"outputs","id":"GIQ79QB0qpejw-9SfV_5Z","children":[],"key":"kiGKF91gEC"}],"key":"JFOiIUlknc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Access conus404 via the WMA STAC catalog.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QNzuRQIv0d"}],"key":"MXi9SboGs9"}],"key":"iACmi2Tqgv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_children(catalog, collection_id=None):\n    \"\"\"\n    This function retrieves a specified collection from a STAC catalog/collection and prints key metadata \n    for exploring/accessing the datasets contained within it.\n    If there is no collection ID provided, the collections in the top level of the catalog will be printed.\n    If a collection ID is provided, it will retrieve the collection with that ID from the input catalog/collection.\n    If the collection ID points to a dataset, it will print the assets available for the dataset.\n    If the collection ID points to another collection, it will list the child collections in the IDed collection.\n\n    Args:\n        catalog (pystac.Catalog | pystac.Collection): The STAC catalog/collection object.\n        collection_id (str): The ID of the collection or dataset to retrieve from catalog.\n    \n    Returns:\n        collection (pystac.Catalog | pystac.Collection): The collection object corresponding to the provided ID\n                                                         or the top-level catalog if no ID is provided.\n    \"\"\"\n    dataset = False\n    if collection_id:\n        collection = catalog.get_child(collection_id)\n        if collection.assets:\n            dataset = True\n            print(f\"{collection_id} is a dataset. Please review the assets below and select one to open.\")\n\n        else:\n            print(f\"{collection_id} is a collection. Please review the child items and select one to open in the next cell.\")\n    else:\n        collection = catalog\n    if dataset==True:\n        # List the assets\n        for asset in collection.assets:\n            print(f\"Asset ID: {asset}\")\n            print(f\"    Title: {collection.assets[asset].title}\")\n            print(f\"    Description: {collection.assets[asset].description}\")\n    else:\n        collections = list(collection.get_collections())\n        print(f\"Number of collections: {len(collections)}\")\n        print(\"Collections IDs:\")\n        for child_collection in collections:\n            id = child_collection.id\n            cite_as = \"Not available\"\n            for link in child_collection.links:\n                if link.rel == \"cite-as\":\n                    cite_as = link.target\n            print(f\"- {id}, Source: {cite_as}\")\n    return collection","key":"gzHIVlBz2Z"},{"type":"outputs","id":"5RbQuADlY0Sh9RXZWrbhE","children":[],"key":"wloBBeFNlF"}],"key":"HLF9SY5gXQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# url for the WMA STAC Catalog\ncatalog_url = \"https://api.water.usgs.gov/gdp/pygeoapi/stac/stac-collection/\"\n\n# use pystac to read the catalog\ncatalog = pystac.Catalog.from_file(catalog_url)\n\n# list the collections in the catalog\ncatalog = get_children(catalog)","key":"BB9FD1vaBA"},{"type":"outputs","id":"UKyQ5-cdiOBFXcYxcwkWD","children":[],"key":"KOL6km4AN9"}],"key":"UOwbz1OqIM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# select a collection from the catalog, replace the collection ID with the one you want to use:\ncollection = get_children(catalog, collection_id=\"conus404\")","key":"ItzCQqOg4e"},{"type":"outputs","id":"FGe0HuTXzfqBY19NGHw6q","children":[],"key":"aMDYSnoHK8"}],"key":"r6UHc8Bte8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# select a collection from the catalog, replace the collection ID with the one you want to use:\ncollection = get_children(collection, collection_id=\"conus404_xtrm_daily\")","key":"SCYBqnJVDF"},{"type":"outputs","id":"3nHVq3-gqOUxAS9qyyhSi","children":[],"key":"LlSIorKZB8"}],"key":"lscJ97abIi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There are a couple of options for accessing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zbeg4M2OPY"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"conus404","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vvDjbPgf8y"}],"key":"F8qrN20rvF"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i8qcBaCo34"}],"key":"SqeLrrFuLk"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HPC Setting (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VzbhlpHvaP"},{"type":"inlineCode","value":"t_sys = HPC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hBepiEwlda"},{"type":"text","value":")","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ndmz32I5zr"}],"key":"IcHgYEZpzO"},{"type":"text","value":":","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kNyRRkpxNQ"}],"key":"FjNOt1ETCh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Assumption","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"D5PaQYMgAr"}],"key":"WCfDfXaAiu"},{"type":"text","value":": The notebook is run on the USGS HPC Hovenweep.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vTGQiZDUMl"}],"key":"sJbmo7RLzc"}],"key":"r9KloK6Z1H"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Access Method","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KFiv3aHEKO"}],"key":"aFfcF96Va9"},{"type":"text","value":": Utilizes the on-premises version of the data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ry8K4RfPbz"}],"key":"bobyCZklKG"}],"key":"G0ijHLBnZl"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Benefits","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eNQkECsJP4"}],"key":"TvdF9AzIQr"},{"type":"text","value":":","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JkqmsmbA6v"}],"key":"VLPziBGRuZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Workflow Association","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"X5WKxomfZr"}],"key":"OzhcCQsMEZ"},{"type":"text","value":": The workflow is directly linked to the data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"NP31adKBPi"}],"key":"K0XN1U8U08"}],"key":"ITFYNJd4ve"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Speed","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"OgmHDxYHeW"}],"key":"EQ36VOxwrA"},{"type":"text","value":": Eliminates the need to download data, significantly reducing access and processing time.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"qEyhB3uNyu"}],"key":"xSMXVsK6uC"}],"key":"ZRaprzvwDw"}],"key":"WRnnbLqKex"}],"key":"rP4ExG8l9X"}],"key":"haHvJFlCxb"}],"key":"vLbKUJD9zb"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Desktop Setting (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"egH1EYyzCv"},{"type":"inlineCode","value":"t_sys = Desktop","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"TOHecQsu3c"},{"type":"text","value":")","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ewz3xSsoUm"}],"key":"TN8CWKZtEO"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"GM7RM0Lcur"}],"key":"s3cSpRaPLD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Use Case","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"jOZY9hCG10"}],"key":"XAVQLl0vhG"},{"type":"text","value":": Suitable for workflows that do not require HPC resources or for developing workflows locally before deploying them to the HPC.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"mBPUvlDWT3"}],"key":"FeXLvHj0vI"}],"key":"Y4qXS9SSus"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Access Method","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ks1xLZE7RF"}],"key":"ra5mnGd0Ru"},{"type":"text","value":": Connects to the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"jUFHEBZ638"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"conus404","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"HSJJJji0Kn"}],"key":"R0oWaPIV6W"},{"type":"text","value":" data via the OSN pod.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"iYwv7LNejX"}],"key":"hHXQh3tZk0"}],"key":"QDSj527cif"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Benefits","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QnooLshBpB"}],"key":"Q4fkhnwszy"},{"type":"text","value":":","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"aBd4nxxXyr"}],"key":"pI53T3rWkY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Flexibility","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ZX8XbsyXCJ"}],"key":"dZVhcdsmer"},{"type":"text","value":": Allows for local development and testing.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RAosouRqTa"}],"key":"qpu9TFYYjV"}],"key":"rA3POi2Mrf"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Performance","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"hwN3AHiajI"}],"key":"ChFRWCbrCS"},{"type":"text","value":": Provides a fast connection to the data.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"jXw78M7fiZ"}],"key":"IE5UNdYgBl"}],"key":"TXNtoDZ46y"}],"key":"D2M3GgkMtZ"}],"key":"qY2OYoDYgW"}],"key":"uzIMrvKeQE"}],"key":"yIj7vqb7fa"}],"key":"uDhWVmRdMK"}],"key":"Ill9etjQFw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Select the dataset you want to read into your notebook and preview its metadata\nif t_sys == \"HPC\":\n    selected_asset_id = 'zarr-disk-hovenweep'\nelif t_sys == \"Desktop\":\n    selected_asset_id = 'zarr-s3-osn' \nelse:\n    print(\"Please set the variable t_sys above to one of 'HPC' or 'Desktop'\")        \nasset = collection.assets[selected_asset_id]\nasset","key":"fBNW9vbuoE"},{"type":"outputs","id":"CHwljpKEWK1syNCHMosXj","children":[],"key":"gFVyss0Zqh"}],"key":"XSWtzRPE2m"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# read in the dataset and use metpy to parse the crs information on the dataset\nprint(f\"Reading {selected_asset_id} metadata...\", end='')\nif Version(zarr.__version__) \u003c Version(\"3.0.0\"):\n    ds = xr.open_dataset(\n        asset.href,\n        storage_options=asset.extra_fields['xarray:storage_options'],\n        **asset.extra_fields['xarray:open_kwargs']\n    )\nelse:\n    ds = xr.open_dataset(\n    asset.href,\n    storage_options=asset.extra_fields['xarray:storage_options'],\n    **asset.extra_fields['xarray:open_kwargs'],\n    zarr_format=2\n    )\n\n\n\nds = ds.metpy.parse_cf()\nds","key":"wbfNf6PX4N"},{"type":"outputs","id":"p5XEAvYUdlnDMYR5VWEyu","children":[],"key":"QKgHuDwEio"}],"key":"KpCPUw3lKD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GDPTools Background","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JOMth6KLK9"}],"identifier":"gdptools-background","label":"GDPTools Background","html_id":"gdptools-background","implicit":true,"key":"moMGJcpzgz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we utilize three data classes from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bZdS0pGmv3"},{"type":"inlineCode","value":"gdptools","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IWMgkey9Tn"},{"type":"text","value":" package: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JDHPJqGSbs"},{"type":"inlineCode","value":"UserCatData","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LbrWnYP99M"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CmXpkpoiKX"},{"type":"inlineCode","value":"WeightGen","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NnS6ayWQSr"},{"type":"text","value":", and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wmOlv0Ghqp"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SOV5HVOmc3"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WLQQ7wVMmz"}],"key":"leEAwjtIRN"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/user_input_data_classes.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UserCatData","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZBzSNR5qpK"}],"key":"SYel3xfESU"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/user_input_data_classes.html","key":"vjWDvRTHLH"},{"type":"text","value":":","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cS0jdMjsue"},{"type":"break","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"srOu3BPUqg"},{"type":"text","value":"Serves as a data container for both the source and target datasets, along with their associated metadata. The instantiated object ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Fu7Zvzt01w"},{"type":"inlineCode","value":"user_data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OJq6sBSlHI"},{"type":"text","value":" is employed by both the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vdUODqcBTK"},{"type":"inlineCode","value":"WeightGen","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PW08IT6N0h"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"D5k4x19S1v"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IAK4dkDEgx"},{"type":"text","value":" classes.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UfChSxjZZ9"}],"key":"bxfzz4YyHJ"}],"key":"UkmhLj0oiN"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/weight_gen_classes.html","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"WeightGen","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"SzUpXnmmdo"}],"key":"SO6rExJyQA"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/weight_gen_classes.html","key":"gctK1s3zCi"},{"type":"text","value":":","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"tkQpyULae5"},{"type":"break","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"NFQmn4yTNZ"},{"type":"text","value":"Responsible for calculating the intersected areas between the source and target datasets. It generates normalized area-weights, which are subsequently used by the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BOwqKBTWZ8"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ko4UxjobTg"},{"type":"text","value":" class to compute interpolated values between the datasets.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cZU8iGzDM0"}],"key":"YYzQ3IxBLF"}],"key":"nRseOzLkoe"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"AggGen","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kLxJEGKg2p"}],"key":"erWbbh7laE"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html","key":"SjWS2H9imr"},{"type":"text","value":":","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DNeXeVLRXA"},{"type":"break","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Wu9JxNLWoI"},{"type":"text","value":"Facilitates the interpolation of target data to match the source data using the areal weights calculated by ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VJkks81QR1"},{"type":"inlineCode","value":"WeightGen","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"G3NeD8KoIK"},{"type":"text","value":". This process is conducted over the time period specified in the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WJtNZy7kXV"},{"type":"inlineCode","value":"UserCatData","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ykbZmXqoZ0"},{"type":"text","value":" object.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YVZUQy1wlm"}],"key":"eCftazw87I"}],"key":"w2fc0JtkXA"}],"key":"fixfrdOwa4"},{"type":"heading","depth":3,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Instantiation of the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RFKuNmoKMf"},{"type":"inlineCode","value":"UserCatData","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"vHMeS2uJJv"},{"type":"text","value":" class.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"GYwLS4knQf"}],"identifier":"instantiation-of-the-usercatdata-class","label":"Instantiation of the UserCatData class.","html_id":"instantiation-of-the-usercatdata-class","implicit":true,"key":"SmptqMxHUe"}],"key":"UvaoP7hdKk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Coordinate Reference System (CRS) of the conus404 dataset\nsource_crs = ds.crs.crs_wkt\n\n# Coordinate names of the conus404 dataset\nx_coord = \"x\"\ny_coord = \"y\"\nt_coord = \"time\"\n\n# Time period of interest for areal interpolation of conus404 to DRB HUC12s\n# using the AggGen class below. Note: The dates follow the same format as the\n# time values in the conus404 dataset.\nsdate = \"1979-10-01T00:00:00.000000000\"\nedate = \"2022-10-01T00:00:00.000000000\"\n\n# Variables from the conus404 dataset used for areal interpolation\nvariables = [\"T2MIN\", \"T2MAX\", \"RAINNCVMEAN\"]\n\n# CRS of the DRB HUC12 polygons\ntarget_crs = 5070\n\n# Column name for the unique identifier associated with target polygons.\n# This ID is used in both the generated weights file and the areal interpolated output.\ntarget_poly_idx = \"huc12\"\n\n# Common equal-area CRS for reprojecting both source and target data.\n# This CRS is used for calculating areal weights in the WeightGen class.\nweight_gen_crs = 5070\n\n# Instantiate the UserCatData class, which serves as a container for both\n# source and target datasets, along with associated metadata. The UserCatData\n# object provides methods used by the WeightGen and AggGen classes to subset\n# and reproject the data.\nuser_data = UserCatData(\n    ds=ds,\n    proj_ds=source_crs,\n    x_coord=x_coord,\n    y_coord=y_coord,\n    t_coord=t_coord,\n    var=variables,\n    f_feature=filtered_gdf,\n    proj_feature=target_crs,\n    id_feature=target_poly_idx,\n    period=[sdate, edate],\n)\n","key":"yEkX1FIVJP"},{"type":"outputs","id":"efDVu79mgx51sV_SioHSp","children":[],"key":"hTocQ2zgvY"}],"key":"ClZ2rJrUrn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Weight Generation with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JKvZCC0Ndr"},{"type":"inlineCode","value":"WeightGen","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gjntq2w3w1"}],"identifier":"weight-generation-with-weightgen","label":"Weight Generation with WeightGen","html_id":"weight-generation-with-weightgen","implicit":true,"key":"A842RrBJ9M"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we utilize the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a9MTelL5jk"},{"type":"inlineCode","value":"WeightGen","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"d5GuZF9dcm"},{"type":"text","value":" class from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VXRmNtUR2l"},{"type":"inlineCode","value":"gdptools","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"C7PGXbyuOb"},{"type":"text","value":" package to calculate the normalized areal weights necessary for interpolating the source gridded data (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nrS45FO2h1"},{"type":"inlineCode","value":"conus404","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dbqnyGyG6o"},{"type":"text","value":") to the target polygonal boundaries (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KKdc4z33PI"},{"type":"inlineCode","value":"DRB HUC12s","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OGpoCTvR38"},{"type":"text","value":"). The areal weights represent the proportion of each grid cell that overlaps with each polygon, facilitating accurate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uYWIBCCEjj"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"areal interpolation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mu8YUdJSV7"}],"key":"ZJg5LH0D92"},{"type":"text","value":" of the data. These weights are calculated using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZiIbvn9wXF"},{"type":"inlineCode","value":"calculate_weights()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IbW9Eoy7P3"},{"type":"text","value":" method.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MjIPYoZZrq"}],"key":"pLvwYfRetP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Weight Calculation Process:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x8JirlQUaE"}],"key":"o9YeuodNB2"}],"key":"xz5fQD1Umm"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Subset Source Data","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yENltEeXbx"}],"key":"KFOkn8bZvI"},{"type":"text","value":": The source data is subset based on the bounds of the target data, with an additional small buffer to ensure coverage. The buffer size is determined based on the cell size of the source data. The buffer is 2 times the max(dx, dy). In other words, the buffer is essentially 2 source grid cells in the x and y dimensions.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"N8xW6fOcXV"}],"key":"IkOIylrGrs"}],"key":"fCtHt8rQ15"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Create cell boundary GeoDataFrame","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RtUiMptoET"}],"key":"Ma9lWTBTfa"},{"type":"text","value":": A GeoDataFrame of the cell boundaries is created for each node in the subsetted source data, enabling spatial operations.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"P51TXXusY3"}],"key":"J08WCwOky3"}],"key":"xhSAF4eDq0"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Validate Geometries","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"iPLugGUs45"}],"key":"mAKDADv7fN"},{"type":"text","value":": The target file is checked for invalid geometries, which can occur due to various reasons such as topology errors. Invalid geometries are fixed using Shapely’s ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Mn6zyYF1y0"},{"type":"inlineCode","value":"make_valid()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YG4QbYZryw"},{"type":"text","value":" method to prevent failures during intersection calculations.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"mDzxjSvnl4"}],"key":"p4uipwZSwH"}],"key":"e5ENsfwdXi"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Calculate and Normalize Areas","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"eciyutFyNH"}],"key":"CuVPoELd2p"},{"type":"text","value":": For each polygon, ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Vs0djZGADo"},{"type":"inlineCode","value":"gdptools","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XxlWBNX9xN"},{"type":"text","value":" calculates the area of each intersecting grid cell and normalizes it by the total area of the target polygon. This ensures that the weights for each polygon sum to 1, provided the polygon is entirely covered by the source data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"YRl2BF2ymf"}],"key":"S4ycnDsJAA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Validation","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"yCczYOCETy"}],"key":"nTiXDIQFgF"},{"type":"text","value":": A quick check on the weights can be performed by grouping the resulting weights by the ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"FnwIFRRpFL"},{"type":"inlineCode","value":"target_poly_idx","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"OqgShRDomB"},{"type":"text","value":" and calculating the sum. For all polygons completely covered by the source data, the weights will sum to 1.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"hhmIPIfRjZ"}],"key":"GfhqInELfF"}],"key":"Mn1kTOr9Dv"}],"key":"OI4Cf7qRaZ"}],"key":"C00rQH3cge"}],"key":"UlF0CYfkJu"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Note:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"nI54xtUxV4"}],"key":"rlASAfaDZy"},{"type":"text","value":" The ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qYdaaLzzQX"},{"type":"inlineCode","value":"method","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mHekBXDtGh"},{"type":"text","value":" parameter can be set to one of ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"wpflsc6eds"},{"type":"inlineCode","value":"\"serial\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Mol9ca1oSi"},{"type":"text","value":", ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BXqNeww4wP"},{"type":"inlineCode","value":"\"parallel\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xv3EauIL2r"},{"type":"text","value":", or ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"PkQcm0po4n"},{"type":"inlineCode","value":"\"dask\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"fNOnszhwJG"},{"type":"text","value":". Given the scale of the gridded ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"VCG8EQ9GKx"},{"type":"inlineCode","value":"conus404","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"FxTGlWn2TE"},{"type":"text","value":" data (4 km × 4 km) and the number and spatial footprint of the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QEFDH2RN7j"},{"type":"inlineCode","value":"DRB HUC12s","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"CFQSgDhw9r"},{"type":"text","value":", using ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"RiMcLvp4Bl"},{"type":"inlineCode","value":"\"serial\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"CguXQXF29E"},{"type":"text","value":" in this case is the most efficient method. In subsequent sections, we will explore how the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"rA8KrFvh44"},{"type":"inlineCode","value":"\"parallel\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pQ0S41poXW"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"DnRn3OXzpS"},{"type":"inlineCode","value":"\"dask\"","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"I6mAmqOtqO"},{"type":"text","value":" methods can provide speed-ups in the areal interpolation process, as well as in the computation of weights for broader CONUS-wide targets.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"FkhDLFgUAA"}],"key":"MLFfuas0w9"}],"key":"xUaVr8KaKP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nwght_gen = WeightGen(\n    user_data=user_data,\n    method=\"serial\",\n    output_file=\"wghts_drb_ser_c404daily.csv\",\n    weight_gen_crs=6931\n)\n\nwdf = wght_gen.calculate_weights()","key":"OkjCjv1gSF"},{"type":"outputs","id":"PLsMzNszNjt-cmIGyqXyj","children":[],"key":"JYIrRBHLEM"}],"key":"QiJxRN89N1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Areal Interpolation with the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bTJFt2drBq"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q62eFuSt0V"},{"type":"text","value":" Class","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"quj2ttjDv4"}],"identifier":"areal-interpolation-with-the-agggen-class","label":"Areal Interpolation with the AggGen Class","html_id":"areal-interpolation-with-the-agggen-class","implicit":true,"key":"XnMY2yN15z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we demonstrate the use of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WrxRvZ6aPB"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VO0XAmYBk0"},{"type":"text","value":" class and its ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dcn3qVmDyN"},{"type":"inlineCode","value":"calculate_agg()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cYRdR2j4AB"},{"type":"text","value":" method from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hbvL7pYDFV"},{"type":"inlineCode","value":"gdptools","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KT3OVLoe6H"},{"type":"text","value":" package to perform areal interpolation. We will explore all three ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bi67h9DPkn"},{"type":"inlineCode","value":"agg_engine","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bEBvU93R17"},{"type":"text","value":" options: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FCNjICDfAK"},{"type":"inlineCode","value":"\"serial\"","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CcNlgbuoFr"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bX6l7S65Ju"},{"type":"inlineCode","value":"\"parallel\"","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"y6h5lFQFLs"},{"type":"text","value":", and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e7j74S0wuh"},{"type":"inlineCode","value":"\"dask\"","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hjw1GVfW5U"},{"type":"text","value":". The following links provide detailed documentation on the available parameter options:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FLeJn19uDl"}],"key":"SwdNbHKa3B"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGENGINES","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"agg_engines","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Q93DF18rTP"}],"key":"BgYGAY8Xrh"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGENGINES","key":"WzbA8p4iFz"}],"key":"xNHvMiW0dZ"}],"key":"A6aHc1ipbb"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGWRITERS","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"agg_writers","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"b2uELGu7Wt"}],"key":"DPXRnd4tHq"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AGGWRITERS","key":"FU7JDg3z8G"}],"key":"NocuYGlYSG"}],"key":"E0spDhqEL6"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.STATSMETHODS","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"stat_methods","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"K9uGt95YSb"}],"key":"GSvJXaapzL"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.STATSMETHODS","key":"X0QXjNGGE2"}],"key":"UkekdvnScY"}],"key":"DnWwYjDXvX"}],"key":"oerFP7nRGm"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"When using ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DW3aixoZPv"},{"type":"inlineCode","value":"AggGen","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"j6M3kjT7t8"},{"type":"text","value":" and the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AEq6uJJKgO"},{"type":"inlineCode","value":"calculate_agg()","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FPnczRElnh"},{"type":"text","value":" method, it is important to consider the overlap between the source and target data when selecting the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"yjO1WrwfZn"},{"type":"inlineCode","value":"stat_method","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eApJjCACpH"},{"type":"text","value":" parameter value. All statistical methods have a masked variant in addition to the standard method; for example, ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pSdopSjwdn"},{"type":"inlineCode","value":"\"mean\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"c1AtUH5mQt"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qwiivGZeIL"},{"type":"inlineCode","value":"\"masked_mean\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"k0c5mix6lq"},{"type":"text","value":". In cases where the source data has partial overlap with a target polygon, the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"joTSq4kubS"},{"type":"inlineCode","value":"\"mean\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"l6I1UH1dk7"},{"type":"text","value":" method will return a missing value for the polygon, whereas the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Dv6BD3pyH7"},{"type":"inlineCode","value":"\"masked_mean\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qKz0KNfEQ8"},{"type":"text","value":" method will calculate the statistic based on the available overlapping source cells. These considerations help users determine whether using a masked statistic is desirable or if a missing value would be preferred, allowing for post-processing of missing values (e.g., using nearest-neighbor or other approaches to handle the lack of overlap). In the case here conus404 completely covers the footprint of the DRB HUC12s, as such the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TJvx4svcYh"},{"type":"inlineCode","value":"\"mean\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fpHWCjd5Py"},{"type":"text","value":" method would be sufficient.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qABPUHCW9i"}],"key":"TqmYiKkj58"}],"key":"ltlxbO5QVT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nagg_gen = AggGen(\n    user_data=user_data,\n    stat_method=\"mean\",\n    agg_engine=\"parallel\",\n    jobs=4,\n    agg_writer=\"netcdf\",\n    weights='wghts_drb_ser_c404daily.csv',\n    out_path='.',\n    file_prefix=\"serial_weights\",\n    precision=8\n)\nngdf, ds_out = agg_gen.calculate_agg()","key":"Ql6Ct0z57q"},{"type":"outputs","id":"0ip2QWQCSDVvyd13Osl1m","children":[],"key":"JW6KbakqfT"}],"key":"qh1BFqev9l"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qK4AnDIF2U"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"uC2now1PDc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HeriLp2Q9q"},{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AggGen.calculate_agg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"calculate_agg()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CQKZyDiH9l"}],"key":"HsVQ20os61"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/agg_gen_classes.html#gdptools.agg_gen.AggGen.calculate_agg","key":"glTi105gXj"},{"type":"text","value":" method returns two objects: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"us6DV4kxGl"},{"type":"inlineCode","value":"ngdf","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qymelVzxqY"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pca8tFtfUU"},{"type":"inlineCode","value":"ds_out","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yeLeaiEauL"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cgHINprx7Z"}],"key":"jgzX5Cm9Pv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"ngdf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"j7r1PpZbaz"}],"key":"zOsPy4gC6l"},{"type":"text","value":": A ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wHunBltyld"},{"type":"inlineCode","value":"GeoDataFrame","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JbqcWMW5fB"},{"type":"text","value":" derived from the target GeoDataFrame (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lfzNsX29QS"},{"type":"inlineCode","value":"filtered_gdf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VWv6J1QOti"},{"type":"text","value":") specified in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wWFp9Y1Uo4"},{"type":"inlineCode","value":"UserCatData","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hvW7Ze4daF"},{"type":"text","value":" container. This GeoDataFrame has been both sorted and dissolved based on the identifiers in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Oq1cpP0anU"},{"type":"inlineCode","value":"\"huc12\"","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aW5kqBm0eY"},{"type":"text","value":" column, as defined by the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"F7plYUTB3c"},{"type":"inlineCode","value":"target_poly_idx","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SW0ACvBDln"},{"type":"text","value":" parameter.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"luUS9DStFp"}],"key":"GXOUslKIqh"}],"key":"AaJduth24q"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"ds_out","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DDuf4NdcNX"}],"key":"WHmpPzwGsS"},{"type":"text","value":": The areally weighted interpolation output as an XArray Dataset. The Dataset consists of dimensions ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"G7R8KwUXxh"},{"type":"inlineCode","value":"time","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jyznxWEAyq"},{"type":"text","value":" and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PgrLrEm2rr"},{"type":"inlineCode","value":"huc12","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"J5xlp3REWh"},{"type":"text","value":", and the data variables are ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DU8AWZa8V2"},{"type":"inlineCode","value":"T2MIN","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"v1QUdbB3YC"},{"type":"text","value":", ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CyZsxnVVmE"},{"type":"inlineCode","value":"T2MAX","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JQeBoZvNyp"},{"type":"text","value":", and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hii5uU6dN1"},{"type":"inlineCode","value":"RAINNCVMEAN","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IdO2TSVXwG"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IyWIxLFnGB"}],"key":"LrBAqkoD2M"}],"key":"C7ix5vNrd0"}],"key":"Jcl27AcgnR"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"A preview of the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ThVUnc6y2N"},{"type":"inlineCode","value":"ngdf","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"STQpL5dXsv"},{"type":"text","value":" GeoDataFrame below shows that it is sorted by ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ERETVNgAbc"},{"type":"inlineCode","value":"\"huc12\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zZ4vAFNRe7"},{"type":"text","value":". In this case, there are no duplicate ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"nOigWzgTNr"},{"type":"inlineCode","value":"\"huc12\"","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EC2twkHGsR"},{"type":"text","value":" values, resulting in the original and output GeoDataFrames having the same number of rows.  Some target datasets such as the GFv1.1, will result in many dissolved geometries.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"f7k0jS1cY6"}],"key":"gzMBqXw8jt"}],"key":"ER5CpaIeFO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ngdf.head()","key":"LgVPQmxbSO"},{"type":"outputs","id":"QDMCiHq_BcAfEYmVfZqmO","children":[],"key":"L0PY5Nm6aB"}],"key":"QbXxmkYIp5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_out","key":"rTcsBzmT7p"},{"type":"outputs","id":"_N_uWFgBxp_EoxOo9olns","children":[],"key":"Iv2vZliJeH"}],"key":"FcMOLqP82a"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the results as a quick sanity check","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"snsbrhK43p"}],"identifier":"plot-the-results-as-a-quick-sanity-check","label":"Plot the results as a quick sanity check","html_id":"plot-the-results-as-a-quick-sanity-check","implicit":true,"key":"ZzAH1L2fqj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we plot the results along with the corresponding conus404 values.  To make the plot a little more interesting we choose the time step with the most precipitation.  This provides a quick qualitative sanity check.  If one is intersted in looking in more detail in a graphic presentation of a target polygon, overlayed on the intersecting grid cells, with the grid-cell values and weights shown for each intersection, please look at the tail end of notebook ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WxbEtwqv1v"},{"type":"link","url":"https://gdptools.readthedocs.io/en/develop/Examples/ClimateR-Catalog/terraclime_et.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ClimateR-Catalog - Terraclime data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YlEPnuHNSe"}],"key":"qVLW0BjXof"}],"urlSource":"https://gdptools.readthedocs.io/en/develop/Examples/ClimateR-Catalog/terraclime_et.html","key":"z7jraN00kn"},{"type":"text","value":" for some example code to generate a plot which give a more quantitative expression of the result.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"krNcDbeweS"}],"key":"wBSiiO93ob"}],"key":"a9TgkVlezp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Format the interpolated results for plotting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FBGO6TlUgj"}],"key":"sGGtLQgUFB"}],"key":"CER43kaQK4"}],"key":"aieMRYv8lN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Convert processed xarray Dataset to DataFrame\ndf = ds_out.to_dataframe().reset_index()\n# Pivot the DataFrame to have variables as separate columns\ndf_pivot = df.pivot_table(index=['time', 'huc12'], values=['T2MAX', 'T2MIN', 'RAINNCVMEAN']).reset_index()\n\n# Merge GeoDataFrame with DataFrame\nmerged_gdf = ngdf.to_crs(5070).merge(df_pivot, on='huc12')\n\n# Convert RAINNCVMEAN from kg/m²/s to mm/day\nmerged_gdf['RAINNCVMEAN_mm_day'] = merged_gdf['RAINNCVMEAN'] * 86400\n# Convert T2MAX and T2MIN from Kelvin to Celsius\nmerged_gdf['T2MAX_C'] = merged_gdf['T2MAX'] - 273.15\nmerged_gdf['T2MIN_C'] = merged_gdf['T2MIN'] - 273.15\n\n# Calculate total precipitation for each time step\nrain_sum = merged_gdf.groupby('time')['RAINNCVMEAN_mm_day'].sum()\n\n# Identify the time step with the maximum total precipitation\nmax_rain_time = rain_sum.idxmax()\nprint(f\"Time step with maximum total precipitation: {max_rain_time}\")\n\n# Subset the GeoDataFrame for the selected time step\nsubset = merged_gdf[merged_gdf['time'] == max_rain_time]\n","key":"T90jkJpJTn"},{"type":"outputs","id":"b3Itp9Dv5U447QxuNo1mv","children":[],"key":"BplKqZLHOf"}],"key":"F465FvTdYR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Process the sub-setted conus404 data for plotting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WC4yFZqcUh"}],"key":"bS8YsyIqDl"}],"key":"PpiZRfDgB5"}],"key":"Q9ETZCHkSO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n# We can use our agg_gen object to retrieve the subsetted conus404 data\nda_t2max = agg_gen.agg_data.get(\"T2MAX\").da\nda_t2min = agg_gen.agg_data.get(\"T2MIN\").da\nda_rain = agg_gen.agg_data.get(\"RAINNCVMEAN\").da\n\n# Get the subsetted raw conus404 cubes used in the areal interpolation\nda_t2max = agg_gen.agg_data.get(\"T2MAX\").da.sel(time=max_rain_time) - 273.15\nda_t2min = agg_gen.agg_data.get(\"T2MIN\").da.sel(time=max_rain_time) - 273.15\nda_rain = agg_gen.agg_data.get(\"RAINNCVMEAN\").da.sel(time=max_rain_time) * 86400","key":"cMpqgkJfis"},{"type":"outputs","id":"IHFOnK3Rk9MyQP9xL_1Z2","children":[],"key":"lxbfS9Fmqf"}],"key":"jtvqxcs9rx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate the plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yie2gyYmar"}],"key":"hy3bM6ovV3"}],"key":"ohhd9b1Lxz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Here we use ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"C8KGTNThUB"},{"type":"link","url":"https://geoviews.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"GeoViews","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mO9JRwBcin"}],"urlSource":"https://geoviews.org/","key":"DN73updAdG"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AwWKbleoRO"},{"type":"link","url":"https://holoviews.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"HoloViews","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"W8Zjuah4D8"}],"urlSource":"https://holoviews.org/","key":"oygB0InUGb"}],"key":"IXyFgBivyc"}],"key":"cM4QA4Ys1F"}],"key":"QvUHX3al7I"}],"key":"zag4gKkoT2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define Cartopy CRS using EPSG code 5070 (NAD83 / Conus Albers)\ncrs_cartopy = ccrs.epsg(5070)\n\n# Define color maps for each variable\ncolor_maps = {\n    'T2MAX_C': 'Reds',\n    'T2MIN_C': 'Blues',\n    'RAINNCVMEAN_mm_day': 'Greens'\n}\n# Define color maps for raw data\ncolor_maps_raw = {\n    'T2MAX': 'Reds',\n    'T2MIN': 'Blues',\n    'RAINNCVMEAN': 'Greens'\n}\n# Create Polygons for T2MAX_C\nmap_T2MAX = gv.Polygons(\n    subset.to_crs(5070), \n    vdims=['T2MAX_C'],\n    crs=crs_cartopy  # Use Cartopy CRS here\n).opts(\n    cmap=color_maps['T2MAX_C'],\n    colorbar=True,\n    tools=['hover'],\n    title='T2MAX (°C)',  # Included units\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal',\n    padding=0,\n)\n\n# Create Polygons for T2MIN_C\nmap_T2MIN = gv.Polygons(\n    subset.to_crs(5070), \n    vdims=['T2MIN_C'],\n    crs=crs_cartopy\n).opts(\n    cmap=color_maps['T2MIN_C'],\n    colorbar=True,\n    tools=['hover'],\n    title='T2MIN (°C)',  # Included units\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal',\n    padding=0,\n)\n\n# Create Polygons for RAINNCVMEAN_mm_day\nmap_RAINNCVMEAN = gv.Polygons(\n    subset.to_crs(5070), \n    vdims=['RAINNCVMEAN_mm_day'],\n    crs=crs_cartopy\n).opts(\n    cmap=color_maps['RAINNCVMEAN_mm_day'],\n    colorbar=True,\n    tools=['hover'],\n    title='RAINNCVMEAN (mm/day)',  # Included units\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal',\n    padding=0,\n)\n\n# Create raw sub-setted data frames\n# Assuming 'lon' and 'lat' are the coordinate names; adjust if necessary\ncoord_x = 'x'  # Replace with actual x-coordinate name\ncoord_y = 'y'  # Replace with actual y-coordinate name\n\n# Create HoloViews Image for T2MAX (Raw)\nimage_T2MAX_raw = hv.Image(\n    da_t2max, \n    kdims=[coord_x, coord_y],\n    vdims=['T2MAX']\n).opts(\n    cmap=color_maps_raw['T2MAX'],\n    colorbar=True,\n    tools=['hover'],\n    title='T2MAX Raw (°C)',\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal'\n)\n\n# Create HoloViews Image for T2MIN (Raw)\nimage_T2MIN_raw = hv.Image(\n    da_t2min, \n    kdims=[coord_x, coord_y],\n    vdims=['T2MIN']\n).opts(\n    cmap=color_maps_raw['T2MIN'],\n    colorbar=True,\n    tools=['hover'],\n    title='T2MIN Raw (°C)',\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal'\n)\n\n# Create HoloViews Image for RAINNCVMEAN (Raw)\nimage_RAIN_raw = hv.Image(\n    da_rain, \n    kdims=[coord_x, coord_y],\n    vdims=['RAINNCVMEAN']\n).opts(\n    cmap=color_maps_raw['RAINNCVMEAN'],\n    colorbar=True,\n    tools=['hover'],\n    title='RAINNCVMEAN Raw (mm/day)',\n    alpha=0.7,\n    frame_width=200,\n    aspect='equal'\n)\n\n# Create a GridSpec with 3 rows and 3 columns\ngrid = pn.GridSpec(ncols=3, nrows=2, sizing_mode='fixed', width=900, height=1200)\n\n# Add title spanning all columns in the first row\ntitle = pn.pane.Markdown(\n    f\"\u003ch2 style='text-align: center;'\u003eAreal Interpolation for {max_rain_time.strftime('%Y-%m-%d')}\u003c/h2\u003e\",\n    width=900,\n    height=20\n)\n\n# Add raw data plots in the first row\ngrid[0, 0] = image_T2MAX_raw\ngrid[0, 1] = image_T2MIN_raw\ngrid[0, 2] = image_RAIN_raw\n\n# Add processed data plots in the second row\ngrid[1, 0] = map_T2MAX\ngrid[1, 1] = map_T2MIN\ngrid[1, 2] = map_RAINNCVMEAN\n\n\n# Display the grid\n# final_layout\ngrid\n\n\n# Combine the three maps into a single layout arranged horizontally\nmaped_layout = pn.Row(\n    map_T2MAX,\n    pn.Spacer(sizing_mode=\"stretch_width\"),\n    map_T2MIN,\n    pn.Spacer(sizing_mode=\"stretch_width\"),\n    map_RAINNCVMEAN,\n    width=800\n)\n\n# Combine raw data plots horizontally\nraw_layout = pn.Row(\n    image_T2MAX_raw,\n    pn.Spacer(sizing_mode=\"stretch_width\"),\n    image_T2MIN_raw,\n    pn.Spacer(sizing_mode=\"stretch_width\"),\n    image_RAIN_raw,\n    width=800\n)\n\n# Create a main title using HTML for center alignment within Markdown\ntitle = pn.pane.Markdown(\n    f\"\u003ch3 style='text-align: center;'\u003eAreal Interpolation for {max_rain_time.strftime('%Y-%m-%d')}\u003c/h3\u003e\",\n    # width=1800  # Adjust width as needed\n)\n\n# Combine both rows vertically\ncombined_layout = pn.Column(\n    raw_layout,\n    maped_layout\n)\n# Combine the title and the layout vertically\nfinal_layout = pn.Column(\n    title,\n    combined_layout,\n    width=850\n)\n\nfinal_layout","key":"MVNaA8Bv81"},{"type":"outputs","id":"keEbnSINAWfbX24z2H4ph","children":[],"key":"GU4DJMQjor"}],"key":"aEC7I9hpbh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There is a clear increasing gradient in temperature from north to south that is visible in the interpolated results.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nLJ13lq9ba"}],"key":"YhneW93xab"}],"key":"jxxtAkphoj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parallel and Dask Methods","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ljtvD69yIo"}],"identifier":"parallel-and-dask-methods","label":"Parallel and Dask Methods","html_id":"parallel-and-dask-methods","implicit":true,"key":"Gz1NwvwPbP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The domain of this workflow is small enough that using either the parallel or dask methods are not necessary.  However there is a speedup that we illustrate.  The parallel and dask engines used in the AggGen object operate in a similar manner using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mq5mYSvTAO"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pMLKWIzuqm"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"upymKfklH3"},{"type":"inlineCode","value":"dask bag","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ehTPy2oRtY"},{"type":"text","value":" respectivly. Using the jobs parameter the user can specify the number of processes to run.  The target data is chunked by the number of processes and each processor recieves a chunked GeoDataFrame along with a copy of the sub-setted source data.  This creates an overhead that can determine how effiently the parallel processing runs.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"V2Y36dztev"}],"key":"B6NzkFmFNL"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The tradeoff in using parallel processing lies in the balance between the number of processors and the overhead of copying data. While increasing the number of processors can significantly reduce computation time by dividing the workload, it also increases the amount of memory used for duplicate datasets and the coordination time between processes. There is a ‘sweet spot’ where the number of processors maximizes performance but beyond this point, additional processors may slow down the operation due to the overhead of managing more processes. The optimal number of processors depends on the size of the data, available memory, and system architecture, and can typically be found through experimentation.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oLpRhzr2No"}],"key":"F2GVKCtTXZ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Importantly, most of the time in processing here is dominated by downloading the data, so the speedup is relatively small.  For larger domains the processing will be a larger percentage of the total time and the speedup should be more pronounced.  Well explore that in the CONUS scale processing of conus404 on Hovenweep.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SkVja3Qpjo"}],"key":"J3az56rjwW"}],"key":"pnuwvr2wO9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\ngg_gen = AggGen(\n    user_data=user_data,\n    stat_method=\"masked_mean\",\n    agg_engine=\"parallel\",\n    agg_writer=\"netcdf\",\n    weights='wghts_drb_ser_c404daily.csv',\n    out_path='.',\n    file_prefix=\"testing_p2\",\n    precision=8,\n    jobs=4\n)\nngdf, ds_out = agg_gen.calculate_agg()","key":"N8p5g6V50u"},{"type":"outputs","id":"F2OwZWa3WwE4dzpnh86Rw","children":[],"key":"M8b3EItL69"}],"key":"aYEimlK4Kk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nagg_gen = AggGen(\n    user_data=user_data,\n    stat_method=\"masked_mean\",\n    agg_engine=\"dask\",\n    agg_writer=\"netcdf\",\n    weights='wghts_drb_ser_c404daily.csv',\n    out_path='.',\n    file_prefix=\"testing_p3\",\n    precision=8,\n    jobs=4\n)\nngdf, ds_out = agg_gen.calculate_agg()","key":"SfJym6DS1u"},{"type":"outputs","id":"EOOfrUi9N6BQo7hNwy4fT","children":[],"key":"hjUtNuSehX"}],"key":"Q2PquD2CTI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_agg = xr.open_dataset(\"testing_p3.nc\")\nds_agg","key":"wWc4qmIDhg"},{"type":"outputs","id":"yTt-Dtb_GyEzM2N8KEqSH","children":[],"key":"Y6RkJDhQuS"}],"key":"pPQlDuuSdK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_agg.T2MAX.values","key":"TRXrPXPkjW"},{"type":"outputs","id":"rRtuo2IyBagnpwjWVsxzk","children":[],"key":"h1BwTpjtlt"}],"key":"nTQ9ZwqpGW"}],"key":"acG7Sg7UN0"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Spatial Aggregation","url":"/dataset-processing/spatial-aggregation","group":"Dataset Processing"},"next":{"title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","url":"/dataset-processing/tutorials/spatial-aggregation/conus404-spatial-aggregation-gfv1-1","group":"Dataset Processing"}}},"domain":"http://localhost:3005"},"project":{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hytest//build/manifest-5D5D9E8C.js";
import * as route0 from "/hytest//build/root-AA24SA6C.js";
import * as route1 from "/hytest//build/routes/$-5SFLQWPV.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hytest//build/entry.client-PCJPW7TK.js");</script></body></html>