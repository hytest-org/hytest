
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Basics of Chunk Shape and Size &#8212; HyTEST Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dataset_processing/tutorials/chunking/101/BasicsShapeSize';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Writing Chunked Files" href="WriteChunkedFiles.html" />
    <link rel="prev" title="How to Examine a Stored Dataset’s Chunk Shape" href="ExamineDataChunking.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">v0.0.1_alpha01</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../doc/About.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-light" alt="HyTEST Project - Home"/>
    <script>document.write(`<img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-dark" alt="HyTEST Project - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Environment Set-Up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/README.html">Compute Environments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-General.html">General QuickStart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-Cloud-Nebari.html">Cloud: Nebari Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/OpenOnDemand.html">HPC Server: Open OnDemand Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/JupyterForward.html">HPC Server: Jupyter Forward Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/StartScript.html">HPC Server: Start Script Quick-Start</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../environment_set_up/Help_AWS_Credentials.html">AWS Credentials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/clusters.html">Starting a Dask Cluster</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Nebari.html">Nebari Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Denali.html">Denali HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.html">Hovenweep/Tallgrass HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Desktop.html">Local Desktop Dask Cluster</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/README.html">Essential Reading</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/ReadingsTutorials.html">Foundations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/DataSources/README.html">Data Sources</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_APIs.html">Data/APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_S3.html">Data/Cloud Storage</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../essential_reading/Parallel_Dask.html">Parallelism with Dask</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Access</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_catalog/README.html">HyTEST Data Catalog (Intake)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/subcatalogs/README.html">HyTEST Intake Sub-Catalogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/STAC.html">USGS Water Mission Area STAC Catalog</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_access/CONUS404_ACCESS.html">CONUS404 Products Data Access</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/CONUS404_CHANGELOG.html">CONUS404 Zarr Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/conus404_explore.html">Explore CONUS404 Dataset</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Zarr Creation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Data Chunking Tutorial Overview</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Introduction to Chunking</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="WhyChunk.html">Why (re)Chunk Data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="ExamineDataChunking.html">How to Examine a Stored Dataset’s Chunk Shape</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Basics of Chunk Shape and Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="WriteChunkedFiles.html">Writing Chunked Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Rechunking.html">Rechunking</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../201/index.html">Advanced Topics in Chunking</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../201/RechunkingwithDask.html">Rechunking Larger Datasets with Dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../201/CreateVirtualZarr.html">Generating a Virtual Zarr Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../201/IncludeCRSinZarr.html">Adding Coordinate Reference Systems (CRS) to Zarr Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../201/OptimalChunkSelection.html">Choosing an Optimal Chunk Size and Shape</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../back/index.html">Chunking References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../back/Glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../back/AdditionalResources.html">Additional Resources</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../conus404_temporal_aggregation.html">CONUS404 Temporal Aggregation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../spatial_aggregation.html">Spatial Aggregation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_DRB.html">gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_GFv1_1.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_WBD12.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation.html">Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_comparison.html">gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_point_selection.html">CONUS404 Site Data Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_regrid.html">CONUS404 Regridding (Curvilinear =&gt; Rectilinear)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Evaluation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/metrics.html">Evaluation Metrics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark – Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_StdSuite_v1.html">Standard Suite (v1) Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_StdSuite_v1.html">Standard Suite (v1) Metrics – Usage Examples</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/00_Overview.html">Streamflow Model Evaluation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/01_Data_Prep.html">Streamflow Eval :: Data Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_StdSuite.html">Streamflow Eval :: StdSuite Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_DScore.html">Steamflow Eval :: DScore Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/03_Vizualization.html">Streamflow Eval :: Visualization</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../LICENSE.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hytest-org/hytest" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basics of Chunk Shape and Size</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-example-dataset">Accessing the Example Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chunk-shape-and-size">Chunk Shape and Size</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-considerations">Shape Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dimension">Time Dimension</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-dimension">Spatial Dimension</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#size-considerations">Size Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#total-chunk-size">Total Chunk Size</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-and-final-considerations">Review and Final Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-chunking-recommendations">Basic Chunking Recommendations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-considerations">Final Considerations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="basics-of-chunk-shape-and-size">
<h1>Basics of Chunk Shape and Size<a class="headerlink" href="#basics-of-chunk-shape-and-size" title="Link to this heading">#</a></h1>
<p>The goal of this notebook is to learn the basics about chunk shape and size.
We will discuss several factors to think about when deciding on chunk shape and size for datasets being written to storage.
These factors can affect the read pattern from storage and subsequently the computations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span>
</pre></div>
</div>
</div>
</div>
<section id="accessing-the-example-dataset">
<h2>Accessing the Example Dataset<a class="headerlink" href="#accessing-the-example-dataset" title="Link to this heading">#</a></h2>
<p>In this notebook, we will use the monthly PRISM v2 dataset as an example for understanding the effects of chunk shape and size.
Let’s go ahead and read in the file using xarray.
To do this, we will use <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a> to get a mapper to the Zarr file on the HyTEST OSN.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The xarray loader is “lazy”, meaning it will read just enough of the data to make decisions about its shape, structure, etc.
It will pretend like the whole dataset is in memory (and we can treat it that way), but it will only load data as required.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
    <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
    <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>   <span class="c1"># anonymous = does not require credentials</span>
    <span class="n">client_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;endpoint_url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://usgs.osn.mghpcc.org/&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s1">&#39;s3://mdmf/gdp/PRISM_v2.zarr/&#39;</span><span class="p">),</span>
    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;zarr&#39;</span>
<span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 33GB
Dimensions:    (lat: 621, lon: 1405, time: 1555, tbnd: 2)
Coordinates:
  * lat        (lat) float32 2kB 49.94 49.9 49.85 49.81 ... 24.19 24.15 24.1
  * lon        (lon) float32 6kB -125.0 -125.0 -124.9 ... -66.6 -66.56 -66.52
  * time       (time) datetime64[ns] 12kB 1895-01-01 1895-02-01 ... 2024-07-01
Dimensions without coordinates: tbnd
Data variables:
    crs        int64 8B ...
    ppt        (time, lat, lon) float64 11GB ...
    time_bnds  (time, tbnd) datetime64[ns] 25kB ...
    tmn        (time, lat, lon) float64 11GB ...
    tmx        (time, lat, lon) float64 11GB ...
Attributes: (12/24)
    Conventions:               CF-1.4
    Metadata_Conventions:      Unidata Dataset Discovery v1.0
    acknowledgment:            PRISM Climate Group, Oregon State University, ...
    authors:                   PRISM Climate Group
    cdm_data_type:             Grid
    creator_email:             daley@nacse.org
    ...                        ...
    publisher_url:             http://prism.oregonstate.edu/
    summary:                   This dataset was created using the PRISM (Para...
    time_coverage_resolution:  Monthly
    title:                     Parameter-elevation Regressions on Independent...
    time_coverage_start:       1895-01-01T00:00
    time_coverage_end:         2024-07-01T00:00</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-101363f3-118e-4b2e-b1c8-6bb6c35f1da8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-101363f3-118e-4b2e-b1c8-6bb6c35f1da8' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 621</li><li><span class='xr-has-index'>lon</span>: 1405</li><li><span class='xr-has-index'>time</span>: 1555</li><li><span>tbnd</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-f3bea3ee-2254-4b8e-95d5-60f76143a0c5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f3bea3ee-2254-4b8e-95d5-60f76143a0c5' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>49.94 49.9 49.85 ... 24.15 24.1</div><input id='attrs-62cbba9a-01f1-4903-b855-f0cd4264ff2d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-62cbba9a-01f1-4903-b855-f0cd4264ff2d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-34841395-182c-4065-a775-e94dc5f8c680' class='xr-var-data-in' type='checkbox'><label for='data-34841395-182c-4065-a775-e94dc5f8c680' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([49.9375  , 49.895832, 49.854168, ..., 24.1875  , 24.145834, 24.104166],
      shape=(621,), dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-125.0 -125.0 ... -66.56 -66.52</div><input id='attrs-a1f712ad-71a1-4859-9091-4cad3ce3a7c5' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a1f712ad-71a1-4859-9091-4cad3ce3a7c5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9d81124d-85b4-48db-9de1-246df32048b5' class='xr-var-data-in' type='checkbox'><label for='data-9d81124d-85b4-48db-9de1-246df32048b5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-125.020836, -124.979164, -124.9375  , ...,  -66.604164,  -66.5625  ,
        -66.520836], shape=(1405,), dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1895-01-01 ... 2024-07-01</div><input id='attrs-0d08e03f-0f06-4ad5-98aa-0a2423c807c6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-0d08e03f-0f06-4ad5-98aa-0a2423c807c6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d1824832-7b0a-4895-9121-f191dc0ed717' class='xr-var-data-in' type='checkbox'><label for='data-d1824832-7b0a-4895-9121-f191dc0ed717' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1895-01-01T00:00:00.000000000&#x27;, &#x27;1895-02-01T00:00:00.000000000&#x27;,
       &#x27;1895-03-01T00:00:00.000000000&#x27;, ..., &#x27;2024-05-01T00:00:00.000000000&#x27;,
       &#x27;2024-06-01T00:00:00.000000000&#x27;, &#x27;2024-07-01T00:00:00.000000000&#x27;],
      shape=(1555,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0b37e5ab-a349-4283-b205-0eaebe94514c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0b37e5ab-a349-4283-b205-0eaebe94514c' class='xr-section-summary' >Data variables: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>crs</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-b085caf9-c438-4564-a954-1c89e2ea7828' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b085caf9-c438-4564-a954-1c89e2ea7828' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b248aaa2-0245-45d0-8630-0149d3d2dfa8' class='xr-var-data-in' type='checkbox'><label for='data-b248aaa2-0245-45d0-8630-0149d3d2dfa8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>crs_wkt :</span></dt><dd>GEOGCRS[&quot;WGS 84&quot;,ENSEMBLE[&quot;World Geodetic System 1984 ensemble&quot;,MEMBER[&quot;World Geodetic System 1984 (Transit)&quot;],MEMBER[&quot;World Geodetic System 1984 (G730)&quot;],MEMBER[&quot;World Geodetic System 1984 (G873)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1150)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1674)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1762)&quot;],MEMBER[&quot;World Geodetic System 1984 (G2139)&quot;],MEMBER[&quot;World Geodetic System 1984 (G2296)&quot;],ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,LENGTHUNIT[&quot;metre&quot;,1]],ENSEMBLEACCURACY[2.0]],PRIMEM[&quot;Greenwich&quot;,0,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],CS[ellipsoidal,2],AXIS[&quot;geodetic latitude (Lat)&quot;,north,ORDER[1],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],AXIS[&quot;geodetic longitude (Lon)&quot;,east,ORDER[2],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],USAGE[SCOPE[&quot;Horizontal component of 3D system.&quot;],AREA[&quot;World.&quot;],BBOX[-90,-180,90,180]],ID[&quot;EPSG&quot;,4326]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984 ensemble</dd><dt><span>grid_mapping_name :</span></dt><dd>latitude_longitude</dd></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ppt</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-6854b13a-1389-4393-9a82-29df7acbf527' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6854b13a-1389-4393-9a82-29df7acbf527' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e6ae26a8-c92f-4897-95b4-d973a2ff317d' class='xr-var-data-in' type='checkbox'><label for='data-e6ae26a8-c92f-4897-95b4-d973a2ff317d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>mm/month</dd><dt><span>long_name :</span></dt><dd>Mean monthly precipitation</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><pre>[1356745275 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, tbnd)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-e61130df-fed7-4059-96a4-b8bc2f0b7285' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e61130df-fed7-4059-96a4-b8bc2f0b7285' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3c316809-2ab8-4457-b894-5b6487f56812' class='xr-var-data-in' type='checkbox'><label for='data-3c316809-2ab8-4457-b894-5b6487f56812' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Time interval endpoints</dd></dl></div><div class='xr-var-data'><pre>[3110 values with dtype=datetime64[ns]]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmn</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-a02f46e8-27b2-427b-9d53-7ca45cf9bf34' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a02f46e8-27b2-427b-9d53-7ca45cf9bf34' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e0a79b60-cf85-4f1e-b268-dd026d5a36e4' class='xr-var-data-in' type='checkbox'><label for='data-e0a79b60-cf85-4f1e-b268-dd026d5a36e4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degC</dd><dt><span>long_name :</span></dt><dd>Minimum monthly temperature</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><pre>[1356745275 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmx</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-a7417d6a-6e7f-4a87-baba-4b691a6615b0' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a7417d6a-6e7f-4a87-baba-4b691a6615b0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e063f2db-5d10-42be-9e7c-757ac554a85b' class='xr-var-data-in' type='checkbox'><label for='data-e063f2db-5d10-42be-9e7c-757ac554a85b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degC</dd><dt><span>long_name :</span></dt><dd>Maximum monthly temperature</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><pre>[1356745275 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-66427ed6-fdb9-4fb5-bed5-88871cd32d7f' class='xr-section-summary-in' type='checkbox'  ><label for='section-66427ed6-fdb9-4fb5-bed5-88871cd32d7f' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-b6e2e3fb-26a8-4862-9bc7-a2493f87e11e' class='xr-index-data-in' type='checkbox'/><label for='index-b6e2e3fb-26a8-4862-9bc7-a2493f87e11e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([          49.9375, 49.89583206176758, 49.85416793823242,
                 49.8125, 49.77083206176758, 49.72916793823242,
                 49.6875, 49.64583206176758, 49.60416793823242,
                 49.5625,
       ...
       24.47916603088379,           24.4375, 24.39583396911621,
       24.35416603088379,           24.3125, 24.27083396911621,
       24.22916603088379,           24.1875, 24.14583396911621,
       24.10416603088379],
      dtype=&#x27;float32&#x27;, name=&#x27;lat&#x27;, length=621))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-465b5b84-cb98-4164-aee8-fdd62bb41fc5' class='xr-index-data-in' type='checkbox'/><label for='index-465b5b84-cb98-4164-aee8-fdd62bb41fc5' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-125.02083587646484, -124.97916412353516,           -124.9375,
       -124.89583587646484, -124.85416412353516,           -124.8125,
       -124.77083587646484, -124.72916412353516,           -124.6875,
       -124.64583587646484,
       ...
        -66.89583587646484,  -66.85416412353516,            -66.8125,
        -66.77083587646484,  -66.72916412353516,            -66.6875,
        -66.64583587646484,  -66.60416412353516,            -66.5625,
        -66.52083587646484],
      dtype=&#x27;float32&#x27;, name=&#x27;lon&#x27;, length=1405))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-7e80eeed-d60c-4bdb-a4c4-91b957476cdf' class='xr-index-data-in' type='checkbox'/><label for='index-7e80eeed-d60c-4bdb-a4c4-91b957476cdf' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1895-01-01&#x27;, &#x27;1895-02-01&#x27;, &#x27;1895-03-01&#x27;, &#x27;1895-04-01&#x27;,
               &#x27;1895-05-01&#x27;, &#x27;1895-06-01&#x27;, &#x27;1895-07-01&#x27;, &#x27;1895-08-01&#x27;,
               &#x27;1895-09-01&#x27;, &#x27;1895-10-01&#x27;,
               ...
               &#x27;2023-10-01&#x27;, &#x27;2023-11-01&#x27;, &#x27;2023-12-01&#x27;, &#x27;2024-01-01&#x27;,
               &#x27;2024-02-01&#x27;, &#x27;2024-03-01&#x27;, &#x27;2024-04-01&#x27;, &#x27;2024-05-01&#x27;,
               &#x27;2024-06-01&#x27;, &#x27;2024-07-01&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=1555, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a98d25ac-a44e-481d-b6c1-32a5b49c46ff' class='xr-section-summary-in' type='checkbox'  ><label for='section-a98d25ac-a44e-481d-b6c1-32a5b49c46ff' class='xr-section-summary' >Attributes: <span>(24)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.4</dd><dt><span>Metadata_Conventions :</span></dt><dd>Unidata Dataset Discovery v1.0</dd><dt><span>acknowledgment :</span></dt><dd>PRISM Climate Group, Oregon State University, http://prism.oregonstate.edu, Accessed Feb 2025.</dd><dt><span>authors :</span></dt><dd>PRISM Climate Group</dd><dt><span>cdm_data_type :</span></dt><dd>Grid</dd><dt><span>creator_email :</span></dt><dd>daley@nacse.org</dd><dt><span>creator_name :</span></dt><dd>Christopher Daley</dd><dt><span>geospatial_lat_max :</span></dt><dd>24.10416603088379</dd><dt><span>geospatial_lat_min :</span></dt><dd>49.9375</dd><dt><span>geospatial_lon_max :</span></dt><dd>-66.52083587646484</dd><dt><span>geospatial_lon_min :</span></dt><dd>-125.02083587646484</dd><dt><span>id :</span></dt><dd>prism/thredds/cida.usgs.gov</dd><dt><span>institution :</span></dt><dd>Oregon State University</dd><dt><span>keywords :</span></dt><dd>Atmospheric Temperature, Air Temperature Atmosphere, Precipitation, Rain, Maximum Daily Temperature, Minimum  Daily Temperature</dd><dt><span>keywords_vocabulary :</span></dt><dd>GCMD Science Keywords</dd><dt><span>license :</span></dt><dd>Freely Available: The PRISM Climate Group, Oregon State University retains rights to ownership of the data and information.</dd><dt><span>naming_authority :</span></dt><dd>cida.usgs.gov</dd><dt><span>publisher_name :</span></dt><dd>PRISM Climate Group</dd><dt><span>publisher_url :</span></dt><dd>http://prism.oregonstate.edu/</dd><dt><span>summary :</span></dt><dd>This dataset was created using the PRISM (Parameter-elevation Regressions on Independent Slopes Model) climate mapping system, developed by Dr. Christopher Daly, PRISM Climate Group director. PRISM is a unique knowledge-based system that uses point measurements of precipitation, temperature, and other climatic factors to produce continuous, digital grid estimates of monthly, yearly, and event-based climatic parameters. Continuously updated, this unique analytical tool incorporates point data, a digital elevation model, and expert knowledge of complex climatic extremes, including rain shadows, coastal effects, and temperature inversions. PRISM data sets are recognized world-wide as the highest-quality spatial climate data sets currently available. PRISM is the USDA&#x27;s official climatological data.</dd><dt><span>time_coverage_resolution :</span></dt><dd>Monthly</dd><dt><span>title :</span></dt><dd>Parameter-elevation Regressions on Independent Slopes Model Monthly Climate Data for the Continental United States 01-1895 - 07-2024.</dd><dt><span>time_coverage_start :</span></dt><dd>1895-01-01T00:00</dd><dt><span>time_coverage_end :</span></dt><dd>2024-07-01T00:00</dd></dl></div></li></ul></div></div></div></div>
</div>
</section>
<section id="chunk-shape-and-size">
<h2>Chunk Shape and Size<a class="headerlink" href="#chunk-shape-and-size" title="Link to this heading">#</a></h2>
<p>Given what we know about this data, we can apply some storage principles to form a strategy for how best to chunk the data if we were to write it to storage (assuming it isn’t already).
Broadly, we need to specify chunk shape and size.</p>
<section id="shape-considerations">
<h3>Shape Considerations<a class="headerlink" href="#shape-considerations" title="Link to this heading">#</a></h3>
<p>“<a class="reference internal" href="../back/Glossary.html#term-Chunk-shape"><span class="std std-ref"><strong>Chunk shape</strong></span></a>” is the shape of a chunk, which specifies the number of elements in each dimension.
So, we will need to decide on the size of each of the dimensions of the chunks.
The preferred shape of each chunk will depend on the read pattern for future analyses.
Our goal is to chunk the data so that future reads will be performant, and that depends on whether the analyses favor one dimension or another.
For some datasets, this will be very apparent.
For example, streamflow gage data is very likely to be consumed along the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension.
So, a collection of data from multiple gages is <em>more likely</em> to have the individual time series analyzed as opposed to analyzing all gages at a given time.
Therefore, we would want a chunk shape that is larger along the time dimension.
For datasets where there is no clear preference, we can try to chunk based on likely read patterns, but allow for other patterns without too much of a performance penalty.</p>
<p>Let’s see how we might do this for our example dataset.
Being this dataset spans space and time, it will likely be used in one of two dominant read patterns:</p>
<ul class="simple">
<li><p>Time series for a given location (or small spatial extent)</p>
<ul>
<li><p>Special case: Is it likely that the time series will be subset by a logical unit (e.g., will this monthly data be consumed in blocks of 12 (i.e., yearly))?</p></li>
</ul>
</li>
<li><p>Full spatial extent for a given point in time.</p>
<ul>
<li><p>Special case: Are specific spatial regions more used than others?</p></li>
</ul>
</li>
</ul>
<p>Let’s look at a couple of options for space and time chunking:</p>
<section id="time-dimension">
<h4>Time Dimension<a class="headerlink" href="#time-dimension" title="Link to this heading">#</a></h4>
<p>As we can see above, the example dataset has 1555 monthly time steps.
How many chunks would we have if we chunked in groups of twelve (i.e., a year at a time)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of chunks: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">12</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of chunks: 129.58
</pre></div>
</div>
</div>
</div>
<p>In this case, a user could get a single year of monthly data as a single chunk.
It is important to note that we have just over a round number of chunks. Having <code class="docutils literal notranslate"><span class="pre">129.58</span></code> time chunks means we will have 130 chunks in practice, but the last one is not full-sized. The last chunk would be a <a class="reference internal" href="../back/Glossary.html#term-Partial-Chunk"><span class="std std-ref">“<strong>partial chunk</strong>”</span></a> because we do not have a full year of data for 2024.</p>
<p>So this is where the judgement call gets made: Which is the more likely read pattern for time: year-by-year, or the whole time series (or some sequence of a few years)?
For PRISM, it is more likely that someone will want more than just one year of data.
A happy medium for chunk shape along the time dimension could be 6 years of data per chunk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_chunk_shape</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">6</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of chunks: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_chunk_shape</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">; Chunk of shape: </span><span class="si">{</span><span class="n">time_chunk_shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of chunks: 21.60; Chunk of shape: 72
</pre></div>
</div>
</div>
</div>
<p>This pattern means only 22 chunks (instead of the 126 chunks we were considering a moment ago) are needed for a full time series in a given location.</p>
</section>
<section id="spatial-dimension">
<h4>Spatial Dimension<a class="headerlink" href="#spatial-dimension" title="Link to this heading">#</a></h4>
<p>As we can see in our example dataset, it technically contains two spatial dimensions: <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code>.
So, we’re really chunking both of these dimensions when we talk about chunking with respect to space.
While we will consider them both together here, it is important to point out that they can have separate chunk shapes.
This leads to the the question of whether future users of this data will want strips of latitude or longitude, square “tiles” in space, or some proportionally-sized tiles of latitude and longitude?
That is, is it important that the North-South extent be broken into the same number of chunks as the East-West extent?
Let’s start by chunking this into square tiles.
Being that there are more <code class="docutils literal notranslate"><span class="pre">lon</span></code> elements than <code class="docutils literal notranslate"><span class="pre">lat</span></code> elements, this means there will be more <code class="docutils literal notranslate"><span class="pre">lon</span></code> chunks than <code class="docutils literal notranslate"><span class="pre">lat</span></code> chunks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
<span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
<span class="n">space_chunk_size</span> <span class="o">=</span> <span class="n">nlat</span> <span class="o">//</span> <span class="mi">4</span> <span class="c1"># split the smaller of the two dimensions into 4 chunks</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lon&#39; chunks: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lat&#39; chunks: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of &#39;lon&#39; chunks: 9.065; Chunk of shape 155; Size of last chunk: 10
Number of &#39;lat&#39; chunks: 4.006; Chunk of shape 155; Size of last chunk: 1
</pre></div>
</div>
</div>
</div>
<p>Having <code class="docutils literal notranslate"><span class="pre">9.06</span></code> longitude chunks means we will have 10 chunks in practice, but that last one is not full-sized.
In this case, this means that the last chunk in the given dimension will be extremely thin.</p>
<p>In the case of the latitude chunks, the extra <code class="docutils literal notranslate"><span class="pre">0.006</span></code> of a chunk means that the last, fractional chunk (or <a class="reference internal" href="../back/Glossary.html#term-Partial-Chunk"><span class="std std-ref">“<strong>partial chunk</strong>”</span></a>) is only one <code class="docutils literal notranslate"><span class="pre">lat</span></code> observation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ideally, we would want partial chunks to be at least half the size of the standard chunk.
The bigger that “remainder” fraction, the better.</p>
</div>
<p>Let’s adjust the chunk shape a little so that we don’t have that sliver.
We’re still committed to square tiles, so let’s try a larger chunk shape to change the size of that last fraction.
Increasing the chunk size a little should get us bigger “remainders”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_chunk_size</span> <span class="o">=</span> <span class="mi">157</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lon&#39; chunks: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lat&#39; chunks: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of &#39;lon&#39; chunks: 8.95; Chunk of shape 157; Size of last chunk: 149
Number of &#39;lat&#39; chunks: 3.96; Chunk of shape 157; Size of last chunk: 150
</pre></div>
</div>
</div>
</div>
<p>With this pattern, the “remainder” latitude chunk will have a shape of 150 in the <code class="docutils literal notranslate"><span class="pre">lat</span></code> dimension, and the “remainder” longitude chunk will have a shape of 149 in the <code class="docutils literal notranslate"><span class="pre">lon</span></code> dimension.
All others will be a square 157 observations in both dimensions.
This amounts to a 9x4 chunk grid, with the last chunk in each dimension being partial.</p>
<p>The entire spatial extent for a single time step can be read in 36 chunks with this chunk shape.
That seems a little high, given that this dataset will likely be taken at full spatial extent for a typical analysis.
Let’s go a little bigger to see what that gets us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_chunk_size</span> <span class="o">=</span> <span class="mi">354</span> <span class="c1"># 157 * 2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lon&#39; chunks: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lat&#39; chunks: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of &#39;lon&#39; chunks: 3.97; Chunk of shape 354; Size of last chunk: 343
Number of &#39;lat&#39; chunks: 1.75; Chunk of shape 354; Size of last chunk: 267
</pre></div>
</div>
</div>
</div>
<p>This is just as good in terms of full-chunk remainders, and the whole extent can be read in with only 8 chunks.
The smallest remainder is still &gt;75% of a full-sized square tile, which is acceptable.</p>
<p>Alternatively, we could stop being committed to square tiles and try and split the spatial regions more evenly.
For example, we could get as close to a 4x2 split as possible:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add one to do a ceil divide</span>
<span class="n">lon_space_chunk_size</span> <span class="o">=</span> <span class="n">nlon</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">lat_space_chunk_size</span> <span class="o">=</span> <span class="n">nlat</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lon&#39; chunks: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lon_space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">lon_space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lon_space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lat&#39; chunks: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lat_space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">lat_space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lat_space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of &#39;lon&#39; chunks: 3.991; Chunk of shape 352; Size of last chunk: 349
Number of &#39;lat&#39; chunks: 1.997; Chunk of shape 311; Size of last chunk: 310
</pre></div>
</div>
</div>
</div>
<p>Or we could aim for a 3x3 split:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add one to do a ceil divide</span>
<span class="n">lon_space_chunk_size</span> <span class="o">=</span> <span class="n">nlon</span> <span class="o">//</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">lat_space_chunk_size</span> <span class="o">=</span> <span class="n">nlat</span> <span class="o">//</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lon&#39; chunks: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lon_space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">lon_space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlon</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lon_space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of &#39;lat&#39; chunks: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lat_space_chunk_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">; Chunk of shape </span><span class="si">{</span><span class="n">lat_space_chunk_size</span><span class="si">}</span><span class="s2">; Size of last chunk: </span><span class="si">{</span><span class="n">nlat</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lat_space_chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of &#39;lon&#39; chunks: 2.996; Chunk of shape 469; Size of last chunk: 467
Number of &#39;lat&#39; chunks: 2.986; Chunk of shape 208; Size of last chunk: 205
</pre></div>
</div>
</div>
</div>
<p>As you might be getting, the chunking proportion between latitude and longitude is not super important.
What is important for basic chunk shape is the total number of chunks between the two and the minimization of the remainder in the final chunk of each dimension.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we were really confident that most analyses wanted the full extent, we might be better off to just put the whole lat/lon dimensions into single chunks each.
This would ensure (and require) that we read the entire spatial extent.
However, our poor time-series analysis would then be stuck reading the entire dataset to get all time values for a single location.</p>
</div>
</section>
</section>
<section id="size-considerations">
<h3>Size Considerations<a class="headerlink" href="#size-considerations" title="Link to this heading">#</a></h3>
<p>Shape is only part of the equation.
Total “<a class="reference internal" href="../back/Glossary.html#term-Chunk-size"><span class="std std-ref"><strong>chunk size</strong></span></a>” also matters.
Size considerations come into play mostly as a consideration of how the chunks are stored on disk.
The retrieval time is influenced by the size of each chunk.
Here are some constraints:</p>
<ul class="simple">
<li><p>Files Too Big:
In a Zarr dataset, each <strong>chunk</strong> is stored as a separate binary file (and the entire zarr dataset is a directory grouping these many “chunk” files).
If we need data from a particular chunk, no matter how little or how much, that file gets opened, decompressed, and the whole thing read into memory.
A large chunk size means that there may be a lot of data transferred in situations when only a small subset of that chunk’s data is actually needed.
It also means there might not be enough chunks to allow the dask workers to stay busy loading data in parallel.</p></li>
<li><p>Files Too Small:
If the chunk size is too small, the time it takes to read and decompress the data for each chunk can become comparable to the latency of S3 (typically 10-100ms).
We want the reads to take at least a second or so, so that the latency is not a significant part of the overall timing.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As a general rule, aim for chunk sizes between 10 and 200 MB, depending on shape and expected read pattern of a user.</p>
</div>
<section id="total-chunk-size">
<h4>Total Chunk Size<a class="headerlink" href="#total-chunk-size" title="Link to this heading">#</a></h4>
<p>To esimate the total chunk size, all we need is the expected chunk shape and data type to know how many bytes a value takes up.
As an example, let’s use a chunk shape of <code class="docutils literal notranslate"><span class="pre">{'time':</span> <span class="pre">72,</span> <span class="pre">'lat':</span> <span class="pre">354,</span> <span class="pre">'lon':</span> <span class="pre">354}</span></code>
This will tell us if we’ve hit our target of between 10 and 200 MB per chunk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">}</span>
<span class="n">bytes_per_value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">tmn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
<span class="n">total_bytes</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bytes_per_value</span>
<span class="n">kiB</span> <span class="o">=</span> <span class="n">total_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">MiB</span> <span class="o">=</span> <span class="n">kiB</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TMN chunk size: </span><span class="si">{</span><span class="n">total_bytes</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">kiB</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) (</span><span class="si">{</span><span class="n">MiB</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TMN chunk size: 72182016 (kiB=70490.25) (MiB=68.84)
</pre></div>
</div>
</div>
</div>
<p>We’re looking really good for size: about 69 MiB.
This maybe even a bit low.
But we’re in the (admittedly broad) range of 10-200 MiB of uncompressed data (i.e., in-memory) per chunk.
Therefore, this seems like it would be a reasonable chunk shape and size for our dataset.
If we were curious about other chunk shapes, like a non-square <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code> chunk, we could repeat this computation to estimate its size and determine if it is reasonable.
However, we aren’t going to do that here, but it is something you could try on your own if you are curious.</p>
</section>
</section>
</section>
<section id="review-and-final-considerations">
<h2>Review and Final Considerations<a class="headerlink" href="#review-and-final-considerations" title="Link to this heading">#</a></h2>
<p>Now that you have a general idea on how to pick chunk shape and size, let’s review and add a few final considerations.</p>
<section id="basic-chunking-recommendations">
<h3>Basic Chunking Recommendations<a class="headerlink" href="#basic-chunking-recommendations" title="Link to this heading">#</a></h3>
<p>When determining the basic chunk shape and size, the choice will depend on the future read pattern and analysis.
If this pattern is unknown, then it is important to take a balanced chunking approach that does not favor one dimension over the others (i.e., larger overall shape in a given dimension).
Next, choosing a chunk shape should try to prevent partial chunks if possible.
Otherwise, partial chunks should be at least half the size of the standard chunk.
Finally, the total chunk size should be between 10 and 200 MiB for optimal performance.</p>
</section>
<section id="final-considerations">
<h3>Final Considerations<a class="headerlink" href="#final-considerations" title="Link to this heading">#</a></h3>
<p>One final thing to consider is that these basic recommendations assume that your chunked data will be static and not updated.
However, some datasets, especially climate related ones, are periodically updated in their time dimension.
These datasets are commonly updated at regular intervals (e.g., every year with the previous years data).
This can change the choice of chunk shape such that adding the next year’s worth of data does not require rechunking the whole data set or result in small partial chunks.
For our PRISM example, if we chose a temporal chunk shape of length 72 (i.e., six years per chunk), adding a year worth of data would require appending the partial chunk until it becomes full.
Then, further new data would require starting a new partial chunk.
This could be prevented if we chose a chunk size of 12 (i.e., one year per chunk).
Then, additional data would only require making new chunks versus editing existing chunks.
Therefore, considering updates to the dataset when deciding the chunking plan can save a lot of time when appending the dataset in the future.</p>
<p>Additionally, all of the information provided here does not discuss proper optimization of chunk shape and size.
Proper optimization would attempt to select chunk sizes that are near powers of two (i.e., <span class="math notranslate nohighlight">\(2^N\)</span>) to facilitate optimal storage and disk retrieval.
Details on this topic can be found in the advanced topic notebook of <a class="reference internal" href="../201/OptimalChunkSelection.html"><span class="std std-doc">Choosing an Optimal Chunk Size and Shape</span></a>.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./dataset_processing/tutorials/chunking/101"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ExamineDataChunking.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to Examine a Stored Dataset’s Chunk Shape</p>
      </div>
    </a>
    <a class="right-next"
       href="WriteChunkedFiles.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Writing Chunked Files</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-example-dataset">Accessing the Example Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chunk-shape-and-size">Chunk Shape and Size</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-considerations">Shape Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dimension">Time Dimension</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-dimension">Spatial Dimension</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#size-considerations">Size Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#total-chunk-size">Total Chunk Size</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-and-final-considerations">Review and Final Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-chunking-recommendations">Basic Chunking Recommendations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-considerations">Final Considerations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>