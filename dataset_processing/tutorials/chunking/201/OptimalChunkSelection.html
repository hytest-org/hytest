
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Choosing an Optimal Chunk Size and Shape &#8212; HyTEST Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dataset_processing/tutorials/chunking/201/OptimalChunkSelection';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Chunking References" href="../back/index.html" />
    <link rel="prev" title="Adding Coordinate Reference Systems (CRS) to Zarr Datasets" href="IncludeCRSinZarr.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">v0.0.1_alpha01</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../doc/About.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-light" alt="HyTEST Project - Home"/>
    <script>document.write(`<img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-dark" alt="HyTEST Project - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Environment Set-Up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/README.html">Compute Environments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-General.html">General QuickStart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-Cloud-Nebari.html">Cloud: Nebari Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/OpenOnDemand.html">HPC Server: Open OnDemand Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/JupyterForward.html">HPC Server: Jupyter Forward Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/StartScript.html">HPC Server: Start Script Quick-Start</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../environment_set_up/Help_AWS_Credentials.html">AWS Credentials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/clusters.html">Starting a Dask Cluster</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Nebari.html">Nebari Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Denali.html">Denali HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.html">Hovenweep/Tallgrass HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Desktop.html">Local Desktop Dask Cluster</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/README.html">Essential Reading</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/ReadingsTutorials.html">Foundations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/DataSources/README.html">Data Sources</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_APIs.html">Data/APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_S3.html">Data/Cloud Storage</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../essential_reading/Parallel_Dask.html">Parallelism with Dask</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Access</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_catalog/README.html">HyTEST Data Catalog (Intake)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/subcatalogs/README.html">HyTEST Intake Sub-Catalogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/STAC.html">USGS Water Mission Area STAC Catalog</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_access/CONUS404_ACCESS.html">CONUS404 Products Data Access</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/CONUS404_CHANGELOG.html">CONUS404 Zarr Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/conus404_explore.html">Explore CONUS404 Dataset</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Zarr Creation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Data Chunking Tutorial Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../101/index.html">Introduction to Chunking</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../101/WhyChunk.html">Why (re)Chunk Data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/ExamineDataChunking.html">How to Examine a Stored Dataset’s Chunk Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/BasicsShapeSize.html">Basics of Chunk Shape and Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/WriteChunkedFiles.html">Writing Chunked Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/Rechunking.html">Rechunking</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Advanced Topics in Chunking</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="RechunkingwithDask.html">Rechunking Larger Datasets with Dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="CreateVirtualZarr.html">Generating a Virtual Zarr Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="IncludeCRSinZarr.html">Adding Coordinate Reference Systems (CRS) to Zarr Datasets</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Choosing an Optimal Chunk Size and Shape</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../back/index.html">Chunking References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../back/Glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../back/AdditionalResources.html">Additional Resources</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../conus404_temporal_aggregation.html">CONUS404 Temporal Aggregation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../spatial_aggregation.html">Spatial Aggregation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_DRB.html">gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_GFv1_1.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_WBD12.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation.html">Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_comparison.html">gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_point_selection.html">CONUS404 Site Data Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_regrid.html">CONUS404 Regridding (Curvilinear =&gt; Rectilinear)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Evaluation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/metrics.html">Evaluation Metrics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark – Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_StdSuite_v1.html">Standard Suite (v1) Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_StdSuite_v1.html">Standard Suite (v1) Metrics – Usage Examples</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/00_Overview.html">Streamflow Model Evaluation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/01_Data_Prep.html">Streamflow Eval :: Data Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_StdSuite.html">Streamflow Eval :: StdSuite Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_DScore.html">Steamflow Eval :: DScore Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/03_Vizualization.html">Streamflow Eval :: Visualization</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../LICENSE.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hytest-org/hytest" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Choosing an Optimal Chunk Size and Shape</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-many-considerations-for-optimal-chunk-shape-and-size-selection">The Many Considerations for Optimal Chunk Shape and Size Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-chunk-shape-algorithm">Optimal Chunk Shape Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-example">Toy Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prism-example">PRISM Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-considerations">Further Considerations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="choosing-an-optimal-chunk-size-and-shape">
<h1>Choosing an Optimal Chunk Size and Shape<a class="headerlink" href="#choosing-an-optimal-chunk-size-and-shape" title="Link to this heading">#</a></h1>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This notebook is based on a 2013 blog post by Russ Rew at Unidata, <a class="reference external" href="http://www.unidata.ucar.edu/blogs/developer/en/entry/chunking_data_choosing_shapes">Chunking Data: Choosing Shapes</a>.
The algorithm utilized in this notebook is based on the algorithm presented in that blog post.</p>
</div>
</aside>
<p>The objective of this notebook is to learn and discuss <em>how</em> to select the optimal chunk size and shape for a given dataset.
In the <a class="reference internal" href="../101/BasicsShapeSize.html"><span class="std std-doc">Basics of Chunk Shape and Size notebook</span></a>, we discussed the general considerations for chunking, but not how to apply these consisderations for selecting chunk shape and size.
These considerations included:</p>
<ul class="simple">
<li><p>chunk size between 10-200 MiB,</p></li>
<li><p>having partial final chunks at least half the size of the standard chunk,</p></li>
<li><p>performant future reads across all dimensions (or optimized for the dominant read pattern), and</p></li>
<li><p>chunk shape that is optimized for future data additions (if they occur).</p></li>
</ul>
<p>Here, we build upon those considerations and present a basic algorithm for automatically selecting the “optimal” chunk shape and size.
Therefore, giving us a method for selecting chunk shape and size without much trial and error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
</pre></div>
</div>
</div>
</div>
<section id="the-many-considerations-for-optimal-chunk-shape-and-size-selection">
<h2>The Many Considerations for Optimal Chunk Shape and Size Selection<a class="headerlink" href="#the-many-considerations-for-optimal-chunk-shape-and-size-selection" title="Link to this heading">#</a></h2>
<p>As we just listed, there are several things to consider when selecting a chunk size.
Creating an “optimal” chunk shape and size requires balancing all of these things to make our dataset perform as we want.
For example, the “perfect” chunking would have:</p>
<ul class="simple">
<li><p>chunk size around 10 MiB (to accomodate different hardware),</p></li>
<li><p>no partial final chunks (i.e., chunk shape is integer divisor of the full data shape),</p></li>
<li><p>performant future reads across all dimensions and groups of dimensions, and</p></li>
<li><p>a shape that is an integer divisor of future data additions (if they occur).</p></li>
</ul>
<p>In addition to these, if we can select a chunk size that is optimal for our disk storage (e.g., disk block size), we should further improve read times.
However, in practice, there is no way to get the “perfect” chunk.
We will almost always have to compromise on one or more of these criteria to stay within the constraints created by another.
The criteria we compromise on is up to us, which makes determining the “optimal” chunk relatively subjective.
Therefore, chunk shape and size selection is just as much an art as a science.
It depends some firm rules, but it also depends on our preferences.</p>
</section>
<section id="optimal-chunk-shape-algorithm">
<h2>Optimal Chunk Shape Algorithm<a class="headerlink" href="#optimal-chunk-shape-algorithm" title="Link to this heading">#</a></h2>
<p>As chunk shape and size selection is relatively subjective, let’s create an algorithm using some of our preferences and restrictions to automate the chunk selection process.
To take into account the first two considerations (size and partial chunks), this algorithm will focus on determining a chunk shape from the dataset shape given a maximum (uncompressed) chunk size and minimum partial chunk fraction.
It will return a chunk shape that has a size as close the maximum size as possible, while ensuring any final chunks contain partial chunk fractions above the specified minimum.
For reads across dimensions, we will limit our algorithm to 3D data only and try and balance 1D-to-2D read times.
For example, if we have a 3D spatiotemporal dataset, it would propose an “optimal” shape that allows for almost equal read times for time-series and spatial reads.
Finally, we will assume the algorithm will only be applied to static datasets and that we do not need to worry about any future data additions.</p>
<p>So, let’s take a look at the algorithm, which we will write as a function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">chunk_shape_3D</span><span class="p">(</span><span class="n">var_shape</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">var_value_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">partial_chunk_frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a &quot;optimal&quot; shape for a 3D variable, assuming balanced 1D-to-2D access.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    var_shape : tuple[int]</span>
<span class="sd">        Length 3 list giving the variable shape in terms of (T, X, Y).</span>
<span class="sd">    chunk_size : int</span>
<span class="sd">        Maximum chunk size desired, in bytes (default = 4096).</span>
<span class="sd">    var_value_size : int</span>
<span class="sd">        Size of each variable data value, in bytes (default = 4).</span>
<span class="sd">    partial_chunk_frac : float</span>
<span class="sd">        The minimum fraction of data that the partial final chunk must</span>
<span class="sd">        contain using the returned chunk shape (default = 0.5).</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        If True, info on other candidate chunk shapes will be printed</span>
<span class="sd">        (default = False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    chunk_shape : tuple[int]</span>
<span class="sd">        The optimal chunk shape that provides balanced access of 1D subsets</span>
<span class="sd">        and 2D subsets of a variable with shape (T, X, Y), T is the typically</span>
<span class="sd">        the time dimension and X and Y are the spatial dimensions. An &quot;optimal&quot;</span>
<span class="sd">        shape for chunks means that the number of chunks accessed to read</span>
<span class="sd">        either a full time series (1D) or full spatial map (2D) is</span>
<span class="sd">        approximately equal, and the size of each chunk (uncompressed) is no</span>
<span class="sd">        more than `chunk_size`, which is often a disk block size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_shape</span><span class="p">)</span>
    <span class="c1"># Get ideal chunk info using only chunk size and balanced read</span>
    <span class="n">ideal_num_vals_per_chunk</span> <span class="o">=</span> <span class="n">chunk_size</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">var_value_size</span><span class="p">)</span>
    <span class="n">ideal_num_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">var_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">ideal_num_vals_per_chunk</span>
    <span class="k">if</span> <span class="n">ideal_num_chunks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ideal_num_chunks</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ideal_1d_num_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ideal_num_chunks</span><span class="p">)</span>
    <span class="n">ideal_2d_num_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ideal_1d_num_chunks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal number of values in a chunk = </span><span class="si">{</span><span class="n">ideal_num_vals_per_chunk</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal number of chunks = </span><span class="si">{</span><span class="n">ideal_num_chunks</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal number of chunks along the 1D axis = </span><span class="si">{</span><span class="n">ideal_1d_num_chunks</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal number of chunks along each 2D axis = </span><span class="si">{</span><span class="n">ideal_2d_num_chunks</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Get 1D optimal chunk shape along dimension</span>
    <span class="c1"># Check if the first dimension has smaller shape then number of chunks</span>
    <span class="c1"># If so, set to chunk shape to 1 and adjust 2D ideal chunks</span>
    <span class="k">if</span> <span class="n">var_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ideal_1d_num_chunks</span><span class="p">:</span>
        <span class="n">chunk_dim</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">ideal_2d_num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">ideal_2d_num_chunks</span>
                               <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">ideal_1d_num_chunks</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chunk_dim</span> <span class="o">=</span> <span class="n">var_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">ideal_1d_num_chunks</span>
    <span class="c1"># Add chunk dim to optimal chunk shape list</span>
    <span class="n">optimal_chunk_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunk_dim</span><span class="p">]</span>

    <span class="c1"># Get 2D optimal chunk shape along each dimension</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># factor to increase other dims if some must be increased to 1.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">var_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ideal_2d_num_chunks</span><span class="p">:</span>
            <span class="n">prod</span> <span class="o">*=</span> <span class="n">ideal_2d_num_chunks</span> <span class="o">/</span> <span class="n">var_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">var_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ideal_2d_num_chunks</span><span class="p">:</span>
            <span class="n">chunk_dim</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chunk_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">prod</span> <span class="o">*</span> <span class="n">var_shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">//</span> <span class="n">ideal_2d_num_chunks</span>
        <span class="n">optimal_chunk_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_dim</span><span class="p">)</span>

    <span class="c1"># Calculate the partial chunk fraction from the remainder</span>
    <span class="n">remainder_frac_per_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">var_shape</span><span class="p">,</span> <span class="n">optimal_chunk_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">optimal_chunk_shape</span>
    <span class="c1"># If the remainder fraction is 0, swap with 1 for multiplication of parial chunk fraction</span>
    <span class="n">optimal_chunk_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">remainder_frac_per_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">remainder_frac_per_dim</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal chunk shape = </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">optimal_chunk_shape</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal chunk, partial chunk fraction = </span><span class="si">{</span><span class="n">optimal_chunk_frac</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimal_chunk_shape is typically too small, size(optimal_chunk_shape) &lt; chunk_size</span>
<span class="sd">    and may have small partial chunks. So, we adjust by adding 1 to some chunk shape</span>
<span class="sd">    dimensions to get as close as possible to chunk_size without exceeding it and then</span>
<span class="sd">    check if the shape is over the minimum partial chunk fraction. If it is acceptable,</span>
<span class="sd">    that is our chunk shape. Otherwise, we continually subtract one from the 1D dimension</span>
<span class="sd">    to get to the partial fraction minimum, while adding one to the 2D dimensions to</span>
<span class="sd">    maintain the size request. We then reverse this and subtract from the 2D demensions</span>
<span class="sd">    and add to the 1D demensions. The optimal chunk is then the one that is the most</span>
<span class="sd">    balanced of these two increment and decrement methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Increment the optimal chunk shape by 1</span>
    <span class="n">best_chunk_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_chunk_shape</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Candidates ---&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dim_increment</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">candidate_chunk_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">optimal_chunk_shape</span><span class="p">,</span> <span class="n">dim_increment</span><span class="p">)</span>
        
        <span class="n">this_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">var_value_size</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">))</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">var_shape</span><span class="p">,</span> <span class="n">candidate_chunk_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">candidate_chunk_shape</span>
        <span class="n">this_chunk_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">this_chunk_size</span> <span class="o">&lt;=</span> <span class="n">chunk_size</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_chunk_frac</span> <span class="o">&gt;=</span> <span class="n">partial_chunk_frac</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">candidate_chunk_shape</span><span class="p">))</span><span class="si">}</span><span class="s1">; &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;Total size per chunk (MB): </span><span class="si">{</span><span class="n">this_chunk_size</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;(ratio: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ideal_num_vals_per_chunk</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">); &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;Partial chunk fraction: </span><span class="si">{</span><span class="n">this_chunk_frac</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Only keep if closest to chunk size limit and above partial fraction limit</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">best_chunk_size</span> <span class="o">&lt;</span> <span class="n">this_chunk_size</span> <span class="o">&lt;=</span> <span class="n">chunk_size</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_chunk_frac</span> <span class="o">&gt;=</span> <span class="n">partial_chunk_frac</span><span class="p">):</span>
            <span class="n">best_chunk_size</span> <span class="o">=</span> <span class="n">this_chunk_size</span>
            <span class="n">best_chunk_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">)</span> <span class="c1"># make a copy of best candidate so far</span>

    <span class="c1"># Return if a shape was found</span>
    <span class="k">if</span> <span class="n">best_chunk_shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">best_chunk_shape</span><span class="p">))</span>

    <span class="c1"># Increment and decrement 1D and 2D from optimal chunk shape to get a best shape    </span>
    <span class="n">increments_decrements</span> <span class="o">=</span> <span class="p">[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>
    <span class="c1"># Use Euclidean distance to estimate balanced shape</span>
    <span class="n">best_shape_balance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimal_chunk_shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">increment_decrement</span> <span class="ow">in</span> <span class="n">increments_decrements</span><span class="p">:</span>
        <span class="n">best_chunk_frac</span> <span class="o">=</span> <span class="n">optimal_chunk_frac</span>
        <span class="n">candidate_chunk_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">optimal_chunk_shape</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">best_chunk_frac</span> <span class="o">&lt;</span> <span class="n">partial_chunk_frac</span><span class="p">:</span>
            <span class="c1"># Quit if any candidate is too big or too small in a dimension</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">candidate_chunk_shape</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var_shape</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">dim_increment</span> <span class="ow">in</span> <span class="n">increment_decrement</span><span class="p">:</span>
                <span class="n">candidate_chunk_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">,</span> <span class="n">dim_increment</span><span class="p">)</span>
                
                <span class="n">this_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">var_value_size</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">))</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">var_shape</span><span class="p">,</span> <span class="n">candidate_chunk_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">candidate_chunk_shape</span>
                <span class="n">this_chunk_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">this_chunk_size</span> <span class="o">&lt;=</span> <span class="n">chunk_size</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_chunk_frac</span> <span class="o">&gt;=</span> <span class="n">partial_chunk_frac</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">candidate_chunk_shape</span><span class="p">))</span><span class="si">}</span><span class="s1">; &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;Total size per chunk (MB): </span><span class="si">{</span><span class="n">this_chunk_size</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1"> &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;(ratio: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ideal_num_vals_per_chunk</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">); &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;Partial chunk fraction: </span><span class="si">{</span><span class="n">this_chunk_frac</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
                    <span class="n">best_chunk_frac</span> <span class="o">=</span> <span class="n">this_chunk_frac</span>
                    <span class="n">shape_balance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimal_chunk_shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">candidate_chunk_shape</span><span class="p">)</span>
                    <span class="c1"># Only save candidate if it is more balanced than previous one</span>
                    <span class="k">if</span> <span class="n">shape_balance</span> <span class="o">&lt;</span> <span class="n">best_shape_balance</span><span class="p">:</span>
                        <span class="n">best_shape_balance</span> <span class="o">=</span> <span class="n">shape_balance</span>
                        <span class="n">best_chunk_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">candidate_chunk_shape</span><span class="p">)</span>


    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">best_chunk_shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<section id="toy-example">
<h3>Toy Example<a class="headerlink" href="#toy-example" title="Link to this heading">#</a></h3>
<p>Okay, now that we have our algorithm, let’s give it a test using some made up data.
We will use a variable of shape <code class="docutils literal notranslate"><span class="pre">(365,</span> <span class="pre">240,</span> <span class="pre">150)</span></code>, aim for a chunk of 1 MiB (<code class="docutils literal notranslate"><span class="pre">2**20</span></code> bytes) in size, and a partial chunk fraction of <code class="docutils literal notranslate"><span class="pre">0.5</span></code> (0.8 in each dimensions; <span class="math notranslate nohighlight">\(0.8^3 \approx 0.5\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">chunk_shape</span> <span class="o">=</span> <span class="n">chunk_shape_3D</span><span class="p">(</span>
    <span class="n">var_shape</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="p">,</span> <span class="n">partial_chunk_frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;Optimal&quot; chunk shape: </span><span class="si">{</span><span class="n">chunk_shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ideal number of values in a chunk = 262144.0
Ideal number of chunks = 50.1
Ideal number of chunks along the 1D axis = 7.1
Ideal number of chunks along each 2D axis = 2.7
Ideal chunk shape = (51, 90, 56)
Ideal chunk, partial chunk fraction = 0.07096171802054155

--- Candidates ---
(16, 124, 90); Total size per chunk (MB): 0.681 (ratio: 0.681); Partial chunk fraction: 0.5067204301075268
(53, 88, 54); Total size per chunk (MB): 0.961 (ratio: 0.961); Partial chunk fraction: 0.5016199733180866

&quot;Optimal&quot; chunk shape: (53, 88, 54)
</pre></div>
</div>
</div>
</div>
<p>Nice!
From these results, we can see that the “ideal” chunk shape given only our chunk size would have been <code class="docutils literal notranslate"><span class="pre">(51,</span> <span class="pre">90,</span> <span class="pre">56)</span></code>.
However, this had some partial chunks that would have been very small.
So, its choice would not have been good given this additional constraint.
Therefore, it adjusted the chunk shape to <code class="docutils literal notranslate"><span class="pre">(53,</span> <span class="pre">88,</span> <span class="pre">54)</span></code> to meet the partial chunk constraint and provide us with a reasonably close alternative in terms of both dimension balance and chunk size.
This is great, exactly what we wanted!</p>
</section>
<section id="prism-example">
<h3>PRISM Example<a class="headerlink" href="#prism-example" title="Link to this heading">#</a></h3>
<p>As a real world example, let’s apply the algorithm to the PRISM data from the <a class="reference internal" href="../101/BasicsShapeSize.html"><span class="std std-doc">Basics of Chunk Shape and Size notebook</span></a>.
First, we need to read in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
    <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
    <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>   <span class="c1"># anonymous = does not require credentials</span>
    <span class="n">client_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;endpoint_url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://usgs.osn.mghpcc.org/&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s1">&#39;s3://mdmf/gdp/PRISM_v2.zarr/&#39;</span><span class="p">),</span>
    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;zarr&#39;</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{}</span>
<span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 33GB
Dimensions:    (lat: 621, lon: 1405, time: 1555, tbnd: 2)
Coordinates:
  * lat        (lat) float32 2kB 49.94 49.9 49.85 49.81 ... 24.19 24.15 24.1
  * lon        (lon) float32 6kB -125.0 -125.0 -124.9 ... -66.6 -66.56 -66.52
  * time       (time) datetime64[ns] 12kB 1895-01-01 1895-02-01 ... 2024-07-01
Dimensions without coordinates: tbnd
Data variables:
    crs        int64 8B ...
    ppt        (time, lat, lon) float64 11GB dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;
    time_bnds  (time, tbnd) datetime64[ns] 25kB dask.array&lt;chunksize=(68, 2), meta=np.ndarray&gt;
    tmn        (time, lat, lon) float64 11GB dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;
    tmx        (time, lat, lon) float64 11GB dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;
Attributes: (12/24)
    Conventions:               CF-1.4
    Metadata_Conventions:      Unidata Dataset Discovery v1.0
    acknowledgment:            PRISM Climate Group, Oregon State University, ...
    authors:                   PRISM Climate Group
    cdm_data_type:             Grid
    creator_email:             daley@nacse.org
    ...                        ...
    publisher_url:             http://prism.oregonstate.edu/
    summary:                   This dataset was created using the PRISM (Para...
    time_coverage_resolution:  Monthly
    title:                     Parameter-elevation Regressions on Independent...
    time_coverage_start:       1895-01-01T00:00
    time_coverage_end:         2024-07-01T00:00</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-f7e1ab5c-9720-46c1-be52-9c7ef42fcdf2' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f7e1ab5c-9720-46c1-be52-9c7ef42fcdf2' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 621</li><li><span class='xr-has-index'>lon</span>: 1405</li><li><span class='xr-has-index'>time</span>: 1555</li><li><span>tbnd</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-431e5e24-be1d-40a3-94c5-cfbcf4458fd3' class='xr-section-summary-in' type='checkbox'  checked><label for='section-431e5e24-be1d-40a3-94c5-cfbcf4458fd3' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>49.94 49.9 49.85 ... 24.15 24.1</div><input id='attrs-c143a8ff-86a9-4a61-97eb-14dc89011600' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c143a8ff-86a9-4a61-97eb-14dc89011600' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c04fd162-820f-409a-bf13-5fab54cc02d8' class='xr-var-data-in' type='checkbox'><label for='data-c04fd162-820f-409a-bf13-5fab54cc02d8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([49.9375  , 49.895832, 49.854168, ..., 24.1875  , 24.145834, 24.104166],
      shape=(621,), dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-125.0 -125.0 ... -66.56 -66.52</div><input id='attrs-e502e0fc-089b-43b8-b01d-12cf7824daae' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e502e0fc-089b-43b8-b01d-12cf7824daae' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3bab40b3-d5ec-48ce-93d0-c8ea36628e6a' class='xr-var-data-in' type='checkbox'><label for='data-3bab40b3-d5ec-48ce-93d0-c8ea36628e6a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-125.020836, -124.979164, -124.9375  , ...,  -66.604164,  -66.5625  ,
        -66.520836], shape=(1405,), dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1895-01-01 ... 2024-07-01</div><input id='attrs-d4b4024e-4252-47ee-86d2-3fcdb4d4c19f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d4b4024e-4252-47ee-86d2-3fcdb4d4c19f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-312be4c1-2d07-4cc6-9812-77e56b11f4ff' class='xr-var-data-in' type='checkbox'><label for='data-312be4c1-2d07-4cc6-9812-77e56b11f4ff' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1895-01-01T00:00:00.000000000&#x27;, &#x27;1895-02-01T00:00:00.000000000&#x27;,
       &#x27;1895-03-01T00:00:00.000000000&#x27;, ..., &#x27;2024-05-01T00:00:00.000000000&#x27;,
       &#x27;2024-06-01T00:00:00.000000000&#x27;, &#x27;2024-07-01T00:00:00.000000000&#x27;],
      shape=(1555,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0999497c-04e5-4b8f-8e76-ce2ff1e60fa6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0999497c-04e5-4b8f-8e76-ce2ff1e60fa6' class='xr-section-summary' >Data variables: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>crs</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-aa13a6f3-63ff-419c-859e-deb177583f97' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aa13a6f3-63ff-419c-859e-deb177583f97' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21b5c591-d94a-40a3-a64f-a5bae1235868' class='xr-var-data-in' type='checkbox'><label for='data-21b5c591-d94a-40a3-a64f-a5bae1235868' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>crs_wkt :</span></dt><dd>GEOGCRS[&quot;WGS 84&quot;,ENSEMBLE[&quot;World Geodetic System 1984 ensemble&quot;,MEMBER[&quot;World Geodetic System 1984 (Transit)&quot;],MEMBER[&quot;World Geodetic System 1984 (G730)&quot;],MEMBER[&quot;World Geodetic System 1984 (G873)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1150)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1674)&quot;],MEMBER[&quot;World Geodetic System 1984 (G1762)&quot;],MEMBER[&quot;World Geodetic System 1984 (G2139)&quot;],MEMBER[&quot;World Geodetic System 1984 (G2296)&quot;],ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,LENGTHUNIT[&quot;metre&quot;,1]],ENSEMBLEACCURACY[2.0]],PRIMEM[&quot;Greenwich&quot;,0,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],CS[ellipsoidal,2],AXIS[&quot;geodetic latitude (Lat)&quot;,north,ORDER[1],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],AXIS[&quot;geodetic longitude (Lon)&quot;,east,ORDER[2],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],USAGE[SCOPE[&quot;Horizontal component of 3D system.&quot;],AREA[&quot;World.&quot;],BBOX[-90,-180,90,180]],ID[&quot;EPSG&quot;,4326]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984 ensemble</dd><dt><span>grid_mapping_name :</span></dt><dd>latitude_longitude</dd></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ppt</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;</div><input id='attrs-100a7a77-722b-46fe-9eff-820a6e360ebf' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-100a7a77-722b-46fe-9eff-820a6e360ebf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-76ec8431-9f5a-4df5-b7e1-feea1a316681' class='xr-var-data-in' type='checkbox'><label for='data-76ec8431-9f5a-4df5-b7e1-feea1a316681' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>mm/month</dd><dt><span>long_name :</span></dt><dd>Mean monthly precipitation</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 10.11 GiB </td>
                        <td> 19.98 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1555, 621, 1405) </td>
                        <td> (68, 131, 294) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 575 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="239" height="168" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="10" x2="80" y2="80" />
  <line x1="10" y1="20" x2="80" y2="90" />
  <line x1="10" y1="30" x2="80" y2="100" />
  <line x1="10" y1="40" x2="80" y2="111" />
  <line x1="10" y1="47" x2="80" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="47" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="51" />
  <line x1="16" y1="6" x2="16" y2="54" />
  <line x1="19" y1="9" x2="19" y2="57" />
  <line x1="22" y1="12" x2="22" y2="60" />
  <line x1="28" y1="18" x2="28" y2="66" />
  <line x1="31" y1="21" x2="31" y2="69" />
  <line x1="34" y1="24" x2="34" y2="72" />
  <line x1="37" y1="27" x2="37" y2="75" />
  <line x1="40" y1="30" x2="40" y2="78" />
  <line x1="47" y1="37" x2="47" y2="84" />
  <line x1="50" y1="40" x2="50" y2="88" />
  <line x1="53" y1="43" x2="53" y2="91" />
  <line x1="56" y1="46" x2="56" y2="94" />
  <line x1="59" y1="49" x2="59" y2="97" />
  <line x1="65" y1="55" x2="65" y2="103" />
  <line x1="68" y1="58" x2="68" y2="106" />
  <line x1="71" y1="61" x2="71" y2="109" />
  <line x1="74" y1="64" x2="74" y2="112" />
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,118.51106487611122 10.0,47.92282958199357" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="118" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="121" y2="3" />
  <line x1="16" y1="6" x2="124" y2="6" />
  <line x1="19" y1="9" x2="127" y2="9" />
  <line x1="22" y1="12" x2="130" y2="12" />
  <line x1="28" y1="18" x2="136" y2="18" />
  <line x1="31" y1="21" x2="140" y2="21" />
  <line x1="34" y1="24" x2="143" y2="24" />
  <line x1="37" y1="27" x2="146" y2="27" />
  <line x1="40" y1="30" x2="149" y2="30" />
  <line x1="47" y1="37" x2="155" y2="37" />
  <line x1="50" y1="40" x2="158" y2="40" />
  <line x1="53" y1="43" x2="161" y2="43" />
  <line x1="56" y1="46" x2="164" y2="46" />
  <line x1="59" y1="49" x2="167" y2="49" />
  <line x1="65" y1="55" x2="173" y2="55" />
  <line x1="68" y1="58" x2="177" y2="58" />
  <line x1="71" y1="61" x2="180" y2="61" />
  <line x1="74" y1="64" x2="183" y2="64" />
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="32" y1="0" x2="103" y2="70" />
  <line x1="55" y1="0" x2="125" y2="70" />
  <line x1="78" y1="0" x2="148" y2="70" />
  <line x1="100" y1="0" x2="171" y2="70" />
  <line x1="118" y1="0" x2="189" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 118.42443729903536,0.0 189.012672593153,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />
  <line x1="80" y1="80" x2="189" y2="80" />
  <line x1="80" y1="90" x2="189" y2="90" />
  <line x1="80" y1="100" x2="189" y2="100" />
  <line x1="80" y1="111" x2="189" y2="111" />
  <line x1="80" y1="118" x2="189" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />
  <line x1="103" y1="70" x2="103" y2="118" />
  <line x1="125" y1="70" x2="125" y2="118" />
  <line x1="148" y1="70" x2="148" y2="118" />
  <line x1="171" y1="70" x2="171" y2="118" />
  <line x1="189" y1="70" x2="189" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 189.012672593153,70.58823529411765 189.012672593153,118.51106487611122 80.58823529411765,118.51106487611122" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="134.800454" y="138.511065" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="209.012673" y="94.549650" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,209.012673,94.549650)">621</text>
  <text x="35.294118" y="103.216947" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,103.216947)">1555</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, tbnd)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(68, 2), meta=np.ndarray&gt;</div><input id='attrs-cb46b9a9-fecf-406c-8ae6-40484acb8619' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cb46b9a9-fecf-406c-8ae6-40484acb8619' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98099de8-a25f-4210-a0ba-5b3ff75d745f' class='xr-var-data-in' type='checkbox'><label for='data-98099de8-a25f-4210-a0ba-5b3ff75d745f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Time interval endpoints</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 24.30 kiB </td>
                        <td> 1.06 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1555, 2) </td>
                        <td> (68, 2) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 23 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> datetime64[ns] numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="75" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="25" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="25" y2="5" />
  <line x1="0" y1="10" x2="25" y2="10" />
  <line x1="0" y1="15" x2="25" y2="15" />
  <line x1="0" y1="20" x2="25" y2="20" />
  <line x1="0" y1="31" x2="25" y2="31" />
  <line x1="0" y1="36" x2="25" y2="36" />
  <line x1="0" y1="41" x2="25" y2="41" />
  <line x1="0" y1="47" x2="25" y2="47" />
  <line x1="0" y1="52" x2="25" y2="52" />
  <line x1="0" y1="62" x2="25" y2="62" />
  <line x1="0" y1="68" x2="25" y2="68" />
  <line x1="0" y1="73" x2="25" y2="73" />
  <line x1="0" y1="78" x2="25" y2="78" />
  <line x1="0" y1="83" x2="25" y2="83" />
  <line x1="0" y1="94" x2="25" y2="94" />
  <line x1="0" y1="99" x2="25" y2="99" />
  <line x1="0" y1="104" x2="25" y2="104" />
  <line x1="0" y1="110" x2="25" y2="110" />
  <line x1="0" y1="120" x2="25" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="25" y1="0" x2="25" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 25.412616514582485,0.0 25.412616514582485,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="12.706308" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >2</text>
  <text x="45.412617" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,45.412617,60.000000)">1555</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmn</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;</div><input id='attrs-5d51fa5b-b589-49b0-86fd-ca20dd740c0e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5d51fa5b-b589-49b0-86fd-ca20dd740c0e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5939994e-ee0a-4357-ad79-d70569e25413' class='xr-var-data-in' type='checkbox'><label for='data-5939994e-ee0a-4357-ad79-d70569e25413' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degC</dd><dt><span>long_name :</span></dt><dd>Minimum monthly temperature</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 10.11 GiB </td>
                        <td> 19.98 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1555, 621, 1405) </td>
                        <td> (68, 131, 294) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 575 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="239" height="168" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="10" x2="80" y2="80" />
  <line x1="10" y1="20" x2="80" y2="90" />
  <line x1="10" y1="30" x2="80" y2="100" />
  <line x1="10" y1="40" x2="80" y2="111" />
  <line x1="10" y1="47" x2="80" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="47" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="51" />
  <line x1="16" y1="6" x2="16" y2="54" />
  <line x1="19" y1="9" x2="19" y2="57" />
  <line x1="22" y1="12" x2="22" y2="60" />
  <line x1="28" y1="18" x2="28" y2="66" />
  <line x1="31" y1="21" x2="31" y2="69" />
  <line x1="34" y1="24" x2="34" y2="72" />
  <line x1="37" y1="27" x2="37" y2="75" />
  <line x1="40" y1="30" x2="40" y2="78" />
  <line x1="47" y1="37" x2="47" y2="84" />
  <line x1="50" y1="40" x2="50" y2="88" />
  <line x1="53" y1="43" x2="53" y2="91" />
  <line x1="56" y1="46" x2="56" y2="94" />
  <line x1="59" y1="49" x2="59" y2="97" />
  <line x1="65" y1="55" x2="65" y2="103" />
  <line x1="68" y1="58" x2="68" y2="106" />
  <line x1="71" y1="61" x2="71" y2="109" />
  <line x1="74" y1="64" x2="74" y2="112" />
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,118.51106487611122 10.0,47.92282958199357" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="118" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="121" y2="3" />
  <line x1="16" y1="6" x2="124" y2="6" />
  <line x1="19" y1="9" x2="127" y2="9" />
  <line x1="22" y1="12" x2="130" y2="12" />
  <line x1="28" y1="18" x2="136" y2="18" />
  <line x1="31" y1="21" x2="140" y2="21" />
  <line x1="34" y1="24" x2="143" y2="24" />
  <line x1="37" y1="27" x2="146" y2="27" />
  <line x1="40" y1="30" x2="149" y2="30" />
  <line x1="47" y1="37" x2="155" y2="37" />
  <line x1="50" y1="40" x2="158" y2="40" />
  <line x1="53" y1="43" x2="161" y2="43" />
  <line x1="56" y1="46" x2="164" y2="46" />
  <line x1="59" y1="49" x2="167" y2="49" />
  <line x1="65" y1="55" x2="173" y2="55" />
  <line x1="68" y1="58" x2="177" y2="58" />
  <line x1="71" y1="61" x2="180" y2="61" />
  <line x1="74" y1="64" x2="183" y2="64" />
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="32" y1="0" x2="103" y2="70" />
  <line x1="55" y1="0" x2="125" y2="70" />
  <line x1="78" y1="0" x2="148" y2="70" />
  <line x1="100" y1="0" x2="171" y2="70" />
  <line x1="118" y1="0" x2="189" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 118.42443729903536,0.0 189.012672593153,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />
  <line x1="80" y1="80" x2="189" y2="80" />
  <line x1="80" y1="90" x2="189" y2="90" />
  <line x1="80" y1="100" x2="189" y2="100" />
  <line x1="80" y1="111" x2="189" y2="111" />
  <line x1="80" y1="118" x2="189" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />
  <line x1="103" y1="70" x2="103" y2="118" />
  <line x1="125" y1="70" x2="125" y2="118" />
  <line x1="148" y1="70" x2="148" y2="118" />
  <line x1="171" y1="70" x2="171" y2="118" />
  <line x1="189" y1="70" x2="189" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 189.012672593153,70.58823529411765 189.012672593153,118.51106487611122 80.58823529411765,118.51106487611122" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="134.800454" y="138.511065" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="209.012673" y="94.549650" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,209.012673,94.549650)">621</text>
  <text x="35.294118" y="103.216947" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,103.216947)">1555</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmx</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(68, 131, 294), meta=np.ndarray&gt;</div><input id='attrs-5d83075d-d853-4ef5-b3e5-735fd4199351' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5d83075d-d853-4ef5-b3e5-735fd4199351' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ad6692ed-d72b-4965-8fbc-bc485fea2f01' class='xr-var-data-in' type='checkbox'><label for='data-ad6692ed-d72b-4965-8fbc-bc485fea2f01' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degC</dd><dt><span>long_name :</span></dt><dd>Maximum monthly temperature</dd><dt><span>grid_mapping :</span></dt><dd>crs</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 10.11 GiB </td>
                        <td> 19.98 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1555, 621, 1405) </td>
                        <td> (68, 131, 294) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 575 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="239" height="168" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="10" x2="80" y2="80" />
  <line x1="10" y1="20" x2="80" y2="90" />
  <line x1="10" y1="30" x2="80" y2="100" />
  <line x1="10" y1="40" x2="80" y2="111" />
  <line x1="10" y1="47" x2="80" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="47" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="51" />
  <line x1="16" y1="6" x2="16" y2="54" />
  <line x1="19" y1="9" x2="19" y2="57" />
  <line x1="22" y1="12" x2="22" y2="60" />
  <line x1="28" y1="18" x2="28" y2="66" />
  <line x1="31" y1="21" x2="31" y2="69" />
  <line x1="34" y1="24" x2="34" y2="72" />
  <line x1="37" y1="27" x2="37" y2="75" />
  <line x1="40" y1="30" x2="40" y2="78" />
  <line x1="47" y1="37" x2="47" y2="84" />
  <line x1="50" y1="40" x2="50" y2="88" />
  <line x1="53" y1="43" x2="53" y2="91" />
  <line x1="56" y1="46" x2="56" y2="94" />
  <line x1="59" y1="49" x2="59" y2="97" />
  <line x1="65" y1="55" x2="65" y2="103" />
  <line x1="68" y1="58" x2="68" y2="106" />
  <line x1="71" y1="61" x2="71" y2="109" />
  <line x1="74" y1="64" x2="74" y2="112" />
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,118.51106487611122 10.0,47.92282958199357" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="118" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="121" y2="3" />
  <line x1="16" y1="6" x2="124" y2="6" />
  <line x1="19" y1="9" x2="127" y2="9" />
  <line x1="22" y1="12" x2="130" y2="12" />
  <line x1="28" y1="18" x2="136" y2="18" />
  <line x1="31" y1="21" x2="140" y2="21" />
  <line x1="34" y1="24" x2="143" y2="24" />
  <line x1="37" y1="27" x2="146" y2="27" />
  <line x1="40" y1="30" x2="149" y2="30" />
  <line x1="47" y1="37" x2="155" y2="37" />
  <line x1="50" y1="40" x2="158" y2="40" />
  <line x1="53" y1="43" x2="161" y2="43" />
  <line x1="56" y1="46" x2="164" y2="46" />
  <line x1="59" y1="49" x2="167" y2="49" />
  <line x1="65" y1="55" x2="173" y2="55" />
  <line x1="68" y1="58" x2="177" y2="58" />
  <line x1="71" y1="61" x2="180" y2="61" />
  <line x1="74" y1="64" x2="183" y2="64" />
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="32" y1="0" x2="103" y2="70" />
  <line x1="55" y1="0" x2="125" y2="70" />
  <line x1="78" y1="0" x2="148" y2="70" />
  <line x1="100" y1="0" x2="171" y2="70" />
  <line x1="118" y1="0" x2="189" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 118.42443729903536,0.0 189.012672593153,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="189" y2="70" style="stroke-width:2" />
  <line x1="80" y1="80" x2="189" y2="80" />
  <line x1="80" y1="90" x2="189" y2="90" />
  <line x1="80" y1="100" x2="189" y2="100" />
  <line x1="80" y1="111" x2="189" y2="111" />
  <line x1="80" y1="118" x2="189" y2="118" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="118" style="stroke-width:2" />
  <line x1="103" y1="70" x2="103" y2="118" />
  <line x1="125" y1="70" x2="125" y2="118" />
  <line x1="148" y1="70" x2="148" y2="118" />
  <line x1="171" y1="70" x2="171" y2="118" />
  <line x1="189" y1="70" x2="189" y2="118" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 189.012672593153,70.58823529411765 189.012672593153,118.51106487611122 80.58823529411765,118.51106487611122" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="134.800454" y="138.511065" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="209.012673" y="94.549650" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,209.012673,94.549650)">621</text>
  <text x="35.294118" y="103.216947" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,103.216947)">1555</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-f9382fac-679a-4564-9b4e-80b794e298d9' class='xr-section-summary-in' type='checkbox'  ><label for='section-f9382fac-679a-4564-9b4e-80b794e298d9' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-5b11c472-ef9f-4da3-9022-91db0910dab6' class='xr-index-data-in' type='checkbox'/><label for='index-5b11c472-ef9f-4da3-9022-91db0910dab6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([          49.9375, 49.89583206176758, 49.85416793823242,
                 49.8125, 49.77083206176758, 49.72916793823242,
                 49.6875, 49.64583206176758, 49.60416793823242,
                 49.5625,
       ...
       24.47916603088379,           24.4375, 24.39583396911621,
       24.35416603088379,           24.3125, 24.27083396911621,
       24.22916603088379,           24.1875, 24.14583396911621,
       24.10416603088379],
      dtype=&#x27;float32&#x27;, name=&#x27;lat&#x27;, length=621))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-4dad7183-a328-46ff-9913-1959cfdf5ab7' class='xr-index-data-in' type='checkbox'/><label for='index-4dad7183-a328-46ff-9913-1959cfdf5ab7' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-125.02083587646484, -124.97916412353516,           -124.9375,
       -124.89583587646484, -124.85416412353516,           -124.8125,
       -124.77083587646484, -124.72916412353516,           -124.6875,
       -124.64583587646484,
       ...
        -66.89583587646484,  -66.85416412353516,            -66.8125,
        -66.77083587646484,  -66.72916412353516,            -66.6875,
        -66.64583587646484,  -66.60416412353516,            -66.5625,
        -66.52083587646484],
      dtype=&#x27;float32&#x27;, name=&#x27;lon&#x27;, length=1405))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-018912fa-4339-433f-aa2e-237f0884a073' class='xr-index-data-in' type='checkbox'/><label for='index-018912fa-4339-433f-aa2e-237f0884a073' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1895-01-01&#x27;, &#x27;1895-02-01&#x27;, &#x27;1895-03-01&#x27;, &#x27;1895-04-01&#x27;,
               &#x27;1895-05-01&#x27;, &#x27;1895-06-01&#x27;, &#x27;1895-07-01&#x27;, &#x27;1895-08-01&#x27;,
               &#x27;1895-09-01&#x27;, &#x27;1895-10-01&#x27;,
               ...
               &#x27;2023-10-01&#x27;, &#x27;2023-11-01&#x27;, &#x27;2023-12-01&#x27;, &#x27;2024-01-01&#x27;,
               &#x27;2024-02-01&#x27;, &#x27;2024-03-01&#x27;, &#x27;2024-04-01&#x27;, &#x27;2024-05-01&#x27;,
               &#x27;2024-06-01&#x27;, &#x27;2024-07-01&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=1555, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-db2c3e64-7749-4c87-8aba-bcfec49f6364' class='xr-section-summary-in' type='checkbox'  ><label for='section-db2c3e64-7749-4c87-8aba-bcfec49f6364' class='xr-section-summary' >Attributes: <span>(24)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.4</dd><dt><span>Metadata_Conventions :</span></dt><dd>Unidata Dataset Discovery v1.0</dd><dt><span>acknowledgment :</span></dt><dd>PRISM Climate Group, Oregon State University, http://prism.oregonstate.edu, Accessed Feb 2025.</dd><dt><span>authors :</span></dt><dd>PRISM Climate Group</dd><dt><span>cdm_data_type :</span></dt><dd>Grid</dd><dt><span>creator_email :</span></dt><dd>daley@nacse.org</dd><dt><span>creator_name :</span></dt><dd>Christopher Daley</dd><dt><span>geospatial_lat_max :</span></dt><dd>24.10416603088379</dd><dt><span>geospatial_lat_min :</span></dt><dd>49.9375</dd><dt><span>geospatial_lon_max :</span></dt><dd>-66.52083587646484</dd><dt><span>geospatial_lon_min :</span></dt><dd>-125.02083587646484</dd><dt><span>id :</span></dt><dd>prism/thredds/cida.usgs.gov</dd><dt><span>institution :</span></dt><dd>Oregon State University</dd><dt><span>keywords :</span></dt><dd>Atmospheric Temperature, Air Temperature Atmosphere, Precipitation, Rain, Maximum Daily Temperature, Minimum  Daily Temperature</dd><dt><span>keywords_vocabulary :</span></dt><dd>GCMD Science Keywords</dd><dt><span>license :</span></dt><dd>Freely Available: The PRISM Climate Group, Oregon State University retains rights to ownership of the data and information.</dd><dt><span>naming_authority :</span></dt><dd>cida.usgs.gov</dd><dt><span>publisher_name :</span></dt><dd>PRISM Climate Group</dd><dt><span>publisher_url :</span></dt><dd>http://prism.oregonstate.edu/</dd><dt><span>summary :</span></dt><dd>This dataset was created using the PRISM (Parameter-elevation Regressions on Independent Slopes Model) climate mapping system, developed by Dr. Christopher Daly, PRISM Climate Group director. PRISM is a unique knowledge-based system that uses point measurements of precipitation, temperature, and other climatic factors to produce continuous, digital grid estimates of monthly, yearly, and event-based climatic parameters. Continuously updated, this unique analytical tool incorporates point data, a digital elevation model, and expert knowledge of complex climatic extremes, including rain shadows, coastal effects, and temperature inversions. PRISM data sets are recognized world-wide as the highest-quality spatial climate data sets currently available. PRISM is the USDA&#x27;s official climatological data.</dd><dt><span>time_coverage_resolution :</span></dt><dd>Monthly</dd><dt><span>title :</span></dt><dd>Parameter-elevation Regressions on Independent Slopes Model Monthly Climate Data for the Continental United States 01-1895 - 07-2024.</dd><dt><span>time_coverage_start :</span></dt><dd>1895-01-01T00:00</dd><dt><span>time_coverage_end :</span></dt><dd>2024-07-01T00:00</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Now, we can estimate the “optimal” chunk shape using our algorithm.
We will only do this for the precipitaiton data variable as the others all have the same shape and data type. If you had additional variables with different data types, you would want to run this algorithm on a variable of each type to find its optimal size.
Also, we will use a maximum chunk size that matches the same chunk size of the dataset currently to see how our algorithm compares to the chosen chunking.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">current_chunk_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">chunksize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">chunksize</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ppt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chunksizes</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">current_chunk_size</span> <span class="o">*=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ppt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>

<span class="n">chunk_shape</span> <span class="o">=</span> <span class="n">chunk_shape_3D</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ppt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="n">current_chunk_size</span><span class="p">,</span>
    <span class="n">var_value_size</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ppt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;Optimal&quot; chunk shape: </span><span class="si">{</span><span class="n">chunk_shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ideal number of values in a chunk = 2618952.0
Ideal number of chunks = 518.0
Ideal number of chunks along the 1D axis = 22.8
Ideal number of chunks along each 2D axis = 4.8
Ideal chunk shape = (68, 130, 294)
Ideal chunk, partial chunk fraction = 0.5250604087788961

--- Candidates ---
(68, 130, 294); Total size per chunk (MB): 19.828 (ratio: 0.992); Partial chunk fraction: 0.5250604087788961
(68, 130, 295); Total size per chunk (MB): 19.896 (ratio: 0.996); Partial chunk fraction: 0.5141402714932127
(68, 131, 294); Total size per chunk (MB): 19.981 (ratio: 1.000); Partial chunk fraction: 0.5004165788452786

&quot;Optimal&quot; chunk shape: [68, 131, 294]
</pre></div>
</div>
</div>
</div>
<p>As we can see, our algorithm struggles with this dataset to come up with a balanced chunk shape that meets our size and partial fraction restrictions.
Rather than having the “ideal” chunk shape of <code class="docutils literal notranslate"><span class="pre">(125,</span> <span class="pre">178,</span> <span class="pre">404)</span></code>, we got a chunk shape of <code class="docutils literal notranslate"><span class="pre">(168,</span> <span class="pre">135,</span> <span class="pre">362)</span></code>, which is quite different than the current chunk shape of <code class="docutils literal notranslate"><span class="pre">(72,</span> <span class="pre">354,</span> <span class="pre">354)</span></code>.
The primary driver of this discrepancy is our restriction on balancing the dimensions, as the current chunk shape has a parital fraction of 0.73.
Therefore, enforcing the balance can be very restrictive.</p>
</section>
</section>
<section id="further-considerations">
<h2>Further Considerations<a class="headerlink" href="#further-considerations" title="Link to this heading">#</a></h2>
<p>As noted in the PRISM example, this algorithm is a very niche case for chunk shape selection.
It assumes you want even read times for the temporal and spatial dimensions, and it only allows for 3D data.
What if we had more dimensions or fewer?
What if we wanted a different read pattern that was unbalanced?
What if we wanted to not have any partial chunks and only use a chunk shape that is a divisor of the variable shape?
Therefore, this algorithm is not general by any means, but does give us an idea on how to formulate more general algorithms in the future.
For example, one of these more general algorithms can be found in <a class="reference external" href="https://github.com/jbusecke/dynamic_chunks">this repo on dynamic rechunking</a>, which has some algorithms that allow for the user to specify the balancing of the dimensions and a chunk size limit.
As algorithms like these become more developed, selecting an optimal chunk size should become easier.
However, the subjective component will never go away and the need for someone to make a decision on what critera that influences chunk shape and size is more important will always be required.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./dataset_processing/tutorials/chunking/201"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="IncludeCRSinZarr.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Adding Coordinate Reference Systems (CRS) to Zarr Datasets</p>
      </div>
    </a>
    <a class="right-next"
       href="../back/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chunking References</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-many-considerations-for-optimal-chunk-shape-and-size-selection">The Many Considerations for Optimal Chunk Shape and Size Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-chunk-shape-algorithm">Optimal Chunk Shape Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-example">Toy Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prism-example">PRISM Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-considerations">Further Considerations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>