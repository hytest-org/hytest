
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Rechunking Larger Datasets with Dask &#8212; HyTEST Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dataset_processing/tutorials/chunking/201/RechunkingwithDask';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Generating a Virtual Zarr Store" href="CreateVirtualZarr.html" />
    <link rel="prev" title="Advanced Topics in Chunking" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">v0.0.1_alpha01</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../doc/About.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-light" alt="HyTEST Project - Home"/>
    <script>document.write(`<img src="../../../../_static/HyTEST_Badge.svg" class="logo__image only-dark" alt="HyTEST Project - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Environment Set-Up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/README.html">Compute Environments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-General.html">General QuickStart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/QuickStart-Cloud-Nebari.html">Cloud: Nebari Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/OpenOnDemand.html">HPC Server: Open OnDemand Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/JupyterForward.html">HPC Server: Jupyter Forward Quick-Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/StartScript.html">HPC Server: Start Script Quick-Start</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../environment_set_up/Help_AWS_Credentials.html">AWS Credentials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../environment_set_up/clusters.html">Starting a Dask Cluster</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Nebari.html">Nebari Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Denali.html">Denali HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.html">Hovenweep/Tallgrass HPC Dask Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment_set_up/Start_Dask_Cluster_Desktop.html">Local Desktop Dask Cluster</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/README.html">Essential Reading</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/ReadingsTutorials.html">Foundations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../essential_reading/DataSources/README.html">Data Sources</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_APIs.html">Data/APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../essential_reading/DataSources/Data_S3.html">Data/Cloud Storage</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../essential_reading/Parallel_Dask.html">Parallelism with Dask</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Access</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_catalog/README.html">Data Catalogs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/storage_locations.html">Data Storage Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/STAC.html">Water Mission Area STAC Catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/intake.html">HyTEST Data Catalog (Intake)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_catalog/subcatalogs/README.html">HyTEST Intake Sub-Catalogs</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dataset_access/CONUS404_ACCESS.html">CONUS404 Products Data Access</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/CONUS404_CHANGELOG.html">CONUS404 Zarr Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dataset_access/conus404_explore.html">Explore CONUS404 Dataset</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Zarr Creation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Data Chunking Tutorial Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../101/index.html">Introduction to Chunking</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../101/WhyChunk.html">Why (re)Chunk Data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/ExamineDataChunking.html">How to Examine a Stored Dataset’s Chunk Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/BasicsShapeSize.html">Basics of Chunk Shape and Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/WriteChunkedFiles.html">Writing Chunked Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../101/Rechunking.html">Rechunking</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Advanced Topics in Chunking</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Rechunking Larger Datasets with Dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="CreateVirtualZarr.html">Generating a Virtual Zarr Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="IncludeCRSinZarr.html">Adding Coordinate Reference Systems (CRS) to Zarr Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalChunkSelection.html">Choosing an Optimal Chunk Size and Shape</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../back/index.html">Chunking References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../back/Glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../back/AdditionalResources.html">Additional Resources</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dataset Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../conus404_temporal_aggregation.html">CONUS404 Temporal Aggregation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../spatial_aggregation.html">Spatial Aggregation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_DRB.html">gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_GFv1_1.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_WBD12.html">gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation.html">Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spatial_aggregation/conus404_spatial_aggregation_comparison.html">gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_point_selection.html">CONUS404 Site Data Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conus404_regrid.html">CONUS404 Regridding (Curvilinear =&gt; Rectilinear)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Evaluation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/metrics.html">Evaluation Metrics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.html">D-Score Suite (v1) Benchmark – Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/Metrics_StdSuite_v1.html">Standard Suite (v1) Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/stats_demos/Usage_StdSuite_v1.html">Standard Suite (v1) Metrics – Usage Examples</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/00_Overview.html">Streamflow Model Evaluation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/01_Data_Prep.html">Streamflow Eval :: Data Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_StdSuite.html">Streamflow Eval :: StdSuite Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/02_Analysis_DScore.html">Steamflow Eval :: DScore Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../evaluation/tutorials/streamflow/03_Vizualization.html">Streamflow Eval :: Visualization</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../LICENSE.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hytest-org/hytest" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Rechunking Larger Datasets with Dask</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-in-a-zarr-store">Read in a Zarr Store</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restrict-for-tutorial">Restrict for Tutorial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk-plan">Rechunk Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk-with-rechunker">Rechunk with Rechunker</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-output-location">Set up output location</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spin-up-dask-cluster">Spin up Dask Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk">Rechunk</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confirm-the-creation-of-the-zarr-store-by-rechunker">Confirm the Creation of the Zarr Store by Rechunker</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clean-up">Clean Up</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="rechunking-larger-datasets-with-dask">
<h1>Rechunking Larger Datasets with Dask<a class="headerlink" href="#rechunking-larger-datasets-with-dask" title="Link to this heading">#</a></h1>
<p>The goal of this notebook is to expand on the rechunking performed in the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">Introductory Rechunking tutorial</span></a>.
This notebook will perfrom the same operations, but will work on the <strong>much</strong> larger dataset and involve some parallelization using <a class="reference external" href="https://www.dask.org/">dask</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You should only run workflows like this tutorial on a cloud or HPC compute node.
In application, this will require reading and writing <strong>enormous</strong> amounts of data.
Using a typical network connection and simple compute environment, you would saturate your bandwidth and max out your processor, thereby taking days for the rechunking to complete.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="c1"># Needed when boto3 &gt;= 1.36.0 or the rechunking process will fail</span>
<span class="c1"># This needs to be set before the boto3 library gets loaded</span>
<span class="c1"># See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_REQUEST_CHECKSUM_CALCULATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;when_required&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_RESPONSE_CHECKSUM_VALIDATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;when_required&#39;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rechunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">rechunk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dask.diagnostics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dask</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">configparser</span>

<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">({</span><span class="s1">&#39;temporary_directory&#39;</span><span class="p">:</span><span class="s1">&#39;../&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;dask.config.set at 0x7fd85c6239d0&gt;
</pre></div>
</div>
</div>
</div>
<section id="read-in-a-zarr-store">
<h2>Read in a Zarr Store<a class="headerlink" href="#read-in-a-zarr-store" title="Link to this heading">#</a></h2>
<p>Like the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">Introductory Rechunking tutorial</span></a>, we will use the data from the National Water Model Retrospective Version 2.1.
The full dataset is part of the <a class="reference external" href="https://aws.amazon.com/opendata/">AWS Open Data Program</a>, available via the S3 bucket at: <code class="docutils literal notranslate"><span class="pre">s3://noaa-nwm-retro-v2-zarr-pds/</span></code>.</p>
<p>As this is a Zarr store, let’s read it in with <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.open_dataset.html"><code class="docutils literal notranslate"><span class="pre">xarray.open_dataset()</span></code></a> and <code class="docutils literal notranslate"><span class="pre">engine='zarr'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s1">&#39;s3://noaa-nwm-retro-v2-zarr-pds&#39;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{},</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;zarr&#39;</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 35TB
Dimensions:         (time: 227904, feature_id: 2729077)
Coordinates:
  * feature_id      (feature_id) int32 11MB 101 179 ... 1180001803 1180001804
    latitude        (feature_id) float32 11MB dask.array&lt;chunksize=(2729077,), meta=np.ndarray&gt;
    longitude       (feature_id) float32 11MB dask.array&lt;chunksize=(2729077,), meta=np.ndarray&gt;
  * time            (time) datetime64[ns] 2MB 1993-01-01 ... 2018-12-31T23:00:00
Data variables:
    elevation       (time, feature_id) float32 2TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    order           (time, feature_id) int32 2TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    qBtmVertRunoff  (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    qBucket         (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    qSfcLatRunoff   (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    q_lateral       (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    streamflow      (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
    velocity        (time, feature_id) float64 5TB dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;
Attributes: (12/17)
    Conventions:                CF-1.6
    cdm_datatype:               Station
    code_version:               v5.1.0-alpha11
    dev:                        dev_ prefix indicates development/internal me...
    dev_NOAH_TIMESTEP:          3600
    dev_OVRTSWCRT:              1
    ...                         ...
    model_output_type:          channel_rt
    model_output_valid_time:    2018-12-28_00:00:00
    model_total_valid_times:    2208
    proj4:                      +proj=lcc +units=m +a=6370000.0 +b=6370000.0 ...
    station_dimension:          feature_id
    stream_order_output:        1</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-47bba1b5-1abb-4d59-af8b-a1f84edeb2c0' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-47bba1b5-1abb-4d59-af8b-a1f84edeb2c0' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 227904</li><li><span class='xr-has-index'>feature_id</span>: 2729077</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6a1abd87-c78a-47fe-8707-1c43bc7cfffe' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6a1abd87-c78a-47fe-8707-1c43bc7cfffe' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>feature_id</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>101 179 ... 1180001803 1180001804</div><input id='attrs-c946b3bc-4c9b-4c60-9f39-c63600da730b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c946b3bc-4c9b-4c60-9f39-c63600da730b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9cbb5f1a-7123-4ee5-9438-5565c356368b' class='xr-var-data-in' type='checkbox'><label for='data-9cbb5f1a-7123-4ee5-9438-5565c356368b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>cf_role :</span></dt><dd>timeseries_id</dd><dt><span>comment :</span></dt><dd>Gage Points Specified by User in Routelink file</dd><dt><span>long_name :</span></dt><dd>Reach ID</dd></dl></div><div class='xr-var-data'><pre>array([       101,        179,        181, ..., 1180001802, 1180001803,
       1180001804], shape=(2729077,), dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(2729077,), meta=np.ndarray&gt;</div><input id='attrs-2eb4d9c9-840a-49dc-8062-8129591ff39a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2eb4d9c9-840a-49dc-8062-8129591ff39a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ab479e98-901f-4f8e-8ad1-c3e305c6f717' class='xr-var-data-in' type='checkbox'><label for='data-ab479e98-901f-4f8e-8ad1-c3e305c6f717' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 10.41 MiB </td>
                        <td> 10.41 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (2729077,) </td>
                        <td> (2729077,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(2729077,), meta=np.ndarray&gt;</div><input id='attrs-4ce5adc6-a9e3-4981-8195-16ece7867638' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4ce5adc6-a9e3-4981-8195-16ece7867638' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5e0935b5-6a8e-44f1-902b-ede94ca86eff' class='xr-var-data-in' type='checkbox'><label for='data-5e0935b5-6a8e-44f1-902b-ede94ca86eff' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 10.41 MiB </td>
                        <td> 10.41 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (2729077,) </td>
                        <td> (2729077,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1993-01-01 ... 2018-12-31T23:00:00</div><input id='attrs-558694e9-d1d5-4337-92a9-2d381f870692' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-558694e9-d1d5-4337-92a9-2d381f870692' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-564973df-f545-4af4-b356-deb31bdc2fd3' class='xr-var-data-in' type='checkbox'><label for='data-564973df-f545-4af4-b356-deb31bdc2fd3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>valid output time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1993-01-01T00:00:00.000000000&#x27;, &#x27;1993-01-01T01:00:00.000000000&#x27;,
       &#x27;1993-01-01T02:00:00.000000000&#x27;, ..., &#x27;2018-12-31T21:00:00.000000000&#x27;,
       &#x27;2018-12-31T22:00:00.000000000&#x27;, &#x27;2018-12-31T23:00:00.000000000&#x27;],
      shape=(227904,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b126a9e4-6b5d-47bb-b722-dfa2af3acff1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b126a9e4-6b5d-47bb-b722-dfa2af3acff1' class='xr-section-summary' >Data variables: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>elevation</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-eb625c4b-5c44-40e9-9cf2-60eb313a15c8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-eb625c4b-5c44-40e9-9cf2-60eb313a15c8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e9480c36-a680-4747-b127-ccdd598d6097' class='xr-var-data-in' type='checkbox'><label for='data-e9480c36-a680-4747-b127-ccdd598d6097' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature Elevation</dd><dt><span>standard_name :</span></dt><dd>Elevation</dd><dt><span>units :</span></dt><dd>meters</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 2.26 TiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>order</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-bd41341b-7b1b-4a04-875a-dc17c35b1948' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-bd41341b-7b1b-4a04-875a-dc17c35b1948' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1afc3a98-e47e-47e9-9201-eff4056264e4' class='xr-var-data-in' type='checkbox'><label for='data-1afc3a98-e47e-47e9-9201-eff4056264e4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Streamflow Order</dd><dt><span>standard_name :</span></dt><dd>order</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 2.26 TiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> int32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qBtmVertRunoff</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-f9106415-189a-4e75-ab8f-25a882fc46b8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f9106415-189a-4e75-ab8f-25a882fc46b8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a3b03ce8-5f30-4c98-9acc-ae135dfc733d' class='xr-var-data-in' type='checkbox'><label for='data-a3b03ce8-5f30-4c98-9acc-ae135dfc733d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>Runoff from bottom of soil to bucket</dd><dt><span>units :</span></dt><dd>m3</dd><dt><span>valid_range :</span></dt><dd>[0, 499999968]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qBucket</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-4acfdf63-27c4-4ba8-a4f9-cf5b55734d9f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4acfdf63-27c4-4ba8-a4f9-cf5b55734d9f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4365b0e9-a662-4866-b054-4b024005c4f9' class='xr-var-data-in' type='checkbox'><label for='data-4365b0e9-a662-4866-b054-4b024005c4f9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>Flux from gw bucket</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, -2147483648]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qSfcLatRunoff</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-c97f308c-6c56-442c-b030-202b7d41729f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c97f308c-6c56-442c-b030-202b7d41729f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ee8eb3bc-3b47-45ca-877a-7da72131fa9d' class='xr-var-data-in' type='checkbox'><label for='data-ee8eb3bc-3b47-45ca-877a-7da72131fa9d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>Runoff from terrain routing</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, -2147483648]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>q_lateral</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-98f96fb3-dc2c-4404-b8d3-55d8c123d4c5' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-98f96fb3-dc2c-4404-b8d3-55d8c123d4c5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4e230083-f99a-4869-b39a-f309bd325b69' class='xr-var-data-in' type='checkbox'><label for='data-4e230083-f99a-4869-b39a-f309bd325b69' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>Runoff into channel reach</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, 5000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>streamflow</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-9502b0f4-ff88-4443-b1bf-f964681a2e72' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9502b0f4-ff88-4443-b1bf-f964681a2e72' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5e17a944-da31-4c4f-9769-6ced79d08cc5' class='xr-var-data-in' type='checkbox'><label for='data-5e17a944-da31-4c4f-9769-6ced79d08cc5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Flow</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>velocity</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 30000), meta=np.ndarray&gt;</div><input id='attrs-553d2fe3-51bf-4e0c-8a30-63ff26c27c20' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-553d2fe3-51bf-4e0c-8a30-63ff26c27c20' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-61b71162-060f-488e-aba2-5cafc22a6e70' class='xr-var-data-in' type='checkbox'><label for='data-61b71162-060f-488e-aba2-5cafc22a6e70' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Velocity</dd><dt><span>units :</span></dt><dd>ms-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.53 TiB </td>
                        <td> 153.81 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (227904, 2729077) </td>
                        <td> (672, 30000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 30940 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="87" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="1" x2="120" y2="1" />
  <line x1="0" y1="3" x2="120" y2="3" />
  <line x1="0" y1="5" x2="120" y2="5" />
  <line x1="0" y1="7" x2="120" y2="7" />
  <line x1="0" y1="9" x2="120" y2="9" />
  <line x1="0" y1="11" x2="120" y2="11" />
  <line x1="0" y1="13" x2="120" y2="13" />
  <line x1="0" y1="15" x2="120" y2="15" />
  <line x1="0" y1="17" x2="120" y2="17" />
  <line x1="0" y1="19" x2="120" y2="19" />
  <line x1="0" y1="21" x2="120" y2="21" />
  <line x1="0" y1="23" x2="120" y2="23" />
  <line x1="0" y1="25" x2="120" y2="25" />
  <line x1="0" y1="27" x2="120" y2="27" />
  <line x1="0" y1="29" x2="120" y2="29" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="33" x2="120" y2="33" />
  <line x1="0" y1="35" x2="120" y2="35" />
  <line x1="0" y1="37" x2="120" y2="37" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="37" style="stroke-width:2" />
  <line x1="5" y1="0" x2="5" y2="37" />
  <line x1="11" y1="0" x2="11" y2="37" />
  <line x1="18" y1="0" x2="18" y2="37" />
  <line x1="25" y1="0" x2="25" y2="37" />
  <line x1="30" y1="0" x2="30" y2="37" />
  <line x1="36" y1="0" x2="36" y2="37" />
  <line x1="43" y1="0" x2="43" y2="37" />
  <line x1="50" y1="0" x2="50" y2="37" />
  <line x1="56" y1="0" x2="56" y2="37" />
  <line x1="61" y1="0" x2="61" y2="37" />
  <line x1="68" y1="0" x2="68" y2="37" />
  <line x1="75" y1="0" x2="75" y2="37" />
  <line x1="81" y1="0" x2="81" y2="37" />
  <line x1="88" y1="0" x2="88" y2="37" />
  <line x1="93" y1="0" x2="93" y2="37" />
  <line x1="100" y1="0" x2="100" y2="37" />
  <line x1="106" y1="0" x2="106" y2="37" />
  <line x1="113" y1="0" x2="113" y2="37" />
  <line x1="120" y1="0" x2="120" y2="37" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,37.57579973674177 0.0,37.57579973674177" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="57.575800" font-size="1.0rem" font-weight="100" text-anchor="middle" >2729077</text>
  <text x="140.000000" y="18.787900" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,18.787900)">227904</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-13ce9045-9e2f-4f0e-a8f6-49cba6054a39' class='xr-section-summary-in' type='checkbox'  ><label for='section-13ce9045-9e2f-4f0e-a8f6-49cba6054a39' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>feature_id</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-d8cd22bb-e403-402d-a96a-edb28d62ffea' class='xr-index-data-in' type='checkbox'/><label for='index-d8cd22bb-e403-402d-a96a-edb28d62ffea' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([       101,        179,        181,        183,        185,        843,
              845,        847,        849,        851,
       ...
       1180001795, 1180001796, 1180001797, 1180001798, 1180001799, 1180001800,
       1180001801, 1180001802, 1180001803, 1180001804],
      dtype=&#x27;int32&#x27;, name=&#x27;feature_id&#x27;, length=2729077))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-c5e00850-025d-46bf-b689-a67f66302196' class='xr-index-data-in' type='checkbox'/><label for='index-c5e00850-025d-46bf-b689-a67f66302196' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1993-01-01 00:00:00&#x27;, &#x27;1993-01-01 01:00:00&#x27;,
               &#x27;1993-01-01 02:00:00&#x27;, &#x27;1993-01-01 03:00:00&#x27;,
               &#x27;1993-01-01 04:00:00&#x27;, &#x27;1993-01-01 05:00:00&#x27;,
               &#x27;1993-01-01 06:00:00&#x27;, &#x27;1993-01-01 07:00:00&#x27;,
               &#x27;1993-01-01 08:00:00&#x27;, &#x27;1993-01-01 09:00:00&#x27;,
               ...
               &#x27;2018-12-31 14:00:00&#x27;, &#x27;2018-12-31 15:00:00&#x27;,
               &#x27;2018-12-31 16:00:00&#x27;, &#x27;2018-12-31 17:00:00&#x27;,
               &#x27;2018-12-31 18:00:00&#x27;, &#x27;2018-12-31 19:00:00&#x27;,
               &#x27;2018-12-31 20:00:00&#x27;, &#x27;2018-12-31 21:00:00&#x27;,
               &#x27;2018-12-31 22:00:00&#x27;, &#x27;2018-12-31 23:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=227904, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a3aa484f-b5df-4c15-a3c0-79ba20ab361d' class='xr-section-summary-in' type='checkbox'  ><label for='section-a3aa484f-b5df-4c15-a3c0-79ba20ab361d' class='xr-section-summary' >Attributes: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.6</dd><dt><span>cdm_datatype :</span></dt><dd>Station</dd><dt><span>code_version :</span></dt><dd>v5.1.0-alpha11</dd><dt><span>dev :</span></dt><dd>dev_ prefix indicates development/internal meta data</dd><dt><span>dev_NOAH_TIMESTEP :</span></dt><dd>3600</dd><dt><span>dev_OVRTSWCRT :</span></dt><dd>1</dd><dt><span>dev_channelBucket_only :</span></dt><dd>0</dd><dt><span>dev_channel_only :</span></dt><dd>0</dd><dt><span>featureType :</span></dt><dd>timeSeries</dd><dt><span>model_configuration :</span></dt><dd>retrospective</dd><dt><span>model_initialization_time :</span></dt><dd>2018-10-01_00:00:00</dd><dt><span>model_output_type :</span></dt><dd>channel_rt</dd><dt><span>model_output_valid_time :</span></dt><dd>2018-12-28_00:00:00</dd><dt><span>model_total_valid_times :</span></dt><dd>2208</dd><dt><span>proj4 :</span></dt><dd>+proj=lcc +units=m +a=6370000.0 +b=6370000.0 +lat_1=30.0 +lat_2=60.0 +lat_0=40.0 +lon_0=-97.0 +x_0=0 +y_0=0 +k_0=1.0 +nadgrids=@</dd><dt><span>station_dimension :</span></dt><dd>feature_id</dd><dt><span>stream_order_output :</span></dt><dd>1</dd></dl></div></li></ul></div></div></div></div>
</div>
</section>
<section id="restrict-for-tutorial">
<h2>Restrict for Tutorial<a class="headerlink" href="#restrict-for-tutorial" title="Link to this heading">#</a></h2>
<p>As we saw in the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">Introductory Rechunking tutorial</span></a>, this dataset is massive, taking up almost 32 TiB uncompressed.
As this is a tutorial, we will still restrict the data to a subset - we don’t really need to work on the entire dataset to demonstrate how to use dask to scale up.
Following the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">Introductory Rechunking tutorial</span></a> let’s only look at <code class="docutils literal notranslate"><span class="pre">streamflow</span></code> and <code class="docutils literal notranslate"><span class="pre">velocity</span></code> for the first 15,000 <code class="docutils literal notranslate"><span class="pre">feature_id</span></code>s, |but we will look at the entire 2000s decade of water years (October 1999 through September 2009) instead of a single water year this time.
This will make our dataset larger-than-memory, but it should still run in a reasonable amount of time.</p>
<p>For processing the full-sized dataset, you’d just skip this step where we slice off a representative example of the data.
Expect run time to increase in proportion to the size of the data being processed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[[</span><span class="s1">&#39;streamflow&#39;</span><span class="p">,</span> <span class="s1">&#39;velocity&#39;</span><span class="p">]]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">feature_id</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15000</span><span class="p">))</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1999-10-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2009-09-30&#39;</span><span class="p">))</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 21GB
Dimensions:     (time: 87672, feature_id: 15000)
Coordinates:
  * feature_id  (feature_id) int32 60kB 101 179 181 183 ... 303420 303422 303424
    latitude    (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
    longitude   (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
  * time        (time) datetime64[ns] 701kB 1999-10-01 ... 2009-09-30T23:00:00
Data variables:
    streamflow  (time, feature_id) float64 11GB dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;
    velocity    (time, feature_id) float64 11GB dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;
Attributes: (12/17)
    Conventions:                CF-1.6
    cdm_datatype:               Station
    code_version:               v5.1.0-alpha11
    dev:                        dev_ prefix indicates development/internal me...
    dev_NOAH_TIMESTEP:          3600
    dev_OVRTSWCRT:              1
    ...                         ...
    model_output_type:          channel_rt
    model_output_valid_time:    2018-12-28_00:00:00
    model_total_valid_times:    2208
    proj4:                      +proj=lcc +units=m +a=6370000.0 +b=6370000.0 ...
    station_dimension:          feature_id
    stream_order_output:        1</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-c3dc3c2e-e4c3-4907-8371-06f5faa6851d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c3dc3c2e-e4c3-4907-8371-06f5faa6851d' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 87672</li><li><span class='xr-has-index'>feature_id</span>: 15000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-f2fcbea3-579c-449d-901a-6754f4b215aa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f2fcbea3-579c-449d-901a-6754f4b215aa' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>feature_id</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>101 179 181 ... 303422 303424</div><input id='attrs-4e2e8da3-107f-48b4-aa1b-078fa71585ed' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4e2e8da3-107f-48b4-aa1b-078fa71585ed' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-068d7afe-81be-40f3-b549-4ecb997214b4' class='xr-var-data-in' type='checkbox'><label for='data-068d7afe-81be-40f3-b549-4ecb997214b4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>cf_role :</span></dt><dd>timeseries_id</dd><dt><span>comment :</span></dt><dd>Gage Points Specified by User in Routelink file</dd><dt><span>long_name :</span></dt><dd>Reach ID</dd></dl></div><div class='xr-var-data'><pre>array([   101,    179,    181, ..., 303420, 303422, 303424],
      shape=(15000,), dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-2e1cd93b-240e-4f3a-82ef-b7a72e268526' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2e1cd93b-240e-4f3a-82ef-b7a72e268526' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8218fcf1-75ed-49f6-8031-affadb881a7d' class='xr-var-data-in' type='checkbox'><label for='data-8218fcf1-75ed-49f6-8031-affadb881a7d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-07bcd014-5b15-454f-810a-904dca2d6944' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-07bcd014-5b15-454f-810a-904dca2d6944' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3d438fea-2127-4944-a522-10efee11792e' class='xr-var-data-in' type='checkbox'><label for='data-3d438fea-2127-4944-a522-10efee11792e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1999-10-01 ... 2009-09-30T23:00:00</div><input id='attrs-b1056f8b-a8e2-4f16-a10c-9a9538172dd6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b1056f8b-a8e2-4f16-a10c-9a9538172dd6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-09a92eec-735f-48a1-929c-1739407336f7' class='xr-var-data-in' type='checkbox'><label for='data-09a92eec-735f-48a1-929c-1739407336f7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>valid output time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1999-10-01T00:00:00.000000000&#x27;, &#x27;1999-10-01T01:00:00.000000000&#x27;,
       &#x27;1999-10-01T02:00:00.000000000&#x27;, ..., &#x27;2009-09-30T21:00:00.000000000&#x27;,
       &#x27;2009-09-30T22:00:00.000000000&#x27;, &#x27;2009-09-30T23:00:00.000000000&#x27;],
      shape=(87672,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fa3e2dfb-c95c-475e-acad-bdbc4c954d65' class='xr-section-summary-in' type='checkbox'  checked><label for='section-fa3e2dfb-c95c-475e-acad-bdbc4c954d65' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>streamflow</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;</div><input id='attrs-0cc59afa-9bf7-42d4-82dc-24a943bb45e2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-0cc59afa-9bf7-42d4-82dc-24a943bb45e2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-05e73912-59dc-4cd9-ba65-678b38299ae2' class='xr-var-data-in' type='checkbox'><label for='data-05e73912-59dc-4cd9-ba65-678b38299ae2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Flow</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (672, 15000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 131 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="41" y2="5" />
  <line x1="0" y1="11" x2="41" y2="11" />
  <line x1="0" y1="18" x2="41" y2="18" />
  <line x1="0" y1="24" x2="41" y2="24" />
  <line x1="0" y1="31" x2="41" y2="31" />
  <line x1="0" y1="37" x2="41" y2="37" />
  <line x1="0" y1="44" x2="41" y2="44" />
  <line x1="0" y1="50" x2="41" y2="50" />
  <line x1="0" y1="57" x2="41" y2="57" />
  <line x1="0" y1="62" x2="41" y2="62" />
  <line x1="0" y1="68" x2="41" y2="68" />
  <line x1="0" y1="75" x2="41" y2="75" />
  <line x1="0" y1="81" x2="41" y2="81" />
  <line x1="0" y1="88" x2="41" y2="88" />
  <line x1="0" y1="94" x2="41" y2="94" />
  <line x1="0" y1="101" x2="41" y2="101" />
  <line x1="0" y1="107" x2="41" y2="107" />
  <line x1="0" y1="114" x2="41" y2="114" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>velocity</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;</div><input id='attrs-62bcfdda-2718-42e3-972f-81e691cdd5c2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-62bcfdda-2718-42e3-972f-81e691cdd5c2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6a74358f-fc04-4c0b-ac3c-584ced4e2fb0' class='xr-var-data-in' type='checkbox'><label for='data-6a74358f-fc04-4c0b-ac3c-584ced4e2fb0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Velocity</dd><dt><span>units :</span></dt><dd>ms-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (672, 15000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 131 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="41" y2="5" />
  <line x1="0" y1="11" x2="41" y2="11" />
  <line x1="0" y1="18" x2="41" y2="18" />
  <line x1="0" y1="24" x2="41" y2="24" />
  <line x1="0" y1="31" x2="41" y2="31" />
  <line x1="0" y1="37" x2="41" y2="37" />
  <line x1="0" y1="44" x2="41" y2="44" />
  <line x1="0" y1="50" x2="41" y2="50" />
  <line x1="0" y1="57" x2="41" y2="57" />
  <line x1="0" y1="62" x2="41" y2="62" />
  <line x1="0" y1="68" x2="41" y2="68" />
  <line x1="0" y1="75" x2="41" y2="75" />
  <line x1="0" y1="81" x2="41" y2="81" />
  <line x1="0" y1="88" x2="41" y2="88" />
  <line x1="0" y1="94" x2="41" y2="94" />
  <line x1="0" y1="101" x2="41" y2="101" />
  <line x1="0" y1="107" x2="41" y2="107" />
  <line x1="0" y1="114" x2="41" y2="114" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-2466c731-22bb-4cb0-acbf-6d13185e56cb' class='xr-section-summary-in' type='checkbox'  ><label for='section-2466c731-22bb-4cb0-acbf-6d13185e56cb' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>feature_id</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-51eee21d-e444-4668-93e9-82eb22fb2702' class='xr-index-data-in' type='checkbox'/><label for='index-51eee21d-e444-4668-93e9-82eb22fb2702' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   101,    179,    181,    183,    185,    843,    845,    847,    849,
          851,
       ...
       303404, 303408, 303410, 303412, 303414, 303416, 303418, 303420, 303422,
       303424],
      dtype=&#x27;int32&#x27;, name=&#x27;feature_id&#x27;, length=15000))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-378942d8-5f40-451f-91c7-28ca455db79a' class='xr-index-data-in' type='checkbox'/><label for='index-378942d8-5f40-451f-91c7-28ca455db79a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1999-10-01 00:00:00&#x27;, &#x27;1999-10-01 01:00:00&#x27;,
               &#x27;1999-10-01 02:00:00&#x27;, &#x27;1999-10-01 03:00:00&#x27;,
               &#x27;1999-10-01 04:00:00&#x27;, &#x27;1999-10-01 05:00:00&#x27;,
               &#x27;1999-10-01 06:00:00&#x27;, &#x27;1999-10-01 07:00:00&#x27;,
               &#x27;1999-10-01 08:00:00&#x27;, &#x27;1999-10-01 09:00:00&#x27;,
               ...
               &#x27;2009-09-30 14:00:00&#x27;, &#x27;2009-09-30 15:00:00&#x27;,
               &#x27;2009-09-30 16:00:00&#x27;, &#x27;2009-09-30 17:00:00&#x27;,
               &#x27;2009-09-30 18:00:00&#x27;, &#x27;2009-09-30 19:00:00&#x27;,
               &#x27;2009-09-30 20:00:00&#x27;, &#x27;2009-09-30 21:00:00&#x27;,
               &#x27;2009-09-30 22:00:00&#x27;, &#x27;2009-09-30 23:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=87672, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-161dcb8c-70a1-45fb-9b8c-90eeb3ef5257' class='xr-section-summary-in' type='checkbox'  ><label for='section-161dcb8c-70a1-45fb-9b8c-90eeb3ef5257' class='xr-section-summary' >Attributes: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.6</dd><dt><span>cdm_datatype :</span></dt><dd>Station</dd><dt><span>code_version :</span></dt><dd>v5.1.0-alpha11</dd><dt><span>dev :</span></dt><dd>dev_ prefix indicates development/internal meta data</dd><dt><span>dev_NOAH_TIMESTEP :</span></dt><dd>3600</dd><dt><span>dev_OVRTSWCRT :</span></dt><dd>1</dd><dt><span>dev_channelBucket_only :</span></dt><dd>0</dd><dt><span>dev_channel_only :</span></dt><dd>0</dd><dt><span>featureType :</span></dt><dd>timeSeries</dd><dt><span>model_configuration :</span></dt><dd>retrospective</dd><dt><span>model_initialization_time :</span></dt><dd>2018-10-01_00:00:00</dd><dt><span>model_output_type :</span></dt><dd>channel_rt</dd><dt><span>model_output_valid_time :</span></dt><dd>2018-12-28_00:00:00</dd><dt><span>model_total_valid_times :</span></dt><dd>2208</dd><dt><span>proj4 :</span></dt><dd>+proj=lcc +units=m +a=6370000.0 +b=6370000.0 +lat_1=30.0 +lat_2=60.0 +lat_0=40.0 +lon_0=-97.0 +x_0=0 +y_0=0 +k_0=1.0 +nadgrids=@</dd><dt><span>station_dimension :</span></dt><dd>feature_id</dd><dt><span>stream_order_output :</span></dt><dd>1</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Now, our subset of data is only about 10 GiB per data variable and has a chunk shape of <code class="docutils literal notranslate"><span class="pre">{'time':</span> <span class="pre">672,</span> <span class="pre">'feature_id':</span> <span class="pre">15000}</span></code> with size of 76.9 MiB.
However, the chunk shape is not an optimal choice for our analysis as it is chunked completely by <code class="docutils literal notranslate"><span class="pre">feature_id</span></code> (i.e., all feature IDs for a given time can be read in a single chunk).
Following the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">Introductory Rechunking tutorial</span></a>, let’s get chunk shapes that are time-series wise chunking (i.e., all <code class="docutils literal notranslate"><span class="pre">time</span></code> for a given <code class="docutils literal notranslate"><span class="pre">feature_id</span></code> in one chunk) for streamflow and balanced for velocity.</p>
</section>
<section id="rechunk-plan">
<h2>Rechunk Plan<a class="headerlink" href="#rechunk-plan" title="Link to this heading">#</a></h2>
<p>Using our general strategy of time-series wise chunking for streamflow and balanced for velocity,
let’s compute how large the chunk sizes will be if we have chunk shapes of <code class="docutils literal notranslate"><span class="pre">{'time':</span> <span class="pre">87672,</span> <span class="pre">'feature_id':</span> <span class="pre">1}</span></code> for streamflow and 3 chunks per dimension for velocity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nfeature</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">feature_id</span><span class="p">)</span>
<span class="n">ntime</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="n">streamflow_chunk_plan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">bytes_per_value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">streamflow</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
<span class="n">total_bytes</span> <span class="o">=</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bytes_per_value</span>
<span class="n">streamflow_MiB</span> <span class="o">=</span> <span class="n">total_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">partial_chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">-</span>  <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ntime</span> <span class="o">/</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">-</span>  <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nfeature</span> <span class="o">/</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]),}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STREAMFLOW </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk of shape </span><span class="si">{</span><span class="n">streamflow_chunk_plan</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;time&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;feature_id&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk size: </span><span class="si">{</span><span class="n">streamflow_MiB</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> [MiB] </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">chunks_per_dim</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">velocity_chunk_plan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">//</span> <span class="n">chunks_per_dim</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">//</span> <span class="n">chunks_per_dim</span><span class="p">}</span>
<span class="n">bytes_per_value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
<span class="n">total_bytes</span> <span class="o">=</span> <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bytes_per_value</span>
<span class="n">velocity_MiB</span> <span class="o">=</span> <span class="n">total_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">partial_chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">-</span>  <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks_per_dim</span><span class="p">,</span>
                  <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">-</span>  <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks_per_dim</span><span class="p">,}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VELOCITY </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk of shape </span><span class="si">{</span><span class="n">velocity_chunk_plan</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;time&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;feature_id&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk size: </span><span class="si">{</span><span class="n">velocity_MiB</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> [MiB]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STREAMFLOW 
Chunk of shape {&#39;time&#39;: 87672, &#39;feature_id&#39;: 1} 
Partial &#39;time&#39; chunk remainder: 0.0 (0.000% of a chunk)
Partial &#39;feature_id&#39; chunk remainder: 0.0 (0.000% of a chunk)
Chunk size: 0.67 [MiB] 

VELOCITY 
Chunk of shape {&#39;time&#39;: 29224, &#39;feature_id&#39;: 5000} 
Partial &#39;time&#39; chunk remainder: 0 (0.000% of a chunk)
Partial &#39;feature_id&#39; chunk remainder: 0 (0.000% of a chunk)
Chunk size: 1114.81 [MiB]
</pre></div>
</div>
</div>
</div>
<p>Okay, we can see that the streamflow chunk size is way to small by a factor of ~100.
So, let’s include 100 feature IDs per chunk.
As for velocity, it is ~10x too big.
As it is an even chunk split, that means we need to increase the number of chunks per dimension by ~<span class="math notranslate nohighlight">\(\sqrt{10} \approx 3\)</span>.
However knowing that the time dimension is hourly, we can get no partial chunks if our chunk per dimension is a divisor of 24.
Luckily, this also applies to the feature ID dimension as 15000 is a multiple of 24.
So, rather than increasing our chunks per dimension by a factor of 3 to 9, let’s increase them to 12 as this will give no partial chunks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nfeature</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">feature_id</span><span class="p">)</span>
<span class="n">ntime</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="n">streamflow_chunk_plan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<span class="n">bytes_per_value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">streamflow</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
<span class="n">total_bytes</span> <span class="o">=</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bytes_per_value</span>
<span class="n">streamflow_MiB</span> <span class="o">=</span> <span class="n">total_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">partial_chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">-</span>  <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ntime</span> <span class="o">/</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">-</span>  <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nfeature</span> <span class="o">/</span> <span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]),}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STREAMFLOW </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk of shape </span><span class="si">{</span><span class="n">streamflow_chunk_plan</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;time&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;feature_id&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">streamflow_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk size: </span><span class="si">{</span><span class="n">streamflow_MiB</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> [MiB] </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">chunks_per_dim</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">velocity_chunk_plan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">//</span> <span class="n">chunks_per_dim</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">//</span> <span class="n">chunks_per_dim</span><span class="p">}</span>
<span class="n">bytes_per_value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
<span class="n">total_bytes</span> <span class="o">=</span> <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bytes_per_value</span>
<span class="n">velocity_MiB</span> <span class="o">=</span> <span class="n">total_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">partial_chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ntime</span> <span class="o">-</span>  <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks_per_dim</span><span class="p">,</span>
                  <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="n">nfeature</span> <span class="o">-</span>  <span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">chunks_per_dim</span><span class="p">,}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VELOCITY </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk of shape </span><span class="si">{</span><span class="n">velocity_chunk_plan</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;time&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Partial &#39;feature_id&#39; chunk remainder: </span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">partial_chunks</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">velocity_chunk_plan</span><span class="p">[</span><span class="s1">&#39;feature_id&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">% of a chunk)</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;Chunk size: </span><span class="si">{</span><span class="n">velocity_MiB</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> [MiB]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STREAMFLOW 
Chunk of shape {&#39;time&#39;: 87672, &#39;feature_id&#39;: 100} 
Partial &#39;time&#39; chunk remainder: 0.0 (0.000% of a chunk)
Partial &#39;feature_id&#39; chunk remainder: 0.0 (0.000% of a chunk)
Chunk size: 66.89 [MiB] 

VELOCITY 
Chunk of shape {&#39;time&#39;: 7306, &#39;feature_id&#39;: 1250} 
Partial &#39;time&#39; chunk remainder: 0 (0.000% of a chunk)
Partial &#39;feature_id&#39; chunk remainder: 0 (0.000% of a chunk)
Chunk size: 69.68 [MiB]
</pre></div>
</div>
</div>
</div>
<p>Nice!
Now, our chunks are a reasonable size and have no remainders.
So, let’s use these chunk plans for our rechunking.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_plan</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;streamflow&#39;</span><span class="p">:</span> <span class="n">streamflow_chunk_plan</span><span class="p">,</span>
    <span class="s1">&#39;velocity&#39;</span><span class="p">:</span> <span class="n">velocity_chunk_plan</span><span class="p">,</span>
     <span class="c1"># We don&#39;t want any of the coordinates chunked</span>
    <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">nfeature</span><span class="p">,),</span>
    <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">nfeature</span><span class="p">,),</span>    
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ntime</span><span class="p">,),</span>
    <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">nfeature</span><span class="p">,)</span>
<span class="p">}</span>
<span class="n">chunk_plan</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;streamflow&#39;: {&#39;time&#39;: 87672, &#39;feature_id&#39;: 100},
 &#39;velocity&#39;: {&#39;time&#39;: 7306, &#39;feature_id&#39;: 1250},
 &#39;latitude&#39;: (15000,),
 &#39;longitude&#39;: (15000,),
 &#39;time&#39;: (87672,),
 &#39;feature_id&#39;: (15000,)}
</pre></div>
</div>
</div>
</div>
</section>
<section id="rechunk-with-rechunker">
<h2>Rechunk with Rechunker<a class="headerlink" href="#rechunk-with-rechunker" title="Link to this heading">#</a></h2>
<p>With this plan, we can now ask Rechunker to re-write the data using the prescribed chunking pattern.</p>
<section id="set-up-output-location">
<h3>Set up output location<a class="headerlink" href="#set-up-output-location" title="Link to this heading">#</a></h3>
<p>Unlike with the smaller dataset in our previous rechunking tutorial, we will write this larger dataset to an object store (similar to an S3 bucket) on the USGS OSN Pod.
So, we need to set that up so that Rechunker will have a suitable place to write data.</p>
<p>First, we need to set up our credentials that allow us to write to the OSN Pod and direct it to the endpoint where the OSN Pod is located (while it is available via the S3 API, it is not in AWS, so we have to tell it where to find the pod!). If you do not already have access to the credentials to write to the OSN Pod and you are a USGS staff member or collaborator, please reach out to asnyder&#64;usgs.gov to request them. If you are not a USGS staff or collaborator, you will need to set up a different location that to you have write permissions to. This could be an AWS S3 bucket that you have access too or you could even set up an <code class="docutils literal notranslate"><span class="pre">fsspec</span></code> <code class="docutils literal notranslate"><span class="pre">LocalFileSystem</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">awsconfig</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">awsconfig</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.aws/credentials&#39;</span><span class="p">)</span> 
    <span class="c1"># default location... if yours is elsewhere, change this.</span>
<span class="p">)</span>
<span class="n">_profile_nm</span>  <span class="o">=</span> <span class="s1">&#39;osn-hytest-scratch&#39;</span>
<span class="n">_endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://usgs.osn.mghpcc.org/&#39;</span>

<span class="c1"># Set environment vars based on parsed awsconfig</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">awsconfig</span><span class="p">[</span><span class="n">_profile_nm</span><span class="p">][</span><span class="s1">&#39;aws_access_key_id&#39;</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">awsconfig</span><span class="p">[</span><span class="n">_profile_nm</span><span class="p">][</span><span class="s1">&#39;aws_secret_access_key&#39;</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_S3_ENDPOINT&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">_endpoint</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_profile_nm</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_DEFAULT_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_profile_nm</span>
<span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Problem parsing the AWS credentials file. &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we make our S3 <code class="docutils literal notranslate"><span class="pre">fsspec.filesystem</span></code> with the required user info and get the mapper to this file to pass to Rechunker.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">getpass</span><span class="w"> </span><span class="kn">import</span> <span class="n">getuser</span>
<span class="n">uname</span><span class="o">=</span><span class="n">getuser</span><span class="p">()</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
    <span class="s1">&#39;s3&#39;</span><span class="p">,</span> 
    <span class="n">anon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">default_fill_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">skip_instance_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">client_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;endpoint_url&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_S3_ENDPOINT&#39;</span><span class="p">],</span> <span class="p">}</span>
<span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;s3://hytest-scratch/rechunking_tutorial/</span><span class="si">{</span><span class="n">uname</span><span class="si">}</span><span class="s1">/&#39;</span>

<span class="n">temp_store</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">+</span> <span class="s1">&#39;temp_store.zarr&#39;</span><span class="p">)</span>
<span class="n">target_store</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">+</span> <span class="s1">&#39;tutorial_rechunked.zarr&#39;</span><span class="p">)</span>
<span class="c1"># Check if the objects exist and remove if they do</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="n">temp_store</span><span class="p">,</span> <span class="n">target_store</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="spin-up-dask-cluster">
<h3>Spin up Dask Cluster<a class="headerlink" href="#spin-up-dask-cluster" title="Link to this heading">#</a></h3>
<p>Our rechunking operation will be able to work in parallel.
To do that, we will spin up a dask cluster to schedule the various workers.</p>
<p>This cluster will be configured differently depending on where you compute is performed. We have set up this notebook to run on <a class="reference external" href="https://www.nebari.dev/">Nebari</a>. If you are working on USGS systems, you can likely use one of our <a class="reference external" href="https://hytest-org.github.io/hytest/environment_set_up/clusters.html">example codes to spin up a dask cluster</a>. Otherwise, please refer to the <a class="reference external" href="https://docs.dask.org/en/stable/deploying.html">dask deployment docs</a> for details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> ../../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb
<span class="c1">## If this notebook is not being run on Nebari, replace the above </span>
<span class="c1">## path name with a helper appropriate to your compute environment.  Examples:</span>
<span class="c1"># %run ../../../../environment_set_up/Start_Dask_Cluster_Denali.ipynb</span>
<span class="c1"># %run ../../../../environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb</span>
<span class="c1"># %run ../../../../environment_set_up/Start_Dask_Cluster_Desktop.ipynb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The &#39;cluster&#39; object can be used to adjust cluster behavior.  i.e. &#39;cluster.adapt(minimum=10)&#39;
The &#39;client&#39; object can be used to directly interact with the cluster.  i.e. &#39;client.submit(func)&#39; 
The link to view the client dashboard is:
&gt;  https://nebari.chs.usgs.gov/gateway/clusters/nebari.5cb3ba1a3cab4091ae7d7aeed5b227ef/status
</pre></div>
</div>
</div>
</div>
</section>
<section id="rechunk">
<h3>Rechunk<a class="headerlink" href="#rechunk" title="Link to this heading">#</a></h3>
<p>Now, we are ready to rechunk!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">rechunk</span><span class="p">(</span>
    <span class="c1"># Make sure the base chunks are correct</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">672</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">}),</span>
    <span class="n">target_chunks</span><span class="o">=</span><span class="n">chunk_plan</span><span class="p">,</span>
    <span class="n">max_mem</span><span class="o">=</span><span class="s2">&quot;2GB&quot;</span><span class="p">,</span>
    <span class="n">target_store</span><span class="o">=</span><span class="n">target_store</span><span class="p">,</span>
    <span class="n">temp_store</span><span class="o">=</span><span class="n">temp_store</span>
<span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><h2>Rechunked</h2>
        <details>
          <summary><b>Source</b></summary>
          <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 21GB
Dimensions:     (time: 87672, feature_id: 15000)
Coordinates:
  * feature_id  (feature_id) int32 60kB 101 179 181 183 ... 303420 303422 303424
    latitude    (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
    longitude   (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
  * time        (time) datetime64[ns] 701kB 1999-10-01 ... 2009-09-30T23:00:00
Data variables:
    streamflow  (time, feature_id) float64 11GB dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;
    velocity    (time, feature_id) float64 11GB dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;
Attributes: (12/17)
    Conventions:                CF-1.6
    cdm_datatype:               Station
    code_version:               v5.1.0-alpha11
    dev:                        dev_ prefix indicates development/internal me...
    dev_NOAH_TIMESTEP:          3600
    dev_OVRTSWCRT:              1
    ...                         ...
    model_output_type:          channel_rt
    model_output_valid_time:    2018-12-28_00:00:00
    model_total_valid_times:    2208
    proj4:                      +proj=lcc +units=m +a=6370000.0 +b=6370000.0 ...
    station_dimension:          feature_id
    stream_order_output:        1</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-39679a62-d54c-4737-8262-ce2e71b1fd11' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-39679a62-d54c-4737-8262-ce2e71b1fd11' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 87672</li><li><span class='xr-has-index'>feature_id</span>: 15000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-dc1a7f2b-f40d-4fe6-ae62-39eb83df1315' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dc1a7f2b-f40d-4fe6-ae62-39eb83df1315' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>feature_id</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>101 179 181 ... 303422 303424</div><input id='attrs-ad3c05cd-8ce8-4444-a223-0fa1686e83c3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ad3c05cd-8ce8-4444-a223-0fa1686e83c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6f9fd5e9-6552-4921-aa57-af979e0b38c3' class='xr-var-data-in' type='checkbox'><label for='data-6f9fd5e9-6552-4921-aa57-af979e0b38c3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>cf_role :</span></dt><dd>timeseries_id</dd><dt><span>comment :</span></dt><dd>Gage Points Specified by User in Routelink file</dd><dt><span>long_name :</span></dt><dd>Reach ID</dd></dl></div><div class='xr-var-data'><pre>array([   101,    179,    181, ..., 303420, 303422, 303424],
      shape=(15000,), dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-7c771818-6f85-4a50-8749-28117ed66b2f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7c771818-6f85-4a50-8749-28117ed66b2f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-048d5c0e-892d-4479-92bf-83aebabd4ef7' class='xr-var-data-in' type='checkbox'><label for='data-048d5c0e-892d-4479-92bf-83aebabd4ef7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-94449dbc-7f2a-4ea8-889a-32f4dedcfd9b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-94449dbc-7f2a-4ea8-889a-32f4dedcfd9b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-62fb9b3f-dd4c-4bf8-823f-1347ee959a5c' class='xr-var-data-in' type='checkbox'><label for='data-62fb9b3f-dd4c-4bf8-823f-1347ee959a5c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1999-10-01 ... 2009-09-30T23:00:00</div><input id='attrs-9230e692-1ae9-4ea3-946b-cd28636b0f2a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9230e692-1ae9-4ea3-946b-cd28636b0f2a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b3a4c16c-592d-4040-a54e-55333c900685' class='xr-var-data-in' type='checkbox'><label for='data-b3a4c16c-592d-4040-a54e-55333c900685' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>valid output time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1999-10-01T00:00:00.000000000&#x27;, &#x27;1999-10-01T01:00:00.000000000&#x27;,
       &#x27;1999-10-01T02:00:00.000000000&#x27;, ..., &#x27;2009-09-30T21:00:00.000000000&#x27;,
       &#x27;2009-09-30T22:00:00.000000000&#x27;, &#x27;2009-09-30T23:00:00.000000000&#x27;],
      shape=(87672,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a8f2f2cf-c6cf-454e-b651-86a089e515e5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a8f2f2cf-c6cf-454e-b651-86a089e515e5' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>streamflow</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;</div><input id='attrs-1336e601-f0b5-4524-a573-a494b205f905' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1336e601-f0b5-4524-a573-a494b205f905' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-04927441-273c-4340-9f81-6cd422938e8b' class='xr-var-data-in' type='checkbox'><label for='data-04927441-273c-4340-9f81-6cd422938e8b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Flow</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (672, 15000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 131 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="41" y2="5" />
  <line x1="0" y1="11" x2="41" y2="11" />
  <line x1="0" y1="18" x2="41" y2="18" />
  <line x1="0" y1="24" x2="41" y2="24" />
  <line x1="0" y1="31" x2="41" y2="31" />
  <line x1="0" y1="37" x2="41" y2="37" />
  <line x1="0" y1="44" x2="41" y2="44" />
  <line x1="0" y1="50" x2="41" y2="50" />
  <line x1="0" y1="57" x2="41" y2="57" />
  <line x1="0" y1="62" x2="41" y2="62" />
  <line x1="0" y1="68" x2="41" y2="68" />
  <line x1="0" y1="75" x2="41" y2="75" />
  <line x1="0" y1="81" x2="41" y2="81" />
  <line x1="0" y1="88" x2="41" y2="88" />
  <line x1="0" y1="94" x2="41" y2="94" />
  <line x1="0" y1="101" x2="41" y2="101" />
  <line x1="0" y1="107" x2="41" y2="107" />
  <line x1="0" y1="114" x2="41" y2="114" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>velocity</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(672, 15000), meta=np.ndarray&gt;</div><input id='attrs-3a69cdb6-381b-40e8-8935-621c9c0c9d56' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3a69cdb6-381b-40e8-8935-621c9c0c9d56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3ccd54b0-36e4-494c-b26a-249ea34b8e67' class='xr-var-data-in' type='checkbox'><label for='data-3ccd54b0-36e4-494c-b26a-249ea34b8e67' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Velocity</dd><dt><span>units :</span></dt><dd>ms-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 76.90 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (672, 15000) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 131 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="41" y2="5" />
  <line x1="0" y1="11" x2="41" y2="11" />
  <line x1="0" y1="18" x2="41" y2="18" />
  <line x1="0" y1="24" x2="41" y2="24" />
  <line x1="0" y1="31" x2="41" y2="31" />
  <line x1="0" y1="37" x2="41" y2="37" />
  <line x1="0" y1="44" x2="41" y2="44" />
  <line x1="0" y1="50" x2="41" y2="50" />
  <line x1="0" y1="57" x2="41" y2="57" />
  <line x1="0" y1="62" x2="41" y2="62" />
  <line x1="0" y1="68" x2="41" y2="68" />
  <line x1="0" y1="75" x2="41" y2="75" />
  <line x1="0" y1="81" x2="41" y2="81" />
  <line x1="0" y1="88" x2="41" y2="88" />
  <line x1="0" y1="94" x2="41" y2="94" />
  <line x1="0" y1="101" x2="41" y2="101" />
  <line x1="0" y1="107" x2="41" y2="107" />
  <line x1="0" y1="114" x2="41" y2="114" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-5cc34a9f-0617-47ab-988c-660ae41f4022' class='xr-section-summary-in' type='checkbox'  ><label for='section-5cc34a9f-0617-47ab-988c-660ae41f4022' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>feature_id</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-5fcbf802-786a-4135-8016-2929659a89d1' class='xr-index-data-in' type='checkbox'/><label for='index-5fcbf802-786a-4135-8016-2929659a89d1' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   101,    179,    181,    183,    185,    843,    845,    847,    849,
          851,
       ...
       303404, 303408, 303410, 303412, 303414, 303416, 303418, 303420, 303422,
       303424],
      dtype=&#x27;int32&#x27;, name=&#x27;feature_id&#x27;, length=15000))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-3667dd9f-22f7-4669-bea0-c4708000e8e8' class='xr-index-data-in' type='checkbox'/><label for='index-3667dd9f-22f7-4669-bea0-c4708000e8e8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1999-10-01 00:00:00&#x27;, &#x27;1999-10-01 01:00:00&#x27;,
               &#x27;1999-10-01 02:00:00&#x27;, &#x27;1999-10-01 03:00:00&#x27;,
               &#x27;1999-10-01 04:00:00&#x27;, &#x27;1999-10-01 05:00:00&#x27;,
               &#x27;1999-10-01 06:00:00&#x27;, &#x27;1999-10-01 07:00:00&#x27;,
               &#x27;1999-10-01 08:00:00&#x27;, &#x27;1999-10-01 09:00:00&#x27;,
               ...
               &#x27;2009-09-30 14:00:00&#x27;, &#x27;2009-09-30 15:00:00&#x27;,
               &#x27;2009-09-30 16:00:00&#x27;, &#x27;2009-09-30 17:00:00&#x27;,
               &#x27;2009-09-30 18:00:00&#x27;, &#x27;2009-09-30 19:00:00&#x27;,
               &#x27;2009-09-30 20:00:00&#x27;, &#x27;2009-09-30 21:00:00&#x27;,
               &#x27;2009-09-30 22:00:00&#x27;, &#x27;2009-09-30 23:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=87672, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2555f8ee-66a7-4728-98be-87359e9f3fd5' class='xr-section-summary-in' type='checkbox'  ><label for='section-2555f8ee-66a7-4728-98be-87359e9f3fd5' class='xr-section-summary' >Attributes: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.6</dd><dt><span>cdm_datatype :</span></dt><dd>Station</dd><dt><span>code_version :</span></dt><dd>v5.1.0-alpha11</dd><dt><span>dev :</span></dt><dd>dev_ prefix indicates development/internal meta data</dd><dt><span>dev_NOAH_TIMESTEP :</span></dt><dd>3600</dd><dt><span>dev_OVRTSWCRT :</span></dt><dd>1</dd><dt><span>dev_channelBucket_only :</span></dt><dd>0</dd><dt><span>dev_channel_only :</span></dt><dd>0</dd><dt><span>featureType :</span></dt><dd>timeSeries</dd><dt><span>model_configuration :</span></dt><dd>retrospective</dd><dt><span>model_initialization_time :</span></dt><dd>2018-10-01_00:00:00</dd><dt><span>model_output_type :</span></dt><dd>channel_rt</dd><dt><span>model_output_valid_time :</span></dt><dd>2018-12-28_00:00:00</dd><dt><span>model_total_valid_times :</span></dt><dd>2208</dd><dt><span>proj4 :</span></dt><dd>+proj=lcc +units=m +a=6370000.0 +b=6370000.0 +lat_1=30.0 +lat_2=60.0 +lat_0=40.0 +lon_0=-97.0 +x_0=0 +y_0=0 +k_0=1.0 +nadgrids=@</dd><dt><span>station_dimension :</span></dt><dd>feature_id</dd><dt><span>stream_order_output :</span></dt><dd>1</dd></dl></div></li></ul></div></div>
        </details>
        <details>
<summary><b>Intermediate</b></summary>
None
</details>

        <details>
          <summary><b>Target</b></summary>
          None
        </details>
</div></div>
</div>
<p>Remember that merely invoking Rechunker does not do any work.
It just sorts out the rechunking plan and writes metadata.
We need to call <code class="docutils literal notranslate"><span class="pre">.execute</span></code> on the <code class="docutils literal notranslate"><span class="pre">result</span></code> object to actually run the rechunking.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">dask</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  

<span class="c1"># Also consolidate the metadata for fast reading into xarray</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">consolidate_metadata</span><span class="p">(</span><span class="n">target_store</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="confirm-the-creation-of-the-zarr-store-by-rechunker">
<h2>Confirm the Creation of the Zarr Store by Rechunker<a class="headerlink" href="#confirm-the-creation-of-the-zarr-store-by-rechunker" title="Link to this heading">#</a></h2>
<p>Let’s read in the resulting re-chunked dataset to confirm it turned out how we intended.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_rechunked</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">target_store</span><span class="p">)</span>
<span class="n">ds_rechunked</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 21GB
Dimensions:     (feature_id: 15000, time: 87672)
Coordinates:
  * feature_id  (feature_id) int32 60kB 101 179 181 183 ... 303420 303422 303424
    latitude    (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
    longitude   (feature_id) float32 60kB dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;
  * time        (time) datetime64[ns] 701kB 1999-10-01 ... 2009-09-30T23:00:00
Data variables:
    streamflow  (time, feature_id) float64 11GB dask.array&lt;chunksize=(87672, 100), meta=np.ndarray&gt;
    velocity    (time, feature_id) float64 11GB dask.array&lt;chunksize=(7306, 1250), meta=np.ndarray&gt;
Attributes: (12/17)
    Conventions:                CF-1.6
    cdm_datatype:               Station
    code_version:               v5.1.0-alpha11
    dev:                        dev_ prefix indicates development/internal me...
    dev_NOAH_TIMESTEP:          3600
    dev_OVRTSWCRT:              1
    ...                         ...
    model_output_type:          channel_rt
    model_output_valid_time:    2018-12-28_00:00:00
    model_total_valid_times:    2208
    proj4:                      +proj=lcc +units=m +a=6370000.0 +b=6370000.0 ...
    station_dimension:          feature_id
    stream_order_output:        1</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-15c011fd-c3b5-4aa1-acef-4fed15110e16' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-15c011fd-c3b5-4aa1-acef-4fed15110e16' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>feature_id</span>: 15000</li><li><span class='xr-has-index'>time</span>: 87672</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-95cda0e8-bf87-41ff-b236-08952a8b1151' class='xr-section-summary-in' type='checkbox'  checked><label for='section-95cda0e8-bf87-41ff-b236-08952a8b1151' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>feature_id</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>101 179 181 ... 303422 303424</div><input id='attrs-ee0ff0c8-a918-499c-99d8-07f476a3e524' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ee0ff0c8-a918-499c-99d8-07f476a3e524' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dc296dab-5d9a-4d0f-a692-d4b01433b6ab' class='xr-var-data-in' type='checkbox'><label for='data-dc296dab-5d9a-4d0f-a692-d4b01433b6ab' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>cf_role :</span></dt><dd>timeseries_id</dd><dt><span>comment :</span></dt><dd>Gage Points Specified by User in Routelink file</dd><dt><span>long_name :</span></dt><dd>Reach ID</dd></dl></div><div class='xr-var-data'><pre>array([   101,    179,    181, ..., 303420, 303422, 303424],
      shape=(15000,), dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-a2cc5beb-84c2-4a35-8b66-7fa59030cd55' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a2cc5beb-84c2-4a35-8b66-7fa59030cd55' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-da467772-9061-44a1-bf55-21f12b7ca4a1' class='xr-var-data-in' type='checkbox'><label for='data-da467772-9061-44a1-bf55-21f12b7ca4a1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(feature_id)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(15000,), meta=np.ndarray&gt;</div><input id='attrs-b6cf30e7-b7bd-493e-bab8-54fa5d153b27' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b6cf30e7-b7bd-493e-bab8-54fa5d153b27' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1d4b3308-8316-4034-b891-e3152c77564a' class='xr-var-data-in' type='checkbox'><label for='data-1d4b3308-8316-4034-b891-e3152c77564a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Feature longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 58.59 kiB </td>
                        <td> 58.59 kiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (15000,) </td>
                        <td> (15000,) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1999-10-01 ... 2009-09-30T23:00:00</div><input id='attrs-d17e48ad-61eb-4eba-bfea-334f5ae11c17' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d17e48ad-61eb-4eba-bfea-334f5ae11c17' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-db180b01-704f-4044-836f-1d517ebbf2c5' class='xr-var-data-in' type='checkbox'><label for='data-db180b01-704f-4044-836f-1d517ebbf2c5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>valid output time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1999-10-01T00:00:00.000000000&#x27;, &#x27;1999-10-01T01:00:00.000000000&#x27;,
       &#x27;1999-10-01T02:00:00.000000000&#x27;, ..., &#x27;2009-09-30T21:00:00.000000000&#x27;,
       &#x27;2009-09-30T22:00:00.000000000&#x27;, &#x27;2009-09-30T23:00:00.000000000&#x27;],
      shape=(87672,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c3a03c63-714e-40b2-ba7b-4e265d5b06c1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c3a03c63-714e-40b2-ba7b-4e265d5b06c1' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>streamflow</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(87672, 100), meta=np.ndarray&gt;</div><input id='attrs-995b562a-d448-406c-9d4c-7019b06088f6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-995b562a-d448-406c-9d4c-7019b06088f6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21bd511f-bffb-4a4b-b6b5-8df8da9b6800' class='xr-var-data-in' type='checkbox'><label for='data-21bd511f-bffb-4a4b-b6b5-8df8da9b6800' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Flow</dd><dt><span>units :</span></dt><dd>m3 s-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 66.89 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (87672, 100) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 150 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="1" y1="0" x2="1" y2="120" />
  <line x1="4" y1="0" x2="4" y2="120" />
  <line x1="6" y1="0" x2="6" y2="120" />
  <line x1="8" y1="0" x2="8" y2="120" />
  <line x1="10" y1="0" x2="10" y2="120" />
  <line x1="12" y1="0" x2="12" y2="120" />
  <line x1="15" y1="0" x2="15" y2="120" />
  <line x1="17" y1="0" x2="17" y2="120" />
  <line x1="19" y1="0" x2="19" y2="120" />
  <line x1="21" y1="0" x2="21" y2="120" />
  <line x1="23" y1="0" x2="23" y2="120" />
  <line x1="25" y1="0" x2="25" y2="120" />
  <line x1="28" y1="0" x2="28" y2="120" />
  <line x1="30" y1="0" x2="30" y2="120" />
  <line x1="32" y1="0" x2="32" y2="120" />
  <line x1="34" y1="0" x2="34" y2="120" />
  <line x1="36" y1="0" x2="36" y2="120" />
  <line x1="39" y1="0" x2="39" y2="120" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>velocity</span></div><div class='xr-var-dims'>(time, feature_id)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(7306, 1250), meta=np.ndarray&gt;</div><input id='attrs-cc5fd3fb-9db5-4c6d-a1ec-7442e3a7e9bb' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cc5fd3fb-9db5-4c6d-a1ec-7442e3a7e9bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-248124c9-5c00-4bf7-ac4a-b6a795beb851' class='xr-var-data-in' type='checkbox'><label for='data-248124c9-5c00-4bf7-ac4a-b6a795beb851' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>grid_mapping :</span></dt><dd>crs</dd><dt><span>long_name :</span></dt><dd>River Velocity</dd><dt><span>units :</span></dt><dd>ms-1</dd><dt><span>valid_range :</span></dt><dd>[0, 50000000]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.80 GiB </td>
                        <td> 69.68 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (87672, 15000) </td>
                        <td> (7306, 1250) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 144 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="91" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="41" y2="0" style="stroke-width:2" />
  <line x1="0" y1="10" x2="41" y2="10" />
  <line x1="0" y1="20" x2="41" y2="20" />
  <line x1="0" y1="30" x2="41" y2="30" />
  <line x1="0" y1="40" x2="41" y2="40" />
  <line x1="0" y1="50" x2="41" y2="50" />
  <line x1="0" y1="60" x2="41" y2="60" />
  <line x1="0" y1="70" x2="41" y2="70" />
  <line x1="0" y1="80" x2="41" y2="80" />
  <line x1="0" y1="90" x2="41" y2="90" />
  <line x1="0" y1="100" x2="41" y2="100" />
  <line x1="0" y1="110" x2="41" y2="110" />
  <line x1="0" y1="120" x2="41" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="3" y1="0" x2="3" y2="120" />
  <line x1="6" y1="0" x2="6" y2="120" />
  <line x1="10" y1="0" x2="10" y2="120" />
  <line x1="13" y1="0" x2="13" y2="120" />
  <line x1="17" y1="0" x2="17" y2="120" />
  <line x1="20" y1="0" x2="20" y2="120" />
  <line x1="24" y1="0" x2="24" y2="120" />
  <line x1="27" y1="0" x2="27" y2="120" />
  <line x1="30" y1="0" x2="30" y2="120" />
  <line x1="34" y1="0" x2="34" y2="120" />
  <line x1="37" y1="0" x2="37" y2="120" />
  <line x1="41" y1="0" x2="41" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 41.324020118004945,0.0 41.324020118004945,120.0 0.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="20.662010" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >15000</text>
  <text x="61.324020" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,61.324020,60.000000)">87672</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-4d6b9a5f-6d8a-4e03-83bb-4b132a675b36' class='xr-section-summary-in' type='checkbox'  ><label for='section-4d6b9a5f-6d8a-4e03-83bb-4b132a675b36' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>feature_id</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-edf9342b-a4b4-48e7-b6d7-6af2b6993485' class='xr-index-data-in' type='checkbox'/><label for='index-edf9342b-a4b4-48e7-b6d7-6af2b6993485' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   101,    179,    181,    183,    185,    843,    845,    847,    849,
          851,
       ...
       303404, 303408, 303410, 303412, 303414, 303416, 303418, 303420, 303422,
       303424],
      dtype=&#x27;int32&#x27;, name=&#x27;feature_id&#x27;, length=15000))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-a97893bc-6cab-48c3-a1a6-31c24efb832e' class='xr-index-data-in' type='checkbox'/><label for='index-a97893bc-6cab-48c3-a1a6-31c24efb832e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1999-10-01 00:00:00&#x27;, &#x27;1999-10-01 01:00:00&#x27;,
               &#x27;1999-10-01 02:00:00&#x27;, &#x27;1999-10-01 03:00:00&#x27;,
               &#x27;1999-10-01 04:00:00&#x27;, &#x27;1999-10-01 05:00:00&#x27;,
               &#x27;1999-10-01 06:00:00&#x27;, &#x27;1999-10-01 07:00:00&#x27;,
               &#x27;1999-10-01 08:00:00&#x27;, &#x27;1999-10-01 09:00:00&#x27;,
               ...
               &#x27;2009-09-30 14:00:00&#x27;, &#x27;2009-09-30 15:00:00&#x27;,
               &#x27;2009-09-30 16:00:00&#x27;, &#x27;2009-09-30 17:00:00&#x27;,
               &#x27;2009-09-30 18:00:00&#x27;, &#x27;2009-09-30 19:00:00&#x27;,
               &#x27;2009-09-30 20:00:00&#x27;, &#x27;2009-09-30 21:00:00&#x27;,
               &#x27;2009-09-30 22:00:00&#x27;, &#x27;2009-09-30 23:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=87672, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9ee971b3-55a4-4c7f-9790-b57bb8cf0e64' class='xr-section-summary-in' type='checkbox'  ><label for='section-9ee971b3-55a4-4c7f-9790-b57bb8cf0e64' class='xr-section-summary' >Attributes: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.6</dd><dt><span>cdm_datatype :</span></dt><dd>Station</dd><dt><span>code_version :</span></dt><dd>v5.1.0-alpha11</dd><dt><span>dev :</span></dt><dd>dev_ prefix indicates development/internal meta data</dd><dt><span>dev_NOAH_TIMESTEP :</span></dt><dd>3600</dd><dt><span>dev_OVRTSWCRT :</span></dt><dd>1</dd><dt><span>dev_channelBucket_only :</span></dt><dd>0</dd><dt><span>dev_channel_only :</span></dt><dd>0</dd><dt><span>featureType :</span></dt><dd>timeSeries</dd><dt><span>model_configuration :</span></dt><dd>retrospective</dd><dt><span>model_initialization_time :</span></dt><dd>2018-10-01_00:00:00</dd><dt><span>model_output_type :</span></dt><dd>channel_rt</dd><dt><span>model_output_valid_time :</span></dt><dd>2018-12-28_00:00:00</dd><dt><span>model_total_valid_times :</span></dt><dd>2208</dd><dt><span>proj4 :</span></dt><dd>+proj=lcc +units=m +a=6370000.0 +b=6370000.0 +lat_1=30.0 +lat_2=60.0 +lat_0=40.0 +lon_0=-97.0 +x_0=0 +y_0=0 +k_0=1.0 +nadgrids=@</dd><dt><span>station_dimension :</span></dt><dd>feature_id</dd><dt><span>stream_order_output :</span></dt><dd>1</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Nice, looks good!
You may have noticed that the only difference between the <a class="reference internal" href="../101/Rechunking.html"><span class="std std-doc">introductory tutorial on rechunking</span></a> and this is the inclusion of creating the dask cluster and where we saved the files.
Picking your compute environment and output location will typically be the only things that vary in other workflows requiring rechunking.
Therefore, if you understand this rechunking process you should be able to apply it to your own data efficiently.</p>
</section>
<section id="clean-up">
<h2>Clean Up<a class="headerlink" href="#clean-up" title="Link to this heading">#</a></h2>
<p>As we don’t want to keep this rechunked Zarr, let’s go ahead and delete it.
We will also conform with best practices and close our Dask client and cluster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">temp_store</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">target_store</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./dataset_processing/tutorials/chunking/201"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Advanced Topics in Chunking</p>
      </div>
    </a>
    <a class="right-next"
       href="CreateVirtualZarr.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Generating a Virtual Zarr Store</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-in-a-zarr-store">Read in a Zarr Store</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restrict-for-tutorial">Restrict for Tutorial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk-plan">Rechunk Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk-with-rechunker">Rechunk with Rechunker</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-output-location">Set up output location</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spin-up-dask-cluster">Spin up Dask Cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk">Rechunk</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confirm-the-creation-of-the-zarr-store-by-rechunker">Confirm the Creation of the Zarr Store by Rechunker</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clean-up">Clean Up</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>