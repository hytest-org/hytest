{"version":3,"kind":"Notebook","sha256":"e4e0f26ed46ad377afba1073d60f4e91bfedb3f0267286c9bc96f0b8fd3e9329","slug":"environment-set-up.help-aws-credentials","location":"/environment_set_up/Help_AWS_Credentials.ipynb","dependencies":[],"frontmatter":{"title":"AWS Credentials","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":1}},"source_url":"https://github.com/hytest-org/hytest/blob/main/environment_set_up/Help_AWS_Credentials.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/environment_set_up/Help_AWS_Credentials.ipynb","exports":[{"format":"ipynb","filename":"Help_AWS_Credentials.ipynb","url":"/hytest//build/Help_AWS_Credentials-e6ec54203a3262942ad8fc665f60e094.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If a workflow needs to access S3, it will be important to establish AWS credentials before first access to the object storage. If you are working in a workflow using a dask cluster, you will need to establish AWS credentials ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K4TuR4TadW"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"before","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u5JLoARXSS"}],"key":"rFgXyXPIAb"},{"type":"text","value":" the cluster starts up.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zciES3QV39"}],"key":"fjJX7Eq7Ur"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The following code block will handle*general configuration for establishing AWS credentials for the notebook and any spawned cluster workers.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eKjgFs8To3"}],"key":"rb4nEpuuer"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"You will need to make sure your ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"URby7EDnw2"},{"type":"inlineCode","value":"AWS_PROFILE","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TMOK9lQbJ1"},{"type":"text","value":" or ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"EaaKMAaGaj"},{"type":"inlineCode","value":"AWS_S3_ENDPOINT","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"T9AzcaP7zG"},{"type":"text","value":" environmental variables are established before this is run. If they are not, the defaults will be set to the access the OSN storage pod (with a profile named ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"X2eTDAlasu"},{"type":"inlineCode","value":"osn-hytest-scratch","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eAC6Ol97O3"},{"type":"text","value":" and an endpoint of ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P6hBu9waPp"},{"type":"inlineCode","value":"https://usgs.osn.mghpcc.org","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bLIrNoi8PS"},{"type":"text","value":"), which will only work if you have this AWS profile configured. Please reach out to ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BJaMpmTGtp"},{"type":"link","url":"mailto:asnyder@usgs.gov","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"asnyder@usgs.gov","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cBgU9Y3TJ4"}],"urlSource":"mailto:asnyder@usgs.gov","key":"ZE2JIL2I9f"},{"type":"text","value":" if you are a USGS staff member and you would like access to the credentials for this scratch space to test out our tutorials.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FeXF8uuhTa"}],"key":"w7zev6pSJk"}],"key":"EOh6kQ3jSz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport logging\nimport configparser\n\nawsconfig = configparser.ConfigParser()\nawsconfig.read(\n    os.path.expanduser('~/.aws/credentials') # default location... if yours is elsewhere, change this.\n)\n## NOTE:  The default will be for the OSN / RENCI profile and endpoint. Override this\n## by setting environment variables before executing this cell/notebook.\n_profile_nm  = os.environ.get('AWS_PROFILE', 'osn-hytest-scratch')\n_endpoint = os.environ.get('AWS_S3_ENDPOINT', 'https://usgs.osn.mghpcc.org')\n# Set environment vars based on parsed awsconfig\ntry:\n    os.environ['AWS_ACCESS_KEY_ID']     = awsconfig[_profile_nm]['aws_access_key_id']\n    os.environ['AWS_SECRET_ACCESS_KEY'] = awsconfig[_profile_nm]['aws_secret_access_key']\n    os.environ['AWS_S3_ENDPOINT']       = _endpoint\n    os.environ['AWS_PROFILE'] = _profile_nm\n    os.environ['AWS_DEFAULT_PROFILE'] = _profile_nm\n    os.environ['AWS_S3_REGION'] = _profile_nm\nexcept KeyError:\n    logging.error(\"Problem parsing the AWS credentials file. \")\n","key":"qhS1FHmMi8"},{"type":"outputs","id":"p3TElQ1I_Of11zUswlZNc","children":[],"key":"bx2TSenPtO"}],"key":"GJWxypPZ4A"}],"key":"zdRffhbrPc"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"HPC Server: Start Script Quick-Start","url":"/environment-set-up/startscript","group":"Environment Set-Up"},"next":{"title":"Starting a Dask Cluster","url":"/environment-set-up/clusters","group":"Environment Set-Up"}}},"domain":"http://localhost:3005"}