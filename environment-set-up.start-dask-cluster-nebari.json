{"version":3,"kind":"Notebook","sha256":"ac63f555d35b9d7b7be8b919e8f08c0353996c614d83fd77edc824a8339c1a35","slug":"environment-set-up.start-dask-cluster-nebari","location":"/environment_set_up/Start_Dask_Cluster_Nebari.ipynb","dependencies":[],"frontmatter":{"title":"Nebari Dask Cluster","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/environment_set_up/Start_Dask_Cluster_Nebari.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/environment_set_up/Start_Dask_Cluster_Nebari.ipynb","exports":[{"format":"ipynb","filename":"Start_Dask_Cluster_Nebari.ipynb","url":"/hytest//build/Start_Dask_Cluster_N-208e4ca930a5792b0f39f8b3795fb4af.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport logging\n\n# Needed when boto3 >= 1.36.0 or the rechunking process will fail\n# This needs to be set before the boto3 library gets loaded\n# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168\nos.environ['AWS_REQUEST_CHECKSUM_CALCULATION'] = 'when_required'\nos.environ['AWS_RESPONSE_CHECKSUM_VALIDATION'] = 'when_required'\n\ntry:\n    from dask_gateway import Gateway\nexcept ImportError:\n    logging.error(\"Unable to import Dask Gateway.  Are you running in a cloud compute environment?\\n\")\n    raise\nos.environ['DASK_DISTRIBUTED__SCHEDULER__WORKER_SATURATION'] = \"1.0\"\n\ngateway = Gateway()\n_options = gateway.cluster_options()\n_options.conda_environment='hytest/hytest-pangeo'  ##<< this is the conda environment we use on nebari.\n_options.profile = 'Medium Worker'\n_env_to_add={}\naws_env_vars=['AWS_ACCESS_KEY_ID',\n              'AWS_SECRET_ACCESS_KEY',\n              'AWS_SESSION_TOKEN',\n              'AWS_DEFAULT_REGION',\n              'AWS_S3_ENDPOINT',\n              'AWS_REQUEST_CHECKSUM_CALCULATION',\n              'AWS_RESPONSE_CHECKSUM_VALIDATION']\nfor _e in aws_env_vars:\n    if _e in os.environ:\n        _env_to_add[_e] = os.environ[_e]\n_options.environment_vars = _env_to_add    \ncluster = gateway.new_cluster(_options)          ##<< create cluster via the dask gateway\ncluster.scale(30)             ##<< Sets scaling parameters. \n\nclient = cluster.get_client()\n\nprint(\"The 'cluster' object can be used to adjust cluster behavior.  i.e. 'cluster.adapt(minimum=10)'\")\nprint(\"The 'client' object can be used to directly interact with the cluster.  i.e. 'client.submit(func)' \")\nprint(f\"The link to view the client dashboard is:\\n>  {client.dashboard_link}\")","key":"IYg77dyHb7"},{"type":"outputs","id":"T3jblF2-K-JfWppxqh6tI","children":[],"key":"pFHdNKVULu"}],"key":"eDNbPbKgXB"}],"key":"CwGKHFdpcT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Starting a Dask Cluster","url":"/environment-set-up/clusters","group":"Environment Set-Up"},"next":{"title":"Denali HPC Dask Cluster","url":"/environment-set-up/start-dask-cluster-denali","group":"Environment Set-Up"}}},"domain":"http://localhost:3005"}