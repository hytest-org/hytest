{"version":3,"kind":"Notebook","sha256":"184430b3e3f34d94e170d99af2b3a08d6a760c7dea4194c7c65a61406b883bd0","slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","location":"/evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb","dependencies":[],"frontmatter":{"title":"Standard Suite (v1) Metrics -- Usage Examples","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb","exports":[{"format":"ipynb","filename":"Usage_StdSuite_v1.ipynb","url":"/hytest//build/Usage_StdSuite_v1-87b4ac1c09247e1ab46eb174601b4dc1.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This notebook will demonstrate how to call the specific functions defined in the\n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qs13fonlq0"},{"type":"link","url":"/evaluation/metrics-stdsuite-v1","urlSource":"/evaluation/Metrics_StdSuite_v1","dataUrl":"/evaluation.metrics-stdsuite-v1.json","internal":true,"children":[{"type":"text","value":"Standard Suite (v1) Metrics","key":"nbpI7VFaUk"}],"protocol":"file","key":"GPZy19yDnR"},{"type":"text","value":"\nnotebook, using a small demonstration dataset.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"StAf5SLsHd"}],"key":"gO7HVmsxWH"}],"key":"sIseZikpQ8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport numpy as np","key":"Yp1OGaOrpm"},{"type":"outputs","id":"LRNai2ZIyYJIovD3tz_W6","children":[],"key":"JCFXUHtM6L"}],"key":"vXUqBc2ye8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sample Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eUwZlj9ous"}],"identifier":"sample-data","label":"Sample Data","html_id":"sample-data","implicit":true,"key":"NwKGmBWB9z"}],"key":"rtyzFy18yA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sampleData = pd.read_csv(r\"../streamflow/NWM_Benchmark_SampleData.csv\", index_col='date').dropna()\nprint(len(sampleData.index), \" Records\")\nsampleData.head()","key":"bK0Sop72We"},{"type":"outputs","id":"mRMrhj2p16b8GlQd9qfyJ","children":[],"key":"t05Nm7n38T"}],"key":"Ank1fmqlc6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Metric Functions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oAItJK1ZGw"}],"identifier":"import-metric-functions","label":"Import Metric Functions","html_id":"import-metric-functions","implicit":true,"key":"JXQbjUOce7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The functions are defined in an\n","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ejKJpfpR02"},{"type":"link","url":"/evaluation/metrics-stdsuite-v1","urlSource":"/evaluation/Metrics_StdSuite_v1","dataUrl":"/evaluation.metrics-stdsuite-v1.json","internal":true,"children":[{"type":"text","value":"Standard Suite (v1) Metrics","key":"rP4uPTflg4"}],"protocol":"file","key":"wyjbQoygZe"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dJ0AnY4eY8"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"h0Al2S3fdK"},{"type":"text","value":"They are imported for use here by running that notebook from within the following cell:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H4xc4ZQHRG"}],"key":"ze9gx3FckE"}],"key":"cnfP3j5wG4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%run ../../Metrics_StdSuite_v1.ipynb\n# This brings functions defined in external notebook into this notebook's namespace.","key":"eqsMP9MBXp"},{"type":"outputs","id":"QVX1gTOP_fGHmsCn7uH_j","children":[],"key":"MZMA88Cj7c"}],"key":"AebXtb3U7w"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The functions are now available here, to run against our sample data.  These are called with two\narguments: an array/series of observed values and an array/series of modeled/simulated values.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lie1XgSQjg"}],"key":"sbQI7rccSM"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"A couple of examples:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"edlTtFrmxd"}],"key":"pZEv1dD2V6"}],"key":"iDdGC942FS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Mean Square Error\nMSE(obs=sampleData['obs'], sim=sampleData['nwm'])","key":"LMegSsM4nq"},{"type":"outputs","id":"06k1QwU22jmYQzfUK7Jvf","children":[],"key":"Fdrfnhiy5w"}],"key":"KYVhvw7zjn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Kling-Gupta efficiency\nKGE(obs=sampleData['obs'], sim=sampleData['nwm'])","key":"Nxah0yJUEL"},{"type":"outputs","id":"XRW9DFCPJOh0Oeov1xmsG","children":[],"key":"RqEf8XWDAe"}],"key":"loZNhzS83T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create Composite Benchmark","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zx2DgOBiVE"}],"identifier":"create-composite-benchmark","label":"Create Composite Benchmark","html_id":"create-composite-benchmark","implicit":true,"key":"i0NHJY1vij"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"It is useful to combine several of these metrics into a single benchmark routine, which returns a\npandas ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SXKpaKZqUf"},{"type":"link","url":"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Series","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WQ6aHqlZnR"}],"urlSource":"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html","key":"Naj54cJRco"},{"type":"text","value":" of\nthe assembled metrics.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IcAgLlMYqQ"}],"key":"mdgNX9KORl"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This example computes those metrics which might apply to the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UEHfLPOo87"},{"type":"inlineCode","value":"streamflow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tOmykvcyul"},{"type":"text","value":" variable.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JRCX6nE5uJ"}],"key":"CAOhXlSWDW"}],"key":"BfXnAuTms2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def compute_benchmark(df):\n    obs = df['obs']\n    sim = df['nwm']\n    return pd.Series(\n        data={\n            'NSE': NSE(obs, sim),\n            'KGE': KGE(obs, sim),\n            'logNSE': logNSE(obs, sim),\n            'pbias': pbias(obs, sim),\n            'rSD': rSD(obs, sim),\n            'pearson': pearson_r(obs, sim),\n            'spearman': spearman_r(obs, sim), \n            'pBiasFMS': pBiasFMS(obs, sim),\n            'pBiasFLV': pBiasFLV(obs, sim),\n            'pBiasFHV': pBiasFHV(obs, sim)\n        },\n        name=df['site_no'].iloc[0], # special case -- 'site_no' column\n        dtype='float64'\n    )","key":"E1u74XmOSZ"},{"type":"outputs","id":"mu5aFkXYh9s3zg4LDfms2","children":[],"key":"YCTYXXPwcF"}],"key":"LAluSUi0aQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"compute_benchmark(sampleData)","key":"CXbtn5id9w"},{"type":"outputs","id":"Yi2CLoNh0KxnQGphWcxBS","children":[],"key":"Sjfi7RSGCJ"}],"key":"GBB3CjaIl6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Streamflow and FDC plots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QqwAV3eDta"}],"identifier":"streamflow-and-fdc-plots","label":"Streamflow and FDC plots","html_id":"streamflow-and-fdc-plots","implicit":true,"key":"WL54sAOAJj"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In the case of ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PiuUJ8ts7T"},{"type":"inlineCode","value":"streamflow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mMbUuvUcH7"},{"type":"text","value":", the NWM standard suite offers a way to plot the Flow Duration Curve when calculating the pBias metrics per Yilmaz et al. This mechanism uses ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"KPUWql2bv8"},{"type":"link","url":"https://matplotlib.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"matplotlib","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Z3UC3vGSdJ"}],"urlSource":"https://matplotlib.org/","key":"yvY11krGCL"},{"type":"text","value":" to implement the figures.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kBgAWNQo2E"}],"key":"Pp3O8K1ru0"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Some examples:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"pXw8fUPLG2"}],"key":"gLvmMBvhVS"}],"key":"dPwCLKj6yN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nfig, ax = plt.subplots(1, 1, figsize=(6, 3), dpi=150)\nax = FDCplot(sampleData['obs'], sampleData['nwm'], ax, segment='mid')\nax.set_title(\"Gage 1104200 - Mid\")\nplt.show()","key":"m2bxvrtWTS"},{"type":"outputs","id":"Q6iZyX5aIt29xbTy_PoVM","children":[],"key":"BM32VAqTUf"}],"key":"S2b4rIeZ0L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Same fig, but with \"segment='lo'\"\nfig, ax = plt.subplots(1, 1, figsize=(6, 3), dpi=150)\nax = FDCplot(sampleData['obs'], sampleData['nwm'], ax, segment='lo')\nax.set_title(\"Gage 1104200 - Low\")\nplt.show()","key":"JkY6EoQYG1"},{"type":"outputs","id":"S3rcZfpXug22YSrId9myC","children":[],"key":"sbbEnPnuKD"}],"key":"omOfPxuowQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Same fig, but with \"segment='hi'\"\nfig, ax = plt.subplots(1, 1, figsize=(6, 3), dpi=150)\nax = FDCplot(sampleData['obs'], sampleData['nwm'], ax, segment='hi')\nax.set_title(\"Gage 1104200 - High\")\nplt.show()","key":"I9lbLcxvht"},{"type":"outputs","id":"VLtPISVKX-73Xh7MhLC45","children":[],"key":"IjYuqCIpD5"}],"key":"l3Llsa04YB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The default behavior is to plot the Y axis log-scale, and to leave units off of the flow rate.\nIf you would like to manipulate these parameters, you may adjust the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jJ7yWKYZ2T"},{"type":"inlineCode","value":"ax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZtsV2ni9RZ"},{"type":"text","value":" after calling ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iEZxlLiUB3"},{"type":"inlineCode","value":"FDCplot()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ito0TvmcWT"},{"type":"text","value":"\n(see example, next cell). In general, any of the matplotlib parameters can be adjusted after\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AOvf15GJlc"},{"type":"inlineCode","value":"FDCplot()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mgE13SBBpv"},{"type":"text","value":" in order to customize the figure.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XXlWpahdsg"}],"key":"pPDPWTs6Xo"}],"key":"AJOyMsO7Pr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 1, figsize=(6, 3), dpi=150)\nax = FDCplot(sampleData['obs'], sampleData['nwm'], ax, segment='mid')\nax.set_yscale('linear')\nax.set_ylabel(\"Flow Rate $m^3 / s$\") # << labels can contain LaTex-style math between $ chars\nplt.show()","key":"SrhI3EwnCF"},{"type":"outputs","id":"ySE625yuuPKtm1CT_qC4X","children":[],"key":"zhkhi346lf"}],"key":"xWEQZiVxdA"}],"key":"I2P1KpyNK7"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Standard Suite (v1) Metrics","url":"/evaluation/metrics-stdsuite-v1","group":"Model Evaluation"},"next":{"title":"Streamflow Model Evaluation","url":"/evaluation/tutorials/streamflow/overview","group":"Model Evaluation"}}},"domain":"http://localhost:3005"}