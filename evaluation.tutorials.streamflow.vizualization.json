{"version":3,"kind":"Notebook","sha256":"e3e1beb2ab062dfe9d91222740099683d1cc33f8e35a5933c5f3a13e8e00956f","slug":"evaluation.tutorials.streamflow.vizualization","location":"/evaluation/tutorials/streamflow/03_Vizualization.ipynb","dependencies":[],"frontmatter":{"title":"Streamflow Eval :: Visualization","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/evaluation/tutorials/streamflow/03_Vizualization.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/evaluation/tutorials/streamflow/03_Vizualization.ipynb","exports":[{"format":"ipynb","filename":"03_Vizualization.ipynb","url":"/hytest//build/03_Vizualization-231c961479767dbeed3f4c0e091f3484.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This notebook is an example of how a HyTEST user may examine streamflow benchmark results\nfrom a hydrologic model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MpylmlI8wn"}],"key":"xZWR8CtlUB"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Here, we are viewing daily streamflow benchmark results from the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"LCDdAq5xvu"},{"type":"link","url":"/evaluation/tutorials/streamflow/analysis-stdsuite","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"example analysis","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SqlXNofJlY"}],"urlSource":"02_Analysis_StdSuite.ipynb","dataUrl":"/evaluation.tutorials.streamflow.analysis-stdsuite.json","internal":true,"protocol":"file","key":"ExvMn9UoKg"},{"type":"text","value":"\nof ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"h73281dRps"},{"type":"link","url":"https://registry.opendata.aws/nwm-archive/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"National Water Model Retrospective version 2.1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"koKdUzHXMj"}],"urlSource":"https://registry.opendata.aws/nwm-archive/","key":"S2viG7vrri"},{"type":"text","value":",\nforced with AORC, at streamflow benchmark locations (“cobalt gages” ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xalDmHyK6j"},{"type":"link","url":"https://www.sciencebase.gov/catalog/item/6181ac65d34e9f2789e44897","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Foks et al., 2022","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WXh8mW8MG5"}],"urlSource":"https://www.sciencebase.gov/catalog/item/6181ac65d34e9f2789e44897","key":"QMlVySQrJl"},{"type":"text","value":").","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"z8T6pURiDn"}],"key":"kE1Yfnu4nd"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Two benchmark results are examined:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ylWQb2cZIz"}],"key":"Iqr78hbh3R"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the standard statistical suite results\n(","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"MzZJPaRLpJ"},{"type":"link","url":"https://www.sciencebase.gov/catalog/item/62336af9d34ec9f19eeb48fd","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Towler et al., 2022","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"o3YJOJQVwl"}],"urlSource":"https://www.sciencebase.gov/catalog/item/62336af9d34ec9f19eeb48fd","key":"npRrmrjwab"},{"type":"text","value":")","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"w91LjBYL96"}],"key":"bCaZerN0ZP"}],"key":"CzdJ3yCqVM"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"decomposition statistical suite, d-score (","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"eLZh40vBwi"},{"type":"link","url":"https://www.sciencebase.gov/catalog/item/61d4c9e9d34ed79293fe91b4","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Hodson et al., 2022","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"la43iqZ870"}],"urlSource":"https://www.sciencebase.gov/catalog/item/61d4c9e9d34ed79293fe91b4","key":"SnPYeswzKe"},{"type":"text","value":").","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"C9UaB6zE3M"}],"key":"zaxEFbnnpq"}],"key":"plD4AHNts1"}],"key":"eAz6RkPmD1"}],"key":"ZtfFIshxmE"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 0: Load Required Python Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"chfgrx7rta"}],"identifier":"step-0-load-required-python-libraries","label":"Step 0: Load Required Python Libraries","html_id":"step-0-load-required-python-libraries","implicit":true,"key":"vlaOLuZ9bB"}],"visibility":"show","key":"HF6ZAwziaZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"try:\n    import pandas as pd\n    import holoviews as hv\n    import hvplot.pandas\n    import panel as pn\n    from geoviews import tile_sources as gvts\nexcept ImportError:\n    print(\"A required library could not be found. \")\n    raise","key":"hoBdB26nGj"},{"type":"outputs","id":"r97F7b9DwnGKu8lLGbUlM","children":[],"key":"Zr52emHmHJ"}],"key":"V4ZFBOyiSm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 1: Load Domain Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uTdLaiBGnL"}],"identifier":"step-1-load-domain-data","label":"Step 1: Load Domain Data","html_id":"step-1-load-domain-data","implicit":true,"key":"wQKGfQbH2D"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Loading the dataset representing the ‘cobalt’ gages. This includes location and other metadata about each gage. We will need this extra metadata to get lat/lon and other characteristics of the gage locations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q9s4KH75TL"}],"key":"ExJ93Jd3CA"}],"key":"qipsKI0aAF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cobalt = pd.read_csv(\n    'https://www.sciencebase.gov/catalog/file/get/6181ac65d34e9f2789e44897?f=__disk__22%2F1a%2Fd2%2F221ad2fe9d95de17731ad35d0fc6b417a4b53ee1',\n    dtype={'site_no':str, 'huc_cd':str, 'reachcode':str, 'comid':str, 'gagesII_class':str, 'aggecoregion': str}, \n    index_col='site_no'\n    )\n# Re-format the gage_id/site_no string value.  ex:   \"1000000\"  ==> \"USGS-1000000\"\ncobalt.rename(index=lambda x: f'USGS-{x}', inplace=True)\ncobalt.rename(columns={'dec_lat_va':'Lat', 'dec_long_va':'Lon'} , inplace=True)\nprint(f\"{len(cobalt.index)} gages in this benchmark\")\ncobalt.head(2)","key":"sQIfedmEfh"},{"type":"outputs","id":"asJw0Md0s5yr6k-LsAkmg","children":[],"key":"LG2QD7jkAv"}],"key":"JsidMeIH14"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 2: Load NWM Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k7OAfkAme8"}],"identifier":"step-2-load-nwm-analysis","label":"Step 2: Load NWM Analysis","html_id":"step-2-load-nwm-analysis","implicit":true,"key":"H6CLTxD7Te"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This table is the collection of evaluation metrics comparing observed vs. modeled streamflow of the cobalt gages. This data is the result\nof the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R5RwF9AoT2"},{"type":"link","url":"/evaluation/tutorials/streamflow/analysis-stdsuite","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"NWM Benchmark Analysis Notebook","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fb4bfdVNel"}],"urlSource":"02_Analysis_StdSuite.ipynb","dataUrl":"/evaluation.tutorials.streamflow.analysis-stdsuite.json","internal":true,"protocol":"file","key":"dE6m3o9kwV"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GKuSBi9dNM"}],"key":"bfhW1p93Yc"}],"key":"EWC99QLEE4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"NWM = pd.read_csv(r'./NWM_v2.1_streamflow_example.csv', dtype={'site_no':str} ).set_index('site_no', drop=False)","key":"xnBgSgmlFH"},{"type":"outputs","id":"TGELsPtCHbKeU1kCB0B6J","children":[],"key":"yTfAIw0And"}],"key":"LmxYRRLRZl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Merge benchmarks with cobalt data to form a single table, indexed by site_no\nmetrics = NWM.columns.tolist()[1:] #list of columns, EXCEPT the first column (site_no)\nNWM = NWM.merge(\n    cobalt, # Table to merge with NWM\n    how='left',            # left join preserves only records which have an index in NWM dataframe.\n    left_index=True, \n    right_index=True\n    )\n# The effect of the left join is that if a cobalt gage does not have a computed benchmark in NWM, \n# (e.g. due to error in the analysis process), it is dropped from the visualization set.","key":"XXHb5CA3Ys"},{"type":"outputs","id":"v9FIVXWMH3oBTi_nhQdkA","children":[],"key":"HBsG3fqzKo"}],"key":"WJ5zc4wusR"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3: Visualize NWM Benchmark Results","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mbBmGa7A4Z"}],"identifier":"step-3-visualize-nwm-benchmark-results","label":"Step 3: Visualize NWM Benchmark Results","html_id":"step-3-visualize-nwm-benchmark-results","implicit":true,"key":"xge33ueQWp"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"A quick look at the joined data table shows that we have a collection of metrics, and the associated metadata,\nall indexed by the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"a5gbQofupd"},{"type":"inlineCode","value":"site_id","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oEXQT47VMR"},{"type":"text","value":".  This table is sortable by column -- you can scroll and select to explore the\nraw result.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"grb2n0M86U"}],"key":"YZlZMUcSeo"}],"visibility":"show","key":"KhqmrA9Rd6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"NWM.hvplot.table(\n    columns=['site_no', 'drain_sqkm','KGE', 'NSE','logNSE','pearson','spearman','rSD','pbias','pBiasFMS','pBiasFHV','pBiasFLV','complete_yrs','n_days'], \n    sortable=True, \n    selectable=True\n)","key":"iFzTb7qJUY"},{"type":"outputs","id":"kEY1L1YaoLyQ9NjpaMj09","children":[],"key":"BLU3Mbg4Sb"}],"key":"wpOOnWjLQd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3a: Benchmark Results Mapped Over the Spatial Extent of the Conterminous United States","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bTcaM2B4YR"}],"identifier":"step-3a-benchmark-results-mapped-over-the-spatial-extent-of-the-conterminous-united-states","label":"Step 3a: Benchmark Results Mapped Over the Spatial Extent of the Conterminous United States","html_id":"step-3a-benchmark-results-mapped-over-the-spatial-extent-of-the-conterminous-united-states","implicit":true,"key":"iGWzIO1UZg"}],"key":"oEt1MwHowP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"var_select = pn.widgets.Select(name='Metric', options=metrics, value='pearson')\nbase_map_select = pn.widgets.Select(name='Basemap:', \n                                    options=list(gvts.tile_sources.keys()), \n                                    value='OSM')\n\n@pn.depends(var=var_select, base_map=base_map_select)\ndef plot(var, base_map):\n    return NWM.hvplot.points(x='Lon', y='Lat', color=var, cmap='turbo_r', geo=True, tiles=base_map)\n\ncol = pn.Column(var_select, base_map_select, plot)\ncol.servable('Hydro Assessment Tool')","key":"tTq6DdiiSD"},{"type":"outputs","id":"GmKZglQ0Edu70rmNzC1DE","children":[],"key":"LK5CpaddOs"}],"key":"YcLU79JDsz"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3b: Boxplots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xOsGgadzRY"}],"identifier":"step-3b-boxplots","label":"Step 3b: Boxplots","html_id":"step-3b-boxplots","implicit":true,"key":"oYk2lRs5Pa"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Grouped by","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cHMA1zIG7C"}],"key":"UASxkcrTcl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Gages-II classification,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dReVuxvkeS"}],"key":"Rxv9FJV8T6"}],"key":"Zl0HE4Hbrw"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"HUC02 group, or","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"okUwfr0UHg"}],"key":"G9OK6RVGf0"}],"key":"fZQMuYsI4v"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Aggregated Ecoregion","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JEzd30XvMB"}],"key":"gKn9YzIdFI"}],"key":"aCP2hVa09o"}],"key":"ClD1BRaXql"}],"visibility":"show","key":"TX97ibt9Px"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# define which columns are metrics in the widget and which ones are groups\nvar_select = pn.widgets.Select(name='Metric', \n        options=metrics, \n        value='pearson')\n\ngroup_select = pn.widgets.Select(name='Group By:', \n        options=['huc02', 'gagesII_class', 'aggecoregion'], \n        value='aggecoregion')\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n        # local scope func to calc summary stats using var/group\n        # build tooltip using the result. \n        # pandas will compute with groupby(). \n    return NWM.hvplot.box(y = var, by = group, height=400, width=800, legend=False)\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('NWM Benchmark Box Plots')\n\n## TODO: \n## Hover over box to tell user exactly the number of samples in group (count), \n# median, mean, max, min, and IQR.  # hovertool -- tooltip","key":"keFcm5F1x9"},{"type":"outputs","id":"HbEP_02QAq7QCZJS5xusS","children":[],"key":"ouQjZoOoqG"}],"key":"Nfr7d5FmZH"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3c: Histograms","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B2TZJsZIbM"}],"identifier":"step-3c-histograms","label":"Step 3c: Histograms","html_id":"step-3c-histograms","implicit":true,"key":"k6Ju5WvbjC"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Grouped by","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MQWSsqSXX4"}],"key":"UVkig8Vy1P"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Gages-II classification,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a6Lt8YUcmj"}],"key":"qwVR2mMUPZ"}],"key":"hPSzSf213h"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"HUC02 group, or","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zx2ixSgiOF"}],"key":"kUINAR82H3"}],"key":"beTaE8w7tT"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Aggregated Ecoregion","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"A6ls14txki"}],"key":"zOvH6fYzcO"}],"key":"kVQh0nfCWh"}],"key":"Geh9mvVccL"}],"visibility":"show","key":"OxRDo6nyz9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"var_select = pn.widgets.Select(name='Metric', \n        options=metrics, \n        value='pearson'\n    )\n\ngroup_select = pn.widgets.Select(name='Group By:', \n        options=['huc02', 'gagesII_class', 'aggecoregion'], \n        value='aggecoregion'\n    )\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n    return NWM.hvplot.hist(var, group, subplots=True, width=400, bins = 500, legend='top')\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('NWM Benchmark Histograms')\n# TODO: Constrain to fixed width for rendering.","key":"A2YWqGB4OL"},{"type":"outputs","id":"8AqGBYrpj1hak8fXFkLzD","children":[],"key":"eqKDBSzpSu"}],"key":"uGm8oc99vM"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3d: Metric by Latitude & Longitude","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hq8snXapvT"}],"identifier":"step-3d-metric-by-latitude-longitude","label":"Step 3d: Metric by Latitude & Longitude","html_id":"step-3d-metric-by-latitude-longitude","implicit":true,"key":"vQq8JNwvzn"}],"visibility":"show","key":"cvhwjTkK4D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"var_select = pn.widgets.Select(name='Metric', options=metrics, \n                               value='pearson')\n\ngroup_select = pn.widgets.Select(name='Group By:', \n                                    options=['Lon', 'Lat'], \n                                    value='Lon')\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n    return NWM.hvplot.scatter(x=group, y=var, height=400, width = 500, legend='top', hover_cols=[\"site_no\",\"Lat\",\"Lon\"])\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('Lat/Lon Scatter Plot')","key":"XvL5BnjxUx"},{"type":"outputs","id":"4akWbSwRXuNPjhCYg-7Pc","children":[],"key":"bXRdpK1BJ5"}],"key":"gFWHP6v8oE"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step 3e: Metric v. Metric","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kl9tnE4gAX"}],"identifier":"step-3e-metric-v-metric","label":"Step 3e: Metric v. Metric","html_id":"step-3e-metric-v-metric","implicit":true,"key":"hDNNxaC2iQ"}],"visibility":"show","key":"BSA0Ipc0SI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"var_select = pn.widgets.Select(name='Metric', options=metrics, \n                               value='pearson')\n\nvar2_select = pn.widgets.Select(name='Metric:', \n                                    options=metrics, \n                                    value='spearman')\n\n@pn.depends(var_select, var2_select)\n\ndef plot(var, var2):\n    return NWM.hvplot.scatter(x = var, y = var2, height=400, width = 500, legend='top', hover_cols=['site_no','Lat', 'Lon'])\n\ncol = pn.Column(var_select, var2_select, plot)\ncol.servable('Metric v Metric Scatter Plot')","key":"hoV1bBeyDh"},{"type":"outputs","id":"SLqPorexR6l6hDtLVXAC-","children":[],"key":"fDrH6oBj8v"}],"key":"YkVWaSzUFi"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V5g6UcUEsd"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Step 4: Visualize D-Score Analysis Results","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nD9FOc9oWD"}],"identifier":"step-4-visualize-d-score-analysis-results","label":"Step 4: Visualize D-Score Analysis Results","html_id":"step-4-visualize-d-score-analysis-results","implicit":true,"key":"JLTG6saksy"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The above steps are repeated for the DScore analysis.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"a7tewqNOtK"}],"key":"PxhPaA6gRV"}],"key":"N4FaJiaEN4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Data is loaded \nDScore = pd.read_csv(r'./DScore_streamflow_example.csv', dtype={'site_no':str} ).set_index('site_no', drop=False)\n# Merge benchmarks with cobalt data to form a single table, indexed by site_no\nmetrics = DScore.columns.tolist()[1:] \nDScore = DScore.merge(\n    cobalt, \n    how='left',\n    left_index=True, \n    right_index=True\n    )","key":"oxq09Bfnt7"},{"type":"outputs","id":"4Mp_HwXKmbu5pusqb5Ui8","children":[],"key":"zhN8APoWgH"}],"key":"PiadCVa6wC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Examine the data table\ncols = ['site_no']\ncols.extend(metrics)\nDScore.hvplot.table(\n    columns=cols, \n    sortable=True, \n    selectable=True\n)","key":"eazAxhhg9W"},{"type":"outputs","id":"nvlikPxoW2G9QiWE-qYZK","children":[],"key":"kchYmOs9SO"}],"key":"qhiLfShfXU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Map\nvar_select = pn.widgets.Select(name='Metric', options=metrics, value='mse')\nbase_map_select = pn.widgets.Select(name='Basemap:', \n                                    options=list(gvts.tile_sources.keys()), \n                                    value='OSM')\n\n@pn.depends(var=var_select, base_map=base_map_select)\ndef plot(var, base_map):\n    return DScore.hvplot.points(x='Lon', y='Lat', color=var, cmap='turbo_r', geo=True, tiles=base_map)\n\ncol = pn.Column(var_select, base_map_select, plot)\ncol.servable('Hydro Assessment Tool')","key":"Ymu610wn3C"},{"type":"outputs","id":"ZCtwdSYsOOO7AgusfMlVc","children":[],"key":"AC1RysZNrl"}],"key":"wXscIZsjeo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Box Plots\nvar_select = pn.widgets.Select(name='Metric', \n        options=metrics, \n        value='mse')\n\ngroup_select = pn.widgets.Select(name='Group By:', \n        options=['huc02', 'gagesII_class', 'aggecoregion'], \n        value='aggecoregion')\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n    return DScore.hvplot.box(y = var, by = group, height=400, width=800, legend=False)\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('DScore Benchmark Box Plots')","key":"No6h8cd5Yn"},{"type":"outputs","id":"iwVJFVdABV4pI2r7H9NpB","children":[],"key":"aErtq0bz4F"}],"key":"NQk9R1FdOG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Histograms\nvar_select = pn.widgets.Select(name='Metric', \n        options=metrics, \n        value='mse'\n    )\n\ngroup_select = pn.widgets.Select(name='Group By:', \n        options=['huc02', 'gagesII_class', 'aggecoregion'], \n        value='aggecoregion'\n    )\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n    return DScore.hvplot.hist(var, group, subplots=True, width=400, bins = 500, legend='top')\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('DScore Benchmark Histograms')","key":"VSj3Q7TjA0"},{"type":"outputs","id":"tSY03l-uOqgUosND3a1Vm","children":[],"key":"cTBRs2IB2K"}],"key":"JdgxIY0D3I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# metric v lat/lon scatter plot\nvar_select = pn.widgets.Select(name='Metric', options=metrics, \n                               value='mse')\n\ngroup_select = pn.widgets.Select(name='Group By:', \n                                    options=['Lon', 'Lat'], \n                                    value='Lon')\n\n@pn.depends(var_select, group_select)\ndef plot(var, group):\n    return DScore.hvplot.scatter(x=group, y=var, height=400, width = 500, legend='top', hover_cols=[\"site_no\",\"Lat\",\"Lon\"])\n\ncol = pn.Column(var_select, group_select, plot)\ncol.servable('Lat/Lon Scatter Plot')","key":"oX8RNb4rit"},{"type":"outputs","id":"rRQhxsMLZb4GZxXkislpb","children":[],"key":"st7U0D7DBB"}],"key":"fWkQhdfe9v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# metric vs metric\nvar_select = pn.widgets.Select(name='Metric', options=metrics, \n                               value='mse')\n\nvar2_select = pn.widgets.Select(name='Metric:', \n                                    options=metrics, \n                                    value='high')\n\n@pn.depends(var_select, var2_select)\n\ndef plot(var, var2):\n    return DScore.hvplot.scatter(x = var, y = var2, height=400, width = 500, legend='top', hover_cols=['site_no','Lat', 'Lon'])\n\ncol = pn.Column(var_select, var2_select, plot)\ncol.servable('Metric v Metric Scatter Plot')","key":"IHRFx5dCWm"},{"type":"outputs","id":"1aheLnItzcWJ0UtZNx7v2","children":[],"key":"eZyxZWe77r"}],"key":"L3dwc0mGY1"}],"key":"QzVyQdgaDP"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Steamflow Eval :: DScore Analysis","url":"/evaluation/tutorials/streamflow/analysis-dscore","group":"Model Evaluation"},"next":{"title":"Contributing","url":"/contributing","group":"Back Matter"}}},"domain":"http://localhost:3005"}