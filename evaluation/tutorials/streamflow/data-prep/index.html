<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Streamflow Eval :: Data Preparation - HyTEST Project</title><meta property="og:title" content="Streamflow Eval :: Data Preparation - HyTEST Project"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg"/><meta property="og:image" content="/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg"/><link rel="stylesheet" href="/hytest//build/_assets/app-SDGCW62C.css"/><link rel="stylesheet" href="/hytest//build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hytest//favicon.ico"/><link rel="stylesheet" href="/hytest//myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hytest//"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="HyTEST Project" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hytest//">HyTEST Project</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Environment Set-Up" class="block break-words rounded py-2 grow cursor-pointer">Environment Set-Up</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Getting Started" class="block break-words rounded py-2 grow cursor-pointer">Getting Started</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Access" class="block break-words rounded py-2 grow cursor-pointer">Dataset Access</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Zarr Creation" class="block break-words rounded py-2 grow cursor-pointer">Zarr Creation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Dataset Processing" class="block break-words rounded py-2 grow cursor-pointer">Dataset Processing</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Model Evaluation" class="block break-words rounded py-2 grow cursor-pointer">Model Evaluation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Back Matter" class="block break-words rounded py-2 grow cursor-pointer">Back Matter</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/hytest-org/hytest" title="GitHub Repository: hytest-org/hytest" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/hytest-org/hytest/edit/main/evaluation/tutorials/streamflow/01_Data_Prep.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Streamflow Eval :: Data Preparation</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="iHC4cCPHyG" class="myst-jp-nb-block relative group/block"><p>As a part of the generalized evaluation workflow:</p><img id="nCe8P8Ckzg" style="width:600px;margin-left:auto;margin-right:auto" src="/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg" data-canonical-url="../../../doc/assets/Eval_PreProc.svg" class=""/><p>The pre-processing step is needed in order to align the two datasets for analysis.  The specific
steps needed to prepare a given dataset may differ, depending on the source and the variable of
interest.</p><p>Some steps might include:</p><ul><li><p>Organizing the time-series index such that the time steps for both simulated and observed are congruent</p><ul><li><p>This may involve interpolation to estimate a more granular time-step than is found in the source data</p></li><li><p>More often, an agregating function is used to ‘down-sample’ the dataset to a coarser time step (days vs hours).</p></li></ul></li><li><p>Coordinate aggregation units between simulated and observed</p><ul><li><p>Gridded data may be sampled per HUC-12, HUC-6, etc. to match modeled data indexed by these units.</p></li><li><p>Index formats may be adjusted (e.g. a ‘gage_id’ may be ‘USGS-01104200’ in one data set, vs ‘01104200’ in another)</p></li></ul></li><li><p>Re-Chunking the data to make time-series analysis more efficient (see <a target="_blank" rel="noreferrer" href="../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb" class="">here</a> for a primer on re-chunking).</p></li></ul><h2 id="streamflow-data-prep" class="relative group"><span class="heading-text">Streamflow Data Prep</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#streamflow-data-prep" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This document shows one approach to preparing the <em>streamflow</em> data for subsequent analysis (That analysis is outlined <a class="" href="/hytest//evaluation/tutorials/streamflow/analysis-stdsuite">here</a>).</p><p>Streamflow analysis will compare time-series of two aligned datasets:</p><ul><li><p>‘observed’ data values obtained from <a target="_blank" rel="noreferrer" href="https://nwis.waterdata.usgs.gov/nwis" class="">NWIS</a></p></li><li><p>‘modeled’ data extracted from the <a target="_blank" rel="noreferrer" href="https://registry.opendata.aws/nwm-archive/" class="">NWM</a></p></li></ul><p>These data soruces are accessed using different methods.  We will pull data from their respective sources, reshape and optimize the data structures, then write that data to storage to make later analysis easier.</p><p>An overview of the steps we will take in this notebook:</p><ol start="1"><li><p>Read Modeled Data</p></li><li><p>Establish AWS Credentials</p></li><li><p>Source NWIS data via API</p></li><li><p>Create a plan to Re-Structure that data for storage as ZARR file on S3.</p><ul><li><p>Rename variables</p></li><li><p>Establish chunking layout</p></li><li><p>Establish encoding</p></li><li><p>Create a template to formalize this configuration</p></li></ul></li><li><p>In Parallel (one worker per gage_id):</p><ul><li><p>Fetch data from NWIS</p></li><li><p>Write data to ZARR file</p></li></ul></li><li><p>Verify the data is correctly written to ZARR storage.</p></li></ol></div><div id="EwAeXqLJ58" class="myst-jp-nb-block relative group/block"><h2 id="id-1-reading-the-modeled-data" class="relative group"><span class="heading-text">1) Reading the ‘modeled’ Data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-reading-the-modeled-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Modeled data for this demonstration tutorial will be sourced from the S3 bucket <code>nhgf-development</code>.</p></div><div id="OxmQfi9aec" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
# Needed when boto3 &gt;= 1.36.0 or the rechunking process will fail
# This needs to be set before the boto3 library gets loaded
# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168
os.environ[&#x27;AWS_REQUEST_CHECKSUM_CALCULATION&#x27;] = &#x27;when_required&#x27;
os.environ[&#x27;AWS_RESPONSE_CHECKSUM_VALIDATION&#x27;] = &#x27;when_required&#x27;
os.environ[&#x27;USE_PYGEOS&#x27;] = &#x27;0&#x27;
import fsspec
import dask
import numpy as np
import xarray as xr
import intake
from getpass import getuser
username = getuser()
from dask_gateway import Gateway</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vXZOsoaGzonNYVzoqG8Nl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mFi9o76obE" class="myst-jp-nb-block relative group/block"><p>Modeled data is within the HyTEST <code>intake</code> catalog, with name “nwm21-streamflow-usgs-gages-osn”:</p></div><div id="nTqhXrLop5" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cat = intake.open_catalog(r&#x27;https://raw.githubusercontent.com/hytest-org/hytest/main/dataset_catalog/hytest_intake_catalog.yml&#x27;)

modeled = cat[&#x27;nwm21-streamflow-usgs-gages-osn&#x27;].to_dask()

modeled</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="l7FOabwGK40AEgS3dNJBj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CqItAAeqAO" class="myst-jp-nb-block relative group/block"><p><strong>Source Data as Template</strong></p><p>This source data set will establish the indices and boundaries for the data we will eventually pull from the NWIS stream gage network.
The two dimensions of this data are the <strong>Gage ID</strong> and <strong>Time</strong>.  We’ll use these dimensions to fetch the ‘observed’ data later. The
endpoints and range of these dimensions will establish that future query.</p></div><div id="gR7QLnBBPY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Gage IDs
import re
_gages = [gage_id.lstrip() for gage_id in modeled[&#x27;gage_id&#x27;].values.astype(&#x27;str&#x27;)]

GAGES = [g for g in _gages if re.search(&#x27;USGS-\d+$&#x27;, g) ][0:100] 
#                                                        ^^^^^^^ See NOTES:

## &gt;&gt; NOTE 1: The regex search pattern ensures we get legal gage names only
## &gt;&gt; NOTE 2: We are limiting the GAGES array to the first 100 gages for this 
##            demo/tutorial. To run this workflow for the entire set of GAGES, 
##            remove the slice notation [0:100]

# Time boundaries for future queries:
start_time = modeled.time.values.min()
stop_time = modeled.time.values.max()
DATE_RANGE=(start_time, stop_time)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Z_ehNlTJYSlfuQJqQUURm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="M7TYzG0znZ" class="myst-jp-nb-block relative group/block"><p>Some important notes for each of those bounds:</p><ul><li><p><strong>GAGES</strong> / Gage IDs :: The list of 7994 gage IDs in the model dataset include some values which the NWIS does not
recognize and will not accept. We need to remove them.</p><ul><li><p>Gage IDs of the form <code>USGS-\d+</code> (A string starting ‘USGS-’ and ending in an arbitrary number of digits)
are processed by NWIS data requests.</p></li><li><p>There are roughly 350 gage IDs in the modeled dataset with letters embedded in the string of digits after the ‘USGS-’. These
will be rejected by the API when we try to call NWIS data service to obtain streamflow history for that location.</p></li><li><p>This is the reason behind the regular expression search (<code>re.search</code>) to select only gage_id of the correct format.</p></li><li><p>After selecting the NWIS-compliant gage IDs, the <code>GAGES</code> list contains 7647 gages. This tutorial will demonstrate
the workflow using only the first 100 gages on that list. If you want to process the whole list, remove the slice notation
as described in the comments above.</p></li></ul></li><li><p><strong>DATE_RANGE</strong> / Dates :: This defines the temporal range for the historical data will will fetch from NWIS.</p><ul><li><p>The NWM modeled data includes time values stepped hourly.</p></li><li><p>The historical streamflow data is stepped daily.</p></li><li><p>We will resample later to make sure the indices match.</p></li></ul></li></ul></div><div id="bO1CFDLaCW" class="myst-jp-nb-block relative group/block"><h2 id="id-2-establish-aws-credentials" class="relative group"><span class="heading-text">2) Establish AWS Credentials</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-establish-aws-credentials" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Now that we’ve got a handle on the ‘modeled’ data, we can begin to think about the matching ‘observed’
data.  But before we do that, let’s establish credentials for working with our compute environment. Doing
this now will streamline future I/O and cluster tasks.</p></div><div id="zqAHsMprdt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># uncomment the lines below to read in your AWS credentials if you want to access data from a requester-pays bucket (-cloud)
os.environ[&#x27;AWS_PROFILE&#x27;] = &#x27;osn-hytest-scratch&#x27;
%run ../../../environment_set_up/Help_AWS_Credentials.ipynb</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="6jMfTVN2oiIcqX17v3vZr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="c1iJo4YIoR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># With credentials established, instantiate a handle for the writable file system
fs_write = fsspec.filesystem(&#x27;s3&#x27;, 
                         anon=False, # force a consult to environment vars set above.
                         profile=&#x27;osn-hytest-scratch&#x27;,
                         skip_instance_cache=True, 
                         client_kwargs={&#x27;endpoint_url&#x27;: &#x27;https://usgs.osn.mghpcc.org&#x27;}
                        )

fname=f&#x27;s3://hytest-scratch/testing/{username}/nwis_out_{username}.zarr&#x27;  #&lt;&lt;&lt;&lt; THIS will be our output location.
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Na8VZhFaX9sAy2e_GDGUy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="wD1i2TnVl1" class="myst-jp-nb-block relative group/block"><h2 id="id-3-sourcing-the-observed-data" class="relative group"><span class="heading-text">3) Sourcing the ‘observed’ data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-sourcing-the-observed-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Now that we have information about the list of gages and the date range covered by the model, we
can use that to query NWIS for matching data points for this same range of dates and station IDs.
Because NWIS data is structured a little differently than the modeled streamflow, we’ll need to
re-arrange the data a little after fetching.</p><p>In addition, a call to NWIS for historical data can be time consuming -- and we will do it roughly
7500 times.  We will eventually set up a mechanism to do these requests in parallel, once we’ve
established how the data restructuring should happen.</p><p>The first step in that process is to make a NWIS request for just a couple of gages to see how
the return data is structured.  We’ll use that information to create the plan by which the full
dataset is to be fetched and reorganized.</p></div><div id="BOX3CIqjl3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from pygeohydro import NWIS
nwis = NWIS()
## Fetch data for a couple of gages to see how NWIS formats a response
observed = nwis.get_streamflow(GAGES[0:2], DATE_RANGE, to_xarray=True) 
    ## get_streamflow() is an API call to a data server via internet.
observed</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="sQjOEXCf8lfD9uDHWPH6q" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iTECGyQie4" class="myst-jp-nb-block relative group/block"><h2 id="id-4-examine-the-response-data-make-a-plan" class="relative group"><span class="heading-text">4) Examine the Response Data -- Make a plan</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-examine-the-response-data-make-a-plan" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Our goal is to use the NWIS service to fetch data for a large number of gages, then assemble that
into a dataset that is structured similarly to our modeled data.</p><p>We requested two stream gages from NWIS rather than just one, to ensure that the dataset is multi-dimensional
(as the final dataset will be). Using what we learned from the above NWIS call, we can make a plan
for how to match it to the existing modeled data.  A few considerations:</p><ul><li><p>We’ll need to rename some variables (i.e. ‘<em>discharge</em>’ --&gt; ‘<em>streamflow</em>’, etc).</p></li><li><p>We also need
to make note of which data variables are strings, but perhaps stored with different encodings.</p></li><li><p>Because the composite dataset will be quite large, some care should be taken to chunk it such that it performs well
for time-series analysis.</p></li></ul><aside class="myst-aside myst-aside-${kind} text-sm lg:h-0 col-margin-right"><p>Learn more about chunking <a target="_blank" rel="noreferrer" href="../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb" class="">here</a></p></aside><p>Lastly, we note the time range returned by NWIS.  It covers the time range we requested in
DATE_RAGE, but is stepped daily. We will use this information to interpolate future results.</p></div><div id="fNB5Hmv63g" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Step 4a :  rename variables
observed = (observed
            .rename_dims({&#x27;station_id&#x27;:&#x27;gage_id&#x27;})
            .rename({&#x27;discharge&#x27;:&#x27;streamflow&#x27;, &#x27;station_id&#x27;:&#x27;gage_id&#x27;})
           )
observed</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="LB59CSpCKNMagXOfrQCIn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="aSFNIXpmH4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Step 4b : define chunking in a &#x27;template&#x27; dataset
source_dataset = observed
template = (xr.zeros_like(source_dataset)  # DataSet just like &#x27;observed&#x27;
             .chunk()           
             .isel(gage_id=0, drop=True)      # temporarily remove gage_id as a dimension and coordinate
             .expand_dims(gage_id=len(GAGES), axis=-1) # add it back, reserving space for the full size of GAGES
             .assign_coords({&#x27;gage_id&#x27;: GAGES}) # add coordinate to match dimension
             .chunk({                         # define chunk sizes
                 &#x27;time&#x27;: len(observed.time),  # all time vals in one chunk
                 &#x27;gage_id&#x27;: 1}                # one gage_id per chunk
             )
           )
template</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Vi3zB5o-xti6XQmLoj41P" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="AEscg2wsYr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Step 4c :  Commit template to permanent storage: 
if fs_write.exists(fname):
    print(&quot;Removing old copy of tutorial/demo output...&quot;, end=&quot;&quot;)
    fs_write.rm(fname, recursive=True)
    print(&quot;Done&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="x_lAMlPK9z6Y2CNobNVvs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iRdcg9iJxv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Step 4c (continued): write the template with specific encodings
outfile = fs_write.get_mapper(fname)
template.to_zarr(
    outfile,
    compute=False,
    encoding =  {                                  # encodings sets data types for the disk store
        &#x27;station_nm&#x27;:  dict( _FillValue=None,        dtype=&#x27;&lt;U64&#x27;), 
        &#x27;alt_datum_cd&#x27;:dict( _FillValue=None,        dtype=&#x27;&lt;U6&#x27;),
        &#x27;alt_acy_va&#x27;:  dict( _FillValue=-2147483647, dtype=np.int32),
        &#x27;alt_va&#x27;:      dict( _FillValue=9.96921e+36, dtype=np.float32),
        &#x27;dec_lat_va&#x27;:  dict( _FillValue=None,        dtype=np.float32),
        &#x27;dec_long_va&#x27;: dict( _FillValue=None,        dtype=np.float32),
        &#x27;streamflow&#x27;:  dict( _FillValue=9.96921e+36, dtype=np.float32)
    },
    consolidated=True,                             # Consolidate metadata
    mode=&#x27;w&#x27;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-yUpeM4GgveH6eHObXVsv" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FOKtmescpy" class="myst-jp-nb-block relative group/block"><h2 id="id-5-parallel-processing" class="relative group"><span class="heading-text">5) Parallel Processing</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-parallel-processing" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The above steps were necessary to establish a permanent disk storage space for the output
dataset.  We’ve established its structure (variables, chunking plan, encodings) and also
given a hint as to its size (by asserting the length of the <code>gage_id</code> index to be <code>len(GAGES)</code>
items).</p><p>With that all established, we can now execute a job where each gage’s data is fetched from
NWIS and inserted into the permanent store. This demo is limited (by default) to only 100
gages, so could in theory be executed serially.  We want to do it in parallel so as to model
the process for an arbitrary number of gages.</p></div><div id="h2DPiXqR0r" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Step 5a) : write the &#x27;worker&#x27; function -- this will be called once per gage
# Globals: 
n_timesteps = len(observed.time)
time_steps = observed.time.values

def write_one_gage(n):
    &quot;&quot;&quot; 
    Writes one gage&#x27;s data to the existing zarr file.  Uses the NWIS API call to fetch data.
    
    Arguments: 
    n   : integer
       the index into the GAGES array identifying which gage to fetch and write. 
    &quot;&quot;&quot;
    site_id = GAGES[n]
    try:
        _obs = nwis.get_streamflow(site_id, DATE_RANGE, to_xarray=True).interp(time=time_steps)
        _obs = _obs.rename_dims({&#x27;station_id&#x27;:&#x27;gage_id&#x27;}).rename({&#x27;station_id&#x27;:&#x27;gage_id&#x27;,&#x27;discharge&#x27;:&#x27;streamflow&#x27;})
        ## We must force the returned data into the datatype that we stored to disk. 
        _obs[&#x27;station_nm&#x27;] = xr.DataArray(data=_obs[&#x27;station_nm&#x27;].values.astype(&#x27;&lt;U64&#x27;), dims=&#x27;gage_id&#x27;)
        _obs[&#x27;alt_datum_cd&#x27;] = xr.DataArray(data=_obs[&#x27;alt_datum_cd&#x27;].values.astype(&#x27;&lt;U6&#x27;), dims=&#x27;gage_id&#x27;)
 
        _obs.to_zarr(
            outfile, 
            region={ #&lt;&lt;&lt; Specifying a region lets us &#x27;insert&#x27; data to a specific place in the dataset. 
                &#x27;time&#x27;: slice(0, n_timesteps), 
                &#x27;gage_id&#x27;: slice(n,n+1)
                }
            )
        return n # If success, returns the index into GAGES. 
    except Exception as e: 
        pass
        #return e  # if failure, return the exception thrown.
        # This is an extremely broad way to catch exceptions... and in general is to be avoided. 
        # We do it this way in this case to protect the parallel run. it allows a single write_one_gage() 
        # to fail silently without affecting the rest of the run.
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1sRgpfSSDVadLmbWXVZJh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="vV223ChJBU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Step 5b) Start up a distributed cluster of workers
# NOTE: This cluster configuration is VERY specific to the JupyterHub cloud environment on ESIP/QHUB
%run ../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OcVNLrLuY7fWBcgPIZ3Vq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KoqGhUUlkz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
## Run the list of tasks: 
results = dask.compute(*[dask.delayed(write_one_gage)(i) for i in range(len(GAGES))], retries=10)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="99ZG5wqxeX6Tt67NKDiuD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BImyFFdOp3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Consolidate metadata, to make future reads easier/faster
from zarr.convenience import consolidate_metadata
_ = consolidate_metadata(outfile)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="tykUSzpL_mEz1O3lpx-f0" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hLR45CFiKU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Shut down the cluster
client.close()
cluster.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7CWQU85EoTTkVlf2h4fKW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eQG6w4zT24" class="myst-jp-nb-block relative group/block"><h2 id="id-6-verify" class="relative group"><span class="heading-text">6) Verify</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6-verify" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We can now read the dataset that we just wrote to disk.  Does it have the dimensions, chunking, and encoding that we want?</p></div><div id="WeGkqPp7UA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## fname is already set from above...
outfile=fs_write.get_mapper(fname)
dst = xr.open_dataset(outfile, engine=&#x27;zarr&#x27;, chunks={}, backend_kwargs=dict(consolidated=True))
## NOTE: xarray will employ a &#x27;lazy&#x27; loader; only metadata will be loaded initially.  Will only 
## read real data when it is actually needed for computation. 
dst</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="RXvI4OUO7VXbvqcYLb5Xz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fzuAxARg2R" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import hvplot.xarray

dst.sel(gage_id=&#x27;USGS-07241800&#x27;).hvplot(x=&#x27;time&#x27;,y=&#x27;streamflow&#x27;, grid=True)
## This select operator is a specific call to read data -- so may take a 
## moment to fetch the full time series for the specified gage. </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="2-1E2zAWsbdcgdYjSxY6O" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="dP4FKUYjul" class="myst-jp-nb-block relative group/block"><h2 id="done" class="relative group"><span class="heading-text">DONE</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#done" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>That dataset is now available for future analysis in which we need a consolidated NWIS
dataset, chunked to optimize time-series analysis.</p></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/hytest//evaluation/tutorials/streamflow/overview"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Model Evaluation</div>Streamflow Model Evaluation</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hytest//evaluation/tutorials/streamflow/analysis-stdsuite"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Model Evaluation</div>Streamflow Eval :: StdSuite Analysis</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hytest//build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-N76G4W6Y.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hytest//build/root-AA24SA6C.js"/><link rel="modulepreload" href="/hytest//build/_shared/chunk-AH7OE64W.js"/><link rel="modulepreload" href="/hytest//build/routes/$-5SFLQWPV.js"/><script>window.__remixContext = {"url":"/evaluation/tutorials/streamflow/data-prep","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hytest/"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/hytest//build/HyTEST_Badge-349dca1252221dedec720796e00b5d0f.svg","folders":true},"nav":[],"actions":[],"projects":[{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"56f55b09ab536cc644b4f9bc69e6ed723cb2747d3898b7a85c698b18e726a70b","slug":"evaluation.tutorials.streamflow.data-prep","location":"/evaluation/tutorials/streamflow/01_Data_Prep.ipynb","dependencies":[],"frontmatter":{"title":"Streamflow Eval :: Data Preparation","content_includes_title":false,"github":"https://github.com/hytest-org/hytest","copyright":"2023","numbering":{"title":{"offset":2}},"source_url":"https://github.com/hytest-org/hytest/blob/main/evaluation/tutorials/streamflow/01_Data_Prep.ipynb","edit_url":"https://github.com/hytest-org/hytest/edit/main/evaluation/tutorials/streamflow/01_Data_Prep.ipynb","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","exports":[{"format":"ipynb","filename":"01_Data_Prep.ipynb","url":"/hytest//build/01_Data_Prep-04102660019715af0dbc685e23fe8906.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As a part of the generalized evaluation workflow:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XOMxGQNRlg"}],"key":"NMdyITE55s"},{"type":"image","url":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","width":600,"key":"nCe8P8Ckzg","urlSource":"../../../doc/assets/Eval_PreProc.svg"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The pre-processing step is needed in order to align the two datasets for analysis.  The specific\nsteps needed to prepare a given dataset may differ, depending on the source and the variable of\ninterest.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"g9Bl5lTAPd"}],"key":"a6xxBbSgVQ"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Some steps might include:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ulthDKi1bk"}],"key":"C4M6tgz1mA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Organizing the time-series index such that the time steps for both simulated and observed are congruent","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"cXOhokhgYr"}],"key":"ybSKCoLc7N"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This may involve interpolation to estimate a more granular time-step than is found in the source data","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"butFHlR273"}],"key":"Tr7hBFx2EC"}],"key":"BCy6wEBBmF"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"More often, an agregating function is used to ‘down-sample’ the dataset to a coarser time step (days vs hours).","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ctjGkbIKKe"}],"key":"YpR6BQTR1u"}],"key":"iLpCqJv955"}],"key":"OZXsJ8vyUD"}],"key":"F1QDuFACE1"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Coordinate aggregation units between simulated and observed","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"LRlXWTXlpp"}],"key":"F1xX8jL9Xf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Gridded data may be sampled per HUC-12, HUC-6, etc. to match modeled data indexed by these units.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"LudWKkc0r1"}],"key":"zrd3IFk2Rd"}],"key":"JDdG0ytNfy"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Index formats may be adjusted (e.g. a ‘gage_id’ may be ‘USGS-01104200’ in one data set, vs ‘01104200’ in another)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"FxpvKJ3M6p"}],"key":"lIv1qOVX6Z"}],"key":"JsDCp5P8o0"}],"key":"tMf1Oo34Eu"}],"key":"ZIGHhQNeZN"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Re-Chunking the data to make time-series analysis more efficient (see ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ntx1UoZ6C7"},{"type":"link","url":"../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"E87QpCPn3J"}],"urlSource":"../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb","key":"sjWM8D2Jz3"},{"type":"text","value":" for a primer on re-chunking).","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"QvilTeOHsD"}],"key":"mECNgGUurc"}],"key":"XW1ed5mxgl"}],"key":"O8Pu2fQKyc"},{"type":"heading","depth":2,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Streamflow Data Prep","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"pCgPIUgasv"}],"identifier":"streamflow-data-prep","label":"Streamflow Data Prep","html_id":"streamflow-data-prep","implicit":true,"key":"zsGBTUCDaU"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"This document shows one approach to preparing the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ILXri50clc"},{"type":"emphasis","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"streamflow","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"WG0vrTY9Mp"}],"key":"RZCnYyhZvo"},{"type":"text","value":" data for subsequent analysis (That analysis is outlined ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Vo1NrngVv6"},{"type":"link","url":"/evaluation/tutorials/streamflow/analysis-stdsuite","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"eizjRzIJf8"}],"urlSource":"02_Analysis_StdSuite.ipynb","dataUrl":"/evaluation.tutorials.streamflow.analysis-stdsuite.json","internal":true,"protocol":"file","key":"lXB6SFIK93"},{"type":"text","value":").","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"rpM9kU1BFk"}],"key":"AWEhbvE69R"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Streamflow analysis will compare time-series of two aligned datasets:","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"TsQDZx4rue"}],"key":"cHSbB0c546"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"‘observed’ data values obtained from ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Iw1zlyTK5Y"},{"type":"link","url":"https://nwis.waterdata.usgs.gov/nwis","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"NWIS","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"KyLTTMq3AT"}],"urlSource":"https://nwis.waterdata.usgs.gov/nwis","key":"srMNA12mEm"}],"key":"R028y4T0OL"}],"key":"xgki7ttJ7h"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"‘modeled’ data extracted from the ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"zPrpuqYeyu"},{"type":"link","url":"https://registry.opendata.aws/nwm-archive/","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"NWM","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"K4x6WPA0JY"}],"urlSource":"https://registry.opendata.aws/nwm-archive/","key":"h8f8wvbFYN"}],"key":"wwHSUBL6jG"}],"key":"Dyhiidns7U"}],"key":"dFNHgN8PC1"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"These data soruces are accessed using different methods.  We will pull data from their respective sources, reshape and optimize the data structures, then write that data to storage to make later analysis easier.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"djgqF68EQU"}],"key":"jUkbXqZc2V"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"An overview of the steps we will take in this notebook:","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"cANCg3dMFz"}],"key":"PzqnLTYbZH"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":32,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Read Modeled Data","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"lN3Ns3OFi4"}],"key":"Q09TX1Rv3i"}],"key":"AcAbgHLHOd"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Establish AWS Credentials","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"CdMupVIH05"}],"key":"MIi7Xzotum"}],"key":"XcsXhEDFYj"},{"type":"listItem","spread":true,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Source NWIS data via API","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"ow7i7pgnmh"}],"key":"FFkwjytUuS"}],"key":"PRRzdvVwHF"},{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a plan to Re-Structure that data for storage as ZARR file on S3.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"KgZ9ugqGk4"}],"key":"H9nckESbkg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Rename variables","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"WJMRJigA8Q"}],"key":"WeFMyJG35Q"}],"key":"GI0FFTOy63"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Establish chunking layout","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"afUPenQVWa"}],"key":"ih6GfaeQyi"}],"key":"F6G1RFr8Yk"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Establish encoding","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Vb5t4SNVu6"}],"key":"t0iiykEDSY"}],"key":"cjLVC44j63"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a template to formalize this configuration","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"Y1oVXOskYf"}],"key":"OSxhNLudaJ"}],"key":"AsD9Ti7OaX"}],"key":"RgRVKyvuj9"}],"key":"A5dSFrsT7b"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In Parallel (one worker per gage_id):","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"w7U2ysUabh"}],"key":"ZSQwR1fgtm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Fetch data from NWIS","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"JFVOgebCR2"}],"key":"gfIHDCEhsm"}],"key":"sxt5lRyvCS"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Write data to ZARR file","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"TBLpJLzdfZ"}],"key":"khMHQJBBoO"}],"key":"NgQAeQG01u"}],"key":"rUEvMpRJlg"}],"key":"Y6Ern4CbuT"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Verify the data is correctly written to ZARR storage.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"dsB9sK1Jd3"}],"key":"LSpVf5v9g8"}],"key":"PG91mmXwnv"}],"key":"X1OMMtv006"}],"key":"iHC4cCPHyG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1) Reading the ‘modeled’ Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MtC4pH98r6"}],"identifier":"id-1-reading-the-modeled-data","label":"1) Reading the ‘modeled’ Data","html_id":"id-1-reading-the-modeled-data","implicit":true,"key":"hnaOrvDZn7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Modeled data for this demonstration tutorial will be sourced from the S3 bucket ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"X8TmGfZf3h"},{"type":"inlineCode","value":"nhgf-development","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iMLqT8yFZ7"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sXmtVk5JoE"}],"key":"qsLIWa02mv"}],"key":"EwAeXqLJ58"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\n# Needed when boto3 \u003e= 1.36.0 or the rechunking process will fail\n# This needs to be set before the boto3 library gets loaded\n# See: https://github.com/aws/aws-cli/issues/9214#issuecomment-2606619168\nos.environ['AWS_REQUEST_CHECKSUM_CALCULATION'] = 'when_required'\nos.environ['AWS_RESPONSE_CHECKSUM_VALIDATION'] = 'when_required'\nos.environ['USE_PYGEOS'] = '0'\nimport fsspec\nimport dask\nimport numpy as np\nimport xarray as xr\nimport intake\nfrom getpass import getuser\nusername = getuser()\nfrom dask_gateway import Gateway","key":"mx5jLCXqTR"},{"type":"outputs","id":"vXZOsoaGzonNYVzoqG8Nl","children":[],"key":"jDLTCzIZNB"}],"key":"OxmQfi9aec"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modeled data is within the HyTEST ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HvZsY1iCKr"},{"type":"inlineCode","value":"intake","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EgsICCk9ag"},{"type":"text","value":" catalog, with name “nwm21-streamflow-usgs-gages-osn”:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TnxQrrteqh"}],"key":"djPDoMsOKO"}],"key":"mFi9o76obE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat = intake.open_catalog(r'https://raw.githubusercontent.com/hytest-org/hytest/main/dataset_catalog/hytest_intake_catalog.yml')\n\nmodeled = cat['nwm21-streamflow-usgs-gages-osn'].to_dask()\n\nmodeled","key":"QRjlcP40w4"},{"type":"outputs","id":"l7FOabwGK40AEgS3dNJBj","children":[],"key":"MWZqcPzBZe"}],"key":"nTqhXrLop5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Source Data as Template","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RsTx2jQkvl"}],"key":"Ttfcd3H8rs"}],"key":"Kd8SL2K5OC"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This source data set will establish the indices and boundaries for the data we will eventually pull from the NWIS stream gage network.\nThe two dimensions of this data are the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"pPv2wB8FhS"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Gage ID","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Qa7Ryb7Mm5"}],"key":"bhfDWIooRC"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fmHKmXtHII"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Time","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"g7bhciBXYz"}],"key":"Y8ntugHQvJ"},{"type":"text","value":".  We’ll use these dimensions to fetch the ‘observed’ data later. The\nendpoints and range of these dimensions will establish that future query.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"f8pY4TdzL5"}],"key":"sPJ52wpmg4"}],"key":"CqItAAeqAO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Gage IDs\nimport re\n_gages = [gage_id.lstrip() for gage_id in modeled['gage_id'].values.astype('str')]\n\nGAGES = [g for g in _gages if re.search('USGS-\\d+$', g) ][0:100] \n#                                                        ^^^^^^^ See NOTES:\n\n## \u003e\u003e NOTE 1: The regex search pattern ensures we get legal gage names only\n## \u003e\u003e NOTE 2: We are limiting the GAGES array to the first 100 gages for this \n##            demo/tutorial. To run this workflow for the entire set of GAGES, \n##            remove the slice notation [0:100]\n\n# Time boundaries for future queries:\nstart_time = modeled.time.values.min()\nstop_time = modeled.time.values.max()\nDATE_RANGE=(start_time, stop_time)","key":"Hm6oCa7QqH"},{"type":"outputs","id":"Z_ehNlTJYSlfuQJqQUURm","children":[],"key":"AZCwIHo2KA"}],"key":"gR7QLnBBPY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Some important notes for each of those bounds:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DToEqFV6mE"}],"key":"pUGlQcYFfU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"GAGES","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ATtyWIQWsb"}],"key":"gjECNaHK0N"},{"type":"text","value":" / Gage IDs :: The list of 7994 gage IDs in the model dataset include some values which the NWIS does not\nrecognize and will not accept. We need to remove them.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"W7k400OXpe"}],"key":"JPL9VsGUIv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Gage IDs of the form ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PCqk3A9D33"},{"type":"inlineCode","value":"USGS-\\d+","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EsU3TusW7E"},{"type":"text","value":" (A string starting ‘USGS-’ and ending in an arbitrary number of digits)\nare processed by NWIS data requests.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zdygA9IrgF"}],"key":"adPTILBAW2"}],"key":"aIWkbHeNHa"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"There are roughly 350 gage IDs in the modeled dataset with letters embedded in the string of digits after the ‘USGS-’. These\nwill be rejected by the API when we try to call NWIS data service to obtain streamflow history for that location.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"bocIb8w3s4"}],"key":"JU8tnyKIKB"}],"key":"dSPaBIPX9Q"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This is the reason behind the regular expression search (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TQKKoISrZX"},{"type":"inlineCode","value":"re.search","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"VZfFmYfY9S"},{"type":"text","value":") to select only gage_id of the correct format.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"buTAD78oE9"}],"key":"R1wynp7x0Y"}],"key":"gRF9f4p3cO"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"After selecting the NWIS-compliant gage IDs, the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EgVp9vYuYR"},{"type":"inlineCode","value":"GAGES","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"c2etS7TMBl"},{"type":"text","value":" list contains 7647 gages. This tutorial will demonstrate\nthe workflow using only the first 100 gages on that list. If you want to process the whole list, remove the slice notation\nas described in the comments above.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zIdDsl9r6t"}],"key":"dDxCR8JgAm"}],"key":"pJ91i0zfMO"}],"key":"tCQ8kDKUtU"}],"key":"d3p106jZvM"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"DATE_RANGE","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VphRxC023Q"}],"key":"OG7d4qntHY"},{"type":"text","value":" / Dates :: This defines the temporal range for the historical data will will fetch from NWIS.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"LhoQZK6xEf"}],"key":"ZP3iiAgoah"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The NWM modeled data includes time values stepped hourly.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"eyUupVBYoL"}],"key":"k4EA0UP4mz"}],"key":"BMumJR1Dp4"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The historical streamflow data is stepped daily.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"PcEhbg2mKY"}],"key":"ptWlLvalJt"}],"key":"Hc8dkkhMTs"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We will resample later to make sure the indices match.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"eilpiN85Ng"}],"key":"oI53OKTYHO"}],"key":"cigLhn5lni"}],"key":"zgjMmsxFlf"}],"key":"kxU3tMgU6T"}],"key":"QFs13xM9Yu"}],"key":"M7TYzG0znZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2) Establish AWS Credentials","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dOoZO24nOF"}],"identifier":"id-2-establish-aws-credentials","label":"2) Establish AWS Credentials","html_id":"id-2-establish-aws-credentials","implicit":true,"key":"HQO62o0BXL"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Now that we’ve got a handle on the ‘modeled’ data, we can begin to think about the matching ‘observed’\ndata.  But before we do that, let’s establish credentials for working with our compute environment. Doing\nthis now will streamline future I/O and cluster tasks.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JTwW192pWe"}],"key":"Wm1MiuTnFT"}],"key":"bO1CFDLaCW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# uncomment the lines below to read in your AWS credentials if you want to access data from a requester-pays bucket (-cloud)\nos.environ['AWS_PROFILE'] = 'osn-hytest-scratch'\n%run ../../../environment_set_up/Help_AWS_Credentials.ipynb","key":"jDd7B4EIwU"},{"type":"outputs","id":"6jMfTVN2oiIcqX17v3vZr","children":[],"key":"HZrd0uwvhc"}],"key":"zqAHsMprdt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# With credentials established, instantiate a handle for the writable file system\nfs_write = fsspec.filesystem('s3', \n                         anon=False, # force a consult to environment vars set above.\n                         profile='osn-hytest-scratch',\n                         skip_instance_cache=True, \n                         client_kwargs={'endpoint_url': 'https://usgs.osn.mghpcc.org'}\n                        )\n\nfname=f's3://hytest-scratch/testing/{username}/nwis_out_{username}.zarr'  #\u003c\u003c\u003c\u003c THIS will be our output location.\n","key":"Nxdy3G4K9f"},{"type":"outputs","id":"Na8VZhFaX9sAy2e_GDGUy","children":[],"key":"hcxGVkYMjz"}],"key":"c1iJo4YIoR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3) Sourcing the ‘observed’ data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A25Ocw1sNE"}],"identifier":"id-3-sourcing-the-observed-data","label":"3) Sourcing the ‘observed’ data","html_id":"id-3-sourcing-the-observed-data","implicit":true,"key":"ksuFe9dwmA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Now that we have information about the list of gages and the date range covered by the model, we\ncan use that to query NWIS for matching data points for this same range of dates and station IDs.\nBecause NWIS data is structured a little differently than the modeled streamflow, we’ll need to\nre-arrange the data a little after fetching.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kYj1oXHrd9"}],"key":"wSxlXUODXJ"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"In addition, a call to NWIS for historical data can be time consuming -- and we will do it roughly\n7500 times.  We will eventually set up a mechanism to do these requests in parallel, once we’ve\nestablished how the data restructuring should happen.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wkHWH1ZtAU"}],"key":"tknkGdgyoI"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"The first step in that process is to make a NWIS request for just a couple of gages to see how\nthe return data is structured.  We’ll use that information to create the plan by which the full\ndataset is to be fetched and reorganized.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"SSBnNN0roJ"}],"key":"GHwNrBDP0K"}],"key":"wD1i2TnVl1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pygeohydro import NWIS\nnwis = NWIS()\n## Fetch data for a couple of gages to see how NWIS formats a response\nobserved = nwis.get_streamflow(GAGES[0:2], DATE_RANGE, to_xarray=True) \n    ## get_streamflow() is an API call to a data server via internet.\nobserved","key":"gVg05utcws"},{"type":"outputs","id":"sQjOEXCf8lfD9uDHWPH6q","children":[],"key":"rD9yuqUAPp"}],"key":"BOX3CIqjl3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4) Examine the Response Data -- Make a plan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"riihJJYTyF"}],"identifier":"id-4-examine-the-response-data-make-a-plan","label":"4) Examine the Response Data -- Make a plan","html_id":"id-4-examine-the-response-data-make-a-plan","implicit":true,"key":"n58fr50BZj"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Our goal is to use the NWIS service to fetch data for a large number of gages, then assemble that\ninto a dataset that is structured similarly to our modeled data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nEKDrmubln"}],"key":"JWrMn5eUAl"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We requested two stream gages from NWIS rather than just one, to ensure that the dataset is multi-dimensional\n(as the final dataset will be). Using what we learned from the above NWIS call, we can make a plan\nfor how to match it to the existing modeled data.  A few considerations:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"erUf0v0ogb"}],"key":"vIMraBWBVS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We’ll need to rename some variables (i.e. ‘","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"dumhXPlUP7"},{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"discharge","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"yxUNEr9LrV"}],"key":"TUgQCPJaoq"},{"type":"text","value":"’ --\u003e ‘","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qUhjNMZ91j"},{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"streamflow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Lbqfw4akft"}],"key":"NlPjMvThaF"},{"type":"text","value":"’, etc).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"msa8BKaArP"}],"key":"iUrFZR5xQe"}],"key":"wxbHlFyKwr"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We also need\nto make note of which data variables are strings, but perhaps stored with different encodings.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"R79e07l7C2"}],"key":"WAOlMwOPnP"}],"key":"AWk9o9jPfN"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Because the composite dataset will be quite large, some care should be taken to chunk it such that it performs well\nfor time-series analysis.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hugZuaPrnv"}],"key":"R8FiwxVEmK"}],"key":"lnQblg7FeN"}],"key":"MhDjO0PkK3"},{"type":"aside","children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Learn more about chunking ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"SxJ2z5Ae03"},{"type":"link","url":"../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"NXRHhmFrtm"}],"urlSource":"../../../dataset_processing/tutorials/rechunking/ReChunkingData.ipynb","key":"B5F2SYjCjh"}],"key":"t4AzB9rQwl"}],"key":"RIXIyU5ZRs"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Lastly, we note the time range returned by NWIS.  It covers the time range we requested in\nDATE_RAGE, but is stepped daily. We will use this information to interpolate future results.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"xtlUB3y38z"}],"key":"Pb1R4gAFwt"}],"key":"iTECGyQie4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Step 4a :  rename variables\nobserved = (observed\n            .rename_dims({'station_id':'gage_id'})\n            .rename({'discharge':'streamflow', 'station_id':'gage_id'})\n           )\nobserved","key":"nXqyQYYoJT"},{"type":"outputs","id":"LB59CSpCKNMagXOfrQCIn","children":[],"key":"scMgiQftla"}],"key":"fNB5Hmv63g"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Step 4b : define chunking in a 'template' dataset\nsource_dataset = observed\ntemplate = (xr.zeros_like(source_dataset)  # DataSet just like 'observed'\n             .chunk()           \n             .isel(gage_id=0, drop=True)      # temporarily remove gage_id as a dimension and coordinate\n             .expand_dims(gage_id=len(GAGES), axis=-1) # add it back, reserving space for the full size of GAGES\n             .assign_coords({'gage_id': GAGES}) # add coordinate to match dimension\n             .chunk({                         # define chunk sizes\n                 'time': len(observed.time),  # all time vals in one chunk\n                 'gage_id': 1}                # one gage_id per chunk\n             )\n           )\ntemplate","key":"kQpjwS2Jmy"},{"type":"outputs","id":"Vi3zB5o-xti6XQmLoj41P","children":[],"key":"s7FGhduNkx"}],"key":"aSFNIXpmH4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Step 4c :  Commit template to permanent storage: \nif fs_write.exists(fname):\n    print(\"Removing old copy of tutorial/demo output...\", end=\"\")\n    fs_write.rm(fname, recursive=True)\n    print(\"Done\")","key":"mJZlQ8IzRr"},{"type":"outputs","id":"x_lAMlPK9z6Y2CNobNVvs","children":[],"key":"lQxzrG4viR"}],"key":"AEscg2wsYr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Step 4c (continued): write the template with specific encodings\noutfile = fs_write.get_mapper(fname)\ntemplate.to_zarr(\n    outfile,\n    compute=False,\n    encoding =  {                                  # encodings sets data types for the disk store\n        'station_nm':  dict( _FillValue=None,        dtype='\u003cU64'), \n        'alt_datum_cd':dict( _FillValue=None,        dtype='\u003cU6'),\n        'alt_acy_va':  dict( _FillValue=-2147483647, dtype=np.int32),\n        'alt_va':      dict( _FillValue=9.96921e+36, dtype=np.float32),\n        'dec_lat_va':  dict( _FillValue=None,        dtype=np.float32),\n        'dec_long_va': dict( _FillValue=None,        dtype=np.float32),\n        'streamflow':  dict( _FillValue=9.96921e+36, dtype=np.float32)\n    },\n    consolidated=True,                             # Consolidate metadata\n    mode='w'\n)","key":"g5pwU8iXnp"},{"type":"outputs","id":"-yUpeM4GgveH6eHObXVsv","children":[],"key":"xQvOeva1EL"}],"key":"iRdcg9iJxv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5) Parallel Processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PmJDH1ov9A"}],"identifier":"id-5-parallel-processing","label":"5) Parallel Processing","html_id":"id-5-parallel-processing","implicit":true,"key":"lFed4cLVYh"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The above steps were necessary to establish a permanent disk storage space for the output\ndataset.  We’ve established its structure (variables, chunking plan, encodings) and also\ngiven a hint as to its size (by asserting the length of the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NOfFKv7k8h"},{"type":"inlineCode","value":"gage_id","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JgfWMFNDuk"},{"type":"text","value":" index to be ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p6sy2vFSqw"},{"type":"inlineCode","value":"len(GAGES)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VZfQ3q1cVf"},{"type":"text","value":"\nitems).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Fu1xVwuqUX"}],"key":"YZtomvXDhs"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"With that all established, we can now execute a job where each gage’s data is fetched from\nNWIS and inserted into the permanent store. This demo is limited (by default) to only 100\ngages, so could in theory be executed serially.  We want to do it in parallel so as to model\nthe process for an arbitrary number of gages.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cZaYtHAhRg"}],"key":"bs20O787Sm"}],"key":"FOKtmescpy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Step 5a) : write the 'worker' function -- this will be called once per gage\n# Globals: \nn_timesteps = len(observed.time)\ntime_steps = observed.time.values\n\ndef write_one_gage(n):\n    \"\"\" \n    Writes one gage's data to the existing zarr file.  Uses the NWIS API call to fetch data.\n    \n    Arguments: \n    n   : integer\n       the index into the GAGES array identifying which gage to fetch and write. \n    \"\"\"\n    site_id = GAGES[n]\n    try:\n        _obs = nwis.get_streamflow(site_id, DATE_RANGE, to_xarray=True).interp(time=time_steps)\n        _obs = _obs.rename_dims({'station_id':'gage_id'}).rename({'station_id':'gage_id','discharge':'streamflow'})\n        ## We must force the returned data into the datatype that we stored to disk. \n        _obs['station_nm'] = xr.DataArray(data=_obs['station_nm'].values.astype('\u003cU64'), dims='gage_id')\n        _obs['alt_datum_cd'] = xr.DataArray(data=_obs['alt_datum_cd'].values.astype('\u003cU6'), dims='gage_id')\n \n        _obs.to_zarr(\n            outfile, \n            region={ #\u003c\u003c\u003c Specifying a region lets us 'insert' data to a specific place in the dataset. \n                'time': slice(0, n_timesteps), \n                'gage_id': slice(n,n+1)\n                }\n            )\n        return n # If success, returns the index into GAGES. \n    except Exception as e: \n        pass\n        #return e  # if failure, return the exception thrown.\n        # This is an extremely broad way to catch exceptions... and in general is to be avoided. \n        # We do it this way in this case to protect the parallel run. it allows a single write_one_gage() \n        # to fail silently without affecting the rest of the run.\n","key":"GxeiNml0LA"},{"type":"outputs","id":"1sRgpfSSDVadLmbWXVZJh","children":[],"key":"iqxqrNYvQE"}],"key":"h2DPiXqR0r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Step 5b) Start up a distributed cluster of workers\n# NOTE: This cluster configuration is VERY specific to the JupyterHub cloud environment on ESIP/QHUB\n%run ../../../environment_set_up/Start_Dask_Cluster_Nebari.ipynb","key":"xtizhkWLBN"},{"type":"outputs","id":"OcVNLrLuY7fWBcgPIZ3Vq","children":[],"key":"zOswYvcP92"}],"key":"vV223ChJBU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n## Run the list of tasks: \nresults = dask.compute(*[dask.delayed(write_one_gage)(i) for i in range(len(GAGES))], retries=10)","key":"jXETHfmqWB"},{"type":"outputs","id":"99ZG5wqxeX6Tt67NKDiuD","children":[],"key":"GhqTENgNDe"}],"key":"KoqGhUUlkz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Consolidate metadata, to make future reads easier/faster\nfrom zarr.convenience import consolidate_metadata\n_ = consolidate_metadata(outfile)","key":"yprQKqL1pF"},{"type":"outputs","id":"tykUSzpL_mEz1O3lpx-f0","children":[],"key":"rDxFfgpqae"}],"key":"BImyFFdOp3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Shut down the cluster\nclient.close()\ncluster.close()","key":"iXa78jzIro"},{"type":"outputs","id":"7CWQU85EoTTkVlf2h4fKW","children":[],"key":"npMPVt8kqg"}],"key":"hLR45CFiKU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6) Verify","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OM5UYvkWNV"}],"identifier":"id-6-verify","label":"6) Verify","html_id":"id-6-verify","implicit":true,"key":"h1bHpZpVOI"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We can now read the dataset that we just wrote to disk.  Does it have the dimensions, chunking, and encoding that we want?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DJn3kZZ9Gx"}],"key":"vhy1XiVyM3"}],"key":"eQG6w4zT24"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## fname is already set from above...\noutfile=fs_write.get_mapper(fname)\ndst = xr.open_dataset(outfile, engine='zarr', chunks={}, backend_kwargs=dict(consolidated=True))\n## NOTE: xarray will employ a 'lazy' loader; only metadata will be loaded initially.  Will only \n## read real data when it is actually needed for computation. \ndst","key":"S5QXjRdzIb"},{"type":"outputs","id":"RXvI4OUO7VXbvqcYLb5Xz","children":[],"key":"PuhntZvkxb"}],"key":"WeGkqPp7UA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import hvplot.xarray\n\ndst.sel(gage_id='USGS-07241800').hvplot(x='time',y='streamflow', grid=True)\n## This select operator is a specific call to read data -- so may take a \n## moment to fetch the full time series for the specified gage. ","key":"pEiY68kyoQ"},{"type":"outputs","id":"2-1E2zAWsbdcgdYjSxY6O","children":[],"key":"K7Ga7ZIvrf"}],"key":"fzuAxARg2R"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"DONE","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZdFXC20LEc"}],"identifier":"done","label":"DONE","html_id":"done","implicit":true,"key":"BrJbQAoUbY"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"That dataset is now available for future analysis in which we need a consolidated NWIS\ndataset, chunked to optimize time-series analysis.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IJZyRFWurS"}],"key":"wM5fZMjv6W"}],"key":"dP4FKUYjul"}],"key":"c08h4puZu7"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Streamflow Model Evaluation","url":"/evaluation/tutorials/streamflow/overview","group":"Model Evaluation"},"next":{"title":"Streamflow Eval :: StdSuite Analysis","url":"/evaluation/tutorials/streamflow/analysis-stdsuite","group":"Model Evaluation"}}},"domain":"http://localhost:3005"},"project":{"title":"HyTEST Project","github":"https://github.com/hytest-org/hytest","copyright":"2023","toc":[{"file":"doc/About.md"},{"children":[{"children":[{"file":"environment_set_up/QuickStart-General.md"},{"file":"environment_set_up/QuickStart-Cloud-Nebari.md"},{"file":"environment_set_up/OpenOnDemand.md"},{"file":"environment_set_up/JupyterForward.md"},{"file":"environment_set_up/StartScript.md"}],"file":"environment_set_up/README.md"},{"file":"environment_set_up/Help_AWS_Credentials.ipynb"},{"children":[{"file":"environment_set_up/Start_Dask_Cluster_Nebari.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Denali.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Tallgrass.ipynb"},{"file":"environment_set_up/Start_Dask_Cluster_Desktop.ipynb"}],"file":"environment_set_up/clusters.md"}],"title":"Environment Set-Up"},{"children":[{"children":[{"file":"essential_reading/ReadingsTutorials.md"}],"file":"essential_reading/README.md"},{"children":[{"file":"essential_reading/DataSources/Data_APIs.md"},{"file":"essential_reading/DataSources/Data_S3.md"}],"file":"essential_reading/DataSources/README.md"},{"file":"essential_reading/Parallel_Dask.ipynb"}],"title":"Getting Started"},{"children":[{"children":[{"file":"dataset_catalog/storage_locations.md"},{"file":"dataset_catalog/STAC.ipynb"},{"file":"dataset_catalog/intake.md"},{"file":"dataset_catalog/subcatalogs/README.md"}],"file":"dataset_catalog/README.md"},{"children":[{"file":"dataset_access/CONUS404_CHANGELOG.md"},{"file":"dataset_access/conus404_explore.ipynb"}],"file":"dataset_access/CONUS404_ACCESS.md"}],"title":"Dataset Access"},{"children":[{"file":"dataset_processing/tutorials/chunking/README.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/101/WhyChunk.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/ExamineDataChunking.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/BasicsShapeSize.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/WriteChunkedFiles.ipynb"},{"file":"dataset_processing/tutorials/chunking/101/Rechunking.ipynb"}],"file":"dataset_processing/tutorials/chunking/101/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/201/RechunkingwithDask.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/CreateVirtualZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/IncludeCRSinZarr.ipynb"},{"file":"dataset_processing/tutorials/chunking/201/OptimalChunkSelection.ipynb"}],"file":"dataset_processing/tutorials/chunking/201/index.md"},{"children":[{"file":"dataset_processing/tutorials/chunking/back/Glossary.md"},{"file":"dataset_processing/tutorials/chunking/back/AdditionalResources.md"}],"file":"dataset_processing/tutorials/chunking/back/index.md"}],"title":"Zarr Creation"},{"children":[{"file":"dataset_processing/tutorials/conus404_temporal_aggregation.ipynb"},{"children":[{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_DRB.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_GFv1_1.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_WBD12.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation.ipynb"},{"file":"dataset_processing/tutorials/spatial_aggregation/conus404_spatial_aggregation_comparison.ipynb"}],"file":"dataset_processing/spatial_aggregation.md"},{"file":"dataset_processing/tutorials/conus404_point_selection.ipynb"},{"file":"dataset_processing/tutorials/conus404_regrid.ipynb"}],"title":"Dataset Processing"},{"children":[{"children":[{"file":"evaluation/Metrics_DScore_Suite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_DScore_Suite_v1.ipynb"},{"file":"evaluation/Metrics_StdSuite_v1.ipynb"},{"file":"evaluation/tutorials/stats_demos/Usage_StdSuite_v1.ipynb"}],"file":"evaluation/metrics.md"},{"children":[{"file":"evaluation/tutorials/streamflow/01_Data_Prep.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_StdSuite.ipynb"},{"file":"evaluation/tutorials/streamflow/02_Analysis_DScore.ipynb"},{"file":"evaluation/tutorials/streamflow/03_Vizualization.ipynb"}],"file":"evaluation/tutorials/streamflow/00_Overview.md"}],"title":"Model Evaluation"},{"children":[{"file":"CONTRIBUTING.md"},{"file":"LICENSE.md"}],"title":"Back Matter"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Environment Set-Up"},{"slug":"environment-set-up.readme","title":"Compute Environments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.quickstart-general","title":"General QuickStart","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.quickstart-cloud-nebari","title":"Cloud: Nebari Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.openondemand","title":"HPC Server: Open OnDemand Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.jupyterforward","title":"HPC Server: Jupyter Forward Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.startscript","title":"HPC Server: Start Script Quick-Start","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.help-aws-credentials","title":"AWS Credentials","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.clusters","title":"Starting a Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"environment-set-up.start-dask-cluster-nebari","title":"Nebari Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-denali","title":"Denali HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-tallgrass","title":"Hovenweep/Tallgrass HPC Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"environment-set-up.start-dask-cluster-desktop","title":"Local Desktop Dask Cluster","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Getting Started"},{"slug":"essential-reading.readme","title":"Essential Reading","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.readingstutorials","title":"Foundations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.readme","title":"Data Sources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"essential-reading.datasources.data-apis","title":"Data/APIs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.datasources.data-s3","title":"Data/Cloud Storage","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"essential-reading.parallel-dask","title":"Parallelism with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Dataset Access"},{"slug":"dataset-catalog.readme","title":"Data Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-catalog.storage-locations","title":"Data Storage Locations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.stac","title":"Water Mission Area STAC Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.intake","title":"HyTEST Data Catalog (Intake)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-catalog.subcatalogs.readme","title":"HyTEST Intake Sub-Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-access","title":"CONUS404 Products Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-access.conus404-changelog","title":"CONUS404 Zarr Changelog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-access.conus404-explore","title":"Explore CONUS404 Dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Zarr Creation"},{"slug":"dataset-processing.tutorials.chunking.readme","title":"Data Chunking Tutorial Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.index","title":"Introduction to Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.101.whychunk","title":"Why (re)Chunk Data?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.examinedatachunking","title":"How to Examine a Stored Dataset’s Chunk Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.basicsshapesize","title":"Basics of Chunk Shape and Size","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.writechunkedfiles","title":"Writing Chunked Files","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.101.rechunking","title":"Rechunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.index","title":"Advanced Topics in Chunking","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.201.rechunkingwithdask","title":"Rechunking Larger Datasets with Dask","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.createvirtualzarr","title":"Generating a Virtual Zarr Store","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.includecrsinzarr","title":"Adding Coordinate Reference Systems (CRS) to Zarr Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.201.optimalchunkselection","title":"Choosing an Optimal Chunk Size and Shape","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.index","title":"Chunking References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.chunking.back.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.chunking.back.additionalresources","title":"Additional Resources","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Dataset Processing"},{"slug":"dataset-processing.tutorials.conus404-temporal-aggregation","title":"CONUS404 Temporal Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.spatial-aggregation","title":"Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-drb","title":"gdptools CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-gfv1-1","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent GFv1.1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-wbd12","title":"gdptools CONUS404 Spatial Aggregation over CONUS-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation","title":"Pangeo CONUS404 Spatial Aggregation over DRB-extent HUC12s","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.spatial-aggregation.conus404-spatial-aggregation-comparison","title":"gdptools-Pangeo Method Comparison for CONUS404 Spatial Aggregation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"dataset-processing.tutorials.conus404-point-selection","title":"CONUS404 Site Data Selection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dataset-processing.tutorials.conus404-regrid","title":"CONUS404 Regridding (Curvilinear =\u003e Rectilinear)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Model Evaluation"},{"slug":"evaluation.metrics","title":"Evaluation Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.metrics-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-dscore-suite-v1","title":"D-Score Suite (v1) Benchmark -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.metrics-stdsuite-v1","title":"Standard Suite (v1) Metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.stats-demos.usage-stdsuite-v1","title":"Standard Suite (v1) Metrics -- Usage Examples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.overview","title":"Streamflow Model Evaluation","description":"","date":"","thumbnail":"/hytest//build/Eval_Overview-29b9b051cf5b081af64c0ddd303c6d0a.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"evaluation.tutorials.streamflow.data-prep","title":"Streamflow Eval :: Data Preparation","description":"","date":"","thumbnail":"/hytest//build/Eval_PreProc-e7e95e0745be409b1f1508ad2e2ff8c5.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-stdsuite","title":"Streamflow Eval :: StdSuite Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.analysis-dscore","title":"Steamflow Eval :: DScore Analysis","description":"","date":"","thumbnail":"/hytest//build/Eval_Analysis-eb8e65bd4b4cb18860a5d6d1ad2f987f.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"evaluation.tutorials.streamflow.vizualization","title":"Streamflow Eval :: Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Back Matter"},{"slug":"contributing","title":"Contributing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"license","title":"License","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hytest//build/manifest-5D5D9E8C.js";
import * as route0 from "/hytest//build/root-AA24SA6C.js";
import * as route1 from "/hytest//build/routes/$-5SFLQWPV.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hytest//build/entry.client-PCJPW7TK.js");</script></body></html>