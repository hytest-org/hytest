Traceback (most recent call last):
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/jupyter_core/utils/__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/jupyter_core/utils/__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------

wbd = gh.WBD("huc4")
del_huc4 = wbd.byids(field="huc4", fids="0204")
huc12_basins = WaterData('wbd12').bygeom(del_huc4.geometry[0])
filtered_gdf = huc12_basins[huc12_basins['huc12'].str.startswith(('020401', '020402'))]
filtered_gdf
------------------


[31m---------------------------------------------------------------------------[39m
[31mJSONDecodeError[39m                           Traceback (most recent call last)
[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/_utils.py:160[39m, in [36mretriever[39m[34m(uid, url, s_kwds, session, read_type, r_kwds, raise_status)[39m
[32m    159[39m [38;5;28;01mtry[39;00m:
[32m--> [39m[32m160[39m     [38;5;28;01mreturn[39;00m uid, [38;5;28;01mawait[39;00m [38;5;28mgetattr[39m(response, read_type)(**r_kwds)
[32m    161[39m [38;5;28;01mexcept[39;00m [38;5;167;01mUnicodeDecodeError[39;00m:

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/aiohttp/client_reqrep.py:766[39m, in [36mClientResponse.json[39m[34m(self, encoding, loads, content_type)[39m
[32m    764[39m     encoding = [38;5;28mself[39m.get_encoding()
[32m--> [39m[32m766[39m [38;5;28;01mreturn[39;00m [43mloads[49m[43m([49m[43mstripped[49m[43m.[49m[43mdecode[49m[43m([49m[43mencoding[49m[43m)[49m[43m)[49m

[31mJSONDecodeError[39m: unexpected character: line 1 column 1 (char 0)

The above exception was the direct cause of the following exception:

[31mServiceError[39m                              Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[3][39m[32m, line 2[39m
[32m      1[39m wbd = gh.WBD([33m"[39m[33mhuc4[39m[33m"[39m)
[32m----> [39m[32m2[39m del_huc4 = [43mwbd[49m[43m.[49m[43mbyids[49m[43m([49m[43mfield[49m[43m=[49m[33;43m"[39;49m[33;43mhuc4[39;49m[33;43m"[39;49m[43m,[49m[43m [49m[43mfids[49m[43m=[49m[33;43m"[39;49m[33;43m0204[39;49m[33;43m"[39;49m[43m)[49m
[32m      3[39m huc12_basins = WaterData([33m'[39m[33mwbd12[39m[33m'[39m).bygeom(del_huc4.geometry[[32m0[39m])
[32m      4[39m filtered_gdf = huc12_basins[huc12_basins[[33m'[39m[33mhuc12[39m[33m'[39m].str.startswith(([33m'[39m[33m020401[39m[33m'[39m, [33m'[39m[33m020402[39m[33m'[39m))]

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/pynhd/core.py:244[39m, in [36mAGRBase.byids[39m[34m(self, field, fids, return_m, return_geom)[39m
[32m    219[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mbyids[39m(
[32m    220[39m     [38;5;28mself[39m,
[32m    221[39m     field: [38;5;28mstr[39m,
[32m   (...)[39m[32m    224[39m     return_geom: [38;5;28mbool[39m = [38;5;28;01mTrue[39;00m,
[32m    225[39m ) -> gpd.GeoDataFrame:
[32m    226[39m [38;5;250m    [39m[33;03m"""Get features based on a list of field IDs.[39;00m
[32m    227[39m 
[32m    228[39m [33;03m    Parameters[39;00m
[32m   (...)[39m[32m    242[39m [33;03m        The requested features as a GeoDataFrame.[39;00m
[32m    243[39m [33;03m    """[39;00m
[32m--> [39m[32m244[39m     oids = [38;5;28;43mself[39;49m[43m.[49m[43mclient[49m[43m.[49m[43moids_byfield[49m[43m([49m[43mfield[49m[43m,[49m[43m [49m[43mfids[49m[43m)[49m
[32m    245[39m     [38;5;28;01mreturn[39;00m [38;5;28mself[39m._getfeatures(oids, return_m, return_geom)

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/pygeoogc/pygeoogc.py:202[39m, in [36mArcGISRESTful.oids_byfield[39m[34m(self, field, ids)[39m
[32m    199[39m [38;5;28;01melse[39;00m:
[32m    200[39m     fids = [33m"[39m[33m, [39m[33m"[39m.join([38;5;28mstr[39m(i) [38;5;28;01mfor[39;00m i [38;5;129;01min[39;00m ids_ls)
[32m--> [39m[32m202[39m [38;5;28;01mreturn[39;00m [38;5;28;43mself[39;49m[43m.[49m[43moids_bysql[49m[43m([49m[33;43mf[39;49m[33;43m"[39;49m[38;5;132;43;01m{[39;49;00m[43mfield[49m[38;5;132;43;01m}[39;49;00m[33;43m IN ([39;49m[38;5;132;43;01m{[39;49;00m[43mfids[49m[38;5;132;43;01m}[39;49;00m[33;43m)[39;49m[33;43m"[39;49m[43m)[49m

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/pygeoogc/pygeoogc.py:233[39m, in [36mArcGISRESTful.oids_bysql[39m[34m(self, sql_clause)[39m
[32m    225[39m payload = {
[32m    226[39m     [33m"[39m[33mwhere[39m[33m"[39m: sql_clause,
[32m    227[39m     [33m"[39m[33mreturnGeometry[39m[33m"[39m: [33m"[39m[33mfalse[39m[33m"[39m,
[32m    228[39m     [33m"[39m[33mreturnIdsOnly[39m[33m"[39m: [33m"[39m[33mtrue[39m[33m"[39m,
[32m    229[39m     [33m"[39m[33mf[39m[33m"[39m: [38;5;28mself[39m.client.outformat,
[32m    230[39m }
[32m    231[39m [38;5;28mself[39m.client.request_id = uuid.uuid4().hex
[32m--> [39m[32m233[39m resp = [38;5;28;43mself[39;49m[43m.[49m[43mclient[49m[43m.[49m[43mget_response[49m[43m([49m[38;5;28;43mself[39;49m[43m.[49m[43mclient[49m[43m.[49m[43mquery_url[49m[43m,[49m[43m [49m[43m[[49m[43mpayload[49m[43m][49m[43m,[49m[43m [49m[43mmethod[49m[43m=[49m[33;43m"[39;49m[33;43mPOST[39;49m[33;43m"[39;49m[43m)[49m[[32m0[39m]
[32m    234[39m [38;5;28;01mtry[39;00m:
[32m    235[39m     [38;5;28;01mreturn[39;00m [38;5;28mself[39m.partition_oids(resp[[33m"[39m[33mobjectIds[39m[33m"[39m])

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/pygeoogc/core.py:342[39m, in [36mArcGISRESTfulBase.get_response[39m[34m(self, url, payloads, method)[39m
[32m    340[39m req_key = [33m"[39m[33mparams[39m[33m"[39m [38;5;28;01mif[39;00m method [38;5;129;01min[39;00m ([33m"[39m[33mGET[39m[33m"[39m, [33m"[39m[33mget[39m[33m"[39m) [38;5;28;01melse[39;00m [33m"[39m[33mdata[39m[33m"[39m
[32m    341[39m [38;5;28;01mtry[39;00m:
[32m--> [39m[32m342[39m     resp = [43mar[49m[43m.[49m[43mretrieve_json[49m[43m([49m
[32m    343[39m [43m        [49m[43m[[49m[43murl[49m[43m][49m[43m [49m[43m*[49m[43m [49m[38;5;28;43mlen[39;49m[43m([49m[43mpayloads[49m[43m)[49m[43m,[49m
[32m    344[39m [43m        [49m[43m[[49m[43m{[49m[43mreq_key[49m[43m:[49m[43m [49m[43mp[49m[43m}[49m[43m [49m[38;5;28;43;01mfor[39;49;00m[43m [49m[43mp[49m[43m [49m[38;5;129;43;01min[39;49;00m[43m [49m[43mpayloads[49m[43m][49m[43m,[49m
[32m    345[39m [43m        [49m[43mrequest_method[49m[43m=[49m[43mmethod[49m[43m,[49m
[32m    346[39m [43m    [49m[43m)[49m
[32m    347[39m     resp = cast([33m"[39m[33mlist[dict[str, Any]][39m[33m"[39m, resp)
[32m    348[39m [38;5;28;01mexcept[39;00m [38;5;167;01mValueError[39;00m [38;5;28;01mas[39;00m ex:

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/async_retriever.py:388[39m, in [36mretrieve_json[39m[34m(urls, request_kwds, request_method, limit_per_host, cache_name, timeout, expire_after, ssl, disable, raise_status)[39m
[32m    326[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mretrieve_json[39m(
[32m    327[39m     urls: Sequence[StrOrURL],
[32m    328[39m     request_kwds: Sequence[[38;5;28mdict[39m[[38;5;28mstr[39m, Any]] | [38;5;28;01mNone[39;00m = [38;5;28;01mNone[39;00m,
[32m   (...)[39m[32m    336[39m     raise_status: [38;5;28mbool[39m = [38;5;28;01mTrue[39;00m,
[32m    337[39m ) -> [38;5;28mlist[39m[[38;5;28mdict[39m[[38;5;28mstr[39m, Any] | [38;5;28;01mNone[39;00m] | [38;5;28mlist[39m[[38;5;28mlist[39m[[38;5;28mdict[39m[[38;5;28mstr[39m, Any]] | [38;5;28;01mNone[39;00m]:
[32m    338[39m [38;5;250m    [39m[33mr[39m[33;03m"""Send async requests and get the response as ``json``.[39;00m
[32m    339[39m 
[32m    340[39m [33;03m    Parameters[39;00m
[32m   (...)[39m[32m    386[39m [33;03m    2675320[39;00m
[32m    387[39m [33;03m    """[39;00m
[32m--> [39m[32m388[39m     [38;5;28;01mreturn[39;00m [43mretrieve[49m[43m([49m[43m  [49m[38;5;66;43;03m# pyright: ignore[reportReturnType][39;49;00m
[32m    389[39m [43m        [49m[43murls[49m[43m,[49m
[32m    390[39m [43m        [49m[33;43m"[39;49m[33;43mjson[39;49m[33;43m"[39;49m[43m,[49m
[32m    391[39m [43m        [49m[43mrequest_kwds[49m[43m,[49m
[32m    392[39m [43m        [49m[43mrequest_method[49m[43m,[49m
[32m    393[39m [43m        [49m[43mlimit_per_host[49m[43m,[49m
[32m    394[39m [43m        [49m[43mcache_name[49m[43m,[49m
[32m    395[39m [43m        [49m[43mtimeout[49m[43m,[49m
[32m    396[39m [43m        [49m[43mexpire_after[49m[43m,[49m
[32m    397[39m [43m        [49m[43mssl[49m[43m,[49m
[32m    398[39m [43m        [49m[43mdisable[49m[43m,[49m
[32m    399[39m [43m        [49m[43mraise_status[49m[43m,[49m
[32m    400[39m [43m    [49m[43m)[49m

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/async_retriever.py:220[39m, in [36mretrieve[39m[34m(urls, read_method, request_kwds, request_method, limit_per_host, cache_name, timeout, expire_after, ssl, disable, raise_status)[39m
[32m    217[39m     disable = os.getenv([33m"[39m[33mHYRIVER_CACHE_DISABLE[39m[33m"[39m, [33m"[39m[33mfalse[39m[33m"[39m).lower() == [33m"[39m[33mtrue[39m[33m"[39m
[32m    219[39m [38;5;28;01mif[39;00m disable:
[32m--> [39m[32m220[39m     results = [43mutils[49m[43m.[49m[43mrun_in_event_loop[49m[43m([49m
[32m    221[39m [43m        [49m[43m_session_without_cache[49m[43m([49m
[32m    222[39m [43m            [49m[43minp[49m[43m.[49m[43murl_kwds[49m[43m,[49m
[32m    223[39m [43m            [49m[43minp[49m[43m.[49m[43mread_method[49m[43m,[49m
[32m    224[39m [43m            [49m[43minp[49m[43m.[49m[43mr_kwds[49m[43m,[49m
[32m    225[39m [43m            [49m[43minp[49m[43m.[49m[43mrequest_method[49m[43m,[49m
[32m    226[39m [43m            [49m[43mssl[49m[43m,[49m
[32m    227[39m [43m            [49m[43mraise_status[49m[43m,[49m
[32m    228[39m [43m            [49m[43mlimit_per_host[49m[43m,[49m
[32m    229[39m [43m            [49m[43mtimeout[49m[43m,[49m
[32m    230[39m [43m        [49m[43m)[49m
[32m    231[39m [43m    [49m[43m)[49m
[32m    232[39m [38;5;28;01melse[39;00m:
[32m    233[39m     results = utils.run_in_event_loop(
[32m    234[39m         _session_with_cache(
[32m    235[39m             inp.url_kwds,
[32m   (...)[39m[32m    245[39m         )
[32m    246[39m     )

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/_utils.py:99[39m, in [36mrun_in_event_loop[39m[34m(coro)[39m
[32m     97[39m [38;5;250m[39m[33;03m"""Run a coroutine in the dedicated asyncio event loop."""[39;00m
[32m     98[39m handler = _get_loop_handler()
[32m---> [39m[32m99[39m [38;5;28;01mreturn[39;00m [43masyncio[49m[43m.[49m[43mrun_coroutine_threadsafe[49m[43m([49m[43mcoro[49m[43m,[49m[43m [49m[43mhandler[49m[43m.[49m[43mloop[49m[43m)[49m[43m.[49m[43mresult[49m[43m([49m[43m)[49m

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/concurrent/futures/_base.py:456[39m, in [36mFuture.result[39m[34m(self, timeout)[39m
[32m    454[39m     [38;5;28;01mraise[39;00m CancelledError()
[32m    455[39m [38;5;28;01melif[39;00m [38;5;28mself[39m._state == FINISHED:
[32m--> [39m[32m456[39m     [38;5;28;01mreturn[39;00m [38;5;28;43mself[39;49m[43m.[49m[43m__get_result[49m[43m([49m[43m)[49m
[32m    457[39m [38;5;28;01melse[39;00m:
[32m    458[39m     [38;5;28;01mraise[39;00m [38;5;167;01mTimeoutError[39;00m()

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/concurrent/futures/_base.py:401[39m, in [36mFuture.__get_result[39m[34m(self)[39m
[32m    399[39m [38;5;28;01mif[39;00m [38;5;28mself[39m._exception:
[32m    400[39m     [38;5;28;01mtry[39;00m:
[32m--> [39m[32m401[39m         [38;5;28;01mraise[39;00m [38;5;28mself[39m._exception
[32m    402[39m     [38;5;28;01mfinally[39;00m:
[32m    403[39m         [38;5;66;03m# Break a reference cycle with the exception in self._exception[39;00m
[32m    404[39m         [38;5;28mself[39m = [38;5;28;01mNone[39;00m

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/async_retriever.py:140[39m, in [36m_session_without_cache[39m[34m(url_kwds, read, r_kwds, request_method, ssl, raise_status, limit_per_host, timeout)[39m
[32m    133[39m request_func = [38;5;28mgetattr[39m(session, request_method.lower())
[32m    134[39m tasks = [
[32m    135[39m     utils.retriever(
[32m    136[39m         uid, url, {[33m"[39m[33mtimeout[39m[33m"[39m: timeout, **kwds}, request_func, read, r_kwds, raise_status
[32m    137[39m     )
[32m    138[39m     [38;5;28;01mfor[39;00m uid, url, kwds [38;5;129;01min[39;00m url_kwds
[32m    139[39m ]
[32m--> [39m[32m140[39m [38;5;28;01mreturn[39;00m [38;5;28;01mawait[39;00m asyncio.gather(*tasks)

[36mFile [39m[32m/home/conda/hytest/f9b85f69-1756479041-247-pangeo/lib/python3.11/site-packages/async_retriever/_utils.py:165[39m, in [36mretriever[39m[34m(uid, url, s_kwds, session, read_type, r_kwds, raise_status)[39m
[32m    163[39m [38;5;28;01mexcept[39;00m (ClientResponseError, [38;5;167;01mValueError[39;00m) [38;5;28;01mas[39;00m ex:
[32m    164[39m     [38;5;28;01mif[39;00m raise_status:
[32m--> [39m[32m165[39m         [38;5;28;01mraise[39;00m ServiceError([38;5;28;01mawait[39;00m response.text(), [38;5;28mstr[39m(response.url)) [38;5;28;01mfrom[39;00m[38;5;250m [39m[34;01mex[39;00m
[32m    166[39m     [38;5;28;01mreturn[39;00m uid, [38;5;28;01mNone[39;00m

[31mServiceError[39m: Service returned the following error message:
URL: https://hydro.nationalmap.gov/arcgis/rest/services/wbd/MapServer/2/query
ERROR: <html>
<head><title>504 Gateway Time-out</title></head>
<body>
<center><h1>504 Gateway Time-out</h1></center>
</body>
</html>



